---
title: "Total_SC"
author: "April Peterson"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '5'
    toc_float: yes
  pdf_document: default
  
---


```{r setup, echo=FALSE, warning=FALSE, include = FALSE}
library(ggplot2)
library(plyr)
library(dplyr)
library(tidyr)
library(xlsx)

#load main MLH1 files to merge MLH1 cell data with the sc data 
setwd("~./")

load(file="~./MLH1repo/data/MLH1/MLH1_data_setup_5.12.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#most recent 

# Total.SC
# input: output from RW SC_skel run over Anon_Data images. The file names are random
# output: DFs of merged MLH1 and Skel data, cell and mouse levels

#these data generated by running "python script --, it should be re-run when new cells are added to the anon.csv file
#SC.skel = read.csv("~./MLH1repo/data/SCskel_output_nov19.csv", header = TRUE, strip.white = TRUE)

#SC.skel = read.csv("~./MLH1repo/data/SCskel_output_feb20.csv", header = TRUE, strip.white = TRUE)

Total.SC_DF = read.xlsx2("~./MLH1repo/data/Total.SC_merge.MLH1.xlsx", header=TRUE, 1)

#this most recent version -- is missing most measures for MOLF_m
```


Read in most recent output, remove the outliers (by strain), WRITE out the excel file for the nice clean total sc file, output from RW SC_skel run over Anon_Data images. The file names are random  The Main dataframe is the Merge MLH1 + skel data.


## Running the Python Script Notes

Python -- apply to all images in the Anon folder (so all the random named image files)

(should I update all the crops? How many images need cropping)


merge the sc.skel outputs with the master MLH1 measures
match up random names with original names

the skel output and scripts are in the SC_skel dir. it was run on all images in the anon_data folder. 
I haven't manually confirmed that the default parameters are skeletonizing the images correctly.


# Clean Skel data

```{r clean.skel.data, echo=FALSE, warning=FALSE}

#format all factors to numbers
SC.skel$bin_size  <- as.character(SC.skel$bin_size )
SC.skel$skel_size  <- as.character(SC.skel$skel_size)

SC.skel$bin_size  <- as.numeric(SC.skel$bin_size )
SC.skel$skel_size <- as.numeric(SC.skel$skel_size)

SC.skel$rand_name <- as.character(SC.skel$rand_name)


#check for duplicatations of the random name
original_DF$Random.Name <- as.character(original_DF$Random.Name)
duplies <- original_DF[duplicated(original_DF$Random.Name),]
#3 duplicate rows in original DF -- because Random name was blank -- how will these be matched to total.SC?


```

```{r merge.MLH1.skel, echo=FALSE}

#MERGEING MLH1 with SKEL by Random.Name
MLH1.merge.Skel <- merge(original_DF, SC.skel, by.x = "Random.Name", by.y = "rand_name", all= F)
OG.MLH1.merge.Skel <- MLH1.merge.Skel #raw version of DF

#no filename in the skel output
#MLH1.merge.Skel.FF <- merge(original_DF, SC.skel, by.x = "fileName", by.y = "fileName", all= F)
#OG.MLH1.merge.Skel <- MLH1.merge.Skel #raw version of DF

```


#clean total.DF

Warning most of the number levels are factors, so to chanage to numbers -- they need to follow the order, factor -> chr -> number.

str(Total.SC_DF)#quality is a factor. must go factor - chr - number


```{r clean.total.DF, echo=FALSE}

#this is a nice merged excel file, still has X, and might have some 'outlier' images
Total.SC_DF.og <- Total.SC_DF
#quality is mess up here

Total.SC_DF$quality <- as.character(Total.SC_DF$quality)
Total.SC_DF$X <- as.character(Total.SC_DF$X)

#Total.SC_DF <- Total.SC_DF %>% filter(X != "X")
#remvove Xs
Total.SC_DF <- Total.SC_DF[ !grepl("X", Total.SC_DF$X) , ]
#Total.SC_DF$X <- droplevels(Total.SC_DF$X)

str(Total.SC_DF)
#check that there are only numbers in the quality
table(Total.SC_DF$quality)

#jj <- Total.SC_DF[ grepl("X", Total.SC_DF$X) , ]

#factor -> chr
Total.SC_DF$n <- as.character(Total.SC_DF$n)
Total.SC_DF$nMLH1.foci<- as.character(Total.SC_DF$nMLH1.foci)

Total.SC_DF$skel_size<- as.character(Total.SC_DF$skel_size)
Total.SC_DF$bin_size<- as.character(Total.SC_DF$bin_size)

#chr -> num
Total.SC_DF$quality<- as.numeric(Total.SC_DF$quality)
Total.SC_DF$n <- as.numeric(Total.SC_DF$n)
Total.SC_DF$nMLH1.foci<- as.numeric(Total.SC_DF$nMLH1.foci)

Total.SC_DF$skel_size<- as.numeric(Total.SC_DF$skel_size)
Total.SC_DF$bin_size<- as.numeric(Total.SC_DF$bin_size)


#table(Total.SC_DF$quality)

```


Total.SC has fewer cells than MLH1.merge (maybe the outliers have been removed). MLH1.merge has 'X'.


```{r check.DFs, echo=FALSE, eval=FALSE}

#compare the total.SC_DF

#MLH1.merge.Skel
#OG.MLH1.merge.Skel

#checking / comparing the two lists

DF.HetC.MixedModel.HQ$mouse

skel.mice_from.MM.DF <- OG.MLH1.merge.Skel[ OG.MLH1.merge.Skel$mouse %in% DF.HetC.MixedModel.HQ$mouse, ]
#1630

#some WSB females missing from DF.HETC.HQ

#compare this list to cells in whole cell / curate (why?)
#FOR COMPARISON ACROSS APPROACHES

#OG.MLH1.merge.Skel doesn't have '.tif' -- remove .tif to make matching easier
skel.mice_from.MM.DF$fileName <- as.character(skel.mice_from.MM.DF$fileName)

for(j in 1:length(skel.mice_from.MM.DF$fileName)){
  print(j) 
  #MLH1_data$quant_status[i] <- ifelse( is.element(MLH1_data$mouse[i], pass_mice), "pass", NA)
   templist2 = strsplit(skel.mice_from.MM.DF$fileName[j], split='.tif')[[1]]
   #print(templist2)
   skel.mice_from.MM.DF$fileName2[j] = templist2
}
#this loop puts list in fileName2


skel.mice_from.MM.DF$og.fileName <- skel.mice_from.MM.DF$fileName
skel.mice_from.MM.DF <- skel.mice_from.MM.DF %>% separate(fileName, c("fileName3","blah"),'.tif')


#cell level data, MLH1 and skel
DF <- skel.mice_from.MM.DF[ skel.mice_from.MM.DF$fileName3 %in% Curated_BivData$fileName, ]#415
#above is the DF which there are cell which have been curated (and there is total.sc data)
#how to merge the biv level data..?

#number of bivs curated?

SC.pass_table <- ddply(.data=Curated_BivData, 
                 .(fileName),
                 summarize, 
                 n.SC.pacc.bivs = length(unique(Obj.ID))
                 
)
#the PWD and KAZ duplicate mice will have more than 20 -- remove them

SC.pass_table <- add_mouse(SC.pass_table)
#SC.pass_table <- add_strain(SC.pass_table)
#SC.pass_table <- add_sex(SC.pass_table)
#SC.pass_table <- add_category(SC.pass_table)

DF$fileName <- DF$fileName3

#with mouse, merge to DF
DF.2 <- merge(DF, SC.pass_table, by = "fileName", all.y = FALSE, no.dups = TRUE )
#not merging because of silly / weird list thing

DF.2 <- DF.2[ -c(14,15,20,23,21) ]
DF.2$mouse <- DF.2$mouse.x

DF.2 <- add_strain(DF.2)
DF.2 <- add_sex(DF.2)
DF.2 <- add_category(DF.2)

table(DF.2$category)


this.plot <- ggplot(DF.2, aes(n.SC.pacc.bivs)) + geom_histogram(bins = 40)+ facet_wrap(~category)+ggtitle("Number of curated bivs per image")

this.plot_WSB.female <- ggplot(DF.2[DF.2$category == "WSB female",], aes(n.SC.pacc.bivs)) + geom_histogram(bins = 40)+ facet_wrap(~mouse)+ggtitle("Number of curated bivs per image")


```



```{r cleaning.up.MLH1.merge, echo=FALSE, eval=FALSE}

#clean up this DataFrame REMOVE 'X'
MLH1.merge.Skel <- MLH1.merge.Skel[ !grepl("X", MLH1.merge.Skel$Batch) , ]
MLH1.merge.Skel <- MLH1.merge.Skel[ !grepl("x", MLH1.merge.Skel$X) , ]
MLH1.merge.Skel <- MLH1.merge.Skel[ !grepl("X", MLH1.merge.Skel$X) , ]
MLH1.merge.Skel <- MLH1.merge.Skel[!(is.na(MLH1.merge.Skel$quality) | MLH1.merge.Skel$quality==""), ]

MLH1.merge.Skel <- add_mouse(MLH1.merge.Skel)
MLH1.merge.Skel <- add_strain(MLH1.merge.Skel)
MLH1.merge.Skel <- add_sex(MLH1.merge.Skel)

MLH1.merge.Skel <- add_category(MLH1.merge.Skel)
MLH1.merge.Skel <- add_subsp(MLH1.merge.Skel)

#where does this DF come from?
#mlh1.skel.og <- add_euth_date(mlh1.skel.og)
#mlh1.skel.og <- add_age(mlh1.skel.og)
#str(mlh1.skel.og)

MLH1.merge.Skel$nMLH1.foci <- as.character(MLH1.merge.Skel$nMLH1.foci)
MLH1.merge.Skel$nMLH1.foci <- as.numeric(MLH1.merge.Skel$nMLH1.foci)



#keep list of outliers (need to adjust threshold with lastest batch)
Total.SC.above.threshold <- MLH1.merge.Skel[MLH1.merge.Skel$skel_size > 25000,]
#remove outliers 
MLH1.merge.Skel <- MLH1.merge.Skel[MLH1.merge.Skel$skel_size < 25000,]

```


# Check Duplicates


```{r Duplicates, echo=FALSE, eval=FALSE}

Total.SC_DF_DUP.list <- Total.SC_DF[duplicated(Total.SC_DF$Random.Name),]
Total.SC_DF_DUP.list <- Total.SC_DF[duplicated(Total.SC_DF$fileName),]
#no Duplicates in total.SC


MLH1.merge.Skel_DUP.list <- MLH1.merge.Skel[duplicated(MLH1.merge.Skel$Random.Name),]
MLH1.merge.Skel_DUP.list <- MLH1.merge.Skel[duplicated(MLH1.merge.Skel$fileName),]

kk <- MLH1.merge.Skel$fileName[duplicated(MLH1.merge.Skel$fileName)]
```

total.SC doesn't have duplicates

# Remove Outliers

below are the list of cell images which have been removed because they look like outliers compared to other cells from that mouse.


Total.SC_DF  vs  MLH1.merge.Skel,  I think these both have outliers.


```{r totSC.viz4outliers, echo=FALSE}

# -- EXAMINE the ggplot scatter plots for outliers
#tot.sc <- ggplot(data= MLH1.merge.Skel, aes(y = bin_size, x=strain))+ #geom_jitter()+facet_wrap(~category, scales = "free")

#round 1
SC.skel.outliers_round1 <- c(
  #MLH1.merge.Skel  %>% filter(category == "WSB male") %>% filter(skel_size > 2000)
  "10apr15_31mar15_WSB_m3_sp1_4_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "WSB female") %>% filter(skel_size > 2700)       
            "17nov16_3nov15_WSB_f1_sp3_4_rev.tif","1may16_3nov15_WSB_f1_sp2_6_rev.tif",
                      
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 20000) 
                      "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000) 
              "1mar16_20feb16_G_f3_sp1_8_rev.tif","21nov16_16jan16_G_f2_sp1_15_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW male") %>% filter(skel_size < 1000)          
          "6mar18_1feb18_LEW_m1_sp1_21.5_rev",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW female") %>% filter(skel_size > 20000)   
          "12jan17_4jan17_LEW_f1_sp1_32_rev.tif","20mar17_13jan17_LEW_f2_sp1_12_rev.tif","9apr18_1feb18_LEW_f1_sp1_23_rev.tif","9apr18_1feb18_LEW_f1_sp1_12_rev.tif", 
                      
       #MLH1.merge.Skel  %>% filter(category == "PWD male") %>% filter(skel_size > 20000)  
                      "6mar15_1mar15_PWD_m1_sp4_6.1_rev.tif","7mar15_1mar15_PWD_m1_sp4_2_rev.tif","20jul15_18may15_PWD_m2_sp1_10.2_rev.tif",
           
   #MLH1.merge.Skel  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
   "6may15_17apr15_PWD_f1_sp1_7_rev",  
       
      #MLH1.merge.Skel  %>% filter(category == "KAZ male") %>% filter(skel_size < 1000)
            "6aug19_10jul19_KAZ_m1_sp1_7.1_rev.tif",
            
    # MLH1.merge.Skel  %>% filter(category == "KAZ female") %>% filter(skel_size > 30000)     
    "16feb18_1feb18_KAZ_f4_sp1_20_rev.tif",  "8feb18_1feb18_KAZ_f1_sp1_24_rev.tif",  
  "16feb18_1feb18_KAZ_f4_sp1_1_rev.tif",   "8feb18_1feb18_KAZ_f1_sp1_5_rev.tif",   
 "16feb18_1feb18_KAZ_f4_sp1_17_rev.tif",  "1mar18_1feb18_KAZ_f3_sp1_8_rev.tif",   
 "7feb18_11jan18_KAZ_f3_sp1_27_rev.tif",  "20apr18_11jan18_KAZ_f1_sp1_6_rev.tif", 
 "16feb18_1feb18_KAZ_f2_sp1_5.2_rev.tif", "16feb18_1feb18_KAZ_f2_sp1_15_rev.tif", 
"7feb18_11jan18_KAZ_f3_sp1_13_rev.tif",  "13apr18_1feb18_KAZ_f6_sp1_25_rev.tif" ,
            
  # MLH1.merge.Skel  %>% filter(category == "SKIVE female") %>% filter(skel_size > 10000)
    "10jun19_31may19_SKIVE_f6_sp1_47_rev.tif","10jun19_31may19_SKIVE_f6_sp1_7_rev.tif",

# MLH1.merge.Skel  %>% filter(category == "MOLF male") %>% filter(skel_size < 1200)
"4jun19_28sep18_MOLF_m1_sp1_10.1_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "AST male") %>% filter(skel_size > 2100)
"16aug19_27aug18_AST_m1_sp1_23_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "MSM female") %>% filter(skel_size > 20000)
"21nov17_16nov17_MSM_f3_sp1_24_rev.tif","21nov17_16nov17_MSM_f3_sp1_3_rev.tif", "21nov17_16nov17_MSM_f3_sp1_27_rev.tif","4dec17_16nov17_MSM_f2_sp1_10_rev.tif",
"5aug17_14jul17_MSM_f1_sp1_25_rev.tif","24jan18_31dec17_MSM_f3_sp1_3_rev.tif", 
"24jan18_31dec17_MSM_f3_sp1_22_rev.tif","21nov17_16nov17_MSM_f3_sp1_17_rev.tif",

#tt <- MLH1.merge.Skel  %>% filter(category == "SPIC female") %>% filter(skel_size > 20000)
"27dec17_4dec17_SPIC_f1_sp1_12_rev.tif",  "5apr18_31dec17_SPIC_f2_sp1_1_rev.tif",
 "26sep18_30may18_SPIC_f4_sp1_14_rev.tif", "4feb18_31dec17_SPIC_f1_sp1_21_rev.tif", 
 "5apr18_31dec17_SPIC_f2_sp1_22_rev.tif",  "27dec17_4dec17_SPIC_f1_sp1_40_rev.tif", 
 "4jul18_30may18_SPIC_f1_sp1_6_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_6_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_10_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_37_rev.tif" , 
 "5sep17_21aug17_SPI_f2_sp1_15_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_24_rev.tif",
"29dec17_4dec17_SPIC_f2_sp1_16_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_30_rev.tif",  
"4feb18_31dec17_SPIC_f1_sp1_5_rev.tif",   "5apr18_31dec17_SPIC_f2_sp1_25_rev.tif", 
 "26sep18_30may18_SPIC_f4_sp1_4_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_22_rev.tif",  
 "5sep17_21aug17_SPI_f2_sp1_19_rev.tif",   "5sep17_21aug17_SPI_f2_sp1_29_rev.tif",  
 "26sep18_30may18_SPIC_f4_sp1_3_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_5.2_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_6_rev.tif",   "13oct17_21aug17_SPI_f1_sp1_13_rev.tif"  )


MLH1.merge.Skel <- MLH1.merge.Skel[!MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1, ]#62 removed

remove.mice_round2 <- c(
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 2500)
    "28jul15_22jun15_G_m2_sp1_5_rev.tif","12may15_30sep14_G_m5_sp1_26_rev.tif",  
    
    #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000)
  "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
#MLH1.merge.Skel_2  %>% filter(category == "PWD male") %>% filter(skel_size > 2100)
"20jul15_18may15_PWD_m1_sp1_10_rev.tif","22mar15_10mar15_PWD_m2_sp1_11.2_rev.tif","22mar15_10mar15_PWD_m1_sp1_4.1_rev.tif","20jul15_18may15_PWD_m1_sp1_7.2_rev.tif",  

#MLH1.merge.Skel_2  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
  "6may15_17apr15_PWD_f1_sp1_7_rev.tif",
  
  #MLH1.merge.Skel_2  %>% filter(category == "KAZ female") %>% filter(skel_size < 1000)
  "8feb18_1feb18_KAZ_f1_sp1_19_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW male") %>% filter(skel_size < 1000 | skel_size > 1750)
"6mar18_1feb18_LEW_m1_sp1_10_rev.tif","3mar15_13jan17_LEW_m1_sp1_15_rev.tif", "4feb17_4jan17_LEW_m1_sp1_13_rev.tif","6mar18_1feb18_LEW_m1_sp1_21.5_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW female") %>% filter(skel_size > 2750 ) 
"20mar17_13jan17_LEW_f2_sp1_10_rev.tif",

# MLH1.merge.Skel_2  %>% filter(category == "CAROLI male") %>% filter(skel_size < 1400 )
"31aug18_1mar18_CAROLI_m1_sp3_29.2_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "MSM male") %>% filter(skel_size < 1200 )
"16aug17_5jul17_MSM_m1_sp1_6.1_rev.tif",

#tt <- MLH1.merge.Skel_2  %>% filter(category == "MSM female") %>% filter(skel_size > 2850 ) 
"29nov17_16nov17_MSM_f1_sp1_10_rev.tif", "4dec17_16nov17_MSM_f2_sp1_24_rev.tif", "21nov17_16nov17_MSM_f3_sp1_26_rev.tif",
#SPIC male  x
#SPIC female  x
#TOM x
#AST x
#CZECH male x 

#MLH1.merge.Skel_2  %>% filter(category == "SPRET male") %>% filter(skel_size < 1900 ) 
 "24may17_8may17_SPRET_m1_sp1_21.1_rev.tif",
#SPRET female X
#MLH1.merge.Skel_2  %>% filter(category == "HMI male") %>% filter(skel_size < 1000 ) 
"29dec17_4dec17_HMI_m1_sp1_4.1_rev.tif"
)
#3remove.mice_round2

MLH1.merge.Skel <- MLH1.merge.Skel[!MLH1.merge.Skel$fileName %in% remove.mice_round2, ]

#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1),]
#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% remove.mice_round2),]
all.remove <- paste( c(SC.skel.outliers_round1, remove.mice_round2 ) )

Total.SC_DF <- Total.SC_DF[!Total.SC_DF$fileName %in% SC.skel.outliers_round1, ]
Total.SC_DF <- Total.SC_DF[!Total.SC_DF$fileName %in% remove.mice_round2, ]
#sum( length(SC.skel.outliers_round1), length(remove.mice_round2) )
```

`r sum( length(SC.skel.outliers_round1), length(remove.mice_round2) )` images were removed as probable outliers.  ~20 outliers were removed from total.sc.skel.


```{r category.table, echo=FALSE, eval=FALSE}

#I should start inventory  how many mice are in each curated category
Skel.summary.table <- ddply(.data=skel.mice_from.MM.list, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci, na.rm = TRUE),
                 var.MLH1 = var(adj_nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)

#add strain, category, etc

  
```


# write table


```{r write.table, echo=FALSE, eval=FALSE}

#add categories and levels

#above threshold is bad,
#write out these cell's info so I can double check them.
#write.table(Total.SC.above.threshold, "~./MLH1repo/data/BivData/total_SC_above_threshold.csv", sep=",", row.names = FALSE)

#write.xlsx2(strain.table.HQ_Fig, "Main_MLH1_table2.xlsx", sheetName = "Sheet1", 
#            col.names = TRUE, row.names = FALSE, append = FALSE)

#write.table(MLH1.merge.Skel, "~./MLH1repo/data/BivData/total_SC_below_threshold.csv", sep=",", row.names = FALSE)

#Below threshold is are the values to use
write.xlsx2(Total.SC_DF, "Total.SC_DF.xlsx", sheetName = "Sheet1", 
            col.names = TRUE, row.names = FALSE, append = FALSE)

#merge skel has more observations (are they dups?)
#write.xlsx2(MLH1.merge.Skel, "Merge.MLH1.xlsx", sheetName = "Sheet1", 
#            col.names = TRUE, row.names = FALSE, append = FALSE)
```




# More Analysis

I noticed that these cells have the same bin sizes and skel sizes
this is written within RW's code

now there are quite a few cells above the threshold
table(Total.SC.above.threshold$category)
more female cells than male


to clean up the total SC data -- use the images with no in redo crop (400 vs 2500)
could also compare to quality =1 cells

```{r ploting, echo=FALSE, eval=FALSE}
Total.SC.box <- ggplot(data = MLH1.merge.Skel, aes(y=skel_size, x=strain, color=sex) ) + geom_boxplot()+ggtitle("Total SC Measures")

Total.SC.points <- ggplot(data = MLH1.merge.Skel, aes(y=skel_size, x=strain, color=sex) ) + 
  geom_jitter()+ggtitle("Total SC Measures")
```


 test if my score of crop, causes more noise / is a cleaner cell segment
for internal checking, not need to keep

 make tables of the means ect to measure how much change there is between these subseted data sets


```{r crop.stuff, echo=FALSE, eval=FALSE}

clean.crop <- MLH1.merge.Skel[MLH1.merge.Skel$REDO.crop == 'no',]
table(clean.crop$category)
table(MLH1.merge.Skel$category)

#WTF are these?
clean.crop.table <- ddply(.data=clean.crop, 
                             .(category),
                             summarize, 
                          #mean skel, mean binary, var for the two
                          n.obs = length(unique(Original.Name)),
                          mean.skel = mean(skel_size), 
                          mean.bin = mean(bin_size),
                          var.skel = var(skel_size),
                          var.bin = var(bin_size)
                          #ncells = length(unique(fileName)),
                             #nbivs = length(unique(Obj.ID))
)

not.clean.crop.table <- ddply(.data=MLH1.merge.Skel[!MLH1.merge.Skel$REDO.crop == 'no',], 
                          .(category),
                          summarize, 
                          #mean skel, mean binary, var for the two
                          n.obs = length(unique(Original.Name)),
                          mean.skel = mean(skel_size), 
                          mean.bin = mean(bin_size),
                          var.skel = var(skel_size),
                          var.bin = var(bin_size)
                          #ncells = length(unique(fileName)),
                          #nbivs = length(unique(Obj.ID))
                          
)

weee <- merge(clean.crop.table, not.clean.crop.table, by.x = 'category', by.y = 'category', all = FALSE)


```


table of clean crop stat, table of total (minus clean crop, stat, difference in means is the amount of error 

For some categories the difference is ~20% between the means
.. usuall difference means the croped version has less compared to other.

```{r more.plot, echo=FALSE, eval=FALSE}

weee$dif.skel.mean <-  ( (weee$mean.skel.x - weee$mean.skel.y) / weee$mean.skel.x ) *100
#what is this below

Total.SC.points2 <- ggplot(data = clean.crop, aes(y=skel_size, x=strain, color=sex) ) + 
  geom_jitter()+ggtitle("Total SC Measures, clean crops")

#str(MLH1.merge.Skel)
```


```{r table.making, echo=FALSE, eval=FALSE}
#mouse level
mouse.level.skel <- ddply(.data=MLH1.merge.Skel,
                          .(mouse),
                          summarize, 
                          ncells = length(unique(Original.Name)),
                          nmice = length(unique(mouse)),
                          mean.MLH1 = mean(nMLH1.foci, na.rm = TRUE),
                          mean.skel = mean(skel_size),
                          mean.bin = mean(bin_size)
)

mouse.level.skel <- add_strain(mouse.level.skel)
mouse.level.skel <- add_sex(mouse.level.skel)
mouse.level.skel <- add_category(mouse.level.skel)
mouse.level.skel <- add_subsp(mouse.level.skel)
```


```{r mouse.level.plot, echo=FALSE, warning=FALSE, eval=FALSE}

looky.mouse <- ggplot(data = mouse.level.skel[mouse.level.skel$subsp == "Musc",], aes(y=mean.skel, x=mean.MLH1, color=strain) ) + geom_jitter() +facet_wrap(subsp~sex) + ggtitle("")
looky.mouse

looky.mouseDom <- ggplot(data = mouse.level.skel[mouse.level.skel$subsp == "Dom",], aes(y=mean.skel, x=mean.MLH1, color=strain) ) + geom_jitter() + ylim(c(150,1200))+facet_wrap(subsp~sex) + ggtitle("")

#theme(legend.position="none") 
```


double check a way to visually inspect the python skel output

repeat random numbers?

some of richard's analysis show negative relationship with SC length and MLH1 (his QTL word doc). Could this be sign
 of pwd like regulation?

remove MLH1 tables since they overwrite other ones

remove plots, tables for internal checking
what to keep: SC.skel, OG.MLH1.merge.Skel, MLH1.merge.Skel, MLH1.merge.Skel.DUPs, mouse.level.skel



```{r saving.data, echo=FALSE}
rm(list=setdiff(ls(), c("SC.skel", "OG.MLH1.merge.Skel", "MLH1.merge.Skel", "MLH1.merge.Skel.DUPs","mouse.level.skel")))

#output: matched random names with real names.
#save RData file
#save.image("~./MLH1repo/data/total_SC_14.2.20.RData")

#changing to just loading the csv file

```

