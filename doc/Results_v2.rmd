---
title: "MLH1 Results Outline"
date: 'null'
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '5'
    toc_float: yes
  pdf_document: default
  word_document:
    toc: yes
    toc_depth: '5'
bibliography: refs_Main_Report.bib
---


```{r setup, echo=FALSE, include = FALSE}
library(knitr)
library(ggplot2)
#library(pwr)
library(plyr)
library(lattice)
library(dplyr)
library(raster)
library(lme4)
library(nlme)
library(RLRsim)
library(ggpubr)
library(reshape2)
#library(patchwork)

options(digits=2)

setwd("~.")#switch over to here()

load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_4.21.20.RData")
#load(file = "C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.31.20.RData")
#2.2.20
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")

load(file="~./MLH1repo/data/CleanBivData_6.3.20.RData")

load(file="~./MLH1repo/data/total_SC_30.12.19.RData")

#skeletonize
SC.skel = read.csv("~./MLH1repo/data/SCskel_output_feb20.csv", header = TRUE, strip.white = TRUE)

#load(file="~./MLH1repo/data/MLH1_data_setup_1.5.20.RData")

#setwd("~./MLH1repo/doc/")
#setwd("C:/Users/alpeterson7/Documents/MLH1repo/doc/")
#setwd("C:/Users/April/Documents/MLH1repo")
#load(file="data/MLH1/MLH1_data_setup.RData")

#load main data file
#load(file="C:/Users/April/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.5.20.RData")#added batch18
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")

#this MLH1 only goes up to batch16!
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#batch18
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#fixing bugs, formating


#load(file="data/MetaData.RData") #this was replacing most updated data file

#load functions
source("~./MLH1repo/src/CommonFunc_MLH1repo.R")
```

<!-- Data Set Up Notes -->

```{r organizing.data, echo=FALSE }
#set the order of another column, based on another variable. consistant order for ploting

#Terminology Note, leptonema, zygonema, and pachynema diplonema diakinesis, are the stage names.
#-ene endings refer to the cells/units within the cell stage? (I think)

#apply this before ploting
MLH1_data <- MLH1_data %>%
  arrange(strain, sex, category, mouse) %>%
  mutate(Original.Name = factor(Original.Name)) #another category that you want the order to match
MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])

# sort your dataframe, by the focal categories
MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))
#use the above line for when order is out of wak

#MLH1_data <- with(MLH1_data, MLH1_data[order(category),])
AP_mouse_table.HQ$var <- as.numeric(AP_mouse_table.HQ$var)

AP_category_table <-  ddply(.data=AP_mouse_table.HQ,
                 .(strain,sex),
                 summarize,
                 sum.ncells = sum(Ncells),
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co),
                 AV.var_MLH1 = mean(var, na.rm=TRUE)
                                  
)

#there might be an error for changing wd
#write.table(AP_category_table, "~./MLH1repo/strain_table_variances.csv", sep=",", row.names = FALSE)

AP_mouse_table.HQ_target <- AP_mouse_table.HQ[!(is.na(AP_mouse_table.HQ$sex) | AP_mouse_table.HQ$sex==""), ]

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC")
AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]

  
var.plot <- ggplot(AP_mouse_table.HQ_target, aes(y=var, x = sex, color=sex))+geom_jitter()+facet_wrap(~strain)+ggtitle("Plots of mouse Variances for MLH1 counts")+
  scale_color_manual(values=c("royalblue", "limegreen"))+theme_bw()

```

```{r misc.setup, echo=FALSE}

colors_of_strains <- c('WSB'= "#56B4E9",'G' ='cadetblue','LEW'= 'lightblue','PERC'= 'blue',
                       #blues
                       
                       'PWD'= 'red2',
                       'SKIVE'= 'coral1','KAZ'= 'coral4', 
                       
                       'TOM'= 'indianred1','AST' = 'tan2',
                       'CZECH'= 'brown1',
                       
                       'MSM'= 'deeppink', 'MOLF'= 'hotpink', #mol are pinks, bc they are fancy mice
                       
                    'CAST'='green','HMI'= 'forestgreen', #greens
                    
                    'SPRET'='gold','SPIC'= 'goldenrod1', #browns? color of mounds?
                    'CAROLI'='gold3',
                    
                    "F1"='grey', "other" = 'grey'
                    )

color_chrm_class <- c( '0' = "#00BFC4", '1' = "#7CAE00", '2' = "#F8766D", '3' = "#C77CFF", '4'= "#F564E3")
#4!!

#show_col(hue_pal()(5))

#add Rec group,

Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                              ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)))

Curated_BivData$Rec.group_alt <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                              ifelse(grepl("MSM male", Curated_BivData$category), 1, 0))


#apply this before ploting, to display strains in desired order
#MLH1_data <- MLH1_data %>%
#  arrange(strain, sex, category, mouse) %>%
#  mutate(Original.Name = factor(Original.Name)) #another category that you want the order to match
#MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])

# sort your dataframe, by the focal categories
#MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))


```

```{r Q1.rbar, echo=FALSE}

source("~./MLH1repo/src/CommonFunc_MLH1repo.R")

#read.csv of gamma estimates from above
gamma_estimates <- read.csv("~./MLH1repo/results/gamma_estimates.csv", header = TRUE)

table_gamma_estimates <- read.csv("~./MLH1repo/table.csv", header = TRUE)

#for(e in 1:length(cleanCurated_BivData$fileName)){
#  mini.IFD <- calq.intra.rbar(mini.IFD)
#  cleanCurated_BivData$rbar[e] <- new.calq.intra.rbar(cleanCurated_BivData[e,])
#  }

#calq the mouse / strain means for rbar

#summarize_rbar_table <- ddply(.data=cleanCurated_BivData,
#                 .(sex, strain),
#                 summarize,
#                 mean.rbar.all = mean(rbar, na.rm = TRUE),
                 
#                 mean.rbar.2CO = mean(rbar[which(hand.foci.count == 2)], na.rm = TRUE),
#                 mean.rbar.3CO = mean(rbar[which(hand.foci.count == 3)], na.rm = TRUE)
#)
#the 3 is negative...

#how best to merge rbar and gamma estiamtes (which estimate)

raw.gamma_estimates <-  gamma_estimates %>% filter(type.IFD == "raw.IFD") %>% filter( (class == "2CO") | (class == "3CO") )

table <- raw.gamma_estimates
#write.table(table, "~./MLH1repo/table.csv", sep=",",row.names = TRUE)

#write.table(summarize_rbar_table, "~./MLH1repo/RBAR.table.csv", sep=",",row.names = TRUE)

#what comparison of IFD and rbar would be logical
#plot rbar and gamma
ll <- ggplot(table_gamma_estimates, aes(y=mean.rbar, x = all.biv.gamma, color = class, shape = sex ))+geom_point()+facet_wrap(~strain)+ ggtitle("")+ylim(c(0,.5))

#mean rbars are up around 
#SKIVE male have extra (very strong interference)
#there's so much variance across the gamma estimates -- 
#most all females seem to have stronger interfernce
#there don't seem to be consistant patterns

#this plot shows much higher 2CO interference (via the gamma estimat from nrmIFD) in high rec males
#across other classes of bivalents 

#most all other estiamtes of gamma estimates are around 4
#

#house mouse raw nu is around 11

```

```{r MLH1.FEMALE.TABLE, echo=FALSE}
female_mouse.av <- subset(AP_mouse_table_w.Ages, select= -c(sex.y,sex.x,
                            subsp.y,subsp.x,
                    category.y,category.x, strain.x,
                    strain.y, mouse.1  )  )

female_mouse.av <- add_sex(female_mouse.av)
female_mouse.av <- add_strain(female_mouse.av)
female_mouse.av <- add_subsp(female_mouse.av)
female_mouse.av <- add_species(female_mouse.av)

female_mouse.avs_for.analysis <-  female_mouse.av %>% filter(sex== "female") %>% filter(species == "M.musculus") %>% filter(strain != "CZECH") %>% filter(strain != "CAST")

female_mouse.avs_for.analysis$subsp <- factor(female_mouse.avs_for.analysis$subsp, ordered = FALSE)
female_mouse.avs_for.analysis$sex <- factor(female_mouse.avs_for.analysis$sex, ordered = FALSE)
female_mouse.avs_for.analysis$strain <- factor(female_mouse.avs_for.analysis$strain, ordered = FALSE)
female_mouse.avs_for.analysis$species <- factor(female_mouse.avs_for.analysis$species, ordered = FALSE)

Musc.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Musc")

#Mol
#Mol.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Mol")

#Dom 
Dom.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Dom")

```

```{r MLH1.MALE.TABLE, echo=FALSE}
#AP_mouse_table.MLH1_HQ

#find the table that includes the las image data
male_MLH1mouse.av <- AP_mouse_table_w.Ages

male_MLH1mouse.av <- add_sex(male_MLH1mouse.av)
male_MLH1mouse.av <- add_strain(male_MLH1mouse.av)
male_MLH1mouse.av <- add_subsp(male_MLH1mouse.av)
male_MLH1mouse.av <- add_species(male_MLH1mouse.av)

fomo.male_mouse.av <-  male_MLH1mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

fomo.male_mouse.av$subsp <- factor(fomo.male_mouse.av$subsp, ordered = FALSE)
fomo.male_mouse.av$sex <- factor(fomo.male_mouse.av$sex, ordered = FALSE)
fomo.male_mouse.av$strain <- factor(fomo.male_mouse.av$strain, ordered = FALSE)
fomo.male_mouse.av$species <- factor(fomo.male_mouse.av$species, ordered = FALSE)


Musc.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Musc")
Mol.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Mol")
#Dom version 
Dom.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Dom")
```

```{r MLH1.MIXED.MODEL.setup, echo=FALSE, warning=FALSE, eval=TRUE}
#DF.HetC.MixedModel.HQ

#this blck is duplicated in setupData.rm

#https://rcompanion.org/handbook/G_03.html
#testing random effects within lme

DF.HetC.MixedModel <- AP_mouse_table_w.Ages[AP_mouse_table_w.Ages$species == "M.musculus",]

#remove the extra merged cols
#DF.HetC.MixedModel <- subset(DF.HetC.MixedModel, select= -c(sex.y,sex.x,
#                            subsp.y,subsp.x,
#                    category.y,category.x, strain.x,
#                    strain.y, mouse.1  )  )

#AP_mouse_table excluide Qual5 cells
DF.HetC.MixedModel.HQ <- AP_mouse_table.MLH1_HQ
DF.HetC.MixedModel.HQ <- add_species(DF.HetC.MixedModel.HQ)

#main df with variables coded as chr
DF.HetC.MixedModel.HQ$subsp <- factor(DF.HetC.MixedModel.HQ$subsp, ordered = FALSE)
DF.HetC.MixedModel.HQ$sex <- factor(DF.HetC.MixedModel.HQ$sex, ordered = FALSE)
DF.HetC.MixedModel.HQ$strain <- factor(DF.HetC.MixedModel.HQ$strain, ordered = FALSE)
#DF.HetC.MixedModel.HQ$species <- factor(DF.HetC.MixedModel.HQ$species, ordered = FALSE)

#kable(table(DF.HetC.MixedModel.HQ$sex, DF.HetC.MixedModel.HQ$strain))


all.cell.MM.HQ <- ddply(.data=DF.HetC.MixedModel.HQ,
                 .(sex, strain),
                 summarize,
                 all.cells = sum(Ncells)
)

```

```{r MLH1.HetC.rates, echo=FALSE, include=FALSE, warning=FALSE}
#calculate the initial HetC levels from best quality mice and cells (compare both levels (cell and mouse average levels))
#subset MLH1_DF, remove non passing mice (as diagnoised from plots)
#remove quality 5 cells

#outgroups
#SPIC
HetC.SPIC <- MLH1_data[(MLH1_data$strain == "SPIC")&(MLH1_data$quality < 5),]
#unique(HetC.SPIC$mouse)
#non-passing mice
SPIC.remove.mice <- c("30may18_SPIC_f1", "8jun18_SPIC_m2")
HetC.SPIC <- HetC.SPIC[ ! HetC.SPIC$mouse %in% SPIC.remove.mice, ]
#calq sex mean
SPIC.mean.MLH1.obs <- ddply(.data=HetC.SPIC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
SPIC.HETC.val <- SPIC.mean.MLH1.obs$mean.MLH1[1] / SPIC.mean.MLH1.obs$mean.MLH1[2]

#SPRET
HetC.SPRET <- MLH1_data[(MLH1_data$strain == "SPRET")&(MLH1_data$quality < 5),]
#unique(HetC.SPRET$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
SPRET.mean.MLH1.obs <- ddply(.data=HetC.SPRET, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

SPRET.HETC.val <- SPRET.mean.MLH1.obs$mean.MLH1[1] / SPRET.mean.MLH1.obs$mean.MLH1[2]

#CAROLI
HetC.CAROLI <- MLH1_data[(MLH1_data$strain == "CAROLI")&(MLH1_data$quality < 5),]
#unique(HetC.CAROLI$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAROLI.mean.MLH1.obs <- ddply(.data=HetC.CAROLI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

#cast
HetC.CAST <- MLH1_data[(MLH1_data$strain == "CAST")&(MLH1_data$quality < 5),]
#unique(HetC.CAST$mouse)
#non-passing mice
#X.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAST.mean.MLH1.obs <- ddply(.data=HetC.CAST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
CAST.HETC.val <- CAST.mean.MLH1.obs$mean.MLH1[1] / CAST.mean.MLH1.obs$mean.MLH1[2]

#HMI
HetC.HMI <- MLH1_data[(MLH1_data$strain == "HMI")&(MLH1_data$quality < 5),]
#unique(HetC.HMI$mouse)
#non-passing mice
#X.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
HMI.mean.MLH1.obs <- ddply(.data=HetC.HMI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

#dom

#WSB
HetC.WSB <- MLH1_data[(MLH1_data$strain == "WSB")&(MLH1_data$quality < 5),]
#unique(HetC.WSB$mouse)
#non-passing mice
WSB.remove.mice <- c("8oct14_WSB_f1", "18nov17_WSB_f5", "16jun15_WSB_f3","10mar15_WSB_m2")
HetC.WSB <- HetC.WSB[ ! HetC.WSB$mouse %in% WSB.remove.mice, ]
#calq sex mean
WSB.mean.MLH1.obs <- ddply(.data=HetC.WSB, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

WSB.HETC.val <- WSB.mean.MLH1.obs$mean.MLH1[1] / WSB.mean.MLH1.obs$mean.MLH1[2]


#LEW
HetC.LEW <- MLH1_data[(MLH1_data$strain == "LEW")&(MLH1_data$quality < 5),]
unique(HetC.LEW$mouse)
#non-passing mice
LEW.remove.mice <- c("4jan17_LEW_f2")
HetC.LEW <- HetC.WSB[ ! HetC.LEW$mouse %in% LEW.remove.mice, ]

#calq sex mean
LEW.mean.MLH1.obs <- ddply(.data=HetC.LEW, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

LEW.HETC.val <- LEW.mean.MLH1.obs$mean.MLH1[1] / LEW.mean.MLH1.obs$mean.MLH1[2]


#G
HetC.G <- MLH1_data[(MLH1_data$strain == "G")&(MLH1_data$quality < 5),]
#unique(HetC.G$mouse)
#non-passing mice
G.remove.mice <- c("8jun15_G_f3","8jun15_G_f4")
HetC.G <- HetC.G[ ! HetC.G$mouse %in% G.remove.mice, ]

#calq sex mean
G.mean.MLH1.obs <- ddply(.data=HetC.G, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]


#PERC
HetC.PERC <- MLH1_data[(MLH1_data$strain == "PERC")&(MLH1_data$quality < 5),]
#unique(HetC.PERC$mouse)
#non-passing mice
#G.remove.mice <- c("8jun15_G_f3","8jun15_G_f4")
#HetC.G <- HetC.PERC[ ! HetC.PERC$mouse %in% PERC.remove.mice, ]

#calq sex mean
PERC.mean.MLH1.obs <- ddply(.data=HetC.PERC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]

#MUSC

#PWD
HetC.PWD <- MLH1_data[(MLH1_data$strain == "PWD")&(MLH1_data$quality < 5),]
#unique(HetC.PWD$mouse)
#non-passing mice
PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
PWD.mean.MLH1.obs <- ddply(.data=HetC.PWD, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
PWD.HETC.val <- PWD.mean.MLH1.obs$mean.MLH1[1] / PWD.mean.MLH1.obs$mean.MLH1[2]

# CZECH
HetC.CZECH <- MLH1_data[(MLH1_data$strain == "CZECH")&(MLH1_data$quality < 5),]
#unique(HetC.CZECH$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
CZECH.mean.MLH1.obs <- ddply(.data=HetC.CZECH, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

CZECH.HETC.val <- CZECH.mean.MLH1.obs$mean.MLH1[1] / CZECH.mean.MLH1.obs$mean.MLH1[2]


# SKIVE
HetC.SKIVE <- MLH1_data[(MLH1_data$strain == "SKIVE")&(MLH1_data$quality < 5),]
#unique(HetC.SKIVE$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
SKIVE.mean.MLH1.obs <- ddply(.data=HetC.SKIVE, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

SKIVE.HETC.val <- SKIVE.mean.MLH1.obs$mean.MLH1[1] / SKIVE.mean.MLH1.obs$mean.MLH1[2]



# KAZ
HetC.KAZ <- MLH1_data[(MLH1_data$strain == "KAZ")&(MLH1_data$quality < 5),]
#unique(HetC.KAZ$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
KAZ.mean.MLH1.obs <- ddply(.data=HetC.KAZ, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
KAZ.HETC.val <- KAZ.mean.MLH1.obs$mean.MLH1[1] / KAZ.mean.MLH1.obs$mean.MLH1[2]


#TOM
HetC.TOM <- MLH1_data[(MLH1_data$strain == "TOM")&(MLH1_data$quality < 5),]
#unique(HetC.TOM$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
TOM.mean.MLH1.obs <- ddply(.data=HetC.TOM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
TOM.HETC.val <- TOM.mean.MLH1.obs$mean.MLH1[1] / TOM.mean.MLH1.obs$mean.MLH1[2]



#AST
HetC.AST <- MLH1_data[(MLH1_data$strain == "AST")&(MLH1_data$quality < 5),]
#unique(HetC.AST$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
AST.mean.MLH1.obs <- ddply(.data=HetC.AST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)
AST.HETC.val <- AST.mean.MLH1.obs$mean.MLH1[1] / AST.mean.MLH1.obs$mean.MLH1[2]


#Molosinus

#MSM
HetC.MSM <- MLH1_data[(MLH1_data$strain == "MSM")&(MLH1_data$quality < 5),]
unique(HetC.MSM$mouse)

#non-passing mice
MSM.remove.mice <- c("12sep16_MSM_f3")
HetC.MSM <- HetC.MSM[ ! HetC.MSM$mouse %in% MSM.remove.mice, ]

#calq sex mean
MSM.mean.MLH1.obs <- ddply(.data=HetC.MSM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

MSM.HETC.val <- MSM.mean.MLH1.obs$mean.MLH1[1] / MSM.mean.MLH1.obs$mean.MLH1[2]


#MOLF
HetC.MOLF <- MLH1_data[(MLH1_data$strain == "MOLF")&(MLH1_data$quality < 5),]
unique(HetC.MOLF$mouse)

#non-passing mice
MOLF.remove.mice <- c("27oct18_MOLF_m3")
HetC.MOLF <- HetC.MOLF[ ! HetC.MOLF$mouse %in% MOLF.remove.mice, ]

#calq sex mean
MOLF.mean.MLH1.obs <- ddply(.data=HetC.MOLF, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(adj_nMLH1.foci),
                 var.MLH1 = var(adj_nMLH1.foci)
)

MOLF.HETC.val <- MOLF.mean.MLH1.obs$mean.MLH1[1] / MOLF.mean.MLH1.obs$mean.MLH1[2]

```

```{r MLH1.HetC.plot, echo=FALSE, warning=FALSE}
#HETC plot
#change the main data? 

HetC_strain_table.M <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "male"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length(adj_nMLH1.foci),
                         mean_co = format(round(  mean(adj_nMLH1.foci), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci),3), nsmall=3),
                         sd   = round(sd(adj_nMLH1.foci), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#
#HetC_strain_table.M <- HetC_strain_table.M[ -c(7, 4, 10,11,12, 14, 17, 18,19), ]

HetC_strain_table.F <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "female"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length(adj_nMLH1.foci),
                         mean_co = format(round(  mean(adj_nMLH1.foci), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci),3), nsmall=3),
                         sd   = round(sd(adj_nMLH1.foci), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#HetC_strain_table.F <- HetC_strain_table.F[ -c(11), ]

#remove the 'other'

HetC_strain_table.M$sex <- "male"
HetC_strain_table.F$sex <- "female"

HetC_strain_table <- merge(HetC_strain_table.M, HetC_strain_table.F, by= "strain")

HetC_strain_table <- add_subsp(HetC_strain_table)

#HetC_strain_table$subsp <- c("Dom", "Dom", "Dom", "Musc", "Musc","Musc","Musc", "Cast", "Outgroup","Outgroup")

HetC_strain_table$mean_co.x <- as.numeric(HetC_strain_table$mean_co.x)
HetC_strain_table$mean_co.y <- as.numeric(HetC_strain_table$mean_co.y)
#str(HetC_strain_table)

Het.C.plot <- ggplot(data= HetC_strain_table, aes(x= mean_co.x, y=mean_co.y, color = subsp, label=strain ))+ geom_point(aes(size=2)) + xlim(c(20,35)) + ylim(c(20, 35)) + geom_abline(slope = 1, intercept = 0)+labs(x="male MLH1 mean",y="female MLH1 mean")+ggtitle("Heterochiasmy Plot")+
  scale_color_manual(values=c("royalblue", "limegreen",  "tomato", "slategray2", "plum", "grey")) + geom_text(data = HetC_strain_table, aes(label=HetC_strain_table$strain, x=mean_co.x, y= mean_co.y,  hjust = 0, nudge_x = 0.09, nudge_y = 0.09) )


```

```{r juvimice.list, echo=FALSE}
juvi_mice <- c(
  "30dec14_WSB_m2","30dec14_WSB_m4","30dec14_WSB_m1","30dec14_WSB_m3","30dec14_WSB_m5",
  "30sep14_G_m1","30sep14_G_m2","30sep14_G_m3","30sep14_G_m4","30sep14_G_m5",
  "12Feb17_LEW_m1","12Feb17_LEW_m2", "13sep17_LEW_m2", "13sep17_LEW_m1","13sep17_LEW_m3",
 
  "12sep17_PWD_m1","12sep17_PWD_m2","12sep17_PWD_m3",
   "30Dec16_MSM_m2","30Dec16_MSM_m3","30Dec16_MSM_m1"
  )

#REMOVE JUVI mice
#juvi.mouse_CurBiv_table <- mouse.avs_4MM[mouse.avs_4MM$mouse  %in% juvi_mice, ]  
#mouse.avs_4MM <- mouse.avs_4MM[! mouse.avs_4MM$mouse  %in% juvi_mice, ] 

```

```{r CurBiv.Mouse.av.TABLE, echo=FALSE}

#this block should be in the data set up
#the mouse averages will be used

#18jul19_31may19_SKIVE_m2_sp1_13.2_rev_8 is missing the 1CO position -- remove for now
cleanCurated_BivData <- cleanCurated_BivData %>% filter(fileName != "18jul19_31may19_SKIVE_m2_sp1_13.2_rev_8")

#cleanCurated_BivData
#removed the no hand foci count

mouse.avs_4MM <- ddply(cleanCurated_BivData, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Ncells  = length(Obj.ID),
                       
                      # mean_CO = mean()
                       
                        mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                       
                       #calq mean.sc by chrm class
                       mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                       
                # IFD things
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                  
              #sis.co.ten!!
              mean.siscoten = mean(SisCoTen, na.rm=TRUE),
              
              mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
              mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
              mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
              
              mean.telo.dist = mean(telo_dist, na.rm=TRUE),
              mean.cent.dist = mean(dis.cent, na.rm=TRUE)
)

#vari
mouse.avs_4MM <- add_sex(mouse.avs_4MM)
mouse.avs_4MM <- add_strain(mouse.avs_4MM)
mouse.avs_4MM <- add_subsp(mouse.avs_4MM)
mouse.avs_4MM <- add_category(mouse.avs_4MM)

#unordered for the mixed models (move this to the MM blocks...?)
#keep order for the plots?
mouse.avs_4MM$subsp <- factor(mouse.avs_4MM$subsp, ordered = FALSE)
mouse.avs_4MM$sex <- factor(mouse.avs_4MM$sex, ordered = FALSE)
mouse.avs_4MM$strain <- factor(mouse.avs_4MM$strain, ordered = FALSE)

#MAKE the same version of the TABLE but for the longest_biv_Dataset (when I get around to making it)
#code if males are high or low?

#REMOVE JUVI mice
juvi.mouse_CurBiv_table <- mouse.avs_4MM[mouse.avs_4MM$mouse  %in% juvi_mice, ]  
mouse.avs_4MM <- mouse.avs_4MM[! mouse.avs_4MM$mouse  %in% juvi_mice, ]  

#assign high and low
#divide musc males into groups
mouse.avs_4MM$Rec.group <- ifelse(grepl("PWD male", mouse.avs_4MM$category), 1, 
                                ifelse(grepl("MSM male", mouse.avs_4MM$category), 1,
                                 ifelse(grepl("SKIVE male", mouse.avs_4MM$category), 1, 0)))


mouse.avs_4MM$Rec.group.exclu <- ifelse(grepl("PWD male", mouse.avs_4MM$category), 1, 
                                ifelse(grepl("MSM male", mouse.avs_4MM$category), 1, 0))

```

```{r Q1.biv.data_table.4MM.Male, echo=FALSE, eval=FALSE}

#add this to setup

#remove female, 
#add back in the BIVDATA from strains which were  removed for the sex-specific comparisons

#Curated_BivData_male

male.av_4MM <- ddply(cleanCurated_BivData, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Ncells  = length(Obj.ID),
                       
                      # mean_CO = mean()
                       
                        mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                       
                       #calq mean.sc by chrm class
                       mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                       
                # IFD things
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                  
              #sis.co.ten!!
              mean.siscoten = mean(SisCoTen, na.rm=TRUE),
              
              mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
              mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
              mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
              
              mean.telo.dist = mean(telo_dist, na.rm=TRUE),
              mean.cent.dist = mean(dis.cent, na.rm=TRUE)
)

#vari
male.av_4MM <- add_sex(male.av_4MM)
male.av_4MM <- add_strain(male.av_4MM)
male.av_4MM <- add_subsp(male.av_4MM)
male.av_4MM <- add_category(male.av_4MM)

#unordered for the mixed models (move this to the MM blocks...?)
#keep order for the plots?
male.av_4MM$subsp <- factor(male.av_4MM$subsp, ordered = FALSE)
male.av_4MM$sex <- factor(male.av_4MM$sex, ordered = FALSE)
male.av_4MM$strain <- factor(male.av_4MM$strain, ordered = FALSE)

#REMOVE JUVI mice
juvi.from.male.biv_table <- male.av_4MM[male.av_4MM$mouse  %in% juvi_mice, ]  
mouse.avs_4MM <- male.av_4MM[! male.av_4MM$mouse  %in% juvi_mice, ] 

```

```{r totSC_setup, echo=FALSE}
#SC.skel
#"anon.batch" "rand_name"  "bin_size"   "skel_size" , all batches included

SC.skel.OG <- SC.skel #5683

#MERGEING MLH1 with SKEL
MLH1.merge.Skel <- merge(original_DF, SC.skel, by.x = "Random.Name", by.y = "rand_name", all= F)

MLH1.merge.Skel <- add_mouse(MLH1.merge.Skel)
MLH1.merge.Skel <- add_strain(MLH1.merge.Skel)
MLH1.merge.Skel <- add_sex(MLH1.merge.Skel)
MLH1.merge.Skel <- add_subsp(MLH1.merge.Skel)
MLH1.merge.Skel <- add_category(MLH1.merge.Skel)
MLH1.merge.Skel <- add_subsp(MLH1.merge.Skel)
#5110, 

OG.MLH1.merge.Skel <- MLH1.merge.Skel #raw version of DF

#check for DUPs, #check for duplicatations of the random name
MLH1.merge.Skel$ fileName  <- as.character(MLH1.merge.Skel$fileName)
tot.SC.dupies <- MLH1.merge.Skel[duplicated(MLH1.merge.Skel$ fileName ),]

MLH1.merge.Skel <- MLH1.merge.Skel %>% filter( X == "") %>% filter(REDO.crop == "no")

MLH1.merge.Skel$bin_size <- as.numeric(MLH1.merge.Skel$bin_size)
MLH1.merge.Skel$skel_size <- as.numeric(MLH1.merge.Skel$skel_size)
#table(MLH1.merge.Skel$category)

#remove outliers
MLH1.merge.Skel <- MLH1.merge.Skel  %>% filter(bin_size < 60000)

```

```{r totSC.viz4outliers, echo=FALSE}

# -- EXAMINE the ggplot scatter plots for outliers
tot.sc <- ggplot(data= MLH1.merge.Skel, aes(y = bin_size, x=strain))+ geom_jitter()+facet_wrap(~category, scales = "free")

#round 1
SC.skel.outliers_round1 <- c(
  #MLH1.merge.Skel  %>% filter(category == "WSB male") %>% filter(skel_size > 2000)
  "10apr15_31mar15_WSB_m3_sp1_4_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "WSB female") %>% filter(skel_size > 2700)       
            "17nov16_3nov15_WSB_f1_sp3_4_rev.tif","1may16_3nov15_WSB_f1_sp2_6_rev.tif",
                      
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 20000) 
                      "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000) 
              "1mar16_20feb16_G_f3_sp1_8_rev.tif","21nov16_16jan16_G_f2_sp1_15_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW male") %>% filter(skel_size < 1000)          
          "6mar18_1feb18_LEW_m1_sp1_21.5_rev",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW female") %>% filter(skel_size > 20000)   
          "12jan17_4jan17_LEW_f1_sp1_32_rev.tif","20mar17_13jan17_LEW_f2_sp1_12_rev.tif","9apr18_1feb18_LEW_f1_sp1_23_rev.tif","9apr18_1feb18_LEW_f1_sp1_12_rev.tif", 
                      
       #MLH1.merge.Skel  %>% filter(category == "PWD male") %>% filter(skel_size > 20000)  
                      "6mar15_1mar15_PWD_m1_sp4_6.1_rev.tif","7mar15_1mar15_PWD_m1_sp4_2_rev.tif","20jul15_18may15_PWD_m2_sp1_10.2_rev.tif",
           
   #MLH1.merge.Skel  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
   "6may15_17apr15_PWD_f1_sp1_7_rev",  
       
      #MLH1.merge.Skel  %>% filter(category == "KAZ male") %>% filter(skel_size < 1000)
            "6aug19_10jul19_KAZ_m1_sp1_7.1_rev.tif",
            
    # MLH1.merge.Skel  %>% filter(category == "KAZ female") %>% filter(skel_size > 30000)     
    "16feb18_1feb18_KAZ_f4_sp1_20_rev.tif",  "8feb18_1feb18_KAZ_f1_sp1_24_rev.tif",  
  "16feb18_1feb18_KAZ_f4_sp1_1_rev.tif",   "8feb18_1feb18_KAZ_f1_sp1_5_rev.tif",   
 "16feb18_1feb18_KAZ_f4_sp1_17_rev.tif",  "1mar18_1feb18_KAZ_f3_sp1_8_rev.tif",   
 "7feb18_11jan18_KAZ_f3_sp1_27_rev.tif",  "20apr18_11jan18_KAZ_f1_sp1_6_rev.tif", 
 "16feb18_1feb18_KAZ_f2_sp1_5.2_rev.tif", "16feb18_1feb18_KAZ_f2_sp1_15_rev.tif", 
"7feb18_11jan18_KAZ_f3_sp1_13_rev.tif",  "13apr18_1feb18_KAZ_f6_sp1_25_rev.tif" ,
            
  # MLH1.merge.Skel  %>% filter(category == "SKIVE female") %>% filter(skel_size > 10000)
    "10jun19_31may19_SKIVE_f6_sp1_47_rev.tif","10jun19_31may19_SKIVE_f6_sp1_7_rev.tif",

# MLH1.merge.Skel  %>% filter(category == "MOLF male") %>% filter(skel_size < 1200)
"4jun19_28sep18_MOLF_m1_sp1_10.1_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "AST male") %>% filter(skel_size > 2100)
"16aug19_27aug18_AST_m1_sp1_23_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "MSM female") %>% filter(skel_size > 20000)
"21nov17_16nov17_MSM_f3_sp1_24_rev.tif","21nov17_16nov17_MSM_f3_sp1_3_rev.tif", "21nov17_16nov17_MSM_f3_sp1_27_rev.tif","4dec17_16nov17_MSM_f2_sp1_10_rev.tif",
"5aug17_14jul17_MSM_f1_sp1_25_rev.tif","24jan18_31dec17_MSM_f3_sp1_3_rev.tif", 
"24jan18_31dec17_MSM_f3_sp1_22_rev.tif","21nov17_16nov17_MSM_f3_sp1_17_rev.tif",

#tt <- MLH1.merge.Skel  %>% filter(category == "SPIC female") %>% filter(skel_size > 20000)
"27dec17_4dec17_SPIC_f1_sp1_12_rev.tif",  "5apr18_31dec17_SPIC_f2_sp1_1_rev.tif",
 "26sep18_30may18_SPIC_f4_sp1_14_rev.tif", "4feb18_31dec17_SPIC_f1_sp1_21_rev.tif", 
 "5apr18_31dec17_SPIC_f2_sp1_22_rev.tif",  "27dec17_4dec17_SPIC_f1_sp1_40_rev.tif", 
 "4jul18_30may18_SPIC_f1_sp1_6_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_6_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_10_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_37_rev.tif" , 
 "5sep17_21aug17_SPI_f2_sp1_15_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_24_rev.tif",
"29dec17_4dec17_SPIC_f2_sp1_16_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_30_rev.tif",  
"4feb18_31dec17_SPIC_f1_sp1_5_rev.tif",   "5apr18_31dec17_SPIC_f2_sp1_25_rev.tif", 
 "26sep18_30may18_SPIC_f4_sp1_4_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_22_rev.tif",  
 "5sep17_21aug17_SPI_f2_sp1_19_rev.tif",   "5sep17_21aug17_SPI_f2_sp1_29_rev.tif",  
 "26sep18_30may18_SPIC_f4_sp1_3_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_5.2_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_6_rev.tif",   "13oct17_21aug17_SPI_f1_sp1_13_rev.tif"  )


MLH1.merge.Skel_1 <- MLH1.merge.Skel[!MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1, ]#62 removed


remove.mice_round2 <- c(
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 2500)
    "28jul15_22jun15_G_m2_sp1_5_rev.tif","12may15_30sep14_G_m5_sp1_26_rev.tif",  
    
    #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000)
  "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
#MLH1.merge.Skel_2  %>% filter(category == "PWD male") %>% filter(skel_size > 2100)
"20jul15_18may15_PWD_m1_sp1_10_rev.tif","22mar15_10mar15_PWD_m2_sp1_11.2_rev.tif","22mar15_10mar15_PWD_m1_sp1_4.1_rev.tif","20jul15_18may15_PWD_m1_sp1_7.2_rev.tif",  

#MLH1.merge.Skel_2  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
  "6may15_17apr15_PWD_f1_sp1_7_rev.tif",
  
  #MLH1.merge.Skel_2  %>% filter(category == "KAZ female") %>% filter(skel_size < 1000)
  "8feb18_1feb18_KAZ_f1_sp1_19_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW male") %>% filter(skel_size < 1000 | skel_size > 1750)
"6mar18_1feb18_LEW_m1_sp1_10_rev.tif","3mar15_13jan17_LEW_m1_sp1_15_rev.tif", "4feb17_4jan17_LEW_m1_sp1_13_rev.tif","6mar18_1feb18_LEW_m1_sp1_21.5_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW female") %>% filter(skel_size > 2750 ) 
"20mar17_13jan17_LEW_f2_sp1_10_rev.tif",

# MLH1.merge.Skel_2  %>% filter(category == "CAROLI male") %>% filter(skel_size < 1400 )
"31aug18_1mar18_CAROLI_m1_sp3_29.2_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "MSM male") %>% filter(skel_size < 1200 )
"16aug17_5jul17_MSM_m1_sp1_6.1_rev.tif",

#tt <- MLH1.merge.Skel_2  %>% filter(category == "MSM female") %>% filter(skel_size > 2850 ) 
"29nov17_16nov17_MSM_f1_sp1_10_rev.tif", "4dec17_16nov17_MSM_f2_sp1_24_rev.tif", "21nov17_16nov17_MSM_f3_sp1_26_rev.tif",
#SPIC male  x
#SPIC female  x
#TOM x
#AST x
#CZECH male x 

#MLH1.merge.Skel_2  %>% filter(category == "SPRET male") %>% filter(skel_size < 1900 ) 
 "24may17_8may17_SPRET_m1_sp1_21.1_rev.tif",
#SPRET female X
#MLH1.merge.Skel_2  %>% filter(category == "HMI male") %>% filter(skel_size < 1000 ) 
"29dec17_4dec17_HMI_m1_sp1_4.1_rev.tif"
)
#3remove.mice_round2

MLH1.merge.Skel_2 <- MLH1.merge.Skel_1[!MLH1.merge.Skel_1$fileName %in% remove.mice_round2, ]
#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1),]
#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% remove.mice_round2),]
all.remove <- paste( c(SC.skel.outliers_round1, remove.mice_round2 ) )

MLH1.merge.Skel <- MLH1.merge.Skel_2

MLH1.merge.Skel <- add_species(MLH1.merge.Skel)


#adjust 
MLH1.merge.Skel_2$mouse <- as.factor(MLH1.merge.Skel_2$mouse)
MLH1.merge.Skel_2$nMLH1.foci <- as.numeric(MLH1.merge.Skel_2$nMLH1.foci)
MLH1.merge.Skel_2$quality <- as.numeric(MLH1.merge.Skel_2$quality)
  
```

```{r tot.skel.table, echo=FALSE}
#calq the correlation for tota.SC and mlh1 - after mouse averages
#use MLH1.merge.Skel_2 -- quality 1-4

totSC.mouse.av.table <- ddply(.data= ( MLH1.merge.Skel_2 %>% filter(quality < 5) ), 
                 .(mouse),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var(adj_nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                
)

totSC.mouse.av.table <- add_strain(totSC.mouse.av.table)
totSC.mouse.av.table <- add_sex(totSC.mouse.av.table)
totSC.mouse.av.table <- add_category(totSC.mouse.av.table)
totSC.mouse.av.table <- add_subsp(totSC.mouse.av.table)
totSC.mouse.av.table <- add_species(totSC.mouse.av.table)

#unorder the factors
totSC.mouse.av.table$subsp <- factor(totSC.mouse.av.table$subsp, ordered = FALSE)
totSC.mouse.av.table$sex <- factor(totSC.mouse.av.table$sex, ordered = FALSE)
totSC.mouse.av.table$strain <- factor(totSC.mouse.av.table$strain, ordered = FALSE)
totSC.mouse.av.table$species <- factor(totSC.mouse.av.table$species, ordered = FALSE)

#add rec group
totSC.mouse.av.table$Rec.group <- ifelse(grepl("PWD male", totSC.mouse.av.table$category), 1, 
                              ifelse(grepl("MSM male", totSC.mouse.av.table$category), 1,
                                ifelse(grepl("SKIVE male", totSC.mouse.av.table$category), 1, 0)))

OG.totSC.mouse.av.table <- totSC.mouse.av.table

#REMOVE JUVI mice
tot.SC_juvi.male <- totSC.mouse.av.table[totSC.mouse.av.table$mouse  %in% juvi_mice, ]

totSC.mouse.av.table <- totSC.mouse.av.table[! totSC.mouse.av.table$mouse  %in% juvi_mice, ] 

totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain!="CAST" & strain !="F1" & strain !="SPIC" & strain !=  "CAROLI" & strain !="SPRET"& strain !="HMI"& strain !="PERC")


#ADD CORRELATION
for(g in length(totSC.mouse.av.table$mouse) ){
totSC.mouse.av.table$cor.SCskel.MLH1[g] <- cor(totSC.mouse.av.table$mean.MLH1[g], totSC.mouse.av.table$mean.skel[g])
}

mouse.av_sc_female <- ggplot(data= OG.totSC.mouse.av.table[OG.totSC.mouse.av.table$sex == "female",], aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(Rec.group~subsp, scales="free")+ theme(axis.title.x=element_blank(),        axis.text.x=element_blank(), axis.ticks.x=element_blank()) + ylim(c(1500,3000 ))+ggtitle("Female Mouse av. total SC area")

mouse.av_sc_male <- ggplot(data= OG.totSC.mouse.av.table[OG.totSC.mouse.av.table$sex == "male",], aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(Rec.group~subsp, scales="free")+ theme(axis.title.x=element_blank(),        axis.text.x=element_blank(), axis.ticks.x=element_blank()) + ylim(c(1200,1850 ))+ggtitle("Mouse av. total SC area")

```

```{r tot.SC.setup, echo = FALSE}
#calc=q correlation, total.sc and mean MLH1


totSC.strain.av.table <- ddply(.data=totSC.mouse.av.table, 
                 .(sex,strain),
                 summarize, 
                 ncells = sum(ncells),
                 nmice = length(unique(mouse)),
                # mean.MLH1 = mean(adj_nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var(adj_nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(mean.skel, na.rm = TRUE),
                 mean.bin =  mean(mean.bin, na.rm = TRUE)
                 
)

totSC.strain.av.table <- add_subsp(totSC.strain.av.table)

```

```{r LONG.SHORT.biv_setup, echo=FALSE}

#FROM q1
#Q1.long.biv_1CO <-  real.long.bivData %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1) %>% filter(strain != "MOLF") %>% filter(strain != "CZECH")
#Q1.short.biv_1CO <-  real.short.bivData %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1)%>% filter(strain != "MOLF") %>% filter(strain != "CZECH")
#from Q2 IFD
#male.long.biv.2CO_IFD <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)
##long biv
#male.long.biv <- real.long.bivData %>% filter(sex== "male") %>% filter(species == "M.musculus") 
#table( droplevels( male.long.biv$strain)  )

#FROM q1 
REAL.short_mouse_table <- ddply(real.short.bivData, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                        ncells = length(unique(fileName)),
                         mean_SC = mean(chromosomeLength),
                        
                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                        
                      #make sure 1CO  
                       #IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE
                    mean_F1pos_ABS =  mean(Foci1[which(hand.foci.count == 1)]),
                    mean_F1pos_PER =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                           
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                                            
                         )

REAL.short_mouse_table <- add_sex(REAL.short_mouse_table)
REAL.short_mouse_table <- add_strain(REAL.short_mouse_table)
REAL.short_mouse_table <- add_subsp(REAL.short_mouse_table)
REAL.short_mouse_table <- add_category(REAL.short_mouse_table)

REAL.short_mouse_table$sex <- factor(REAL.short_mouse_table$sex, ordered = FALSE)
REAL.short_mouse_table$strain <- factor(REAL.short_mouse_table$strain, ordered = FALSE)
REAL.short_mouse_table$subsp <- factor(REAL.short_mouse_table$subsp, ordered = FALSE)

#divide musc males into groups
REAL.short_mouse_table$Rec.group <- ifelse(grepl("PWD male", REAL.short_mouse_table$category), 1, 
                                  ifelse(grepl("MSM male", REAL.short_mouse_table$category), 1,
                                  ifelse(grepl("SKIVE male", REAL.short_mouse_table$category), 1,
                                           0)))

REAL.short_mouse_table$Rec.group.exclu <- ifelse(grepl("PWD male", REAL.short_mouse_table$category), 1, 
                                ifelse(grepl("MSM male", REAL.short_mouse_table$category), 1, 0))

###LONG BIV

REAL.long_mouse_table <- ddply(real.long.bivData, c("mouse"), summarise,
                       n_obs = length(Obj.ID),
                        ncells = length(unique(fileName)),
                         mean_SC = mean(chromosomeLength),
                        
                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                        
                      #make sure 1CO,  #IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE
                    mean_F1pos_ABS =  mean(Foci1[which(hand.foci.count == 1)]),
                    mean_F1pos_PER =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                           
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                         )

REAL.long_mouse_table <- add_sex(REAL.long_mouse_table)
REAL.long_mouse_table <- add_strain(REAL.long_mouse_table)
REAL.long_mouse_table <- add_subsp(REAL.long_mouse_table)
REAL.long_mouse_table <- add_category(REAL.long_mouse_table)

REAL.long_mouse_table$sex <- factor(REAL.long_mouse_table$sex, ordered = FALSE)
REAL.long_mouse_table$strain <- factor(REAL.long_mouse_table$strain, ordered = FALSE)
REAL.long_mouse_table$subsp <- factor(REAL.long_mouse_table$subsp, ordered = FALSE)

#divide musc males into groups
REAL.long_mouse_table$Rec.group <- ifelse(grepl("PWD male", REAL.long_mouse_table$category), 1, 
                                  ifelse(grepl("MSM male", REAL.long_mouse_table$category), 1,
                                  ifelse(grepl("SKIVE male", REAL.long_mouse_table$category), 1,
                                           0)))

REAL.long_mouse_table$Rec.group.exclu <- ifelse(grepl("PWD male", REAL.long_mouse_table$category), 1, 
                                ifelse(grepl("MSM male", REAL.long_mouse_table$category), 1, 0))


#find which one 
```

```{r table.for.plot, echo=FALSE, warning=FALSE}
#why do I add in a different table?

#this move this to the setup file
#MLH1_data  %>% filter(quality < 5)  -- low quality cells removed

#pooled
strain.table.HQ_Fig.og <- ddply(MLH1_data  %>% filter(quality < 5), c("subsp","strain", "sex"), summarise,
                        Nmice =length(unique(mouse)),
                        Ncells  =length(nMLH1.foci),
                        mean_co =as.numeric(format(round(mean(nMLH1.foci), 3 ), nsmall=3) ),
                        cV = cv(nMLH1.foci, na.rm = TRUE),
                        var = as.numeric(format(round(   var(nMLH1.foci, na.rm = TRUE),3), nsmall=3)), 
                        sd   = round(sd(nMLH1.foci, na.rm = TRUE), 3),
                       #Standard error (mice vs cells)
                        se  = round(sd / sqrt(Ncells), 3)
                       
                       #range_mouse_means = range()
                   #consider adding crhm proportions?
    )


strain.table.HQ_Fig <-  strain.table.HQ_Fig.og %>% filter(strain != "F1" & strain != "PERC" &
                       strain != "TOM" &  strain != "AST" & strain != "CZECH" & strain != "CAROLI" & strain != "HMI")

#adjust order of plot here
strain.table.HQ_Fig$strain <- factor(strain.table.HQ_Fig$strain,levels =c(
     "MSM", "MOLF",   
  "PWD", "SKIVE",  "KAZ",
  "WSB","G","LEW","PERC",
                     "CAST",
                         "SPRET","SPIC" ), order=T )

```

```{r Fig1, echo=FALSE, warning=FALSE}

#might need to nudge the X values

Fig1_v1_strain <- ggplot(strain.table.HQ_Fig, aes(y=mean_co, x=strain, color=strain, shape=sex))+ 
  ylab("Average MLH1 Foci per Cell")+

  geom_point(aes(shape = sex), size=3, position=position_dodge(.5))+

    geom_errorbar(aes(ymin=mean_co-(se*2), ymax=mean_co+(se*2) ), width=.3, position = position_dodge(.5), size=1.001)+
  
  ylim(c(18, 35))+
 scale_color_manual(values=colors_of_strains)+ 

    theme(legend.position="none",
  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line=element_line(colour = "black"),
  axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())
#remove y labfor male 
 
   #segments
#  annotate("segment", x=.75, xend=4.5, y=19.5, yend=19.5, colour="black", size=1)+
  #Musc
#  annotate("segment", x= 5.5, xend=10.2, y=19.5, yend=19.5, colour="black", size=1)+
  #mol
#  annotate("segment", x=11, xend=12.25, y=19.5, yend=19.5, colour="black", size=1)+
  #cast
#  annotate("segment", x=13, xend=14, y=19.5, yend=19.5, colour="black", size=1)+
  #outgroups
 # annotate("segment", x=14.5, xend=16, y=19.5, yend=19.5, colour="black", size=1)+
  #label

 #   annotate("text", x = c(2,4.4,6,8, 10), #list of all x points 
   #        y = c(18.5,18.5,33,18.5, 18.5),
           
  # label = c("M. m. domesticus","M. m. musculus", "M. m. molossinus", "M. m. castaneus", "Outgroups"),
    #       fontface = 'italic', hjust = 0.5, size=3.5)



```

```{r female.show.plots, echo=FALSE, fig.width = 4, fig.height=2.5, warning=FALSE}

female_mouse.av <- subset(AP_mouse_table_w.Ages, select= -c(sex.y,sex.x,
                            subsp.y,subsp.x,
                    category.y,category.x, strain.x,
                    strain.y, mouse.1  )  )

female_mouse.av <- add_sex(female_mouse.av)
female_mouse.av <- add_strain(female_mouse.av)
female_mouse.av <- add_subsp(female_mouse.av)
female_mouse.av <- add_species(female_mouse.av)

female_mouse.avs_for.analysis <-  female_mouse.av %>% filter(sex== "female") %>% filter(species == "M.musculus") 

female_mouse.avs_for.analysis$subsp <- factor(female_mouse.avs_for.analysis$subsp, ordered = FALSE)
female_mouse.avs_for.analysis$sex <- factor(female_mouse.avs_for.analysis$sex, ordered = FALSE)
female_mouse.avs_for.analysis$strain <- factor(female_mouse.avs_for.analysis$strain, ordered = FALSE)
female_mouse.avs_for.analysis$species <- factor(female_mouse.avs_for.analysis$species, ordered = FALSE)

#table( droplevels(female_mouse.avs_for.analysis$strain) )
#there are cast strains too


Musc.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Musc")

female.specific.plot <- ggplot(female_mouse.avs_for.analysis, aes(x = as.factor(strain), y = mean_co, color= strain))+ geom_boxplot()+  geom_jitter(aes( alpha=0.5), width = .2 )+ ggtitle("Female mouse av")+scale_color_manual(values=colors_of_strains)+ylim(c(20,34))+
  theme(legend.position="none",
  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line=element_line(colour = "black"))+theme(axis.text.x = element_text(angle = 45, hjust = 1))

#female.specific.plot


```

```{r male.show.plots, echo=FALSE, fig.width = 4, fig.height=2.5, warning=FALSE, include=FALSE}
#try customize the plot size

male_mouse.av <- subset(AP_mouse_table_w.Ages, select= -c(sex.y,sex.x,
                            subsp.y,subsp.x,
                    category.y,category.x, strain.x,
                    strain.y, mouse.1  )  )

male_mouse.av <- add_sex(male_mouse.av)
male_mouse.av <- add_strain(male_mouse.av)
male_mouse.av <- add_subsp(male_mouse.av)
male_mouse.av <- add_species(male_mouse.av)

#just.male_mouse.av <-  male_mouse.av %>% filter(sex== "male") %>% #filter(species == "M.musculus") 


just.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

just.male_mouse.av$sex <- factor(just.male_mouse.av$sex, ordered = FALSE)
just.male_mouse.av$strain <- factor(just.male_mouse.av$strain, ordered = FALSE)
just.male_mouse.av$subsp <- factor(just.male_mouse.av$subsp, ordered = FALSE)
just.male_mouse.av$species <- factor(just.male_mouse.av$species, ordered = FALSE)

#table( droplevels(just.male_mouse.av$strain) )
#there are cast strains too

Musc.male_mouse.av <-  just.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Musc")

#fomo.male_mouse.av

male.plot <- ggplot(just.male_mouse.av, aes(x = as.factor(strain), y = mean_co, color= strain))+geom_jitter( alpha=0.5, width = .2) +geom_boxplot()+ ggtitle("Male mouse mean")+scale_color_manual(values=colors_of_strains)+ylim(c(20,34))+theme(legend.position="none",
  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line=element_line(colour = "black"))+theme(axis.text.x = element_text(angle = 45, hjust = 1))
male.plot

musc.male.plot <- ggplot(Musc.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = mean_co, color= strain, alpha=0.5), width = .2 )+ ggtitle("Musc male of MLH1 distributions")+scale_color_manual(values=colors_of_strains)+ylim(c(20,34))

```

```{r three.plots, echo=FALSE, warning=FALSE}
#merge the 3 plots
#try patchwork

#Fig1_v1_strain + female.specific.plot + male.plot

#Fig1_v1_strain + female.specific.plot - male.plot + plot_layout(ncol=1)
#Fig1_v1_strain / (female.specific.plot + male.plot )

#(p1 | p2 | p3)/p4
```

```{r main.fig1s, echo=FALSE, include=FALSE}
strain.table.HQ_Fig_F <-  strain.table.HQ_Fig %>% filter(sex == "female") %>% filter(strain != "CAST" & strain != "SPRET" & strain != "SPIC" )

Fig1_Female <- ggplot(strain.table.HQ_Fig_F, aes(y=mean_co, x=strain, color=strain, shape=sex))+ 
  ylab("Average MLH1 Foci per Cell")+

  geom_point( size=3, position=position_dodge(.5))+

    geom_errorbar(aes(ymin=mean_co-(se*2), ymax=mean_co+(se*2) ), width=.3, position = position_dodge(.5), size=1.001)+
  
  ylim(c(18, 35))+
 scale_color_manual(values=colors_of_strains)+ 

    theme(legend.position="none",
  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line=element_line(colour = "black"),
  axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())


#strain.table.HQ_Fig.og

strain.table.HQ_Fig_M <-  strain.table.HQ_Fig.og %>% filter(sex == "male") %>% filter(strain != "CAST" & strain != "SPRET" & strain != "SPIC" & strain != "PERC" & strain != "F1" & strain != "HMI" & strain != "CAROLI")

strain.table.HQ_Fig_M$strain <- factor(strain.table.HQ_Fig_M$strain,levels =c(
     "MSM", "MOLF",   
  "PWD", "SKIVE",  "KAZ", "TOM", "AST","CZECH",
  "WSB","G","LEW"), order=T )


Fig1_Male <- ggplot( strain.table.HQ_Fig_M, aes(y=mean_co, x=strain, color=strain, shape=sex))+ 
  ylab("Average MLH1 Foci per Cell")+

  geom_point(size=3, position=position_dodge(.5))+

    geom_errorbar(aes(ymin=mean_co-(se*2), ymax=mean_co+(se*2) ), width=.3, position = position_dodge(.5), size=1.001)+
  
  ylim(c(18, 35))+
 scale_color_manual(values=colors_of_strains)+ 

    theme(legend.position="none",
  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line=element_line(colour = "black"),
  axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())

```

```{r basic.numbers, echo=FALSE, eval=FALSE}

#kable(table(AP_mouse_table.HQ$category), col.names = c("Category", "mice"), label = "Number of mice by category" )


#kable(table(MLH1_data$category), col.names = c("Category","Cells"), label = "Number of Cells by category" )

```

```{r rand.misc, echo=FALSE, include=FALSE, eval=FALSE}
#str(AP_mouse_table_w.Ages)

AP_mouse_table.HQ$var <- as.numeric(AP_mouse_table.HQ$var)

#remove sex.x == na, and strain.x=na or F1
AP_mouse_table.HQ <- AP_mouse_table.HQ[!(is.na(AP_mouse_table.HQ$sex) | AP_mouse_table.HQ$sex==""), ]

AP_mouse_table.HQ <- AP_mouse_table.HQ[!(is.na(AP_mouse_table.HQ$var) | AP_mouse_table.HQ$var==""), ]
#plot variance and mean (facet sex)

AP_mouse_table_w.Ages <- AP_mouse_table_w.Ages[!( AP_mouse_table_w.Ages$strain.x =="F1"), ]

VandMean.mouse <- ggplot(aes(x=mean_co, y = var), data=AP_mouse_table.HQ )+geom_point(aes(color=strain))+facet_wrap(~sex)+ggtitle("mouse MLH1 averages; variance by mean")

cVandMean.mouse <- ggplot(aes(x=mean_co, y = cV), data=AP_mouse_table.HQ )+geom_point(aes(color=strain))+facet_wrap(~sex)+ggtitle("mouse MLH1 averages; cV by means")

#str(AP_mouse_table.HQ)

cor(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "female"], AP_mouse_table.HQ$var[AP_mouse_table.HQ$sex == "female"])
#[1] 0.5750399
cor(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "male"], AP_mouse_table.HQ$var[AP_mouse_table.HQ$sex == "male"])
#0.321601

cor(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "female"], AP_mouse_table.HQ$cV[AP_mouse_table.HQ$sex == "female"])
# 0.3515544
cor(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "male"], AP_mouse_table.HQ$cV[AP_mouse_table.HQ$sex == "male"])
#-0.03713536

cor.test(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "male"], 
    AP_mouse_table.HQ$var[AP_mouse_table.HQ$sex == "male"] )
# p-value = 8.623e-09

cor.test(AP_mouse_table.HQ$mean_co[AP_mouse_table.HQ$sex == "male"], 
    AP_mouse_table.HQ$cV[AP_mouse_table.HQ$sex == "male"] )


#remove mice with fewer than 10 cells

AP_mouse_table.HQ.10plus <- AP_mouse_table.HQ[AP_mouse_table.HQ$Ncells >= 10,]

VandMean.mouse.10plus <- ggplot(aes(x=mean_co, y = var), data=AP_mouse_table.HQ.10plus )+geom_point(aes(color=strain))+facet_wrap(~sex)+ggtitle("10 plus mouse MLH1 averages; variance by mean")

cor(AP_mouse_table.HQ.10plus$mean_co[AP_mouse_table.HQ.10plus$sex == "female"], AP_mouse_table.HQ.10plus$cV[AP_mouse_table.HQ.10plus$sex == "female"])


cor.test(AP_mouse_table.HQ.10plus$mean_co[AP_mouse_table.HQ.10plus$sex == "female"], 
    AP_mouse_table.HQ.10plus$var[AP_mouse_table.HQ.10plus$sex == "female"] )



#why did I male just a female table?
female.musc.cells <- MLH1_data[( MLH1_data$sex == "female") & (MLH1_data$subsp == "Musc" ), ]

female.musc.mice.table <- ddply(female.musc.cells, c("sex"), summarise,
                        Nmice = length(unique(mouse)),
                        Ncells  = length(adj_nMLH1.foci),
                        mean_co = as.numeric(format(round(  mean(adj_nMLH1.foci), 3 ), nsmall=3) ),
                        cV = cv(adj_nMLH1.foci),
                        var = format(round(   var(adj_nMLH1.foci),3), nsmall=3),
                        sd   = round(sd(adj_nMLH1.foci), 3),
                        se   = round(sd / sqrt(Ncells), 3)
                        #quality?
)
```


# genome-wide recombination rate estimates for both sexes

<notes about figure; make sure the order highlights the difference (mol, musc, dom). Clean up the axis and titles. Resizing might be an issue too.>


```{r MLH1.summ.stats, echo=FALSE}

#strain.table.HQ_Fig.og  all strains
#strain.table.HQ_Fig  extra strains removed

main.table <- strain.table.HQ_Fig.og  %>% filter(strain != "F1")

main.table <- add_subsp(main.table)
main.table <- add_species(main.table)

#main.table %>% filter(sex == "female")
#main.table %>% filter(sex == "male")

#G.HETC.val #1.2
#LEW.HETC.val  #1
#WSB.HETC.val  #1
#KAZ.HETC.val  #1.1

#SKIVE.HETC.val # 0.96
#PWD.HETC.val  #0.88
#MSM.HETC.val #0.9

#kable(head(main.table),  caption = "Table 1. MLH1 counts per cell summary statistics by strain")

#strain.table.HQ_Fig

#sum( (main.table  %>% filter(sex == "male"))$Ncells)
#the kable version is bulkier than the other versaion

```

```{r MLH1.sum.stats.Bret.edits, echo=FALSE}

AP_mouse_table.HQ <- add_species(AP_mouse_table.HQ)
#total mice
#length( unique(AP_mouse_table.HQ %>% filter(species == "M.musculus") )$mouse )

#average cell number for spermatocytes and oocytes
#mean(female_mouse.avs_for.analysis$Ncells, na.rm = T)
#mean( (male_mouse.av %>% filter(species == "M.musculus") )$Ncells, na.rm = T)
```


We used counts of MLH1 foci per cell to estimate genome-wide recombination rates in `r length(unique(  (main.table  %>% filter(species == "M.musculus") )$strain) )` wild-derived inbred strains sampled from three subspecies of house mice: *M. m. domesticus*, *M. m. musculus* and *M. m. molossinus*. Mean MLH1 foci counts for `r length( unique(AP_mouse_table.HQ %>% filter(species == "M.musculus") )$mouse )` mice were quantified from an average of `r mean( (male_mouse.av %>% filter(species == "M.musculus") )$Ncells, na.rm = T)` spermatocytes per male (for a total of `r sum( (main.table %>% filter(species == "M.musculus") %>% filter(sex == "male"))$Ncells)` spermatocytes) and `r mean(female_mouse.avs_for.analysis$Ncells, na.rm = T)` oocytes per female (for a total of `r sum( (main.table %>% filter(species == "M.musculus") %>% filter(sex == "female"))$Ncells)` oocytes). 


Graphical comparisons between the two sexes reveal several patterns (Figure 1A). First, recombination rate differs between females and males in most strains. Second, the direction and magnitude of heterochiasmy varies among strains. Although the majority of strains show higher recombination rates in females (following the pattern in laboratory mice), two musculus strains and one molossinus strain exhibit male-biased heterochiasmy. Hence, relative recombination rates in the two sexes are evolutionarily labile.  


The general patterns of heterochiasmy in house mouse are displayed in Figure 1A. Taking note of the direction and the magnitude of the sex differences, our results confirm two general patterns: i) genome-wide recombination rates averages are greater in females compared to males (female biased heterochiasmy) and ii) the degree of heterochiasmy (Female:Male ratio) is generally low, ranging from `r G.HETC.val` in _domesticus^G^_ to `r LEW.HETC.val` in _domesticus^LEW^_. Three notable exceptions of male biased heterochiasmy are the strains _musculus^PWD^_, _molossinus^MSM^_ and _musculus^SKIVE^_, with heterochiasmy values of `r PWD.HETC.val`, `r MSM.HETC.val` and `r SKIVE.HETC.val` respectively.  


Separately examining the mouse means of MLH1 foci per cell for each sex points to distinct patterns of variation (Figure 1B-C). Female recombination rates are evenly distributed around the sex-wide mean of approximately 25 MLH1 foci per cell (Figure 1B). In stark contrast, males separate more clearly into two groups of strains with high rates (near 30 MLH1 foci per cell) and low rates (near 23 MLH1 foci per cell) (Figure 1C).


```{r female.strain.table, echo=FALSE}
female_mouse.avs_for.analysis <- female_mouse.avs_for.analysis %>% filter(strain != "CAST")
#female strain table
#female_mouse.avs_for.analysis
F.strain.table <- ddply(female_mouse.avs_for.analysis, c("strain"), summarise,
                       
                        Nmice = length(unique(mouse)),
                        
                        total.cells  = sum(Ncells, na.rm = TRUE),
                        
                        mouse.mean_co = mean(mean_co, na.rm=TRUE),
                       
                        mean.mouse_cV = mean(cV, na.rm = TRUE),
                        
                        mean.mouse_var = mean(var, na.rm = TRUE ), 
                        
                        mean.mouse_sd   = mean(sd, na.rm = TRUE ),
                       
                        #Standard error (mice vs cells)
                        mean.mouse_se  = mean(se, na.rm=TRUE)
    )
#F.strain.table

#F.strain.table

# I don't know why most of the table is blank
```

```{r female.dif, echo=FALSE}

#how much greater are the high strains?
G_female <-  female_mouse.avs_for.analysis %>% filter(strain == "G")
mean.G.female <- mean(G_female$mean_co, na.rm=TRUE)

LEW_female <-  female_mouse.avs_for.analysis %>% filter(strain == "LEW")
mean.LEW.female <- mean(LEW_female$mean_co, na.rm=TRUE)

#how much greater is MSM female
MSM_female <-  female_mouse.avs_for.analysis %>% filter(strain == "MSM")
mean.MSM.female <- mean(MSM_female$mean_co, na.rm=TRUE)


sans_high_female <- female_mouse.avs_for.analysis %>% filter(strain != "G") %>%  filter(strain != "MSM") %>%  filter(strain != "LEW")
mean.all.other <- mean(sans_high_female$mean_co, na.rm=TRUE)


G.female.diff <- (mean.G.female / mean.all.other)
LEW.female.diff <- (mean.LEW.female / mean.all.other)
MSM.female.diff <- (mean.MSM.female / mean.all.other)
```

```{r mouse.var.plots.female, echo=FALSE, fig.width = 4, fig.height=2.5, include=FALSE, eval=FALSE}
Musc.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Musc")

#variance plots
musc.female.VAR.plot <- ggplot(Musc.female_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Musc female of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)
musc.female.VAR.plot

#Mol.female.VAR.plot <- ggplot(Mol.female_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Mol female of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)
#Mol.female.VAR.plot

Dom.female.VAR.plot <- ggplot(Dom.female_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Dom feale ofwithin mouse  MLH1 distributions")+scale_color_manual(values=colors_of_strains)
Dom.female.VAR.plot

```

```{r Female.specific.glm, echo=FALSE}

glm.female.strain.subsp <- glm(mean_co ~ subsp * strain, data= female_mouse.avs_for.analysis)

summry.female.strain.effects <- summary(glm.female.strain.subsp)
#round(summry.female.strain.effects$coefficients[,c(1,4)],5)
#write.table(summry.female.strain.effects$coefficients, "~./MLH1repo/summry.female.strain.effects.csv", sep=",",row.names = TRUE)

MLH1.female.spc.glm.M2 <- glm(mean_co ~ strain, data= female_mouse.avs_for.analysis)
sum_MLH1.female.spc.glm.M2 <- summary(MLH1.female.spc.glm.M2)

#round(lm.female.strain_sum$coefficients[,c(1,4)],5)

#write.table(lm.female.strain_sum$coefficients, "~./MLH1repo/lm.female.strain.csv", sep=",",row.names = TRUE)
```

```{r FEMALE.VAR.MODELS, echo=FALSE}
## within mouse variance models 
lmVAR.female.strain.subsp <- glm(var ~ subsp * strain, data= female_mouse.avs_for.analysis)
summry.female.strain.VAReffects <- summary(lmVAR.female.strain.subsp)

lmVAR.female.strain <- glm(var ~ strain, data= female_mouse.avs_for.analysis)
lmVAR.female.strain_sum <- summary(lmVAR.female.strain)

#round( #round isn't working for this sumary
#lmVAR.female.strain_sum$coefficients[,c(1,4)]
#Q12
Q12_female_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "female")

lm.m1.Q12_female <- glm(var ~ subsp * strain, data= Q12_female_table)
lm.m1.Q12_female_sum <- summary(lm.m1.Q12_female)


lm.m2.Q12_female <- glm(var ~ strain, data= Q12_female_table)
lm.m2.Q12VAR.female_sum <- summary(lm.m2.Q12_female)#LEW changes to PWD

lm.m2.Q12_female.cv <- glm(cV ~ strain, data= Q12_female_table)
lm.m2.Q12_female.cv_sum <- summary(lm.m2.Q12_female.cv)

#lm.m2.Q12VAR.female_sum$coefficients[,c(1,4)]
#LEW sig

```
<!-- male section -->

```{r male.strain.table, echo=FALSE}
M.strain.table <- ddply(fomo.male_mouse.av, c("strain"), summarise,
                        Nmice =length(unique(mouse)),
                        
                        totNcells  = sum(Ncells, na.rm=TRUE),
                        
                        mean.mouse_mean_co = mean(mean_co, na.rm=TRUE),
                       
                        mean.mouse_cV = mean(cV, na.rm = TRUE),
                        
                        mean.mouse_var = mean(var, na.rm = TRUE ), 
                        
                        mean.mouse_sd   = mean(sd, na.rm=TRUE),
                       
                        #Standard error (mice . cells)
                        mean.mouse_se  = mean(se, na.rm=TRUE)
    )
#M.strain.table
#same issue as the female table .. ugh
```

```{r male.diff, echo=FALSE}
just.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

just.male_mouse.av$sex <- factor(just.male_mouse.av$sex, ordered = FALSE)
just.male_mouse.av$strain <- factor(just.male_mouse.av$strain, ordered = FALSE)
just.male_mouse.av$subsp <- factor(just.male_mouse.av$subsp, ordered = FALSE)
just.male_mouse.av$species <- factor(just.male_mouse.av$species, ordered = FALSE)


#how much greater are the High Rec gwRRs
just.male_mouse.av$Rec.group <- ifelse(grepl("PWD", just.male_mouse.av$strain), 1, 
                              ifelse(grepl("MSM", just.male_mouse.av$strain), 1,
                                ifelse(grepl("SKIVE", just.male_mouse.av$strain), 1, 0)))


#how much bigger are the high rec male means?
sans_LewRec_male <- just.male_mouse.av %>% filter(Rec.group == 0)
#mean(sans_LewRec_male$mean_co)

PWD_male <-  just.male_mouse.av %>% filter(strain == "PWD")
#mean(PWD_male$mean_co) / mean(sans_LewRec_male$mean_co)

MSM_male <- just.male_mouse.av %>% filter(strain == "MSM")
#mean(MSM_male$mean_co) / mean(sans_LewRec_male$mean_co)

SKIVE_male <-   just.male_mouse.av %>% filter(strain == "SKIVE")
#mean(SKIVE_male$mean_co) /  
```

```{r mouse.var.plots.male, echo=FALSE, fig.width = 4, fig.height=2.5, include=FALSE, include=FALSE, eval=FALSE}

#variance plots
musc.male.VAR.plot <- ggplot(Musc.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Musc male of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)


Mol.male.VAR.plot <- ggplot(Mol.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Mol male of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)


Dom.male.VAR.plot <- ggplot(Dom.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Dom male ofwithin mouse  MLH1 distributions")+scale_color_manual(values=colors_of_strains)

```

```{r Male.specific.glm, echo=FALSE}
# 1 way anova, is at least 1 strain different from the rest?
# given a lm, how sig is the strain effect
glm.male.strain.subsp <- glm(mean_co ~ subsp * strain, data= just.male_mouse.av)

#summry.male.strain.effects <- summary(glm.male.strain.subsp)
#round(summry.male.strain.effects$coefficients[,c(1,4)], 5)

#write.table(summry.male.strain.effects$coefficients , "~./MLH1repo/summry.male.strain.effects.csv", sep=",",row.names = TRUE)

#1. determine which strain effects are sig

#M2
MLH1.male.specific.glm.M2 <- glm(mean_co ~ strain, data= just.male_mouse.av)
sum_MLH1.male.specific.glm.M2 <- summary(MLH1.male.specific.glm.M2)

#round(lm.male.strain_sum$coefficients[,c(1,4)], 5)

#write.table(lm.male.strain_sum$coefficients , "~./MLH1repo/lm.male.strain_sum.csv", sep=",",row.names = TRUE)

#even when all the other male strains are added -- the same result; PWD, MSM and SKIVE strain effects are significant.
```

```{r MALE.SPECIFIC.variance.model, echo=FALSE}
## within mouse variance models 
lmVAR.male.strain.subsp <- lm(var ~ subsp * strain, data= just.male_mouse.av)
summry.male.strain.VAReffects <- summary(lmVAR.male.strain.subsp)
#round(summry.male.strain.VAReffects$coefficients[,c(1,4)], 5)

#all p values kinda high, MSM and TOM are slightly sig
lmVAR.male.strain <- lm(var ~ strain, data= just.male_mouse.av)
lmVAR.male.strain_sum <- summary(lmVAR.male.strain)
#round(lmVAR.male.strain_sum$coefficients[,c(1,4)], 5)
#non sig

lmcv.male.strain <- lm(cV ~ strain, data= just.male_mouse.av)
lmcv.male.strain_sum <- summary(lmcv.male.strain)
#round(lmcv.male.strain_sum$coefficients[,c(1,4)], 5)
#HMI sig for cv model -- in the other model, CAST subsp and TOM strain are slightly significant

#Q12
Q12_male_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "male")

lm.m1.Q12_male <- lm(var ~ subsp * strain, data= Q12_male_table)
lm.m1.Q12_male_sum <- summary(lm.m1.Q12_male)
#round(lm.m1.Q12_male_sum$coefficients[,c(1,4)], 5)
#NS

lm.m2.Q12_male <- lm(var ~ strain, data= Q12_male_table)
lm.m2.Q12VAR.male_sum <- summary(lm.m2.Q12_male)
#round(lm.m2.Q12VAR.male_sum$coefficients[,c(1,4)], 5)
#NS

```


# Partitioning variation in recombination rate


```{r MLH1co.lmer.MM, echo=FALSE, waring=FALSE, message=FALSE}

#DF.HetC.MixedModel.HQ

MLH1.MM.M1 <- lmer(mean_co ~ subsp * sex + (1|strain), data=DF.HetC.MixedModel.HQ) 
MLH1.MM.M1.reduce.sex <- lmer( mean_co ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1.MM.M1.reduce.subp <- lmer( mean_co ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

#summary(MLH1.MM.M1)$coefficients

MLH1.MM_interaction <- drop1(MLH1.MM.M1, test="Chisq")$`Pr(Chi)`[2]
MLH1.MM_sex <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
MLH1.MM_subp <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
MLH1.MM_strain<- MM.rand.pval <- exactRLRT(MLH1.MM.M1)$p.value 

MLH1.MMlmer_results <- data.frame(sub.sp = MLH1.MM_subp, 
sex.results =  MLH1.MM_sex, 
               interaction.pval = MLH1.MM_interaction,  rand.pval = 
MLH1.MM_strain)

```

```{r MLH1.glmM2, echo=FALSE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")
#AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
#kkll <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

#strain = fixed
MLH1.M2.glm.strain.fixed.full <- glm(mean_co ~ subsp * sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]   )

summ.MLH1.M2.glm.strain.fixed.full <- summary(MLH1.M2.glm.strain.fixed.full)

#table of just coeff anf pvalue
#round(summ$coefficients[,c(1,4)],5 )

#write.table(summ$coefficients , "~./MLH1repo/glm.strain.fixed.full.csv", sep=",",row.names = TRUE)
```


```{r MLH1.glm.M3, echo=FALSE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

MLH1.M3.strain.fixed <- lm(mean_co ~ sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,])

summ.MLH1.M3.strain.fixed <- summary(MLH1.M3.strain.fixed)

#round(summ.strain.fixed$coefficients[,c(1,4)],5)

#write.table(summ.strain.fixed$coefficients , "~./MLH1repo/summ.strain.fixed.csv", sep=",",row.names = TRUE)
```


```{r bret.comment.var, echo=FALSE}



```


To situate variation in recombination rate within an evolutionary framework, we fit a series of models including subspecies, strain, and sex, to mean MLH1 foci counts from `r length(DF.HetC.MixedModel.HQ$mean_co)` mice. We began with a full mixed model (M1, see Methods), which showed that strain 
(random effect p < `r MLH1.MMlmer_results$rand.pval`   **someSmallNumber**), sex (p = `r MLH1.MMlmer_results$sex.results`), subspecies (p=`r MLH1.MMlmer_results$sub.sp`), and subspecies sex (p = `r MLH1.MMlmer_results$interaction.pval`) each significantly affect recombination rate. 


After a general linear model including all factors as fixed effects (M2) revealed only weak contributions of subspecies, we focused on additional models designed to illuminate the role of strain and sex. A general linear model with these two variables (M3) identified two strains with particularly strong effects on recombination rate: musculus^MSM^ (p= `r summ.MLH1.M3.strain.fixed$coefficients[,4][6]`)
and domesticus^G^ (`r summ.MLH1.M3.strain.fixed$coefficients[,4][3]`). In addition, two strains exhibit strain-by-sex interactions:  molossinus^MSM^  (`r summ.MLH1.M3.strain.fixed$coefficients[,4][13]`) and musculus^PWD^ (`r summ.MLH1.M3.strain.fixed$coefficients[,4][12]`). 


We next fit general linear models separately for `r length(fomo.male_mouse.av$mouse)` males and `r length(female_mouse.avs_for.analysis$mouse)` females (M4  **male specific, M2? rename the code for these models**). In the male dataset, three strains significantly affect recombination rate: musculus^PWD^ ((glm; p = `r sum_MLH1.male.specific.glm.M2$coefficients[5,][4]`; effect = 
`r MLH1.male.specific.glm.M2$coefficients[5]` -- ~ 5 foci), and musculus^SKIVE^ (glm; p = 0.01; `r sum_MLH1.male.specific.glm.M2$coefficients[8,][4]` -- effect = `r MLH1.male.specific.glm.M2$coefficients[8]` -- ~7 foci), and  _molossinus^MSM^_ (glm; p=`r sum_MLH1.male.specific.glm.M2$coefficients[6,][4]`; effect  `r MLH1.male.specific.glm.M2$coefficients[6]` ~ 2 foci). These three strains point to rapid evolution in recombination rate in spermatocytes; we subsequently refer to them collectively as "high-recombination" strains.  Analysis of the female dataset points to four strains with significant effects on recombination rate: domesticus^G^ (p = `r sum_MLH1.female.spc.glm.M2$coefficients[2,][4]`), molossinus^MSM^ (p = `r sum_MLH1.female.spc.glm.M2$coefficients[5,][4]`), domesticus^LEW^ (p = `r sum_MLH1.female.spc.glm.M2$coefficients[3,][4]`), and musculus^PWD^ (p= `r sum_MLH1.female.spc.glm.M2$coefficients[4,][4]`). Strain effect sizes in females are modest in magnitude (ranging from 1 to 4 foci) compared to those in males. 

<in the above section reorder the strains by the effect sizes>


Together, these results demonstrate heritable differences in the genome-wide recombination rate evolving in a highly sex-specific manner over short evolutionary timescales.

<bret above>

<!-- transition gwRR to within mouse variance -->

# Within mouse variance in CO count per cell


**re-read Lenzi et al -- heterogeneity in oogenesis**


```{r M1.MLH1.var_cv, echo=FALSE, warning=FALSE, message=FALSE}

MLH1var_M1 <- lmer( var ~ subsp * sex +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1var_M1.reduce.sex <- lmer( var ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1var_M1.reduce.subp <- lmer( var ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

#summary(MLH1var_M1)
LmerMLH1_VAR_int <- drop1(MLH1var_M1, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_VAR_sex <- anova(MLH1var_M1, MLH1var_M1.reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_subsp <- anova(MLH1var_M1, MLH1var_M1.reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_strain <- exactRLRT(MLH1var_M1)$p.value

LmerMLH1_VAR_results <- data.frame(sub.sp = LmerMLH1_VAR_subsp,
sex.results =  LmerMLH1_VAR_sex, interaction.pval = LmerMLH1_VAR_int,  rand.pval = LmerMLH1_VAR_strain)


#CV
MLH1cV_M1 <- lmer( cV ~ subsp * sex +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1cV_M1.reduce.sex <- lmer( cV ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1cV_M1.reduce.subp <- lmer( cV ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

LmerMLH1_CV_int <- drop1(MLH1cV_M1, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_CV_sex <- anova(MLH1cV_M1, MLH1cV_M1.reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_CV_subsp <- anova(MLH1cV_M1, MLH1cV_M1.reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_CV_strain <- exactRLRT(MLH1cV_M1)$p.value

LmerMLH1_CV_results <- data.frame(sub.sp = LmerMLH1_CV_subsp,
sex.results =  LmerMLH1_CV_sex, interaction.pval = LmerMLH1_CV_int,  rand.pval = LmerMLH1_CV_strain)

#USE Q12 (Q123) table
#Q12_mouse_table_w.Ages
#Q12 var
MLH1var_M1_Q12 <- lmer( var ~ subsp * sex +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1var_M1_Q12reduce.sex <- lmer( var ~ subsp  +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1var_M1_Q12reduce.subp <- lmer( var ~ sex  +(1|strain), data=Q12_mouse_table_w.Ages )

LmerMLH1_M1_Q12VAR_int <- drop1(MLH1var_M1_Q12, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_M1_Q12_VAR_sex <- anova(MLH1var_M1_Q12, MLH1var_M1_Q12reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_VAR_subsp <- anova(MLH1var_M1_Q12, MLH1var_M1_Q12reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_VAR_strain <- exactRLRT(MLH1var_M1_Q12)$p.value

LmerMLH1_M1_Q12_VAR_results <- data.frame(sub.sp = LmerMLH1_M1_Q12_VAR_subsp,
sex.results =  LmerMLH1_M1_Q12_VAR_sex, interaction.pval = LmerMLH1_M1_Q12VAR_int,  rand.pval = LmerMLH1_M1_Q12_VAR_strain)

#Q12 cv
MLH1cv_M1_Q12 <- lmer( cV ~ subsp * sex +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1cv_M1_Q12reduce.sex <- lmer( cV ~ subsp  +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1cv_M1_Q12reduce.subp <- lmer( cV ~ sex  +(1|strain), data=Q12_mouse_table_w.Ages )

LmerMLH1_M1_Q12_CV_int <- drop1(MLH1cv_M1_Q12, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_M1_Q12_CV_sex <- anova(MLH1cv_M1_Q12, MLH1cv_M1_Q12reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_CV_subsp <- anova(MLH1cv_M1_Q12, MLH1cv_M1_Q12reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_CV_strain <- exactRLRT(MLH1cv_M1_Q12)$p.value

LmerMLH1_M1_Q12_VAR_results <- data.frame(sub.sp = LmerMLH1_M1_Q12_CV_subsp,
sex.results =  LmerMLH1_M1_Q12_CV_sex, interaction.pval = LmerMLH1_M1_Q12_CV_int,  rand.pval = LmerMLH1_M1_Q12_CV_strain)
```

```{r M2.MLH1.var, echo=FALSE, include=FALSE}
#not including this model for now / brivity
#$$mouse CO metric  ~=~ subsp * sex * strain + \varepsilon$$

#why are these named M3? -- rename to M2

MLH1var_M2 <- lm( var ~ subsp * sex * strain,  data=DF.HetC.MixedModel.HQ )

MLH1var_M2_sum <- summary(MLH1var_M2)

#summary(MLH1var_M2)
#anova(MLH1var_M2)  
#as.data.frame( round(summary(MLH1var_M2)$coefficients, 6)) #table of p values for coefficients.


MLH1cv_M2 <- lm(cV ~ subsp*sex*strain, data=DF.HetC.MixedModel.HQ)

#summary(MLH1cv_M3)

#anova(MLH1cv_M2)
#as.data.frame( round(summary(MLH1cv_M2)$coefficients, 6))

#Q12 var
MLH1var_M2_Q12 <- lm( var ~ subsp*sex*strain,  data=Q12_mouse_table_w.Ages )

#summary(MLH1var_M3_Q12)
#anova(MLH1var_M2_Q12)  
#as.data.frame( round(summary(MLH1var_M2_Q12)$coefficients, 6))

#Q12 cv
MLH1cv_M2_Q12 <- lm( cV ~ subsp*sex*strain, data=Q12_mouse_table_w.Ages )

#summary(MLH1cv_M2_Q12)
#anova(MLH1cv_M2_Q12)#sex large F
#as.data.frame( round(summary(MLH1cv_M2_Q12)$coefficients, 6))
```

```{r M3.MLH1.var, echo=FALSE}
glmMLH1Var_M3 <- glm( var ~ sex * strain,  data=DF.HetC.MixedModel.HQ )
glmMLH1Var_M3_sum <- summary(glmMLH1Var_M3)
#round(glmMLH1Var_M3_sum$coefficients[,c(1,4)], 5)

#use the values from this model below

MLH1cv_M3 <- glm(cV ~ sex * strain, data=DF.HetC.MixedModel.HQ)
#summary(MLH1cv_M4)
#round(summary(MLH1cv_M3)$coefficients[,c(1,4)], 6)

### Q12 var
MLH1var_M3_Q12 <- glm( var ~ sex*strain, data=Q12_mouse_table_w.Ages )
MLH1var_M3_Q12_sum <- summary(MLH1var_M3_Q12)

#as.data.frame( round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6))
#round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6)

#Q12 cv
MLH1cv_M4_Q12 <- glm( cV ~ sex*strain, data=Q12_mouse_table_w.Ages )
#round(summary(MLH1cv_M4_Q12)$coefficients[,c(1,4)], 6)
```


Counting MLH1 foci in multiple oocytes for each female and multiple spermatocytes for each male allowed us to examine determinants of the within-mouse variance in recombination rate. To do this, we considered the same models as above, but replaced mean MLH1 foci count with within-mouse variance in MLH1 foci count as the dependent variable. Sex is the only variable that significantly affects recombination rate in both the mixed model (M1) (p < **smallNumber** -- `r round(LmerMLH1_VAR_results$sex.results, 5)`) and general linear model (M2) (p = `r round(MLH1var_M3_Q12_sum$coefficients[,4][2], 5)` (old) `r round(MLH1var_M2_sum$coefficients[,4][4], 5)`  correct). **the pland full M2 model is not significant**.  M3 `r round(glmMLH1Var_M3_sum$coefficients[,4][2], 5)`. 

In general, females have almost twice as much variance in MLH1 foci per cell compared to males (Figure 1). Since estimates of within-mouse variance may be more susceptible to technical error from the staining protocol, we repeated the analyses using a subset of cells with higher quality scores (quality score 1 and 2, see Materials and Methods).  

<Bret's comment for below, are there differences between the curated and the full dataset? he propbably means, Q1 and full data set.>

The results are similar: sex is the strongest effect (p < **smallNumber** `r round(LmerMLH1_M1_Q12_VAR_results$sex.results, 5)`, M1; p = `r  round(MLH1var_M3_Q12_sum$coefficients[2,4], 5)`, M2 -- also M3). When both quality-curated and full datasets are considered, strain does not significantly and consistently affect variance in MLH1 foci count per cell in either sex. These results suggest that within-mouse variance in recombination rate evolves independently of mean recombination rate.

<strain specific effect section was deleted for not highlighting main pattern. I agree>


# DSB. Evolution of genome-wide recombination rate is associated with evolution of double strand breaks


```{r DMC1.setup, echo=FALSE}
#load DMC1 csv
#DMC1.DF <- read.csv("~./DMC1/newJuviQuant.csv", header = TRUE)
DMC1.DF <- read.csv("~./MLH1repo/data/DMC1newJuviQuant.csv", header = TRUE)


DMC1.DF$fileName <- DMC1.DF$Original.Name
DMC1.DF <- add_mouse(DMC1.DF)
DMC1.DF <- add_strain(DMC1.DF)
DMC1.DF <- add_category(DMC1.DF)
DMC1.DF <- add_subsp(DMC1.DF)
DMC1.DF <- DMC1.DF[DMC1.DF$stage != "P",]

#make DMC1 table
DMC1.mean.obs.L <- ddply(.data=DMC1.DF[DMC1.DF$stage == "L",],
                 .(category),
                 summarize, 
                 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.L$stage <- "L"

DMC1.mean.obs.Z <- ddply(.data=DMC1.DF[DMC1.DF$stage == "Z",],
                 .(category),
                 summarize, 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.Z$stage <- "Z"

DMC1.mean.table <- rbind(DMC1.mean.obs.L,DMC1.mean.obs.Z)

#write.table(DMC1.mean.table, "~./MLH1repo/DMC1.mean.table.csv", sep=",",
#            row.names = FALSE)

DMC1.DF$rec_group <- ifelse(grepl("WSB", DMC1.DF$strain), "Low",
                          ifelse(grepl("G",DMC1.DF$strain), "Low",
                                 
              ifelse(grepl("KAZ", DMC1.DF$strain), "Low",
            ifelse(grepl("PWD", DMC1.DF$strain), "High",
               ifelse(grepl("MSM", DMC1.DF$strain), "High","")))))
```

```{r MAIN.DMC1.plot, echo=FALSE, warning=FALSE}
#think of better color scheme
#make the jitter col thinner or make the stacked dots.
#remember that box-plots add outlier dots.
#change y labels

#experimenting with ggboplot
everyday <- ggboxplot(DMC1.DF[DMC1.DF$stage != "P",], x = "strain", y = "total.count",
          color = "stage", palette = "jco",
          add = "jitter", short.panel.labs = FALSE)
  #library gpubr has functions to add in sig/test bars.

#change order

DMC1.DF$strain<- factor(DMC1.DF$strain, levels =c("LEW",
                      "WSB","G", "KAZ", "SKIVE","PWD","MSM"), order=T )


DMC1.boxplot <- ggplot(aes(x=strain, y=total.count, color=stage), data=DMC1.DF[DMC1.DF$stage != "P",])+
  geom_boxplot(alpha=.5) +geom_jitter()+ggtitle("DMC1 averages in juvenile mice")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))

DMC1.boxplot
```

```{r plot.stage.ttest, echo=FALSE, warning=FALSE}

anno_df_stage = compare_means(total.count ~ stage, group.by = "rec_group", data = DMC1.DF[DMC1.DF$stage != "P",],method = "t.test") %>% mutate(y_pos = 300)
#

DMC1.bxlt_Z_to_L <- ggplot(DMC1.DF[DMC1.DF$stage != "P",], aes(x=stage, y=total.count)) + 
  geom_boxplot(position=position_dodge()) + 
  geom_point(aes(color=rec_group), position=position_jitterdodge()) + 
  
  #facet_wrap(~stage, nrow=1) + 
  
  ggsignif::geom_signif(
    data=anno_df_stage, 
    aes(xmin=group1, xmax=group2, annotations=p.adj, y_position=y_pos), 
    manual=TRUE
  )+ggtitle("Comparison of DMC1 means across high and low recombing groups")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))

#Musc.mouse.av <-  Mouse.Table_BivData_4MM %>%  filter(subsp == "Musc") 

ttest.ZtoL <- t.test(DMC1.DF$total.count[(DMC1.DF$stage == "L")],
               DMC1.DF$total.count[(DMC1.DF$stage == "Z")]  )


DMC1.High.goup <-  DMC1.DF %>%  filter(rec_group == "High") 

ttest.ZtoL.high <- t.test(DMC1.High.goup$total.count[(DMC1.High.goup$stage == "L")],
               DMC1.High.goup$total.count[(DMC1.High.goup$stage == "Z")]  )


DMC1.Low.goup <-  DMC1.DF %>%  filter(rec_group == "Low") 

ttest.ZtoL.Low <- t.test(DMC1.Low.goup$total.count[(DMC1.Low.goup$stage == "L")],
               DMC1.Low.goup$total.count[(DMC1.Low.goup$stage == "Z")]  )
```

```{r plot.t.test, echo=FALSE, include=FALSE}

  #this will add neat bars, but still need to figure out what groups ect it's actually using
#THE stat_compare function adds a arm thing and pvalue for 
#  stat_compare_means(comparisons = my_comparisons)

#status - legend, expression y-axis, facet, facet_wrap SYMBOL
#legend - stage. y=total count, FACet strain


#add column to distinguish high vs low rec strains
DMC1.DF$rec_group <- ifelse(grepl("WSB", DMC1.DF$strain), "Low",
                          ifelse(grepl("G",DMC1.DF$strain), "Low",
                                 
              ifelse(grepl("KAZ", DMC1.DF$strain), "Low",
            ifelse(grepl("PWD", DMC1.DF$strain), "High",
               ifelse(grepl("MSM", DMC1.DF$strain), "High","")))))

DMC1.DF$rec_group <- as.factor(DMC1.DF$rec_group)

                   
# annotation table with adjusted pvals and y-position of the labels

anno_df = compare_means(total.count ~ rec_group, group.by = "stage", data = DMC1.DF[DMC1.DF$stage != "P",],method = "t.test") %>% mutate(y_pos = 300)
#

DMC1.bxlt_High.to.Low <- ggplot(DMC1.DF[DMC1.DF$stage != "P",], aes(x=rec_group, y=total.count)) + 
  geom_boxplot(position=position_dodge()) + 
  geom_point(aes(color=stage), position=position_jitterdodge()) + 
  facet_wrap(~stage, nrow=1) + 
  ggsignif::geom_signif(
    data=anno_df, 
    aes(xmin=group1, xmax=group2, annotations=p.adj, y_position=y_pos), 
    manual=TRUE
  )+ggtitle("Comparison of DMC1 means across high and low recombing groups")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))

#example for ggplot+ test from here
#https://github.com/kassambara/ggpubr/issues/65

#https://www.r-bloggers.com/add-p-values-and-significance-levels-to-ggplots/

```

```{r DMC1_t.tests, echo=FALSE, warning=FALSE}
#2. t-tests for the DMC1 counts 
#need to account for sample sizes when comparing t.tests (KAZ and G don't have equal across )
#best case scnario -- more microscoping to get ~20 cells for each stage by strain combo


#high vs low group (L)
ttest.HighLow.L.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value =  0.002145


#high vs low group (Z)
ttest.HighLow.Z.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value = 0.6628


#dom vs musc (L) (2 subsp vs)
ttest.subsp.L <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "L")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "L")] )
# p-value = 0.003016

#dom vs musc (Z)
ttest.subsp.Z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "Z")] )
#p-value = 0.09588

#KAZ vs Dom (Z) (only 1 L cell)
ttest.KAZ.Dom.z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], 
      DMC1.DF$total.count[(DMC1.DF$strain == "KAZ") & (DMC1.DF$stage == "Z")] )

#p-value = 0.004148
#Kaz Z are higher than Dom
```

```{r DMC1_anova, echo=FALSE, warning=FALSE}
#1. ANOVA, is there a difference in DMC1 counts across strains?

#unorder strain
DMC1.DF$strain <- factor(DMC1.DF$strain, levels = c("G","WSB","KAZ","PWD","MSM"), ordered = FALSE )

mod.L <- lm(total.count ~ strain, data = DMC1.DF[DMC1.DF$stage == "L",])
mod.Z <- lm(total.count ~ strain, data = DMC1.DF[DMC1.DF$stage == "Z",])

l.anova.pval <- anova(mod.L)$`Pr(>F)`[1] #0.0002701 ***
z.anova.pval <- anova(mod.Z)$`Pr(>F)`[1] #NS

#anova's aren't appropriate for 2 samples... re-do the anova
#so that it's compareing more than just 2 categories -- or delete

```

```{r DMC1_MLH1.MAIN_TABLE, echo=FALSE, warning = FALSE}
#make category averages from AP_mouse_table.HQ
mean.MLH1.obs <- ddply(.data=AP_mouse_table.HQ,
                 .(category),
                 summarize, 
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co)
)

DMC1.target.strains <- subset(mean.MLH1.obs, category == "G male" |
                   category == "WSB male" |
                     category == "KAZ male" |
                  category == "MSM male" |
                    category == "PWD male")
#attach this mini DF to the DMC1 data


DMC1.mean.obs.L$mean.count.L <- DMC1.mean.obs.L$mean.count
DMC1.mean.obs.Z$mean.count.Z <- DMC1.mean.obs.Z$mean.count


DMC1table <- merge(DMC1.mean.obs.L, DMC1.mean.obs.Z, by="category")

DMC1table.main <- merge(DMC1.target.strains, DMC1table, by="category")

MLH1.DMC1.L_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.L, method = c("pearson"))#MLH1.DMC1.Z_cor

MLH1.DMC1.Z_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.Z, method = c("pearson"))#0.2793237

##RATIOS
DMC1table.main$MLH1.L_ratio <- DMC1table.main$mean.MLH1/ DMC1table.main$mean.count.L 
DMC1table.main$MLH1.Z_ratio <- DMC1table.main$mean.MLH1 / DMC1table.main$mean.count.Z
  
#colnames(DMC1table.main) <- c("category", "mean.MLH1", "", "", "")

#DMC1.mean.table
DMC1.mean.table.99 <- subset(DMC1table.main, select= -c(var.MLH1,  mean.count.x,  mean.count.y, stage.x, stage.y))

colnames(DMC1.mean.table.99) <- c("category","mean.MLH1","ncells.L","mean.L",
                  "ncells.Z", "mean.Z", "MLH1.L_ratio", "MLH1.Z_ratio")


WSB_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "WSB male") )$mean.count.L / (DMC1table.main %>% filter(category == "WSB male"))$mean.MLH1
  
G_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "G male") )$mean.count.L / (DMC1table.main %>% filter(category == "G male"))$mean.MLH1

MSM_DMC1.Z_CO_ratio <- ( DMC1table.main %>% filter(category == "MSM male") )$mean.count.L / (DMC1table.main %>% filter(category == "MSM male"))$mean.MLH1

PWD_DMC1.Z_CO_ratio <-( DMC1table.main %>% filter(category == "PWD male") )$mean.count.L / (DMC1table.main %>% filter(category == "PWD male"))$mean.MLH1



DMC1table.main$category <- factor(DMC1table.main$category, levels = c("WSB male","G male","KAZ male",               "PWD male","MSM male"), ordered = TRUE )

DMC1table.main <- DMC1table.main[order(DMC1table.main$category),]

#MAIN TABLE, headers need to be fixed, remove var.MLH1
#try adding double decker colume names / lines for early Z and late Z
#kable(head(DMC1table.main),  caption = "Table X. DMC1 foci counts per cell summary")


DMC1.Lratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.L_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.L_ratio        )
                               

DMC1.Zratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.Z_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.Z_ratio        )

```


In an attempt to localize the male-specific evolution of crossover number to steps of the meiotic pathway, we counted foci from a marker for double strand breaks (DSBs), DMC1, in prophase spermatocytes. DMC1 foci were scored from a total of `r sum( (DMC1.mean.table %>%  filter(stage == "L") )$ncells)` early zygotene-stage and `r sum( (DMC1.mean.table %>%  filter(stage == "Z") )$ncells)` late zygotene-stage spermatocytes from juvenile mice (12 to 18 days) from three low-recombination strains (musculus^KAZ^ , domesticus^WSB^ , and domesticus^G^) and two high-recombination strains (musculus^PWD^ and molossinus^MSM^).  


The high-recombination strains have significantly more DMC1 foci than the low-recombination strains in early zygotene cells (t-test, p<**someSmallNumber** -- `r ttest.HighLow.L.pval`). In contrast, the two strain groups do not differ in DMC1 foci counted in late zygotene cells (t-test, p = 0.66 --- `r ttest.HighLow.Z.pval`). 

[@cole2012] suggest that early Z counts for DMC1 are most relevant for predicting CO number.
(CO homeostasis -- robustness )

After DSB formation, DSBs are repaired as either non-crossovers (NCO) or as crossovers (COs), with the vast majority being repaired as NCOs. Thus the ratio of CO:DSB is a partial indicator of the proportion of DSBs which are designated as COs. 
**what does the ratio tell us? which stage of DMC1 counts is most relevant for CO count** 

The ratios, calculated for DMC1 means from both stages, are not significantly different between the high and low strain groups (t-test, p = `r DMC1.Lratio_t.test$p.value` and p = 0.11 -- `r DMC1.Zratio_t.test$p.value` for early zygotene and late zygotene ratios, respectively). This comparison raises the possibility that the evolution of crossover number is primarily due to processes that precede the crossover/non-crossover decision.

**note that this interpertation depends on which stage is most relevant to CO number**  


the difference in DMC1 counts across staes of zygotene may be related to the findings related to (crossover homeostasis).

The number of DSBs increase in zygotene, then deminish as the effects of crossover homeostasis are implemented (Cole). (co homeostasis also indecates dsb )


'Natural' variation in precursor number (the relationship of DSB and CO number) was analyzed in Barier et al  and links/ connects the CO number variation to 'pre' DSB formation -- fitting the model that DSB formation is dependant on the axis-loop structure of chromatin.
(this study only examined one stage of early prophase for DMC1 counts)

'does the number of DSBs per se regulate CO number?'

bairer-- DSB number is not a primary driver of variation in CO number -- these authors suggest that chromatin organizaiton (loop-axis) structure is the primary determinant of CO variation.


the birer et al ratios for strain average DMC1: MLH1 were 5.6 cast. 6.6 c3h, 7.3 B6 )

<Bret's Q, ANOVA is not appropriate for 2 samples unless it's specilaized somehow>

<This result, combined with the big difference in MLH1 count between high and low strains, might indicate that the CO/NCO decision contributes to strain differences in recombination rate. **It depends on whether leptonene or zygotene DSBs are viewed as more relevant for crossover numbers**.>


```{r DMC1.subsampling, echo=FALSE, eval = FALSE, include = FALSE}

#Subsampling code -- don't report
 
#The number of observations are not quite equal across strains and cell stages, so I ran permutations sampling 25 cells from the high and low recombining groups of cells. Below are the distributions of p values for permuted t-tests from sampling 25 cells from the pooled high and low recombining groups. Permutations were done for both cell stages. The actual p value is in red. 

#The observed p value does not fall outside of the permuted distribution with assumes equal cell sampling.

#recreate the DMC1 data by subsampling ~9 or lowest cell number from 
# the 2 groups

#make the 2 pools
High.L.pool <- DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ]
High.Z.pool <- DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ]

Low.L.pool <- DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]
Low.Z.pool <- DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]


#permute drawing / subsampling and performing the t-test
#put the p.value results into a DF!


#permut.SC.cv.diff  <- as.data.frame(
#sample(THE.DF, SAMPLE.SIZE, REPLACE?)

#permuting samples -- and re-licating t-tests

#nrep <- 1000

#permuting samples to replicate the t.test across cell stages from high and low with equal sample sizes.
bunchOpvals.L <- replicate(1000, 
    # t.test
    t.test( sample(High.L.pool, 25, replace = FALSE),
            sample(Low.L.pool, 25, replace = FALSE), var.equal = FALSE )$p.value
          )
bunchOpvals.L <- as.data.frame(bunchOpvals.L)
bunchOpvals.L$stage <- "L"

bunchOpvals.Z <- replicate(1000, 
    # t.test
    t.test( sample(High.Z.pool, 25, replace = FALSE),
            sample(Low.Z.pool, 25, replace = FALSE), var.equal = FALSE)$p.value
          )

bunchOpvals.Z <- as.data.frame(bunchOpvals.Z)
bunchOpvals.Z$stage <- "Z"

#could merge the lists of p-values
replicated.Ttests <- cbind(bunchOpvals.L, bunchOpvals.Z)
#have to melt, the rbinded dataframe to get the cols 'stage' and 'pvale'


#ASSUMPTIONS; normality, equal variance

#plot the lists of pvals in histogram? compare to the observed pvalue to get a sense as of how much sample size shifts the pvalues.

#plot.pvals.L <- ggplot(bunchOpvals.L, aes(bunchOpvals.L) )+geom_histogram(bins = 50)+ ggtitle("1000 rep t-tests sample size 25, High vs Low Leptotene")+geom_vline(xintercept=ttest.HighLow.L$p.value, linetype="dotted", color="red")


#plot.pvals.Z <- ggplot(bunchOpvals.Z, aes(bunchOpvals.Z) )+geom_histogram(bins = 50)+ ggtitle("1000 rep t-tests sample size 25, High vs Low Zygotene")+geom_vline(xintercept=ttest.HighLow.Z$p.value, linetype="dotted", color="red")
#plot.pvals.L
#plot.pvals.Z


#The t.test( ) function produces a variety of t-tests. Unlike most statistical packages, the default assumes #unequal variance and applies the Welsh df modification.
#n use the var.equal = TRUE
#https://www.statmethods.net/stats/ttest.html
```

```{r normality, echo=FALSE, warning=FALSE, eval=FALSE}
#these are histogram plots for testing Normality shape -- move to supplemenatry section
#- check that distributions are close to normal
#- check for equal variance.

DMC1.histogram <- ggplot(DMC1.DF, aes(total.count, fill = stage)) + geom_histogram(alpha = 0.4)+facet_wrap(~strain)+ ggtitle("DMC1 histogram")

#checking equal variance, https://www.statmethods.net/stats/anovaAssumptions.html
#bartlet's test, Levine's test
```


# Evolution of genome-wide recombination rate is reflected at the single chromosome level


```{r algorithm_performance_stats, echo=FALSE}

#sort by category, 
#compare total boxes and rate passed
#Curated_BivData  -- pass rate?

#number of mice, number of cells
#mean number of isolate bivs per cell,
#use these two metrics
#cell.level.BivData_table$boxs.IDd 
#cell.level.BivData_table$nboxes_passed

#calq the mean rate by category

cell.level.BivData_table$pass.rate <- cell.level.BivData_table$nboxes_passed / cell.level.BivData_table$boxs.IDd 

algorithm.stat.mouse <- ddply(cell.level.BivData_table, c("mouse"), summarise,
                        n_obs = length( unique(fileName) ),
                         mean_pass.rate = mean(pass.rate)
                         )

cell.level.BivData_table <- add_sex(cell.level.BivData_table)

algorithm.stat.category <- ddply(cell.level.BivData_table, c("sex", "strain"), summarise,
                        n_obs = length(unique(fileName)),
                        mean_pass.rate = mean(pass.rate)
                         )

#showing the table..
#data.frame(table( droplevels( Curated_BivData  %>%  filter(hand.foci.count  == 0 | hand.foci.count  == 1 |                                       hand.foci.count  == 2 | hand.foci.count  == 3 | hand.foci.count  == 4 ) )$category ) )
```

```{r chrm_prop_data, echo=FALSE, warning=FALSE}
#shut off eval for now because of wd / path error
#chrm.class.DF = read.csv("~./MLH1repo/data/ChrmClassProportions.csv", header = TRUE)
#chrm.class.DF = read.csv("C:/Users/alpeterson7/Documents/MLH1repo/data/ChrmClassProportions.csv", header = TRUE)

chrm.class.DF = read.csv("~./MLH1repo/data/ChrmClassProportions2.csv", header = TRUE)

#try adding the BivData version of the proportions


#chrm.class.DF = read.csv("C:/Users/alpeterson7/Documents/MLH1repo/data/ChrmClassProportions2.csv", header = TRUE)

#this excel file is ~100 cells (10 per category) where I manually verified the number of chrom classes. (this file can also be used to quantify error for CO counts)

chrm.class.DF$fileName <- (chrm.class.DF$Original.Name)
chrm.class.DF <- add_mouse(chrm.class.DF)
chrm.class.DF <- add_strain(chrm.class.DF)
chrm.class.DF <- add_sex(chrm.class.DF)
chrm.class.DF <- add_category(chrm.class.DF)
#chrm.class.DF <- add_euth_date(meta.data.file2)
#chrm.class.DF <- add_age(meta.data.file2)

#table(chrm.class.DF$category)
#str(chrm.class.DF)

#summarize by category
proportion_stats_category  <- ddply(.data=chrm.class.DF, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                  tot_biv  = sum(biv.sum.check,  na.rm = TRUE),

                 n0CO = sum(n0CO, na.rm = TRUE),
                  n1CO = sum(n1CO,na.rm = TRUE),
                  n2CO = sum(n2CO,na.rm = TRUE),
                  n3CO = sum(n3CO,na.rm = TRUE),
                  n4CO = sum(n4CO,na.rm = TRUE),
                 
                 per0CO = sum(n0CO) / tot_biv,                 
                 per1CO= sum(n1CO)/ tot_biv,
                 per2CO= sum(n2CO)/ tot_biv,
                 per3CO= sum(n3CO)/ tot_biv,
                 per4CO= sum(n4CO)/ tot_biv,
                 
                 mean.MLH1.foci = mean(MLH1.sum.check),
                 mean.MLH1.foci2 = mean(nMLH1.foci),
                 meanQ = mean(quality)

)
#this is the table that needs melting
#but is also easy to redo by hand

#write.table(proportion_stats_category, "~./MLH1repo/prop_category.csv", sep=",", row.names = FALSE)
```

```{r plot.chrm.prop.melt, echo=FALSE, warning=FALSE}

#add subspecies to these values
melt.Chrm.Prop.table = read.csv("~./MLH1repo/data/ChrmClassProportions2_melt.csv", header = TRUE)

#melt.Chrm.Prop.table = read.csv("MLH1repo/data/ChrmClassProportions2_melt.csv", header = TRUE)
melt.Chrm.Prop.table <- melt.Chrm.Prop.table[c(1:5)]

#add the subsps
melt.Chrm.Prop.table$strain<- factor(melt.Chrm.Prop.table$strain, levels =c("LEW",
                      "WSB","G", "TOM","AST","KAZ", "SKIVE","PWD","MSM", "MOLF"), order=T )

melt.Chrm.Prop.table <- with(melt.Chrm.Prop.table, melt.Chrm.Prop.table[order(strain),])

chrm.class.barplot <- ggplot(data = melt.Chrm.Prop.table, aes(y = value, x = strain, fill=as.factor(type)) ) + geom_col(position = "dodge")+facet_grid(sex~strain, scales = "free")+ggtitle("Chrm Proportions from Hand Measured Data")+ylim(c(0,1))+theme(legend.position="none")

#need a second DF / the first df
#+ annotate() text 
#annotate()text

#proportion_stats_category,  tot_biv, ncells
#add number of cells and bivalents in the corner

#chrm.class.barplot
```

```{r test.Chrm.Prop, echo=FALSE, eval=TRUE, warning=FALSE}

#prop.test(x, y)  x number of successes, y total  
#strain sums of n
#look up continuity correction

#mouse.level.BivData_table <-- has more male strains
#Mouse.Table_BivData_4MM <- only sex matched strains

#perform test across strain 
#removed all lines with no hand.foci.count entry
Chrm.prop_strain_table <- ddply(mouse.level.BivData_table, c("strain","sex"), summarise,
                  
                  nbiv = sum(tot.biv ),              
                 n0CO = sum(n0CO ),
                  n1CO = sum(n1CO ),
                 n2CO = sum(n2CO ),
                  n3CO = sum(n3CO ),
                 n4CO = sum(n4CO )
                          )

Chrm.prop_strain_table <- add_subsp(Chrm.prop_strain_table)

for(g in 1:length(Chrm.prop_strain_table$nbiv)){
  
  Chrm.prop_strain_table$sum2[g] <- sum(c(Chrm.prop_strain_table$n0CO[g],
                                     Chrm.prop_strain_table$n1CO[g],
                                     Chrm.prop_strain_table$n2CO[g],
                                     Chrm.prop_strain_table$n3CO[g] ))  
}

Chrm.prop_strain_table$dcheck <- Chrm.prop_strain_table$nbiv - Chrm.prop_strain_table$sum2
#there are still some wacky entries -- but much fewer than before

chrm.prop.strain.female <-  Chrm.prop_strain_table %>%  filter(sex == "female")

female.0CO.prop.test <- prop.test(chrm.prop.strain.female$n0CO, chrm.prop.strain.female$sum2 )
female.1CO.prop.test <- prop.test(chrm.prop.strain.female$n1CO, chrm.prop.strain.female$sum2 )
female.2CO.prop.test <- prop.test(chrm.prop.strain.female$n2CO, chrm.prop.strain.female$sum2 )
#the pvalues for 0 are not sig dif
#the p values for 1 and 2CO are sig diff

#seperate by subsp
chrm.prop.female.dom <-  chrm.prop.strain.female %>%  filter(subsp == "Dom")
chrm.prop.female.musc <-  chrm.prop.strain.female %>%  filter(subsp == "Musc")
chrm.prop.female.mol <-  chrm.prop.strain.female %>%  filter(subsp == "Mol")

Dom_female.0CO.prop.test <- prop.test(chrm.prop.female.dom$n0CO, chrm.prop.female.dom$sum2 )
Dom_female.1CO.prop.test <- prop.test(chrm.prop.female.dom$n1CO, chrm.prop.female.dom$sum2 )
Dom_female.2CO.prop.test <- prop.test(chrm.prop.female.dom$n2CO, chrm.prop.female.dom$sum2 )
Dom_female.3CO.prop.test <- prop.test(chrm.prop.female.dom$n3CO, chrm.prop.female.dom$sum2 )
#WSB has fewer 2COs than other 3 strains

Musc_female.0CO.prop.test <- prop.test(chrm.prop.female.musc$n0CO, chrm.prop.female.musc$sum2 )
Musc_female.1CO.prop.test <- prop.test(chrm.prop.female.musc$n1CO, chrm.prop.female.musc$sum2 )
Musc_female.2CO.prop.test <- prop.test(chrm.prop.female.musc$n2CO, chrm.prop.female.musc$sum2 )
#KAZ has slightly more 1CO than the other two


#high.female_G.LEW.
chrm.prop.female.high <-  chrm.prop.strain.female %>%  filter(strain == "G" | strain == "LEW")

high_female.0CO.prop.test <- prop.test(chrm.prop.female.high$n0CO, chrm.prop.female.high$sum2 )
high_female.1CO.prop.test <- prop.test(chrm.prop.female.high$n1CO, chrm.prop.female.high$sum2 )
high_female.2CO.prop.test <- prop.test(chrm.prop.female.high$n2CO, chrm.prop.female.high$sum2 )


#Low.female.G.LEW.
chrm.prop.female.low <-  chrm.prop.strain.female %>%  filter(strain != "G" | strain != "LEW")

low_female.0CO.prop.test <- prop.test(chrm.prop.female.low$n0CO, chrm.prop.female.low$sum2 )
low_female.1CO.prop.test <- prop.test(chrm.prop.female.low$n1CO, chrm.prop.female.low$sum2 )
low_female.2CO.prop.test <- prop.test(chrm.prop.female.low$n2CO, chrm.prop.female.low$sum2 )


#all females

chrm.prop.strain.male <-  Chrm.prop_strain_table %>%  filter(sex == "male")
male.0CO.prop.test <- prop.test(chrm.prop.strain.male$n0CO, chrm.prop.strain.male$sum2 )

male.1CO.prop.test <- prop.test(chrm.prop.strain.male$n1CO, chrm.prop.strain.male$sum2 )
male.2CO.prop.test <- prop.test(chrm.prop.strain.male$n2CO, chrm.prop.strain.male$sum2 )
#the pvals for these 3 class are sig dif

#seperate by subsp
chrm.prop.male.dom <-  chrm.prop.strain.male %>%  filter(subsp == "Dom")
chrm.prop.male.musc <-  chrm.prop.strain.male %>%  filter(subsp == "Musc")
chrm.prop.male.mol <-  chrm.prop.strain.male %>%  filter(subsp == "Mol")

Dom_male.0CO.prop.test <- prop.test(chrm.prop.male.dom$n0CO, chrm.prop.male.dom$nbiv )
Dom_male.1CO.prop.test <- prop.test(chrm.prop.male.dom$n1CO, chrm.prop.male.dom$nbiv )
Dom_male.2CO.prop.test <- prop.test(chrm.prop.male.dom$n2CO, chrm.prop.male.dom$nbiv )
#non of the Dom proportions are different

Musc_male.0CO.prop.test <- prop.test(chrm.prop.male.musc$n0CO, chrm.prop.male.musc$nbiv )
Musc_male.1CO.prop.test <- prop.test(chrm.prop.male.musc$n1CO, chrm.prop.male.musc$nbiv )
Musc_male.2CO.prop.test <- prop.test(chrm.prop.male.musc$n2CO, chrm.prop.male.musc$nbiv )
#all v different

Mol_male.0CO.prop.test <- prop.test(chrm.prop.male.mol$n0CO, chrm.prop.male.mol$nbiv )
Mol_male.1CO.prop.test <- prop.test(chrm.prop.male.mol$n1CO, chrm.prop.male.mol$nbiv )
Mol_male.2CO.prop.test <- prop.test(chrm.prop.male.mol$n2CO, chrm.prop.male.mol$nbiv )


#high vs low
chrm.prop.strain.male$Rec.group <- ifelse(grepl("PWD", chrm.prop.strain.male$strain), 1, 
                              ifelse(grepl("MSM", chrm.prop.strain.male$strain), 1,
                                 ifelse(grepl("SKIVE", chrm.prop.strain.male$strain), 1, 0)))

chrm.prop.male.low <-  chrm.prop.strain.male %>%  filter(Rec.group == 0)
chrm.prop.male.low2 <-  chrm.prop.strain.male  %>%  filter(Rec.group == 0 | strain == "SKIVE") #cool this worked


chrm.prop.male.high2 <-  chrm.prop.strain.male %>%  filter(Rec.group == 1) %>%  filter(strain != "SKIVE")
chrm.prop.male.high1 <-  chrm.prop.strain.male %>%  filter(Rec.group == 1)


Low_male.0CO.prop.test <- prop.test(chrm.prop.male.low$n0CO, chrm.prop.male.low$nbiv )
Low_male.1CO.prop.test <- prop.test(chrm.prop.male.low$n1CO, chrm.prop.male.low$nbiv )
Low_male.2CO.prop.test <- prop.test(chrm.prop.male.low$n2CO, chrm.prop.male.low$nbiv )
#the low strains do vary slightly in their 1CO and 2CO proportions

#includes SKIVE
Low2_male.0CO.prop.test <- prop.test(chrm.prop.male.low2$n0CO, chrm.prop.male.low2$nbiv )
Low2_male.1CO.prop.test <- prop.test(chrm.prop.male.low2$n1CO, chrm.prop.male.low2$nbiv )
Low2_male.2CO.prop.test <- prop.test(chrm.prop.male.low2$n2CO, chrm.prop.male.low2$nbiv )
#all very sig p values


High2_male.0CO.prop.test <-prop.test(chrm.prop.male.high2$n0CO,chrm.prop.male.high2$nbiv )
High2_male.1CO.prop.test <- prop.test(chrm.prop.male.high2$n1CO,chrm.prop.male.high2$nbiv )
High2_male.2CO.prop.test <- prop.test(chrm.prop.male.high2$n2CO,chrm.prop.male.high2$nbiv )
#these proportions are v different

#no SKIVE
High1_male.0CO.prop.test <- prop.test(chrm.prop.male.high1$n0CO, chrm.prop.male.high1$nbiv )
High1_male.1CO.prop.test <- prop.test(chrm.prop.male.high1$n1CO, chrm.prop.male.high1$nbiv )
High1_male.2CO.prop.test <- prop.test(chrm.prop.male.high1$n2CO, chrm.prop.male.high1$nbiv )
#MSM and PWD only slightly sig dif 2CO

#MSM-MOLF
MSM.MOLF.0CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n0CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  )

MSM.MOLF.1CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n1CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  )

MSM.MOLF.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n2CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  ) 
 

#PWD-KAZ
PWD.KAZ.0CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n0CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

PWD.KAZ.1CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n1CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

PWD.KAZ.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n2CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

PWD.MSM.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "MSM") )$n2CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "MSM") )$nbiv )


```

```{r Chrm.props.plot2, echo=FALSE}

#barplots for proportions of chrm classes

#consider adding this the the setup block (could have done this to category level table)
mouse.level.BivData_table$per.0CO <- mouse.level.BivData_table$n0CO / mouse.level.BivData_table$tot.biv

mouse.level.BivData_table$per.1CO <- mouse.level.BivData_table$n1CO / mouse.level.BivData_table$tot.biv

mouse.level.BivData_table$per.2CO <- mouse.level.BivData_table$n2CO / mouse.level.BivData_table$tot.biv

mouse.level.BivData_table$per.3CO <- mouse.level.BivData_table$n3CO / mouse.level.BivData_table$tot.biv

mouse.level.BivData_table$per.4CO <- mouse.level.BivData_table$n4CO / mouse.level.BivData_table$tot.biv

#DF needs to be melted -- so they all in 1 col
#per code, I've done this by hand

#subset DF for ease
skinny.mouse.level <- mouse.level.BivData_table[-c(12:21) ]
col.names.list.99 <- colnames(skinny.mouse.level)

#all of the cols to use
MELT_Chrm.Proportion <- melt(skinny.mouse.level[,c(  "mouse", "ncells","boxs.IDd", "nboxes_passed","Nbiv","tot.biv","n0CO","n1CO","n2CO","n3CO","n4CO",
             
               #leave out the Foci
                "per.0CO", "per.1CO", "per.2CO", "per.3CO", "per.4CO")], 
               
  id=c("mouse", "ncells","boxs.IDd",    "nboxes_passed","Nbiv","tot.biv","n0CO","n1CO","n2CO","n3CO","n4CO"))

MELT_Chrm.Proportion <- MELT_Chrm.Proportion[(!is.na(MELT_Chrm.Proportion$value)),]
MELT_Chrm.Proportion <- MELT_Chrm.Proportion[!(is.na(MELT_Chrm.Proportion$value) | MELT_Chrm.Proportion$value==0), ]

#no filename for add mouse, strain subsp
MELT_Chrm.Proportion <- add_category(MELT_Chrm.Proportion)
MELT_Chrm.Proportion <- add_sex(MELT_Chrm.Proportion)
MELT_Chrm.Proportion <- add_strain(MELT_Chrm.Proportion)


#then this DF has to be summarized into categories
chrm.class.category_MELT <- ddply(MELT_Chrm.Proportion, c("strain","sex", "variable"), summarise,
                             mean.percent.type = mean(value)
                             #sum is the wrong!
                             #used average percentage, might consider a different summary
)

#can't apply function use this
chrm.class.category_MELT$subsp <- ifelse(grepl("WSB", chrm.class.category_MELT$strain), "Dom", 
             ifelse(grepl("G", chrm.class.category_MELT$strain), "Dom",
                 ifelse(grepl("LEW", chrm.class.category_MELT$strain), "Dom", 
                ifelse(grepl("PERC", chrm.class.category_MELT$strain), "Dom",
                                                            
          ifelse(grepl("CAST", chrm.class.category_MELT$strain), "Cast",
              ifelse(grepl("HMI", chrm.class.category_MELT$strain), "Cast",
                                                                                 
                                       ifelse(grepl("MSM", chrm.class.category_MELT$strain), "Mol", #added Mol as distinct subsp class
                                      ifelse(grepl("MOLF", chrm.class.category_MELT$strain), "Mol",    
            ifelse(grepl("PWD", chrm.class.category_MELT$strain), "Musc", 
                     ifelse(grepl("CZECH", chrm.class.category_MELT$strain), "Musc", 
                 ifelse(grepl("AST", chrm.class.category_MELT$strain), "Musc",     
                      ifelse(grepl("TOM", chrm.class.category_MELT$strain), "Musc",  
                   ifelse(grepl("SKIVE", chrm.class.category_MELT$strain), "Musc",
                        ifelse(grepl("KAZ", chrm.class.category_MELT$strain), "Musc",
                                                                                                                                              
             ifelse(grepl("SPRET", chrm.class.category_MELT$strain), "Spretus",
               ifelse(grepl("SPIC", chrm.class.category_MELT$strain), "Spic",  "other"))))))))))))))))
  

chrm.class.category_MELT$subsp <- factor(chrm.class.category_MELT$subsp, ordered = TRUE,levels =c( "Dom",                    "Cast",
                                                                 "Musc",
                                                                 "Mol",
                                                                 "Spretus","Spic",
                                                                 "other") )
#ggplot

chrm.class.barplot <- ggplot(data = chrm.class.category_MELT, aes(y = mean.percent.type, x = strain, fill=as.factor(variable)) ) + geom_col(position = "dodge")+ggtitle("Chrm Proportions from BivData Data")+ylim(c(0,1)) + facet_wrap(sex~subsp, scales = "free")
#chrm.class.barplot
chrm.class.barplot

```

```{r Chrm.Prop.misc.calulations, echo=FALSE}

total.biv.all <- sum( MELT_Chrm.Proportion$n0CO, MELT_Chrm.Proportion$n1CO, MELT_Chrm.Proportion$n2CO, MELT_Chrm.Proportion$n3CO, MELT_Chrm.Proportion$n4CO)

#sum( MELT_Chrm.Proportion$n1CO) / total.biv.all
#sum( MELT_Chrm.Proportion$n2CO) / total.biv.all

#MELT_Chrm.Proportion$Rec.group <- ifelse(grepl("PWD male", MELT_Chrm.Proportion$category), 1, 
#                              ifelse(grepl("MSM male", MELT_Chrm.Proportion$category), 1,
#                                ifelse(grepl("SKIVE male", MELT_Chrm.Proportion$category), 1, 0)))
  
#Chrm.prop.male.low <- MELT_Chrm.Proportion %>% filter(sex=="male") %>% filter(Rec.group == 0)
#Chrm.prop.male.HIGH <- MELT_Chrm.Proportion %>% filter(sex=="male") %>% filter(Rec.group == 1)

#strain av tables
#chrm.prop.male.high1
#chrm.prop.male.low
```


To examine the connection between evolution of the genome-wide recombination rate and changes to the recombination landscape, we used an image analysis pipeline to measure properties of single bivalents ([@peterson2019]). 

<bret suggests moving this section to Mat and Methods>
This algorithm substantially speeds the accurate measurement of bivalents, but has the limitation that not all bivalents per cell can be isolated due to overlapping bivalents. In this dataset, isolation rates per cell range from `r min(algorithm.stat.category$mean_pass.rate)` (molossinus^MSM^ male) to `r max(algorithm.stat.category$mean_pass.rate)` (musculus^KAZ^ female). 

From the total set of cell images, `r length(unique(new.Curate.FULL.org %>% filter(SC.pass == "1"))$fileName )` bivalent objects were isolated by the image analysis software. After a human curation step ([@peterson2019]), `r length(unique(new.Curate.FULL.org %>% filter(hand.foci.count != ""))$Obj.ID )`  single-bivalent observations remained. We assume that the isolation of bivalents within cells is unbiased. <might be the only section to leave in Results> 

Given the large number of single-bivalent observations, we assume that each of the datasets are equally representative of general patterns. <Bret says this statment should be more clear>  


An additional challenge of the MLH1 framework is that the identities of individual autosomes and the XX in females cannot be easily obtained (the male XY is distinct). <Bret suggests moving to Methods>

<figure>

Ninety-six percent of single bivalents in our pooled dataset (n = `r total.biv.all`) have either one or two crossovers (Figure X). The proportion of one-crossover (1CO) to two-crossover (2CO) bivalents distinguishes the high vs. low recombining strains (Figure X). High-recombination strains are enriched for 2CO bivalents at the expense of 1CO bivalents: proportions of 2CO bivalents are 0.33 -- `r chrm.prop.male.high1$n2CO[chrm.prop.male.high1$strain == "SKIVE"] / chrm.prop.male.high1$nbiv[chrm.prop.male.high1$strain == "SKIVE"]` ( _musculus^SKIVE^_ ) in musculus^SKIVE^, 0.44 -- `r chrm.prop.male.high1$n2CO[chrm.prop.male.high1$strain == "PWD"] / chrm.prop.male.high1$nbiv[chrm.prop.male.high1$strain == "PWD"]` in musculus^PWD^, and `r chrm.prop.male.high1$n2CO[chrm.prop.male.high1$strain == "MSM"] / chrm.prop.male.high1$nbiv[chrm.prop.male.high1$strain == "MSM"]` in molossinus^MSM^. 

Following patterns in the genome-wide recombination rate, male musculus^PWD^ and male molossinus^MSM^ have 2CO proportions that are more similar to each other than to strains from their own subspecies (chi-square tests; musculus^PWD^ vs. musculus^KAZ^ p = `r PWD.KAZ.2CO.prop.test$p.value`; molossinus^MSM^ vs. molossinus^MOLF^ p = `r MSM.MOLF.2CO.prop.test$p.value`). 


Next, we use this single-bivalent dataset to focus on aspects of the recombination landscape along chromosomes. We address two main questions. First, which traits are sexually dimorphic? Second, which traits differ between males from high-recombination vs. low-recombination strains?


# Q1 Sex Differences in the Length of the Synaptonemal Complex


```{r Q1.Short.Long_biv.setup, echo=FALSE}

#REAL.long_mouse_table
#REAL.short_mouse_table

#make the Q1 strain list
Q1.real.short_mouse_table <- REAL.short_mouse_table %>% filter( (strain != "CZECH") & (strain != "MOLF") )

Q1.real.long_mouse_table <- REAL.long_mouse_table %>% filter( (strain != "CZECH") & (strain != "MOLF") )

```

```{r Q1.show.SC.length, echo=FALSE, warning=FALSE}

Curated_BivData99 <- Curated_BivData[Curated_BivData$hand.foci.count < 5,]
Curated_BivData99 <- Curated_BivData99[(!is.na(Curated_BivData99$sex)),]

#CLEAN UP THE FULL DATA SET

#adjust order of plot here
Curated_BivData99$strain <- factor(Curated_BivData99$strain,levels =c(
  "WSB","G","LEW","PERC",  
"PWD", "SKIVE",  "KAZ",
     "MSM", "MOLF",   
                     "CAST",
                         "SPRET","SPIC" ), order=T )


#nested boxplots, pooled Bivalents

Q1.SC.length_Nested_boxplots_Dom <- ggplot(Curated_BivData99[Curated_BivData99$subsp == "Dom",], aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ggtitle("Bivalent SC Lengths by Chrm Class \n Dom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,255))+theme(legend.position="none") 

Q1.SC.length_Nested_boxplots_Musc <- ggplot(Curated_BivData99 %>% filter(subsp == "Musc") %>% filter(strain != "CZECH"), aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ggtitle("Bivalent SC Lengths by Chrm Class \nMusc")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,255))+theme(legend.position="none") 

Q1.SC.length_Nested_boxplots_Mol <- ggplot(Curated_BivData99 %>% filter(strain == "MSM"), aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+geom_jitter(alpha=.3)+
  ggtitle("Bivalent SC Lengths by Chrm Class\n Mol")+facet_wrap(strain~sex, scales="free")+ylim(c(25,255))+theme(legend.position="none") 

```

```{r Q1.SC.show.short.biv, echo=FALSE}

Q1.SC.short.mouse_scatter_boxplot <- ggplot( Q1.real.short_mouse_table, aes(y = mean_SC, x = sex, color=strain)) + geom_jitter()+ geom_boxplot(alpha=.2) +scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales="free")+ylim(c(20,115) )+ggtitle("Mouse average SC Length \n short bivalent dataset")

Q1.SC.short.mouse_scatter_boxplot

#ploting SKIVE alone, confirms the ranges overlap, KAZ also have close ranges
skiveQ1.SC.short.mouse_scatter_boxplot <- ggplot( Q1.real.short_mouse_table %>% filter(strain == "SKIVE"), aes(y = mean_SC, x = sex, color=strain)) + geom_jitter()+ geom_boxplot(alpha=.2) +scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales="free")+ylim(c(20,115) )+ggtitle("Mouse average SC Length \n short bivalent dataset")
#skiveQ1.SC.short.mouse_scatter_boxplot
#there are 2 lowish female means, 

```

```{r Q1_SC.biv.short_ttest, echo=FALSE}

#run t.tests for the mouse av. for reduced single bivalent datasets
#WSB
Q1_mus.av_shortSC_t.test.WSB <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean_SC)

#G
Q1_mus.av_shortSC_t.test.G <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "G") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "G") )$mean_SC)

#LEW
Q1_mus.av_shortSC_t.test.LEW <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean_SC)

#PWD
Q1_mus.av_shortSC_t.test.PWD <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean_SC)

#KAZ
Q1_mus.av_shortSC_t.test.KAZ <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean_SC)

#SKIVE
Q1_mus.av_shortSC_t.test.SKIVE <- t.test((Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean_SC,
                           (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean_SC)

#MSM
#Q1_mus.av_shortSC_t.test.MSM <-t.test( (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$mean_SC, 
#          (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == #"MSM"))$mean_SC )
#1 male, 3 females measures
#try to merge the manual - whole cell observations (at least 2 males)

```

```{r Q1SC_short.biv_dif, echo=FALSE}

#calq the different in short.biv means

#WSB
Q1SC.mus.av.short.biv_DIFF_WSB <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean_SC )

#LEW
Q1SC.mus.av.short.biv_DIFF_LEW <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean_SC )

#G
Q1SC.mus.av.short.biv_DIFF_G <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "G") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "G") )$mean_SC )

#PWD
Q1SC.mus.av.short.biv_DIFF_PWD <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean_SC )

#KAZ
Q1SC.mus.av.short.biv_DIFF_KAZ <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean_SC )

#SKIVE
Q1SC.mus.av.short.biv_DIFF_SKIVE <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean_SC )

#MSM
Q1SC.mus.av.short.biv_DIFF_MSM <- mean( (Q1.real.short_mouse_table %>% filter(sex == "female") %>% filter(strain == "MSM") )$mean_SC) / mean(  (Q1.real.short_mouse_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$mean_SC )

#this bivData ratio is the same as mouse average
Q1SC.BivData.short.biv_DIFF_MSM <- mean( (real.short.bivData %>% filter(sex == "female") %>% filter(strain == "MSM") )$chromosomeLength) / mean(  (real.short.bivData %>% filter(sex == "male") %>% filter(strain == "MSM") )$chromosomeLength )

```

```{r Q1.tot.SC_show, echo=FALSE, warning=FALSE}
# fig.width = 4, fig.height=2.5

Q1.totSC.mouse.av.table <-  totSC.mouse.av.table ##%>% filter(species == "") 
  
Q1.totSC.mouse.av.table$strain <- factor(Q1.totSC.mouse.av.table$strain,levels =c(
   "WSB","G","LEW","PERC", 
  "PWD", "SKIVE",  "KAZ",
  "MSM", "MOLF"), order=T )

Q1.totSC.mouse.av.table <- with(Q1.totSC.mouse.av.table, Q1.totSC.mouse.av.table[order(sex, strain),])

#order the strains
Q1.totSC.mouse.av.table <- Q1.totSC.mouse.av.table %>%
  arrange(strain) %>%
  mutate(mouse = factor(mouse))

Q1.totSC.mouse.av.table <- with(Q1.totSC.mouse.av.table, Q1.totSC.mouse.av.table[order(sex, strain),])

#add category mean
#totSC.strain.av.table %>% filter
#totsc.dom_tot.sc <- Q1.totSC.mouse.av.table %>% filter( subsp == "Dom" )
#totsc_strain.av.dom <- totSC.strain.av.table %>% filter( subsp == "Dom" )

Tot.SC_mouse.av_ALL <- ggplot(data= Q1.totSC.mouse.av.table, aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(sex~subsp, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC.strain.av.table, aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,2600 ))+ggtitle("Mouse av. total SC area") + theme(legend.position="none")

Tot.SC_mouse.av_ALL

#full dataset --- 

totsc.musc <- Q1.totSC.mouse.av.table %>% filter( subsp == "Musc" )
totsc_strain.av.msc <- totSC.strain.av.table %>% filter( subsp == "Musc" )

Tot.SC_mouse.av_Musc <- ggplot(data= totsc.musc, aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totsc_strain.av.msc, aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ggtitle("Mouse av. total SC area")+  ylim(c(1000,3000 ))


totsc.mol <- Q1.totSC.mouse.av.table %>% filter( subsp == "Mol" )
totsc_strain.av.mol <- totSC.strain.av.table %>% filter( subsp == "Mol" )

Tot.SC_mouse.av_Mol <- ggplot(data= totsc.mol, aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totsc_strain.av.mol, aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,3000 ))+ggtitle("Mouse av. total SC area")

```

```{r Q1.total.SC_t.test, echo=FALSE}

#run t-test for male female avergage for each strain

#ALL
Q1_tot.sc_t.test.all <- t.test((totSC.mouse.av.table %>% filter(sex == "male") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female"))$mean.skel)


#dom
Q1_tot.sc_t.test.DOM <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Dom") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(subsp == "Dom") )$mean.skel)

#WSB
Q1_tot.sc_t.test.WSB <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean.skel)
#G
Q1_tot.sc_t.test.G <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "G") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "G") )$mean.skel)
#LEW
Q1_tot.sc_t.test.LEW <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean.skel)

#Musc
Q1_tot.sc_t.test.MUSC <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(subsp == "Musc") )$mean.skel)

#PWD
Q1_tot.sc_t.test.PWD <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean.skel)

#KAZ
Q1_tot.sc_t.test.KAZ <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean.skel)

#SKIVE
#Q1_tot.sc_t.test.SKIVE <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean.skel,
#           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean.skel, paired = FALSE, alternative = #"greater")
#cell level total SC
#MLH1.merge.Skel   $skel_size
#error not enought female observations, ONLY 1 female SKIVE mouse

Q1_tot.scBIV_t.test.SKIVE <- t.test((MLH1.merge.Skel %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$skel_size,
           (MLH1.merge.Skel %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$skel_size   )




#MSM
Q1_tot.sc_t.test.MSM <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(strain == "MSM") )$mean.skel,
                           (totSC.mouse.av.table %>% filter(sex == "female") %>% filter(strain == "MSM") )$mean.skel)

```

```{r Q1.totSC_male.first.comp, echo=FALSE}

Q1.male.Dom.Musc.t.test <- t.test( ( totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Dom") )$mean.skel,
(totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean.skel)

Q1.male.Dom.Mol.t.test <- t.test( ( totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Dom") )$mean.skel,
(totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean.skel)
```

```{r Q1.M.lmer_totalSC, echo=FALSE, warning=FALSE, message=FALSE}

Q1.lmer_totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain != "AST" & strain != "TOM" & strain != "CZECH" & strain != "MOLF")

#str(Q1.lmer_totSC.mouse.av.table)

#unorder factors
Q1.lmer_totSC.mouse.av.table$subsp <- factor(Q1.lmer_totSC.mouse.av.table$subsp, ordered = FALSE)
Q1.lmer_totSC.mouse.av.table$sex <- factor(Q1.lmer_totSC.mouse.av.table$sex, ordered = FALSE)
Q1.lmer_totSC.mouse.av.table$strain <- factor(Q1.lmer_totSC.mouse.av.table$strain, ordered = FALSE)
Q1.lmer_totSC.mouse.av.table$species <- factor(Q1.lmer_totSC.mouse.av.table$species, ordered = FALSE)


#TOTAL SC AREA!!
lmer.Q1_mus.av_totSC <- lmer(mean.skel ~ subsp * sex + (1|strain), data=Q1.lmer_totSC.mouse.av.table, REML = TRUE) 

lmer.Q1_mus.av_totSC_R.sex <- lmer(mean.skel ~ subsp + (1|strain), data=Q1.lmer_totSC.mouse.av.table, REML = TRUE) 

lmer.Q1_mus.av_totSC_R.subsp <- lmer(mean.skel ~ sex + (1|strain), data=Q1.lmer_totSC.mouse.av.table, REML = TRUE) 


lmer.Q1_mus.av_totSC_interaction  <-drop1(lmer.Q1_mus.av_totSC, test="Chisq" )$`Pr(Chi)`[2]

lmer.Q1_mus.av_totSC_sex  <-anova(lmer.Q1_mus.av_totSC, lmer.Q1_mus.av_totSC_R.sex)$`Pr(>Chisq)`[2]

lmer.Q1_mus.av_totSC_subp  <- anova(lmer.Q1_mus.av_totSC, lmer.Q1_mus.av_totSC_R.subsp)$`Pr(>Chisq)`[2]

lmer.Q1_mus.av_totSC_strain  <- exactRLRT(lmer.Q1_mus.av_totSC)$p.value 

#as.data.frame(round(summary(lmer.SCLength_all_MM.M1)$coefficients, 6))#these Dont return p values for the fixed effects

Q1.lmer.totSC_results <- data.frame(sub.sp = lmer.Q1_mus.av_totSC_subp, 
sex.results =  lmer.Q1_mus.av_totSC_sex, 
               interaction.pval = lmer.Q1_mus.av_totSC_interaction,  rand.pval = 
lmer.Q1_mus.av_totSC_strain)

#Q1.lmer.totSC_results

#G
```

```{r Q1.M1_short_biv_lmer, echo=FALSE, warning=FALSE, message=FALSE}
lmer.Q1_SCLength_short_M1 <- lmer(mean_SC ~ subsp * sex + (1|strain), data=Q1.real.short_mouse_table, REML = TRUE) 

lmer.Q1_SCLength_short_M1_R.sex <- lmer(mean_SC ~ subsp + (1|strain), data=Q1.real.short_mouse_table, REML = TRUE) 

lmer.Q1_SCLength_short_M1_R.subsp <- lmer(mean_SC ~ sex + (1|strain), data=Q1.real.short_mouse_table, REML = TRUE) 

Q1lmer.MM_SC_short_interaction  <-drop1(lmer.Q1_SCLength_short_M1, test="Chisq" )$`Pr(Chi)`[2]
Q1lmer.MM_SC_short_sex  <-anova(lmer.Q1_SCLength_short_M1, lmer.Q1_SCLength_short_M1_R.sex)$`Pr(>Chisq)`[2]
Q1lmer.MM_SC_short_subp  <- anova(lmer.Q1_SCLength_short_M1, lmer.Q1_SCLength_short_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1lmer.MM_SC_short_strain  <- exactRLRT(lmer.Q1_SCLength_short_M1)$p.value 

#as.data.frame(round(summary(lmer.SCLength_all_MM.M1)$coefficients, 6))#these Dont return p values for the fixed effects

Q1lmer.MM_SC_short_results <- data.frame(sub.sp = Q1lmer.MM_SC_short_subp, 
sex.results =  Q1lmer.MM_SC_short_sex, 
               interaction.pval = Q1lmer.MM_SC_short_interaction,  rand.pval = 
Q1lmer.MM_SC_short_strain)


#Q1lmer.MM_SC_short_results

```

In many mammalian species, the synaptonemal complex (SC) is longer in females. Yet, the majority of these observations come from species with female-biased heterochiasmy. Our wider survey of recombination in house mice provides an opportunity to determine whether sex differences in chromatin compaction (SC length) are reversed when heterochiasmy is male-biased. In addition, if SC length is a strong determinant of the genome-wide recombination rate,  male musculus^PWD^ and male molossinus^MSM^ should have longer SC lengths than the other strains. <moved section on reduced bivalent data set to methods>  

<figure>


Short bivalents are significantly longer in females than males in all strains (t-test; p < 0.05) except musculus^SKIVE^.  The female:male ratio ranges across strains from `r Q1SC.mus.av.short.biv_DIFF_MSM` (musculus^MSM^) to `r Q1SC.mus.av.short.biv_DIFF_WSB` (domesticus^WSB^). <moved section on total SC to methods> 


Females have significantly longer total SC than males in each strain tested separately (t-test; p < 0.05). That females have longer SCs is also supported by mixed models and general linear models with covariates, which identify sex as the most consistently significant effect (p < 0.05). Additionally, there are some significant subspecies and strain effects (p < 0.05), indicating that SC length has evolved among strains and subspecies.

<figure>

In summary, two approaches for measuring and analyzing SC length indicate that females have longer SCs (chromosome axes), even in strains where males have more MLH1 foci per cell. Furthermore, joint consideration of MLH1 foci and total SC length suggests that males from high-recombination strains have less "space" in which to place their additional crossovers.



```{r Q1.glm_totalSC_M2.M3, echo=FALSE, message=FALSE}
#total-SC
#Q1.lmer_totSC.mouse.av.table

Q1.glm_totSC_M2 <- glm(mean.skel ~ subsp*strain * sex, data=Q1.lmer_totSC.mouse.av.table)
sum.Q1.glm_totSC_M2 <- summary(Q1.glm_totSC_M2)

#subsp effect, many strain, #male
#G * male v.sig and male*LEW

Q1.glm_totSC_M3 <- glm(mean.skel ~ strain * sex, data=Q1.lmer_totSC.mouse.av.table)
sum.Q1.glm_totSC_M3 <- summary(Q1.glm_totSC_M3)
#LOT OF SIGNIFICant strain effects in this model
```

```{r Q1.SC_short_M2, echo=FALSE, warning=FALSE, message=FALSE}

Q1.real.short_mouse_table$subsp <- factor(Q1.real.short_mouse_table$subsp, ordered = FALSE)
Q1.real.short_mouse_table$sex <- factor(Q1.real.short_mouse_table$sex, ordered = FALSE)
Q1.real.short_mouse_table$strain <- factor(Q1.real.short_mouse_table$strain, ordered = FALSE)

Q1.glm_short.SC_M2 <- glm(mean_SC ~ subsp * strain * sex, data=Q1.real.short_mouse_table)

#summary(Q1.glm_short.SC_M2)

summ.Q1.glm_short.SC_M2 <- summary(Q1.glm_short.SC_M2)

#round(summ.Q1.glm_short.SC_M2$coefficients[,c(1,4)],5)

```

```{r Q1.glm_short.SC_M3, echo=FALSE, message=FALSE}

Q1.glm_short.SC_M3 <- glm(mean_SC ~ strain * sex, data=Q1.real.short_mouse_table)

#summary(Q1.glm_short.SC_M3)

summ.Q1.glm_short.SC_M3 <- summary(Q1.glm_short.SC_M3)

#round(summ.Q1.glm_short.SC_M3$coefficients[,c(1,4)],5)
#sex male very sig -- only sig
```


```{r Q1.SC.Q12, echo=FALSE}

#make comparisons for the high quality cells

#get Q12 cells from MLH1.merge.Skel
#calq the mouse averages

MLH1.merge.Skel$quality <- as.numeric(MLH1.merge.Skel$quality)

totSC_Q12_mouse.av.table <- ddply(.data=MLH1.merge.Skel %>% filter(quality < 3), 
                 .(mouse),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                # mean.MLH1 = mean(adj_nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var(adj_nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)

totSC_Q12_mouse.av.table <- add_strain(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_sex(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_category(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_subsp(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_species(totSC_Q12_mouse.av.table)

#unorder the factors
totSC_Q12_mouse.av.table$subsp <- factor(totSC_Q12_mouse.av.table$subsp, ordered = FALSE)
totSC_Q12_mouse.av.table$sex <- factor(totSC_Q12_mouse.av.table$sex, ordered = FALSE)
totSC_Q12_mouse.av.table$strain <- factor(totSC_Q12_mouse.av.table$strain, ordered = FALSE)
totSC_Q12_mouse.av.table$species <- factor(totSC_Q12_mouse.av.table$species, ordered = FALSE)

#add rec group
totSC_Q12_mouse.av.table$Rec.group <- ifelse(grepl("PWD male", totSC_Q12_mouse.av.table$category), 1, 
                              ifelse(grepl("MSM male", totSC_Q12_mouse.av.table$category), 1,
                                ifelse(grepl("SKIVE male", totSC_Q12_mouse.av.table$category), 1, 0)))

#REMOVE JUVI mice
tot.SC.Q12_juvi.male <- totSC_Q12_mouse.av.table[totSC_Q12_mouse.av.table$mouse  %in% juvi_mice, ]
totSC_Q12_mouse.av.table <- totSC_Q12_mouse.av.table[! totSC_Q12_mouse.av.table$mouse  %in% juvi_mice, ] 



totSC_Q12_strain.av.table <- ddply(.data=MLH1.merge.Skel %>% filter(quality < 3), 
                 .(strain, sex),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                # mean.MLH1 = mean(adj_nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var(adj_nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)
#totSC_Q12_strain.av.table <- add_strain(totSC_Q12_strain.av.table)
#totSC_Q12_strain.av.table <- add_sex(totSC_Q12_strain.av.table)
#totSC_Q12_strain.av.table <- add_category(totSC_Q12_strain.av.table)
totSC_Q12_strain.av.table <- add_subsp(totSC_Q12_strain.av.table)
totSC_Q12_strain.av.table <- add_species(totSC_Q12_strain.av.table)

#unorder the factors
totSC_Q12_strain.av.table$subsp <- factor(totSC_Q12_strain.av.table$subsp, ordered = FALSE)
totSC_Q12_strain.av.table$sex <- factor(totSC_Q12_strain.av.table$sex, ordered = FALSE)
totSC_Q12_strain.av.table$strain <- factor(totSC_Q12_strain.av.table$strain, ordered = FALSE)
totSC_Q12_strain.av.table$species <- factor(totSC_Q12_strain.av.table$species, ordered = FALSE)

```

```{r Q1.SC_showQ12Tot.SC, echo=FALSE, warning=FALSE}

Q12.Tot.SC_mouse.av_Dom <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Dom"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Dom"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,2600 ))+ggtitle("Mouse av. Q12 total SC area")

#Q12.Tot.SC_mouse.av_Dom
#Tot.SC_mouse.av_Dom


Q12.Tot.SC_mouse.av_Musc <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Musc"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Musc"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,3000 ))+ggtitle("Mouse av. Q12 total SC area")

#Q12.Tot.SC_mouse.av_Musc
#Tot.SC_mouse.av_Musc

Q12.Tot.SC_mouse.av_Mol <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Mol"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Mol"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,3000 ))+ggtitle("Mouse av. Q12 total SC area")
```


```{r show.long.biv, echo=FALSE, include=FALSE}
#mouse av
Q1.SC.long.mouse_scatter_boxplot <- ggplot( Q1.real.long_mouse_table, aes(y = mean_SC, x = sex, color=strain)) + geom_jitter()+ geom_boxplot(alpha=.2) +scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales="free")+ylim(c(75,150) )+ggtitle("Mouse average SC Length \n long bivalent dataset")

```

```{r Q1_SC.biv.long_ttest, echo=FALSE, include=FALSE}

#Q1.real.long_mouse_table

Q1_mus.av_longSC_t.test.WSB <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean_SC)

#G
Q1_mus.av_longSC_t.test.G <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "G") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "G") )$mean_SC)

#LEW
Q1_mus.av_longSC_t.test.LEW <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean_SC)

#PWD
Q1_mus.av_longSC_t.test.PWD <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean_SC)

#KAZ
Q1_mus.av_longSC_t.test.WSB <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean_SC)

#SKIVE
Q1_mus.av_longSC_t.test.SKIVE <- t.test((Q1.real.long_mouse_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean_SC,
                           (Q1.real.long_mouse_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean_SC)

#MSM
#Q1_mus.av_longSC_t.test.MSM <- t.test((Q1.real.long_mouse_table %>% filter(sex #== "male") %>% filter(strain == "MSM") )$mean_SC,
#                           (Q1.real.long_mouse_table %>% filter(sex == "female") #%>% filter(strain == "MSM") )$mean_SC)


#run t.tests for the mouse av. for reduced single bivalent datasets
```

```{r Q1other_SC_lmer, echo=FALSE, include=FALSE}

#1CO  lmer.Q1_SCLength_M1
Q1.lmer_SCLength_1CO_M1 <- lmer(mean.SC_1CO ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM)
Q1.lmer_SCLength_1CO_M1_R.sex <- lmer(mean.SC_1CO ~ subsp + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE)
Q1.lmer_SCLength_1CO_M1_R.subsp <- lmer(mean.SC_1CO ~ sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 

#as.data.frame(round(summary(Q1.lmer_SCLength_1CO_M1)$coefficients, 6))

Q1.lmer_SCLength.1CO_sex <- anova(Q1.lmer_SCLength_1CO_M1, Q1.lmer_SCLength_1CO_M1_R.sex)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.1CO_subsp <- anova(Q1.lmer_SCLength_1CO_M1, Q1.lmer_SCLength_1CO_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.1CO_int <- drop1(Q1.lmer_SCLength_1CO_M1, test="Chisq")$`Pr(Chi)`[2]
Q1.lmer_SCLength.1CO_strain <- exactRLRT(Q1.lmer_SCLength_1CO_M1)$p.value

Q1.lmer_SCLength.1CO_results <- data.frame(sub.sp = Q1.lmer_SCLength.1CO_subsp, 
sex.results =  Q1.lmer_SCLength.1CO_sex, 
               interaction.pval = Q1.lmer_SCLength.1CO_int,  rand.pval = 
Q1.lmer_SCLength.1CO_strain)


#2CO
Q1.lmer_SCLength_2CO_M1 <- lmer(mean.SC_2CO ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM)
Q1.lmer_SCLength_2CO_M1_R.sex <- lmer(mean.SC_2CO ~ subsp + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 
Q1.lmer_SCLength_2CO_M1_R.subsp <- lmer(mean.SC_2CO ~ sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 

#as.data.frame(round(summary(Q1.lmer_SCLength_2CO_M1)$coefficients, 6))

Q1.lmer_SCLength.2CO_sex <- anova(Q1.lmer_SCLength_2CO_M1, Q1.lmer_SCLength_2CO_M1_R.sex)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.2CO_subsp <- anova(Q1.lmer_SCLength_2CO_M1, Q1.lmer_SCLength_2CO_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.2CO_int <- drop1(Q1.lmer_SCLength_2CO_M1, test="Chisq")$`Pr(Chi)`[2]
Q1.lmer_SCLength.2CO_strain <- exactRLRT(Q1.lmer_SCLength_2CO_M1)$p.value


Q1.lmer_SCLength.2CO_results <- data.frame(sub.sp = Q1.lmer_SCLength.2CO_subsp, 
sex.results =  Q1.lmer_SCLength.2CO_sex, 
               interaction.pval = Q1.lmer_SCLength.2CO_int,  rand.pval = 
Q1.lmer_SCLength.2CO_strain)
#as.data.frame(round(summary(SCLength_long.biv_MM.M1)$coefficients, 6))
```

```{r Q1.SC.M2plot, echo=FALSE, include=FALSE}

#removing these plots for space

Musc.mouse.av <-  Mouse.Table_BivData_4MM %>%  filter(subsp == "Musc") 
#Musc.all
Q1glm_SCLength_M2.Musc <- glm(mean_SC ~ strain * sex, data = Musc.mouse.av)

#BivData Level
Musc_BivData <-  Curated_BivData %>%  filter(subsp == "Musc") 

Q1.SClength_Musc.BivData_plot <- ggplot( Musc_BivData, aes(y = chromosomeLength, x = strain, color=strain)) + geom_jitter(alpha=.3)+ geom_boxplot(alpha=.3)+scale_color_manual(values=colors_of_strains)+ggtitle("Musc av. SC Length \nBivData Level")+facet_wrap(~sex, scales="free")+ylim(c(30,225))

#BivData Level
Dom_BivData <-  Curated_BivData %>%  filter(subsp == "Dom") 

Q1.SClength_Dom.BivData_plot <- ggplot( Dom_BivData, aes(y = chromosomeLength, x = strain, color=strain)) + geom_jitter(alpha=.3)+ geom_boxplot(alpha=.3)+scale_color_manual(values=colors_of_strains)+ggtitle("Dom SC Lengths \nBivData Level")+facet_wrap(~sex, scales="free")+ylim(c(30,225))

```



# Q1. Sex Differences in the Positions of Single Crossovers


```{r Q1.F1pos_long.short_setup, echo=FALSE}

Q1.long.biv_1CO <-  real.long.bivData %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1) %>% filter(strain != "MOLF") %>% filter(strain != "CZECH")

```

```{r CO.positions.figs, echo=FALSE, include=FALSE, warning=FALSE}
#main figure of density plots,
MELT_Curated_BivData <- add_sex(MELT_Curated_BivData)
MELT_Curated_BivData <- add_strain(MELT_Curated_BivData)
MELT_Curated_BivData <- add_subsp(MELT_Curated_BivData)#subsp, needs strain

#clean up all the non 1 to 4 hand.foci counts
MELT_Curated_BivData.1CO <- MELT_Curated_BivData[MELT_Curated_BivData$hand.foci.count < 2, ]

MELT_Curated_BivData.1CO <- MELT_Curated_BivData.1CO[MELT_Curated_BivData.1CO$PER.Foci.Pos < 1.01, ]

# remove the na's
MELT_Curated_BivData.1CO <- MELT_Curated_BivData.1CO[!(is.na(MELT_Curated_BivData.1CO$hand.foci.count) | MELT_Curated_BivData.1CO$hand.foci.count==""), ]

CO.Pos.density_1CO <- ggplot(MELT_Curated_BivData.1CO, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(sex~subsp, ncol=2)+ggtitle("Normalized 1CO Foci Positions")+scale_fill_manual(values=colors_of_strains)

#category specific plots, don't run for now.
Dom.female_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "female") & (MELT_Curated_BivData$subsp == "Dom") ), ]
CO.Pos.density_Dom_female <- ggplot(Dom.female_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Dom female \nNormalized Foci Positions")
#Musc male
Musc.male_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "male") & (MELT_Curated_BivData$subsp == "Musc") ), ]

CO.Pos.density_Musc_male <- ggplot(Musc.male_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Musc male \nNormalized Foci Positions")
#Dom male
Dom.male_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "male") & (MELT_Curated_BivData$subsp == "Dom") ), ]

CO.Pos.density_Dom_male <- ggplot(Dom.male_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Dom male \nNormalized Foci Positions")
```

```{r Q1show.F1pos_Full, echo=FALSE, warning=FALSE}

Q1.mouse.av.biv_scatr_box   <- ggplot(mouse.avs_4MM, aes(x=sex, y=norm.first.foci.pos, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= norm.first.foci.pos ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \n all bivalents")

```

```{r Q1_1COpos.t.test, echo=FALSE}
#testing,
#norm.first.foci.pos  - mean nrm.F1.pos for just 1CO bivalents

Q1_1CO.pos_t.test.FULL <- t.test((mouse.avs_4MM %>% filter(sex == "male") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") )$norm.first.foci.pos)

#WSB
Q1_1CO.pos_t.test.WSB <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "WSB") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "WSB") )$norm.first.foci.pos)
#G
Q1_1CO.pos_t.test.G <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "G") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "G") )$norm.first.foci.pos)
#LEW
Q1_1CO.pos_t.test.LEW <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "LEW") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "LEW") )$norm.first.foci.pos)

#PWD
Q1_1CO.pos_t.test.PWD <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "PWD") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "PWD") )$norm.first.foci.pos)

#KAZ
Q1_1CO.pos_t.test.KAZ <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "KAZ") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "KAZ") )$norm.first.foci.pos)

#SKIVE
Q1_1CO.pos_t.test.SKIVE <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$norm.first.foci.pos,
           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$norm.first.foci.pos )

#MSM
Q1_1CO.pos_t.test.MSM <- t.test((mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain == "MSM") )$norm.first.foci.pos,
                           (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain == "MSM") )$norm.first.foci.pos)

#Single Biv Level
#single.biv.1CO_pos_t.test <- t.test( 
 # Curated_BivData$PER_Foci_1[(Curated_BivData$subsp=="Musc")&(Curated_BivData$sex=="male")&(Curated_BivData$hand.foci.count==1)&(Curated_BivData$Rec.group==1)], 
#   Curated_BivData$PER_Foci_1[(Curated_BivData$subsp=="Musc")&(Curated_BivData$sex=="male")&(Curated_BivData$hand.foci.count==1)&(Curated_BivData$Rec.group==0)]
#  )

#t.tests for mous.av_nrm.1CO.pos 
```

```{r Q1.CO1pos_lmer.M1, echo=FALSE, message=FALSE}

#make sure this dataset has all the right strains
Q1.Foci.pos_DF <- Mouse.Table_BivData_4MM %>% filter(strain != "CZECH") %>% filter(strain != "MOLF")

lmer.Q1.nrm1CO_M1 <- lmer(norm.first.foci.pos ~ subsp * sex + (1|strain), data=Q1.Foci.pos_DF, REML = TRUE) 

lmer.Q1.nrm1CO_M1reduce.sex <- lmer( norm.first.foci.pos ~ subsp  +(1|strain), data=Q1.Foci.pos_DF )

lmer.Q1.nrm1CO_M1reduce.subp <- lmer( norm.first.foci.pos ~ sex  +(1|strain), data=Q1.Foci.pos_DF )


lmer.Q1.nrm1CO_M1.sex <-  anova(lmer.Q1.nrm1CO_M1, lmer.Q1.nrm1CO_M1reduce.sex)$`Pr(>Chisq)`[2]
lmer.Q1.nrm1CO_M1.subp <-  anova(lmer.Q1.nrm1CO_M1, lmer.Q1.nrm1CO_M1reduce.subp)$`Pr(>Chisq)`[2]

lmer.Q1.nrm1CO_M1_interaction <- drop1(lmer.Q1.nrm1CO_M1, test="Chisq" )$`Pr(Chi)`[2]
lmer.Q1.nrm1CO_M1_strain <- exactRLRT(lmer.Q1.nrm1CO_M1)$p.value 

lmer.Q1.nrm1CO_M1_results <- data.frame(sub.sp = lmer.Q1.nrm1CO_M1.subp, 
sex.results = lmer.Q1.nrm1CO_M1.sex , 
               interaction.pval = lmer.Q1.nrm1CO_M1_interaction,  rand.pval = lmer.Q1.nrm1CO_M1_strain)

#lmer.Q1.nrm1CO_M1_results

#write.table(round(summry.glm.Q1_IFD.PER.M2$coefficients, 6), "~./MLH1repo/summry.glm.Q1_IFD.PER.M2.csv", sep=",",row.names = TRUE)

```

```{r Q1.CO1pos_glm.M2, echo=FALSE}

#in case factors aren't ordered
#Q1.real.short_mouse_table$subsp <- factor(Q1.real.short_mouse_table$subsp, ordered = FALSE)
#Q1.real.short_mouse_table$sex <- factor(Q1.real.short_mouse_table$sex, ordered = FALSE)
#Q1.real.short_mouse_table$strain <- factor(Q1.real.short_mouse_table$strain, ordered = FALSE)

Q1.glm_F1pos_M2 <- glm(norm.first.foci.pos ~ subsp * strain * sex, data=Q1.Foci.pos_DF)

#summary(Q1.glm_F1pos_M2)

summry.Q1.glm_F1pos_M2 <- summary(Q1.glm_F1pos_M2)
#round(summry.Q1.glm_F1pos_M2$coefficients[,c(1,4)],5)

#write.table(round(summry.Q1.glm_nrmF1pos_M2$coefficients,5), "~./MLH1repo/summry.Q1.glm_nrmF1pos_M2.csv", #sep=",",row.names = TRUE)


#DOM
Q1.glm_nrmF1pos_M2_Dom <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q1.glm_nrmF1pos_M2_Dom)

#MUSC
Q1.glm_nrmF1pos_M2_Musc <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q1.glm_nrmF1pos_M2_Musc)

#MOL
Q1.glm_nrmF1pos_M2_Mol <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q1.glm_nrmF1pos_M2_Mol)

```

```{r Q1.CO1pos_glm.M3, echo=FALSE, eval=TRUE}

Q1.glm_1CO.pos_M3 <- glm(norm.first.foci.pos ~ strain * sex, data=Q1.Foci.pos_DF)

#summary(Q1.glm_1CO.pos_M3)

summry.Q1.glm_1CO.pos_M3 <- summary(Q1.glm_1CO.pos_M3)
#round(summry.Q1.glm_1CO.pos_M3$coefficients[,c(1,4)],5)
#write.table(round(summry.Q1.glm_nrmF1pos_M3$coefficients,5), "~./MLH1repo/summry.Q1.glm_nrmF1pos_M3.csv", sep=",",row.names = TRUE)

```


In most of the strains we surveyed, the majority of bivalents are observed to contain one crossover (focus). In all strains, the landscape across 1CO bivalents is significantly different in females and males. Normalized foci positions tend to be more central in females `r mean( (mouse.avs_4MM %>% filter(sex == "female") )$norm.first.foci.pos, na.rm = TRUE )` and closer to the telomere in males `r mean( (mouse.avs_4MM %>% filter(sex == "male") )$norm.first.foci.pos, na.rm = TRUE )` (t-test; p = `r Q1_1CO.pos_t.test.FULL$p.value`). Sex is also the most significant effect on focus position in a mixed model (M1: p = `r lmer.Q1.nrm1CO_M1_results$sex.results`) and in general linear models (M2: p = `r summry.Q1.glm_F1pos_M2$coefficients[,4][8]`; M3: p = `r summry.Q1.glm_1CO.pos_M3$coefficients[,4][8]`). These sex differences in the placement of foci on 1CO bivalents follow a pattern observed across a variety of mammalian species [@sardell_sex_2020].



```{r Q1.F1.pos.LONG.SHORT.BIV_scatter, echo=FALSE}

#real.long.bivData
Q1.short.biv_scatr_box   <- ggplot( (real.short.bivData %>% filter(hand.foci.count == 1) ), aes(x=sex, y=PER_Foci_1, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= PER_Foci_1 ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nShort Biv")


Q1.long.biv_scatr_box   <- ggplot((real.long.bivData %>% filter(hand.foci.count == 1) ), aes(x=sex, y=PER_Foci_1, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= PER_Foci_1 ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nLong Biv")

```

```{r Q1.mouse.av.F1.pos.LONG.BIV_scatter, echo=FALSE}

#REAL.short_mouse_table
#REAL.long_mouse_table
#mouse.av.long.biv.table

Q1.av.long.biv_scatr_box   <- ggplot(REAL.long_mouse_table  , aes(x=sex, y=mean_F1pos_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean_F1pos_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nLong Biv")

Q1.av.short.biv_scatr_box   <- ggplot(REAL.short_mouse_table, aes(x=sex, y=mean_F1pos_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean_F1pos_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nShort Biv")
```

```{r show.siscoten, echo=FALSE, eval=FALSE}
#think of a good way to display this

sis.co.ten.plot_WSB_female <- ggplot(data = Curated_BivData[Curated_BivData$category == "WSB female",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
sis.co.ten.plot_WSB_female

sis.co.ten.plot_WSB_male <- ggplot(data = Curated_BivData[Curated_BivData$category == "WSB male",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
sis.co.ten.plot_WSB_male

sis.co.ten.plot_LEW_female <- ggplot(data = Curated_BivData[Curated_BivData$category == "LEW female",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
#sis.co.ten.plot_LEW_female

sis.co.ten.plot_LEW_male <- ggplot(data = Curated_BivData[Curated_BivData$category == "LEW male",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
#sis.co.ten.plot_LEW_male


sis.co.ten.plot_PWD_female <- ggplot(data = Curated_BivData[Curated_BivData$category == "PWD female",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
#sis.co.ten.plot_PWD_female


sis.co.ten.plot_PWD_male <- ggplot(data = Curated_BivData[Curated_BivData$category == "PWD male",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)
#sis.co.ten.plot_PWD_male


Curated_BivData <- Curated_BivData[Curated_BivData$hand.foci.count < 5,]
Curated_BivData <- Curated_BivData[!(is.na(Curated_BivData$hand.foci.count) | Curated_BivData$hand.foci.count==""), ]


jitter_siscoten_PWDf <- ggplot(data = Curated_BivData[Curated_BivData$category == "PWD female",], aes(y=SisCoTen, x=hand.foci.count, color = as.factor(hand.foci.count) ))+ ggtitle("PWD female Sis.co.ten")+
  geom_jitter()+facet_wrap(sex~strain)
#jitter_siscoten_PWDf

jitter_siscoten_PWDm <- ggplot(data = Curated_BivData[Curated_BivData$category == "PWD male",], aes(y=SisCoTen, x=hand.foci.count, color = as.factor(hand.foci.count) ))+ggtitle("PWD male sis.co.ten")+
  geom_jitter()+facet_wrap(sex~strain)
#jitter_siscoten_PWDm

jitter_siscoten_WSBf <- ggplot(data = Curated_BivData[Curated_BivData$category == "WSB female",], aes(y=SisCoTen, x=hand.foci.count, color = as.factor(hand.foci.count) ))+ggtitle("WSB female sis.co.ten")+
  geom_jitter()+facet_wrap(sex~strain)
#jitter_siscoten_WSBf

jitter_siscoten_WSBm <- ggplot(data = Curated_BivData[Curated_BivData$category == "WSB male",], aes(y=SisCoTen, x=hand.foci.count, color = as.factor(hand.foci.count) ))+ggtitle("WSB male sis.co.ten")+
  geom_jitter()+facet_wrap(sex~strain)
#jitter_siscoten_WSBm
```

```{r show.norm.siscoten, echo=FALSE, eval=FALSE}
Curated_BivData$nrm.siscoten <- Curated_BivData$SisCoTen/Curated_BivData$chromosomeLength

Nrm.sis.co.ten.plot_WSB <- ggplot(data = Curated_BivData[Curated_BivData$strain == "WSB",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n WSB")+theme(legend.position="none")
Nrm.sis.co.ten.plot_WSB

Nrm.sis.co.ten.plot_G <- ggplot(data = Curated_BivData[Curated_BivData$strain == "G",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n G")+theme(legend.position="none")
Nrm.sis.co.ten.plot_G


Nrm.sis.co.ten.plot_LEW <- ggplot(data = Curated_BivData[Curated_BivData$strain == "LEW",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten\nLEW")+theme(legend.position="none")
Nrm.sis.co.ten.plot_LEW



Nrm.sis.co.ten.plot_PWD <- ggplot(data = Curated_BivData[Curated_BivData$strain == "PWD",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n PWD")+theme(legend.position="none")
Nrm.sis.co.ten.plot_PWD


Nrm.sis.co.ten.plot_KAZ <- ggplot(data = Curated_BivData[Curated_BivData$strain == "KAZ",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n KAZ")+theme(legend.position="none")
Nrm.sis.co.ten.plot_KAZ


Nrm.sis.co.ten.plot_SKIVE <- ggplot(data = Curated_BivData[Curated_BivData$strain == "PWD",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n SKIVE")+theme(legend.position="none")
Nrm.sis.co.ten.plot_SKIVE

Nrm.sis.co.ten.plot_MSM <- ggplot(data = Curated_BivData[Curated_BivData$strain == "MSM",], aes(y=SisCoTen/chromosomeLength, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(~sex)+ggtitle("Normalized siscoten \n MSM")+theme(legend.position="none")
Nrm.sis.co.ten.plot_MSM

```

```{r sis.co.ten.test_HetC, echo=FALSE, eval=FALSE}

#glm for siscoten
#mouse.avs_4MM  - mouse averages with mean sis.co.ten
#MM
lme_MM_siscoten <- lme(mean.siscoten ~ subsp * sex, data= mouse.avs_4MM, random=list(strain=pdDiag(~sex) ) )
as.data.frame( round(  summary(lme_MM_siscoten)$tTable, 6 ) )

#sex and sex*subsp interaction effect are significant for mean sis.co.ten
lmer_MM_siscoten <- lmer(mean.siscoten ~ subsp * sex + (1|strain), data=mouse.avs_4MM, REML = TRUE)
#anova(lmer_MM_siscoten) 

#thing1  <- summary(lmer_MM_siscoten)
#drop1(lmer_MM_siscoten, test="Chisq") 

rand_siscoten_MM <- exactRLRT(lmer_MM_siscoten)
rand_siscoten_MM
#slightly sig
```

```{r siscoten.test.poly, echo=FALSE, eval=FALSE}

#move this to the set up blocks

mouse.avs_4MM$Rec.group <- ifelse(grepl("PWD", mouse.avs_4MM$strain), 1, 
                            ifelse(grepl("MSM", mouse.avs_4MM$strain), 1,
                             ifelse(grepl("SKIVE", mouse.avs_4MM$strain), 1, 0)) )

#test high vs low Musc strains
#mouse.avs_4MM
```

```{r log.reg_siscoten, echo=FALSE, eval=FALSE}

#replace the table

male_mouse.av$Rec.group <- ifelse(grepl("PWD", male_mouse.av$strain), 1, 
                            ifelse(grepl("MSM", male_mouse.av$strain), 1,
                             ifelse(grepl("SKIVE", male_mouse.av$strain), 1, 0)) )

Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                            ifelse(grepl("MSM", Male.poly.Mouse.Table_BivData_4MM$strain), 1,
                             ifelse(grepl("SKIVE", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 0)) )

#SISCOTEN
#mouse av, norm.first foci is from 1CO bivalents

log.reg_SIS.co.ten_mouse.av <- glm(Rec.group ~ mean.siscoten, 
                           
                                 data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
summary(log.reg_SIS.co.ten_mouse.av)


#single biv level
log.reg_Sis.co.ten_biv <- glm(Rec.group ~ SisCoTen, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

summary(log.reg_Sis.co.ten_biv)

```

```{r t.test_sis.co.ten,echo=FALSE, eval=FALSE}

#bivData -- 

t.test_mouse.av_siscoten <- t.test(
  
  Male.poly.Mouse.Table_BivData_4MM$mean.siscoten[(mouse.avs_4MM$Rec.group == 1)],
  
  Male.poly.Mouse.Table_BivData_4MM$mean.siscoten[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc") &(Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0)] 
  )

#1CO
t.test_mouse.av_siscoten_1CO <- t.test( 
  Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_1CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")& (Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1)], 
 
   Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_1CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")& (Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0)]
  )

#2CO
t.test_mouse.av_siscoten_2CO <- t.test( 
  Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_2CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")&(Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1)], 
 
   Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_2CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")& (Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0)]
  )

#3CO
t.test_mouse.av_siscoten_3CO <- t.test( 
  Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_3CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")& (Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1)], 
 
   Male.poly.Mouse.Table_BivData_4MM$mean.siscoten_3CO[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc")&(Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0)]
  )



####
#Single Biv Level -- from the main 
#pull the single BivData -- MUSC

#check that these have the extra male strains

t.test_single.biv_siscoten <- t.test( 
  
  Curated_BivData$SisCoTen[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male")& (Curated_BivData$Rec.group == 1)], 
 
   Curated_BivData$SisCoTen[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male")& (Curated_BivData$Rec.group == 0)]
  )

#1CO
mouse.avs_4MM$mean.siscoten_2CO

```

```{r telo.dist, echo=FALSE, eval=FALSE}

sis.co.ten.plot_WSB_female <- ggplot(data = Curated_BivData[Curated_BivData$category == "WSB female",], aes(y=SisCoTen, x=chromosomeLength, color = as.factor(hand.foci.count) ))+
  geom_point()+facet_wrap(sex~strain)

Curated_BivData <- Curated_BivData[Curated_BivData$hand.foci.count < 5,]
Curated_BivData <- Curated_BivData[!(is.na(Curated_BivData$hand.foci.count) | Curated_BivData$hand.foci.count==""), ]


telo.dist_boxplots <- ggplot(Curated_BivData, aes(x= hand.foci.count, y=telo_dist ) )+ geom_boxplot(aes( fill=hand.foci.count, group=strain), alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("boxy plots")+ ylim(c(0, 150))


telo_jitter <- ggplot(Curated_BivData, aes(x= strain, y=telo_dist, color=as.factor(hand.foci.count) ) )+ geom_jitter(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("raw telomere distance")+ ylim(c(0, 150))
telo_jitter


nrm.telo_jitter <- ggplot(Curated_BivData, aes(x= strain, y=telo_dist_PER, color=as.factor(hand.foci.count) ) )+ geom_jitter(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("Normalized telomere distance")+ylim(c(0,1.2))
nrm.telo_jitter

#why do a different number of rows removed each time??
```

```{r MM.telo, echo=FALSE, eval=FALSE}
#HetC

lme_MM_telo.dist <- lmer(mean.telo.dist ~ subsp * sex + (1|strain), data= Mouse.Table_BivData_4MM )
drop1(lme_MM_telo.dist, test="Chisq")
as.data.frame( round(  summary(lme_MM_telo.dist)$coefficients, 6 ) )

#sex and sex*subsp interaction effect are significant for mean sis.co.ten

lmer_MM_telo.dist <- lmer(mean.telo.dist ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE)
#anova(lmer_MM_siscoten) 

#thing1  <- summary(lmer_MM_siscoten)
drop1(lmer_MM_telo.dist, test="Chisq") 
rand_telo.dist_MM <- exactRLRT(lmer_MM_telo.dist)
rand_telo.dist_MM
```

```{r log.reg_telo.dist, echo=FALSE, eval=FALSE}

Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD male", Mouse.Table_BivData_4MM$category), 1, 
                            ifelse(grepl("MSM male", Mouse.Table_BivData_4MM$category), 1,
                             ifelse(grepl("SKIVE male", Mouse.Table_BivData_4MM$category), 1, 0)) )


#TELO.DIST
#mouse av, norm.first foci is from 1CO bivalents
log.reg_Telo.Dist_mouse.av <- glm(Rec.group ~ mean.telo.dist, 
                           
                                 data=Mouse.Table_BivData_4MM[(Mouse.Table_BivData_4MM$subsp == "Musc")&(Mouse.Table_BivData_4MM$sex == "male"),], family=binomial(link="logit"))
summary(log.reg_Telo.Dist_mouse.av)


#single biv level
log.reg_Telo.Dist_biv <- glm(Rec.group ~ telo_dist, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

summary(log.reg_Telo.Dist_biv)


#PER versions
log.reg_Telo.Dist.PER_biv <- glm(Rec.group ~ telo_dist_PER, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

summary(log.reg_Telo.Dist.PER_biv)
```

```{r t.test_Telo.Dist, echo=FALSE, eval=FALSE}

#mouse av
t.test_mouse.av_telo.dist <- t.test(
  
  Mouse.Table_BivData_4MM$mean.telo.dist[(Mouse.Table_BivData_4MM$Rec.group == 1)],
  
  Mouse.Table_BivData_4MM$mean.telo.dist[(Mouse.Table_BivData_4MM$sex == "male") & (Mouse.Table_BivData_4MM$subsp == "Musc") &(Mouse.Table_BivData_4MM$Rec.group == 0)] 
  )


#Single Biv Level
single.biv_t.test_Telo.Dist <- t.test( 
  
  Curated_BivData$telo_dist[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 1)], 
 
   Curated_BivData$telo_dist[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 0)]
  )
   
#Telo Dist PER
single.biv_t.test_Telo.Dist_PER <- t.test( 
  
  Curated_BivData$telo_dist_PER[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male")& (Curated_BivData$Rec.group == 1)], 
 
   Curated_BivData$telo_dist_PER[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 0)]
  )
   
```

```{r cent.dist_show, echo=FALSE, eval=FALSE}
cent.dist_boxplots <- ggplot(Curated_BivData, aes(x= strain, y=dis.cent ) )+ geom_boxplot(aes( fill=hand.foci.count, group=strain), alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("raw centromere distance")+ ylim(c(0, 150))


cent.dist_jitter <- ggplot(Curated_BivData, aes(x= strain, y=dis.cent, color=as.factor(hand.foci.count) ) )+ geom_jitter(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("raw centromere dist")+ ylim(c(0, 200))
cent.dist_jitter

norm.cent.dist_jitter <- ggplot(Curated_BivData, aes(x= strain, y=dis.cent.PER, color=as.factor(hand.foci.count) ) )+ geom_jitter(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("Normalized centromere distance")+ylim(c(0,1.2))
norm.cent.dist_jitter

```

```{r MM.cent.dist, echo=FALSE, eval=FALSE}

lme_MM_cent.dist <- lme(mean.cent.dist ~ subsp * sex, data= Mouse.Table_BivData_4MM, random=list(strain=pdDiag(~sex) ) )
as.data.frame( round(  summary(lme_MM_cent.dist)$tTable, 6 ) )

lmer_MM_cent.dist <- lmer(mean.cent.dist ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE)

exactRLRT(lmer_MM_cent.dist)
```

```{r log.reg_CENT.dist, echo=FALSE, eval=FALSE}

#CENT.DIST
#mouse av, norm.first foci is from 1CO bivalents
log.reg_CENT.Dist_mouse.av <- glm(Rec.group ~ mean.cent.dist, 
                           
                                 data=Mouse.Table_BivData_4MM[(Mouse.Table_BivData_4MM$subsp == "Musc")&(Mouse.Table_BivData_4MM$sex == "male"),], family=binomial(link="logit"))
summary(log.reg_CENT.Dist_mouse.av)


#single biv level
log.reg_CENT.Dist_biv <- glm(Rec.group ~ dis.cent, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

summary(log.reg_CENT.Dist_biv)


#PER versions
log.reg_CENT.Dist.PER_biv <- glm(Rec.group ~ dis.cent.PER, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

summary(log.reg_CENT.Dist.PER_biv)
```

```{r t.test_CENT.Dist, echo=FALSE, eval=FALSE}
#CENT.DIST
#mouse av
t.test_mouse.av_Cent.dist <- t.test(
  
  Mouse.Table_BivData_4MM$mean.cent.dist[(Mouse.Table_BivData_4MM$Rec.group == 1)],
  
  Mouse.Table_BivData_4MM$mean.cent.dist[(Mouse.Table_BivData_4MM$sex == "male") & (Mouse.Table_BivData_4MM$subsp == "Musc") &(Mouse.Table_BivData_4MM$Rec.group == 0)] 
  )


#Single Biv Level
single.biv_t.test_Cent.Dist <- t.test( 
  
  Curated_BivData$dis.cent[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 1)], 
 
   Curated_BivData$dis.cent[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 0)]
  )
   
#Cent Dist PER
single.biv_t.test_Cent.Dist_PER <- t.test( 
  
  Curated_BivData$dis.cent.PER[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male") & (Curated_BivData$Rec.group == 1)], 
 
   Curated_BivData$dis.cent.PER[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male")& (Curated_BivData$Rec.group == 0)]
  )
   
```

```{r Q1.CO1_foci_pos_boxplot, echo=FALSE, eval=FALSE}

MELT_long_biv <- MELT_Curated_BivData[ MELT_Curated_BivData$Obj.ID %in% real.long.bivData$Obj.ID, ]

CO.Pos.boxplots_1CO <- ggplot(MELT_Curated_BivData.1CO, aes(x= strain, y=PER.Foci.Pos, fill=strain) ) + geom_boxplot(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("Percent Foci Position")+geom_jitter(alpha=.1)+scale_fill_manual(values=colors_of_strains)
CO.Pos.boxplots_1CO

```

```{r CO1_foci_pos_boxplot, echo=FALSE, eval=FALSE}

MELT_long_biv <- MELT_Curated_BivData[ MELT_Curated_BivData$Obj.ID %in% real.long.bivData$Obj.ID, ]

CO.Pos.boxplots_1CO <- ggplot(MELT_Curated_BivData.1CO, aes(x= strain, y=PER.Foci.Pos, fill=strain) ) + geom_boxplot(alpha=.2) + facet_wrap(sex~subsp, ncol=2, scales="free")+ggtitle("Percent Foci Position")+geom_jitter(alpha=.1)+scale_fill_manual(values=colors_of_strains)
CO.Pos.boxplots_1CO

```

```{r Q1.1CO.pos_Sardell.eq, echo=FALSE, eval=FALSE, include=FALSE}
#IGNORE THIS FOR KNOW, THIS 

#filter all Curated biv data for 1 strain
#WSB.Bivalents.DF , use single bivalent level observations, with the strain specific DFs


# the stardell paper sums the number of COs for bins (10)

#in my data it would be like adding -- 10 more colums, and marking 1 if there is a bin within it
#but then the model would be close to logistic

#summing the number of COs per bin, losses the chrom specific data....
#!! need to use a melted Data frame to capture all nrm.foci obs
#wsb.ttest<- mouse.avs_4MM %>% filter()
#start with same chrm classes
#the telomere dist and centromere dis were celulcate for the nearest foci ... but really these shhould be calq for each foci

WSB.Biv.1CO <- WSB.Bivalents.DF %>% filter(hand.foci.count == 1)

Sardell.mo.WSB <- lmer(PER_Foci_1 ~ dis.cent + telo_dist + sex+ (1 | chromosomeLength), data = WSB.Biv.1CO)


PWD.Biv.1CO <- PWD.Bivalents.DF %>% filter(hand.foci.count == 1)

Sardell.mo.PWD <- lmer(PER_Foci_1 ~ dis.cent + telo_dist + sex + (1 | chromosomeLength), data = PWD.Biv.1CO)
Sardell.mo.PWD_R.dis.cent <- lmer(PER_Foci_1 ~  telo_dist + sex + (1 | chromosomeLength), data = PWD.Biv.1CO)
Sardell.mo.PWD_R.dis.telo <- lmer(PER_Foci_1 ~  dis.cent + sex + (1 | chromosomeLength), data = PWD.Biv.1CO)

anova(Sardell.mo.PWD,Sardell.mo.PWD_R.dis.cent) #p= highly sig

anova(Sardell.mo.PWD,Sardell.mo.PWD_R.dis.telo) #p= v low

anova(Sardell.mo.PWD_R.dis.cent, Sardell.mo.PWD_R.dis.telo) #p = 1

#or AIC(model1,model2)

```

```{r Q1.mean.nrmF1_table, echo=FALSE, eval=FALSE}

#make a table for the sex specific values of the normalized F1 positions

#for strain, sex -- Curated_BivData
#or (Mouse.Table_BivData_4MM)
#norm.first.foci.pos
Q1.normF1.pos_table <- ddply(Mouse.Table_BivData_4MM, c("strain","sex"), summarise,
                  
                    mean_1CO_nrm.pos = mean(norm.first.foci.pos, na.rm = TRUE), 
                  n1CO = sum(n1CO )

)

```

```{r norm.CO.pos_longBiv, echo=FALSE, eval=FALSE}

#real.long.bivData
#MELT_Curated_BivData

#these isn't long.biv data
MELT_long_biv <- MELT_Curated_BivData[ MELT_Curated_BivData$Obj.ID %in% real.long.bivData$Obj.ID, ]

real.long.bivData
MELT_Curated_BivData.1CO <- MELT_Curated_BivData[MELT_Curated_BivData$hand.foci.count < 2, ]
MELT_Curated_BivData.1CO <- MELT_Curated_BivData.1CO[MELT_Curated_BivData.1CO$PER.Foci.Pos < 1.01, ]

MELT_long_biv <- MELT_Curated_BivData[ MELT_Curated_BivData$Obj.ID %in% real.long.bivData$Obj.ID, ]


MELT_long_biv <- add_sex(MELT_long_biv)
MELT_long_biv <- add_strain(MELT_long_biv)
MELT_long_biv <- add_subsp(MELT_long_biv)
MELT_long_biv <- add_category(MELT_long_biv)


long.biv_Dom.male <- MELT_long_biv[ (MELT_long_biv$subsp == "Dom") & (MELT_long_biv$sex == "male"), ]

Dom.male_MELT_long <- ggplot( long.biv_Dom.male, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Dom male long biv\nNormalized Foci Positions")+scale_fill_manual(values=colors_of_strains)
Dom.male_MELT_long


long.biv_Musc.male <- MELT_long_biv[ (MELT_long_biv$subsp == "Musc") & (MELT_long_biv$sex == "male"), ]

Musc_male_MELT_long <- ggplot( long.biv_Musc.male, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Musc male long biv\nNormalized Foci Positions")+scale_fill_manual(values=colors_of_strains)
Musc_male_MELT_long

#there are v few observations in this dataset
```

```{r Q1.log.reg.CO1_pos, echo=FALSE, eval=FALSE}

#LOGISTIC REGRESSION for FOCI POSITION

#mouse av, norm.first foci is from 1CO bivalents
log.reg_1CO_pos_mouse.av <- glm(Rec.group ~ norm.first.foci.pos, 
                            data=mouse.avs_4MM[(mouse.avs_4MM$subsp == "Musc")&(mouse.avs_4MM$sex == "male"),], family=binomial(link="logit"))
summary(log.reg_1CO_pos_mouse.av)


#single biv level
log.reg_1CO_pos_biv <- glm(Rec.group ~ PER_Foci_1, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male")&(Curated_BivData$hand.foci.count == 1),], family=binomial(link="logit"))
summary(log.reg_1CO_pos_biv)

```


# Q1. Sex Differences in CO Interference (IFD)


```{r Q1.IFD_show.IFD_99, echo=FALSE, warning=FALSE, message=FALSE}

#first draft of the IFD comparisons
#make the mouse boxplots -- instead of geom_points

#Only use 2CO bivalents
Curated_BivData.22 <- Curated_BivData[Curated_BivData$hand.foci.count == 2,]
Curated_BivData.22 <- Curated_BivData.22[(!is.na(Curated_BivData.22$hand.foci.count)),]


P1.by.P2_plot <- ggplot(Curated_BivData.22, aes(y = rev(PER_Foci_2), x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized IFD")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none")+xlim(c(0,1))+ylim(c(0,1))

#each point is a 2CO, with the F1 and F2 position 
#based on plot from Dourad et al (Mercier)

P1.by.P2_plot_raw.WSB <- ggplot(Curated_BivData.22 %>% filter(strain == "WSB"),
    aes(y = Foci2, x= Foci1, color=strain))+
  geom_jitter(alpha=.5)+
  ggtitle("Raw IFD WSB")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none") + ylim(c(0,160))+xlim(c(0,160))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )

#trying to move x axis to top
#cowplot might be the easier way -- since kinda diffecult in ggplot
#or ggdraw

P1.by.P2_plot_nrm.PWD.f <- ggplot(Curated_BivData.22 %>% filter(strain == "PWD") %>% filter(sex == "female"),
    aes(y = PER_Foci_2, x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.5)+
#  scale_x_continuous(position = "top") +
  scale_x_continuous(sec.axis = dup_axis(), position = "top")+
    ggtitle("Nrm IFD PWD, female")+scale_color_manual(values=colors_of_strains)+ ylim(c(0,1))+xlim(c(0,1))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )


P1.by.P2_plot_nrm.PWD.male <- ggplot(Curated_BivData.22 %>% filter(strain == "PWD") %>% filter(sex == "male"),
    aes(y = PER_Foci_2, x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.5)+
#  scale_x_continuous(position = "top") +
  scale_x_continuous(sec.axis = dup_axis(), position = "top")+
    ggtitle("Nrm IFD PWD, male")+scale_color_manual(values=colors_of_strains)+ ylim(c(0,1))+xlim(c(0,1))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )



#boxplots
boxplots_first.IFD.plot_ABS <- ggplot(Curated_BivData.22, aes(y = IFD1_ABS, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, ABS")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+ylim(c(20,160))+theme(legend.position="none")
#order is out of wack, but -- good for now

boxplots_first.IFD.plot_PER <- ggplot(Curated_BivData.22, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, PER")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none")+ylim(c(0,1))


first.IFD.plot_ABS <- ggplot(Curated_BivData.22, aes(y = IFD1_ABS, x= strain, color=mouse))+geom_jitter()+ggtitle("Interfocal Distances, ABS")+facet_wrap(sex~subsp, scales = "free")+ylim(c(20,160))+theme(legend.position="none") #+scale_color_manual(values=colors_of_strains)


first.IFD.plot_PER <- ggplot(Curated_BivData.22 %>% filter(chromosomeLength < 150), aes(y = IFD1_PER, x= strain, color=chromosomeLength))+geom_jitter()+ggtitle("Interfocal Distances, PER \ncut off of chrm lengths, 150")+facet_wrap(sex~subsp, scales = "free")+ylim(c(0,1)) 

#+theme(legend.position="none")
```

```{r Q1.IFD_IFD.old.plots, echo=FALSE, eval=FALSE, warning=FALSE, message=FALSE}
#long SC Long_biv_mouse.avs_4MM
#real.long.bivData
#Only use 2CO bivalents

real.long.bivData.22 <- real.long.bivData[real.long.bivData$hand.foci.count == 2,]
real.long.bivData.22 <- real.long.bivData.22[(!is.na(real.long.bivData.22$hand.foci.count)),]


long.biv_IFD_look_ABS <- ggplot(real.long.bivData.22, aes(y = IFD1_ABS, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, ABS")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+ylim(c(20,160))+theme(legend.position="none")+scale_color_manual(values=colors_of_strains)


long.biv_IFD_look_PER <- ggplot(real.long.bivData.22, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, ABS")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+ylim(c(0,1))+theme(legend.position="none")+scale_color_manual(values=colors_of_strains)
```

```{r Q1.IFD_Ttests, echo=FALSE, warning=FALSE, message=FALSE}
#below are calq just from 2COs, have no fear
#mean_IFD.2CO_ABS
#mean_IFD.2CO_PER

#FULL all strains
Q1.IFD.raw_FULL_t.test <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain !=  "CZECH" ) %>% filter(strain !=  "MOLF" )    )$mean_IFD.2CO_ABS,
                           
                                ( mouse.avs_4MM %>% filter(sex == "female") )$mean_IFD.2CO_ABS)
#p-value = 0.07


Q1.IFD.PER_FULL_t.test <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain !=  "CZECH" ) %>% filter(strain !=  "MOLF" )    )$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") )$mean_IFD.2CO_PER)
#p-value = 1e-12


#WSB
Q1.IFD.raw_t.test_WSB <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="WSB" ))$mean_IFD.2CO_ABS,
                                (mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="WSB"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_WSB <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="WSB" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="WSB"))$mean_IFD.2CO_PER)

#LEW
Q1.IFD.raw_t.test_LEW <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="LEW" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="LEW"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_LEW <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="LEW"))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="LEW"))$mean_IFD.2CO_PER)

#G
Q1.IFD.raw_t.test_G <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="G" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="G"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_G <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="G" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="G"))$mean_IFD.2CO_PER)


#PWD
Q1.IFD.raw_t.test_PWD <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="PWD" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="PWD"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_PWD <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="PWD" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="PWD"))$mean_IFD.2CO_PER)


#KAZ
Q1.IFD.raw_t.test_KAZ <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="KAZ"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_KAZ <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="KAZ"))$mean_IFD.2CO_PER)


#SKIVE
Q1.IFD.raw_t.test_SKIVE <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="SKIVE" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="SKIVE"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_SKIVE <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="SKIVE" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="SKIVE"))$mean_IFD.2CO_PER)

#MSM
Q1.IFD.raw_t.test_MSM <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="MSM" ))$mean_IFD.2CO_ABS,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="MSM"))$mean_IFD.2CO_ABS)

Q1.IFD.PER_t.test_MSM <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain =="MSM" ))$mean_IFD.2CO_PER,
                                ( mouse.avs_4MM %>% filter(sex == "female") %>% filter(strain =="MSM"))$mean_IFD.2CO_PER)


#FULL all strains
Q1.IFD.raw_sansG_t.test <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(strain !=  "CZECH" ) %>% filter(strain !=  "MOLF" )  %>%  filter(strain !="G") )$mean_IFD.2CO_ABS,
                           
                                ( mouse.avs_4MM %>% filter(sex == "female") %>%  filter(strain !="G") )$mean_IFD.2CO_ABS)
#p-value = 0.3
```

```{r Q1.show.IFD.scatter, echo=FALSE, eval=FALSE, message=FALSE}
nrm.IFD_KAZ_long <- ggplot( (Q1.IFD.long %>% filter(strain =="KAZ" ) ) , aes(y = meanIFD2CO_norm, x= sex,color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")

nrm.IFD_KAZ_BIV.long <- ggplot( (real.long.bivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2")  ) , aes(y = IFD1_PER, x= sex, color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")
#11jan18_KAZ_m3, 26jan18_11jan18_KAZ_m3_sp1_8_rev_19
#looked up image, measures confirmed 

####
nrm.IFD_KAZ_short <- ggplot( (Q1.IFD.short %>% filter(strain =="KAZ" ) ) , aes(y = meanIFD2CO_norm, x= sex,color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")

nrm.IFD_KAZ_BIV.short <- ggplot( (real.short.bivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2")  ) , aes(y = IFD1_PER, x= sex, color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")
#21may18_KAZ_m2 -- seems like it might be an outlier
#5jun18_21may18_KAZ_m2_sp1_19.2_rev_16
#second foci slightly smaller, kinda fainter -- but also much brighter than background

#check all KAZ males

nrm.IFD_KAZ_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_KAZ.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_KAZ.female_BIV.data


nrm.IFD_PWD.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="PWD" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female PWD")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_PWD.female_BIV.data

nrm.IFD_LEW.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_LEW.female_BIV.data

nrm.IFD_G.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="G" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female G")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_G.female_BIV.data

nrm.IFD_WSB.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="WSB" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female WSB")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_WSB.female_BIV.data    #18nov17_WSB_f2 has continuous ifd range

nrm.IFD_LEW_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MOLF")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))+theme(axis.text.x = element_blank())

raw.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_ABS, x= mouse, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MOLF")+theme(axis.text.x = element_blank())+ylim(c(0, 100))

raw.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_ABS, x= mouse, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MSM")+theme(axis.text.x = element_blank())+ylim(c(0, 100))



Fby.F.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = Foci1, x=Foci2, color=chromosomeLength))+geom_point()+ggtitle("FOce Pos by Fos Pos MOLF")+facet_wrap(~mouse, scales = "free")+ylim(c(0,75))+xlim(c(0,120))+theme(legend.position="none") 

Fby.F.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = Foci1, x=Foci2, color=chromosomeLength))+geom_point()+ggtitle("Foci Pos by Fos Pos MSM")+facet_wrap(~mouse, scales = "free")+ylim(c(0,75))+xlim(c(0,120))+theme(legend.position="none") 


###look at why KAZ males are weird



nrm.IFD_KAZ_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))


nrm.IFD_LEW_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

#the difference the the Nrm IFD cut off is striking with these plots


nrm.IFD_PWD_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="PWD" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male") ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male PWD")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

#this might 


nrm.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male GMSM")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))


nrm.IFD_SKIVE_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="SKIVE" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male SKIVE")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_G_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="G" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male G")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))


nrm.IFD_sex.comp_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, ")+facet_wrap(~sex, scales = "free")+ylim(c(0,1))+theme(legend.position="none") 

```

```{r Q1.IFD_gamma, echo=FALSE, message=FALSE}
library(EnvStats)
#cleanCurated_BivData

#all.female.multi <- (cleanCurated_BivData %>% filter(sex == "female") %>% filter(hand.foci.count > 1) %>%
#                       filter( !is.na( IFD1_ABS) ))  #$IFD1_ABS


#this MELT BIVDATA should be good to go
MELT.IFD.BIVDATA <- melt(cleanCurated_BivData[,c("fileName", "chromosomeLength","centromere_ABS_Position", "centromere_PER_Position",
                            "Obj.ID","hand.foci.count",
                            "mouse","category","strain", "sex", "Rec.group",
                            "IFD1_ABS","IFD2_ABS","IFD3_ABS")], 
           
             id=c("fileName", "chromosomeLength","centromere_ABS_Position", "centromere_PER_Position",
                            "Obj.ID","hand.foci.count",
                            "mouse","category","strain", "sex", "Rec.group"))
#rename the cols and clean up
MELT.IFD.BIVDATA <- MELT.IFD.BIVDATA[(!is.na(MELT.IFD.BIVDATA$value)),]

colnames(MELT.IFD.BIVDATA) <- c("fileName", "chromosomeLength","centromere_ABS_Position", "centromere_PER_Position",
                            "Obj.ID","hand.foci.count",
                            "mouse","category","strain", "sex", "Rec.group", 
                               "whichIFD", "IFDval") 

MELT.IFD.BIVDATA$Nrm.IFD <- MELT.IFD.BIVDATA$IFDval / MELT.IFD.BIVDATA$chromosomeLength

#START isolating all the types of IFDs

#all.female.multi$mycol <- apply(all.female.multi[,c('IFD1_ABS','IFD2_ABS','IFD3_ABS')], 1, function(x) x[!is.na(x)][1])

all.female.IFDs <- MELT.IFD.BIVDATA %>% filter(sex == "female")#1697

all.male.IFDs <- MELT.IFD.BIVDATA %>% filter(sex == "male")#1392

#shape and scale parameter

#gamma fits
FULL.female.gamma <- egamma( all.female.IFDs$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.8

#gamma fits
FULL.male.gamma <- egamma( all.male.IFDs$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#shape  5.4
#male, stronger interference

WSB.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.1, 3.73 (raw, PER) (n=252)

WSB.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.6, 5.10 (raw, PER) (n=186)
#try the short and long bivalents dataset

WSB.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3, 3.237 (raw, PER) (n=60)


#gamma fits
WSB.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "WSB")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.5,  5.1 (raw, PER) (n= 109)  

WSB.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.9, 3.9 (raw, PER)  (n=107)
#there are 0 3CO and 2  4CO bivalents -- this causes a greater difference in the PER based value

```

```{r Q1.gamma.IFD, echo=FALSE, message=FALSE}
female.gamma <- egamma( (all.female.IFDs )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

f2CO.female.gamma <- egamma( (all.female.IFDs  %>% filter(hand.foci.count == 2)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

f3CO.female.gamma <- egamma( (all.female.IFDs %>%  filter(hand.foci.count == 3)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

f4CO.female.gamma <- egamma( (all.female.IFDs %>%  filter(hand.foci.count == 4)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
PWD.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "PWD")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.8, 4.844 (raw, nrm)  (n = 357)
PWD.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "PWD") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3.8, 6.746 (raw, nrm) (n = 285)
PWD.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "PWD") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#3, 3.628 (n = 72)

KAZ.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "KAZ")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#

KAZ.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "KAZ") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#

KAZ.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "KAZ") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
#####
SKIVE.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "SKIVE")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
SKIVE.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "SKIVE") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
SKIVE.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "SKIVE") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
##
MSM.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "MSM")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MSM.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "MSM") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MSM.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "MSM") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

MSM.4CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "MSM") %>% filter(hand.foci.count == 4)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)


######
G.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "G")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
G.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "G") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
G.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "G") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

G.4CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "G") %>% filter(hand.foci.count == 4)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

######
LEW.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "LEW")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
LEW.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "LEW") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
LEW.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "LEW") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

LEW.4CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "LEW") %>% filter(hand.foci.count == 4)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
######
WSB.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
WSB.2CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
WSB.3CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

WSB.4CO.female.gamma <- egamma( (all.female.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 4)  )$IFDval, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
```

```{r Q1.male.IFD_gamma, echo=FALSE, message=FALSE}
#gamma fits
male.gamma <- egamma( (all.male.IFDs )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

m2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

m3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE,         ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
#gamma fits
PWD.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "PWD")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#8.1, 11.74 (n=318) (lots of variation when I apply sample size of 18)

PWD.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "PWD") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#10.3, 16.962, (n=300)

PWD.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "PWD") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#2.9, 3.4, (n=18)

####
KAZ.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "KAZ")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
KAZ.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "KAZ") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
KAZ.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "KAZ") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
SKIVE.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "SKIVE")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
SKIVE.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "SKIVE") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
SKIVE.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "SKIVE") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)


###
MSM.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MSM")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MSM.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MSM") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE,     ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MSM.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MSM") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
MOLF.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MOLF")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MOLF.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MOLF") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
MOLF.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "MOLF") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
G.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "G")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
G.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "G") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
G.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "G") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
LEW.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "LEW")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
LEW.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "LEW") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
LEW.3CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "LEW") %>% filter(hand.foci.count == 3)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)

###
WSB.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "WSB")  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
#
WSB.2CO.male.gamma <- egamma( (all.male.IFDs %>% filter(strain == "WSB") %>% filter(hand.foci.count == 2)  )$Nrm.IFD, method = "mle", ci = TRUE, 
                            ci.type = "two-sided", ci.method = "normal.approx", 
                            normal.approx.transform = "kulkarni.powar", conf.level = 0.95)
```

```{r Q1.IFD.lmer.M1, echo=FALSE, message=FALSE, warning=FALSE}

#M1_IFD_2CO_ABS
lmer.IFD.ABS_MM.M1 <- lmer(mean_IFD.2CO_ABS ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 
lmer.IFD.ABS_MM.M1.reduce.sex <- lmer( mean_IFD.2CO_ABS ~ subsp  +(1|strain), data=Mouse.Table_BivData_4MM )
lmer.IFD.ABS_MM.M1.reduce.subp <- lmer( mean_IFD.2CO_ABS ~ sex  +(1|strain), data=Mouse.Table_BivData_4MM )

ABS.IFD_Q1.M1_sex  <- anova(lmer.IFD.ABS_MM.M1, lmer.IFD.ABS_MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
ABS.IFD_Q1.M1_subsp  <- anova(lmer.IFD.ABS_MM.M1, lmer.IFD.ABS_MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
ABS.IFD_Q1.M1_intr  <- drop1(lmer.IFD.ABS_MM.M1, test="Chisq" )$`Pr(Chi)`[2]
ABS.IFD_Q1.M1_strain  <- exactRLRT(lmer.IFD.ABS_MM.M1)$p.value

Q1.IFD.ABS_M1_lmer.results <- data.frame(sub.sp = ABS.IFD_Q1.M1_subsp, sex.results =  ABS.IFD_Q1.M1_sex, 
               interaction.pval = ABS.IFD_Q1.M1_intr,  rand.pval = ABS.IFD_Q1.M1_strain)

#M1_IFD_2CO
lmer.IFD.PER_MM.M1 <- lmer(mean_IFD.2CO_PER ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 
lmer.IFD.PER_MM.M1.reduce.sex <- lmer( mean_IFD.2CO_PER ~ subsp  +(1|strain), data=Mouse.Table_BivData_4MM )
lmer.IFD.PER_MM.M1.reduce.subp <- lmer( mean_IFD.2CO_PER ~ sex  +(1|strain), data=Mouse.Table_BivData_4MM )

sex.pval <- anova(lmer.IFD.PER_MM.M1, lmer.IFD.PER_MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
subsp.pval <- anova(lmer.IFD.PER_MM.M1, lmer.IFD.PER_MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
subsp.sex.pval <- drop1(lmer.IFD.PER_MM.M1, test="Chisq" )$`Pr(Chi)`[2]
strain.pval <- exactRLRT(lmer.IFD.PER_MM.M1)$p.value

Q1.IFD.PER_M1_lmer.results <- data.frame(sub.sp = subsp.pval, sex.results =  sex.pval, 
               interaction.pval = subsp.sex.pval,  rand.pval = strain.pval)

```

```{r Q1.IFD_glm.M2, echo=FALSE, warning=FALSE, message=FALSE}
#mouse.avs_4MM -- is also the bivbased mouse average table 
#Mouse.Table_BivData_4MM #this one is the HetC table (all the Curated BivData)

glm.Q1_IFD.ABS.M2  <- glm(mean_IFD.2CO_ABS ~ subsp * sex * strain, data=Mouse.Table_BivData_4MM)
summry.glm.Q1_IFD.ABS.M2 <- summary(glm.Q1_IFD.ABS.M2)

glm.Q1_IFD.ABS.M2_kindaFU  <- glm(mean_IFD.2CO_ABS ~ subsp * sex * strain, data=mouse.avs_4MM)
summry.glm.Q1_IFD.ABS.M2_kindaFU <- summary(glm.Q1_IFD.ABS.M2_kindaFU)

#write.table(round(summry.glm.Q1_IFD.ABS.M2$coefficients,5), "~./MLH1repo/summry.glm.Q1_IFD.ABS.M2.csv", sep=",",row.names = TRUE)

#PER
glm.Q1_IFD.PER.M2 <- glm(mean_IFD.2CO_PER ~ subsp * sex * strain, data=Mouse.Table_BivData_4MM)
summry.glm.Q1_IFD.PER.M2 <- summary(glm.Q1_IFD.PER.M2)
```

```{r Q1.IFD_glmM3, echo=FALSE, warning=FALSE, message=FALSE}

glm.Q1_IFD.ABS.M3  <- glm(mean_IFD.2CO_ABS ~  sex * strain, data=Mouse.Table_BivData_4MM)
summry.glm.Q1_IFD.ABS.M3 <- summary(glm.Q1_IFD.ABS.M3)

#PER
glm.Q1_IFD.PER.M3  <- glm(mean_IFD.2CO_PER ~ sex * strain, data=Mouse.Table_BivData_4MM)
summry.glm.Q1_IFD.PER.M3 <- summary(glm.Q1_IFD.PER.M3)
#round(summry.glm.Q1_IFD.PER.M3$coefficients[,c(1,4)],5)

#write.table(round(summry.glm.Q1_IFD.PER.M3$coefficients,6), #"~./MLH1repo/summry.glm.Q1_IFD.PER.M3.csv", sep=",",row.names = TRUE)
```


There is no strong signal of sex differences in raw mean inter-focal distances (IFD^raw^) across the full set of strains. A marginally significant difference between the sexes (t-test; p = 0.07 -- `r Q1.IFD.raw_FULL_t.test$p.value`) is driven by one strain (t-test without domesticus^G^; p = 0.27 -- `r Q1.IFD.raw_t.test_G$p.value`). This result indicates that females and males exhibit a similar level of interference when it is measured in physical (SC) units. In contrast, males have significantly longer normalized mean inter-focal distances (IFD^norm^) than females in seven out of eight strains (t-tests; p < 0.02 -- `r Q1.IFD.PER_FULL_t.test$p.value`), with only musculus^KAZ^ showing no difference (t-test; p = 0.33 --  `r Q1.IFD.PER_t.test_KAZ$p.value`). Examination of IFD^norm^ distributions indicates that female IFD^norm^ values are centered at approximately 50% and show a slight enrichment of low (<25%) values, whereas males are enriched for higher values.
Mixed models and general linear models of IFD^norm^ support the inference of stronger interference in males: sex is the most significant variable (M1 - LRT **random**: p = 6.7410^{-14} -- `r Q1.IFD.PER_M1_lmer.results$sex.results`  glm *M2* `r summry.glm.Q1_IFD.PER.M2$coefficients[,4][4]`  *M3* `r summry.glm.Q1_IFD.PER.M3$coefficients[,4][2]`). When interference is measured in physical SC units (IFD^raw^), the differences between sexes is low and only slightly significant (data not shown). 
In summary, controlling for differences in chromatin compaction (SC length) using IFDnorm indicates that interference is stronger in males, whereas consideration of IFD^raw^ shows that the sexes exhibit a similar level of interference on the physical (SC) scale.  While the comparisons of the IFD^norm^ metrics can reveal more general recombination landscape patterns while controlling for the underlying differences in chromatin compaction and SC length.

<moved a section on relationship of linkage maps to Discussion (or Methods)>  


```{r Q1.IFD.plot, echo=FALSE}

#make interference plots of IFD, position p1 by p2




```

```{r Comp_Ratios, echo=FALSE}

#calq ratios of belo 30

top.male <-  G.Bivalents.DF %>% filter(sex== "male") %>%  filter(hand.foci.count== 2) %>%filter(IFD1_PER <= .3) 

bottom.male <-  G.Bivalents.DF %>% filter(sex== "male") %>%  filter(hand.foci.count== 2) 

ratio.male <- length(top.male$Obj.ID)/ length(bottom.male$Obj.ID)


top.female <-  G.Bivalents.DF %>% filter(sex== "female") %>%  filter(hand.foci.count== 2) %>% filter(IFD1_PER <= .3)

bottom.female <-  G.Bivalents.DF %>% filter(sex== "female")%>%  filter(hand.foci.count== 2)

ratio.female <- length(top.female$Obj.ID)/ length(bottom.female$Obj.ID)

#what is the fastest way to calq all these ratios?  also what's the fastst way to get them into a DF / table?


#put all the DFs in a list, for each DF in the list -- apply the filters for the nom and denominator
MOLF.Bivalents.DF <- Curated_BivData %>% filter(strain == "MOLF")


DF.strain.list <- list(
  WSB.Bivalents.DF, G.Bivalents.DF, LEW.Bivalents.DF, 
  PWD.Bivalents.DF, KAZ.Bivalents.DF, SKIVE.Bivalents.DF,
  MSM.Bivalents.DF, MOLF.Bivalents.DF
  )

entr_DF <- data.frame(strain=c("WSB", "G", "LEW", "PWD", "KAZ", "SKIVE", "MSM", "MOLF"), 
        total.2CO_female=c(0,0,0,0,0,0,0,0), total.2CO_male=c(0,0,0,0,0,0,0,0), below30_male = c(0,0,0,0,0,0,0,0), below30_female = c(0,0,0,0,0,0,0,0),     
          female.ratio = c(0,0,0,0,0,0,0,0), male.ratio = c(0,0,0,0,0,0,0,0))
  
i = 1
for(x in (DF.strain.list) ){
  
  #print(head())
  
  #these filters won't apply to the indexed DF
  top.male =  x %>% filter(sex== "male") %>%  filter(hand.foci.count== 2) %>%filter(IFD1_PER <= .3)

  bottom.male <-  x %>% filter(sex== "male") %>%  filter(hand.foci.count== 2)

  entr_DF$total.2CO_male[i] <- length(bottom.male$Obj.ID)
  entr_DF$below30_male[i] <- length(top.male$Obj.ID)
  entr_DF$male.ratio[i] <- length(top.male$Obj.ID)/ length(bottom.male$Obj.ID)
  
  top.female <-  x %>% filter(sex== "female") %>%  filter(hand.foci.count== 2) %>% filter(IFD1_PER <= .3)
  
  bottom.female <-  x %>% filter(sex== "female")%>%  filter(hand.foci.count== 2)

  
  entr_DF$total.2CO_female[i] <- length(bottom.female$Obj.ID)
  entr_DF$below30_female[i] <- length(top.female$Obj.ID)
  entr_DF$female.ratio[i] <- length(top.female$Obj.ID)/ length(bottom.female$Obj.ID)
  
  i = i+1
  
  }
#entr_DF

entr_DF$sex.dif <- entr_DF$female.ratio - entr_DF$male.ratio

```

```{r Q1.IFD.long.short.setup, echo=FALSE, eval=FALSE}

#real.long.bivData
#real.short.bivData

Q1.IFD.long <- ddply(real.long.bivData, c("mouse"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
            
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                         
                     )

Q1.IFD.long <- add_sex(Q1.IFD.long)
Q1.IFD.long <- add_strain(Q1.IFD.long)
Q1.IFD.long <- add_subsp(Q1.IFD.long)

Q1.IFD.long$strain <- factor(Q1.IFD.long$strain, ordered = FALSE)
Q1.IFD.long$subsp <- factor(Q1.IFD.long$subsp, ordered = FALSE)



Q1.IFD.short <- ddply(real.short.bivData, c("mouse"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
            
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                         
                     )

Q1.IFD.short <- add_sex(Q1.IFD.short)
Q1.IFD.short <- add_strain(Q1.IFD.short)
Q1.IFD.short <- add_subsp(Q1.IFD.short)

Q1.IFD.short$strain <- factor(Q1.IFD.short$strain, ordered = FALSE)
Q1.IFD.short$subsp <- factor(Q1.IFD.short$subsp, ordered = FALSE)

#t.test. mouse av
Q1.IFD.raw_short.ttest_KAZ <-  t.test( (Q1.IFD.short %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$meanIFD2CO_norm,
                                ( Q1.IFD.short %>% filter(sex == "female") %>% filter(strain =="KAZ"))$meanIFD2CO_norm)

  
Q1.IFD.raw_long.ttest_KAZ <- t.test( (Q1.IFD.long %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$meanIFD2CO_norm,
                                ( Q1.IFD.long %>% filter(sex == "female") %>% filter(strain =="KAZ"))$meanIFD2CO_norm)
#both the short and long norm IFD are NS
  

#t.test Biv
Q1.IFD.raw_BIV.long.ttest_KAZ <-  t.test( (real.long.bivData %>% filter(sex == "male") %>% filter(strain =="KAZ" )  %>% filter(hand.foci.count == "2") )$IFD1_PER,
                ( real.long.bivData %>% filter(sex == "female") %>% filter(strain =="KAZ") %>%  filter(hand.foci.count == "2"))$IFD1_PER)

Q1.IFD.raw_BIV.short.ttest_KAZ <-  t.test( (real.short.bivData %>% filter(sex == "male") %>% filter(strain =="KAZ" )  %>% filter(hand.foci.count == "2") )$IFD1_PER,
                ( real.short.bivData %>% filter(sex == "female") %>% filter(strain =="KAZ") %>%  filter(hand.foci.count == "2"))$IFD1_PER)
```

# Additional Determinants of Genome-wide Recombination Rate Evolution in Males


The next section is meant to focusNext, we used the contrast between high-recombination strains (musculus^PWD^ , musculus^SKIVE^, and molossinus^MSM^) and low-recombination strains to identify features of the recombination landscape associated with evolutionary transitions in the genome-wide recombination rate. 
on the greater aspect of variation in mean MLH1 counts per cell the high recombining strains ( musculus^PWD^ , musculus^SKIVE^, and molossinus^MSM^) to the low recombing strains. The main objective of this section is to test for significant correlations between features of the recombination landscape and the evolution of mean MLH1 foci per cell.
In comparing the male specific single bivalent based metrics the first creteria for analysis is a significant differences between the high and low recombining groups and the second step is testing for significant subspecies and strain effects in the same models which used mean MLH1 count per cell.


Previous empirical work suggests basic predictions for the relationship between the genome wide recombination rate and two aspects of the recombination landscape. **SC length is expected to be positively associated with genome-wide recombination rate because of the loop-axis strucutre** (zickler Kleckner 1999, Merier 2015?). Crossover interference strength is expected to be negatively **associated with genome-wide recombination rate since interference is defined as the non-random spacing between crossovers on the same chromosome**. 

Following this logic we predict (1) musculus^PWD^ will have greater SC length and weaker interference than musculus^SKIVE^, which in turn will have longer SC and weaker interference compared to the other _musculus_ strains, (2) molossinus^MSM^ will have longer SC and weaker interference compared to molossinus^MOLF^, and 3) _domesticus_ strains will have similar SC length and crossover interference.


# Q2 SC Length

```{r Q2.SC.short.long.setup, echo=FALSE}

#table(male.long.biv$strain)
#the Long biv dataset is quite unbalance (esp MSM)
male.long.biv <- real.long.bivData %>% filter(sex== "male")

#mouse av for long biv
cell.av.long.biv.table <- ddply(male.long.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
cell.av.long.biv.table <- add_mouse(cell.av.long.biv.table)
cell.av.long.biv.table <- add_strain(cell.av.long.biv.table)
cell.av.long.biv.table <- add_subsp(cell.av.long.biv.table)

cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)


Q2mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                         #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)])
                         )

Q2mouse.av.long.biv.table <- add_strain(Q2mouse.av.long.biv.table)
Q2mouse.av.long.biv.table <- add_subsp(Q2mouse.av.long.biv.table)

Q2mouse.av.long.biv.table$strain <- factor(Q2mouse.av.long.biv.table$strain, ordered = FALSE)
Q2mouse.av.long.biv.table$subsp <- factor(Q2mouse.av.long.biv.table$subsp, ordered = FALSE)

#divide musc males into groups
Q2mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.long.biv.table$strain), 1, 
                                  ifelse(grepl("MSM", Q2mouse.av.long.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.long.biv.table$strain), 1,
                                           0)))

Q2mouse.av.long.biv.table$Rec.group.exclu <- ifelse(grepl("PWD", Q2mouse.av.long.biv.table$strain), 1, 
                                ifelse(grepl("MSM", Q2mouse.av.long.biv.table$strain), 1, 0))


male.short.biv <- real.short.bivData %>% filter(sex== "male")

Q2mouse.av.short.biv.table <- ddply(male.short.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                        #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]
                         ) ) 

Q2mouse.av.short.biv.table <- add_mouse(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_strain(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_subsp(Q2mouse.av.short.biv.table)

Q2mouse.av.short.biv.table$strain <- factor(Q2mouse.av.short.biv.table$strain, ordered = FALSE)
Q2mouse.av.short.biv.table$subsp <- factor(Q2mouse.av.short.biv.table$subsp, ordered = FALSE)

Q2mouse.av.short.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.short.biv.table$strain), 1, 
ifelse(grepl("MSM", Q2mouse.av.short.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.short.biv.table$strain), 1,
                                           0)))

Q2mouse.av.short.biv.table$Rec.group.exclu <- ifelse(grepl("PWD", Q2mouse.av.short.biv.table$strain), 1, 
                                ifelse(grepl("MSM", Q2mouse.av.short.biv.table$strain), 1, 0))
```

<!-- plots -->

```{r Q2.show.SC.length, echo=FALSE, warning=FALSE}

Curated_BivData99 <- Curated_BivData[Curated_BivData$hand.foci.count < 5,]
Curated_BivData99 <- Curated_BivData99[(!is.na(Curated_BivData99$sex)),]

#adjust order of plot here
Curated_BivData99$strain <- factor(Curated_BivData99$strain,levels =c(
  "WSB","G","LEW","PERC",  
"PWD", "SKIVE",  "KAZ",
     "MSM", "MOLF",   
                     "CAST",
                         "SPRET","SPIC" ), order=T )

Q2.SC_BivData <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)

#nested boxplots, pooled Bivalents
#x axis for hand.focicount -- good for seperating the points --- but it pools 

#prediction for Dom strains: low variation 
Q2.SC.length_Nested_boxplots_Dom <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \n Dom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") + scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Dom2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nDom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Musc2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Musc",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot( aes(x=strain), alpha=0.5)+geom_jitter(alpha=.2)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nMusc")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)


Q2.SC.length_Nested_boxplots_Mol <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Mol",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+geom_jitter(alpha=.3)+  ggtitle("Bivalent SC Lengths by Chrm Class\n Mol")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none")+scale_color_manual(values=color_chrm_class)

#+theme(legend.position="none") 
```

```{r Q2.SC.long.biv_plots, echo=FALSE}

#REAL.long_mouse_table
#REAL.short_mouse_table

#real.long.bivData
#real.short.bivData

shoo.long.biv <- ggplot( (real.long.bivData %>% filter(sex == "male") ), aes(y=chromosomeLength, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Single Biv \nMale Long Biv SC Lengths")


#cell.avlong.biv <- ggplot(cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Cell av. \nMale Long Biv SC Lengths")


mouse.shoo.long.biv <- ggplot( REAL.long_mouse_table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Mouse av. \nMale Long Biv SC Lengths")

                      
#cell.avlong.biv <- ggplot( cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + #ggtitle("Cell av. \nMale Long Biv SC Lengths")

```

```{r Q2_tot.sc_plot, echo=FALSE, warning=FALSE}

#totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain!="CAST" & strain !="F1"& strain !="SPIC" & strain !=  "CAROLI" & strain !="SPRET"& strain !="HMI"& strain !="PERC")

#MLH1_data <- MLH1_data %>%
#  arrange(strain, sex, mouse) %>%
#  mutate(file.name = factor(file.name))

mouse.av_totsc_male <- ggplot(data= totSC.mouse.av.table %>% filter(sex == "male"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(Rec.group~subsp, scales="free")+ theme(axis.title.x=element_blank(),        axis.text.x=element_blank(), axis.ticks.x=element_blank()) + ylim(c(1200,1850 ))+ggtitle("Mouse av. total SC area")

mouse.av_totsc_male

```

```{r Q2.SC_MLH1.by.totalSC, echo=FALSE, warning=FALSE}

#make plot of mouse averages for MLH1 and total SC

bep <- merge(  fomo.male_mouse.av,   totSC.mouse.av.table)

X.by.texas <- ggplot(bep, aes(x=mean.skel, y=mean_co, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")

X.by.texas

```

```{r Q2totalSC_checkdates, echo=FALSE, eval=FALSE}

#investigating potential skew / technical effects in the algorithm

Neg.control <- ggplot(bep, aes(x=mean.skel, y=mean.bin, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")
#not sure what my expectations for this plot are, 

median(bep$oldest.image.date) #"2017-08-03"
#there might be an issue with the algorithm performance 
#given the parrelle diagonal lines -- 
#this might be due to the dates imaged  2017-02-07

bep$date.cut.off <- ifelse( bep$oldest.image.date < "2017-02-07", 0, 1 )

Neg.control.find.date <- ggplot(bep, aes(x=mean.skel, y=mean.bin, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")+facet_wrap(~date.cut.off)

#there's evidence that the algorithm might have some biased effects -- 
#that will be investigated later.

```

```{r Q2.totSC.ttest, echo=FALSE}
#totalSC high and low rec group

Q2tot.sc_t.test_High.Low <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") )$mean.skel,
                (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "1") )$mean.skel)
#p-value = 0.007


#mol
Q2tot.sc_t.test_High.Low_Mol <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.skel,
         (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "1") %>% filter(subsp == "Mol") )$mean.skel)


#musc
Q2tot.sc_t.test_High.Low_Musc <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Musc"))$mean.skel,
                (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == "1") )$mean.skel)

```

```{r Q2.SC.length.bret.comments, echo=FALSE}
#correlation, total sc and Mean MLH1



```

```{r Q2.short.long.ttest, echo=FALSE}

#long and short 
#mouse.av.short.biv.table
#Q2mouse.av.short.biv.table
Q2short.biv_t.test_High.Low <- t.test((Q2mouse.av.short.biv.table %>% filter(Rec.group == "0") )$mean.SC,
                                      (Q2mouse.av.short.biv.table %>% filter(Rec.group == "1") )$mean.SC)

#p-value = 0.9

#mouse.av.long.biv.table
Q2long.biv_t.test_High.Low <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") )$mean.SC)
#p-value = 0.2


#mUSC-short
Q2.short_t.test_High.Low.musc <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-short
#Q2.short_t.test_High.Low.mol <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Mol"))$mean.SC)


#musc-long
Q2.long_t.test_High.Low.musc <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-long
#Q2.long_t.test_High.Low.mol <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp =="Mol"))$mean.SC)

#not enought observations 

```

```{r Q2.SC_HvL_allBiv, echo=FALSE}

#High-Low_All-BivData

Q2.all.BIV_t.test_HL <- t.test((Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)


#short
Q2.BIV_short_t.test_HL <- t.test((real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

#long
Q2.BIV_long_t.test_HL <- t.test((real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

```

```{r Q2.SC_across.subsp_tot.SC, echo=FALSE}

#Dom-Musc
Q2.totSC_t.test_DomMusc <- t.test((totSC.mouse.av.table  %>% filter(subsp == "Dom") )$mean.skel,
                          (totSC.mouse.av.table  %>%  filter(subsp == "Musc"))$mean.skel)
#p-value = 0.5

#Dom-Mol
Q2.totSC_t.test_DomMol <- t.test((totSC.mouse.av.table  %>% filter(subsp == "Dom") )$mean.skel,
                          (totSC.mouse.av.table  %>%  filter(subsp == "Mol"))$mean.skel)
#p-value = 0.1
```

```{r Q2.SC_across.subsp_short.long.mus.av, echo=FALSE}

#DOM-musc-long
Q2.long_t.test_DomMusc <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.08

#DOM-musc-short
Q2.short_t.test_DomMusc <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.8

#DOM-mol-long
Q2.long_t.test_DomMol <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.4

#DOM-mol-short
Q2.short_t.test_DomMol <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.09

```

```{r Q2.SC_across.subsp_short.long_biv, echo=FALSE}

#DOM-MUSC-ALL
Q2.all.BIV_t.test_DomMusc <- t.test((Curated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (Curated_BivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 4e-13

#DOM-MOL-ALL
Q2.all.BIV_t.test_DomMol <- t.test((Curated_BivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (Curated_BivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 6e-10

#DOM-musc-long
Q2.longBIV_t.test_DomMusc <- t.test((real.long.bivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.long.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.2

#DOM-musc-short
Q2.shortBIV_t.test_DomMusc <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.short.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.8


#DOM-mol-long
Q2.longBIV_t.test_DomMol <- t.test((real.long.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.long.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.4

#DOM-mol-short
Q2.shortBIV_t.test_DomMol <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.short.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.06

```

```{r Q2.totSC.glm, echo=FALSE}

Q2.glm_mus.av_totSC_M1 <- glm(mean.skel ~ subsp * strain, data= totSC.mouse.av.table %>% filter(sex == "male"))
sum.Q2.glm_mus.av_totSC_M1  <- summary(Q2.glm_mus.av_totSC_M1)$coefficients

#sum.Q2.glm_mus.av_totSC_M1$coefficients[,4]   pvalues of all effects
#sum.Q2.glm_mus.av_totSC_M1$coefficients[,1]  coefficients of all effects
#round(sum.Q2.glm_mus.av_totSC_M1$coefficients[,c(1,4)], 6)

Q2.glm_mus.av_totSC_M2 <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male"))
sum.Q2.glm_mus.av_totSC_M2  <- summary(Q2.glm_mus.av_totSC_M2)
#round(summary(sum.Q2.glm_mus.av_totSC_M2)$coefficients[,c(1,4)], 6)

totSC.mouse.av.table <- add_strain(totSC.mouse.av.table)
totSC.mouse.av.table <- add_sex(totSC.mouse.av.table)
totSC.mouse.av.table <- add_subsp(totSC.mouse.av.table)
#within subspecies values

#Dom
Q2.glm_mus.av_totSC_M2_DOM <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Dom"))
sum.Q2.glm_mus.av_totSC_M2_DOM  <- summary(Q2.glm_mus.av_totSC_M2_DOM)
#there are significant strain effects in DOM,


#Musc
Q2.glm_mus.av_totSC_M2_MUSC <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") )
sum.Q2.glm_mus.av_totSC_M2_MUSC  <- summary(Q2.glm_mus.av_totSC_M2_MUSC)
#KAZ -- is the only significant effect

#Mol
Q2.glm_mus.av_totSC_M2_MOL <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Mol") )
sum.Q2.glm_mus.av_totSC_M2_MOL  <- summary(Q2.glm_mus.av_totSC_M2_MOL)

#these pair-wise t.test aren't working
#dom
#pairwise.t.test( ( totSC.mouse.av.table %>% filter(subsp == "Dom") %>% filter(sex == "male") )$mean.skel, 
#                 ( totSC.mouse.av.table %>% filter(subsp == "Dom") %>% filter(sex == "male") )$strain )

#musc
#pairwise.t.test( ( totSC.mouse.av.table %>% filter(subsp == "Musc") %>% filter(sex == "male") )$mean.skel, 
#                 ( totSC.mouse.av.table %>% filter(subsp == "Musc") %>% filter(sex == "male") )$strain )

#mol
#pairwise.t.test( ( totSC.mouse.av.table %>% filter(subsp == "Mol") %>% filter(sex == "male") )$mean.skel, 
#                 ( totSC.mouse.av.table %>% filter(subsp == "Mol") %>% filter(sex == "male") )$strain )

```

```{r Q2.glm.SC.long, echo=FALSE}

#Q2.glm.M2.SC.cell.av_long.biv <- glm(mean.SC ~ strain, data= cell.av.long.biv.table)
#round(summary(glm.Q2.M2.SC.cell.av_long.biv)$coefficients[,c(1,4)], 6)
#table(mouse.av.long.biv.table$mouse)
#Q2mouse.av.long.biv.table

#this dataset is all males
glmQ2_long.biv_M1 <- glm(mean.SC ~ subsp * strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M1 <- summary(glmQ2_long.biv_M1)
#

glmQ2_long.biv_M2 <- glm(mean.SC ~ strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M2 <- summary(glmQ2_long.biv_M2)
#round(sum.glmQ2_long.biv_M2$coefficients[,c(1,4)], 6)

glmQ2_long.biv_M2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_long.biv_M2_DOM <- summary(glmQ2_long.biv_M2_DOM)

#MUSC
glmQ2_long.biv_M2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_long.biv_M2_MUSC <- summary(glmQ2_long.biv_M2_MUSC)

#MOL can't be done -- only 1 mouse for each MSM and MOLF
glmQ2_long.biv_M2_MOL <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Mol") )  )
sum.glmQ2_long.biv_M2_MOL <- summary(glmQ2_long.biv_M2_MOL)


#Dom
glm_SC.male_Dom_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Dom",])
#Musc
glm_SC.male_Musc_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Musc",])
#summary(glm_SC.male_Musc_long.biv)
#Mol
glm_SC.male_Mol_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Mol",])

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom")%>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain )

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$strain )

```

```{r Q2.glm.SC.short, echo=FALSE}
#Q2mouse.av.short.biv.table
#mouse.av.short.biv.table

glmQ2_short.biv_M1 <- glm(mean.SC ~ subsp*strain, data= Q2mouse.av.short.biv.table)
sum.glmQ2_short.biv_M1 <- summary(glmQ2_short.biv_M1)

#round(summary(sum.glmQ2_short.biv_M1)$coefficients[,c(1,4)], 6)

glmQ2_short.biv_M2 <- glm(mean.SC ~ strain, data= Q2mouse.av.short.biv.table)
glmQ2_short.biv_M2 <- summary(glmQ2_short.biv_M2)

#DOM
glmQ2_short.biv_M2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_short.biv_M2_DOM <- summary(glmQ2_short.biv_M2_DOM)

#MUSC
glmQ2_short.biv_M2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_short.biv_M2_MUSC <- summary(glmQ2_short.biv_M2_MUSC)

#MOL
#within subspecies

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$strain, p.adj = "bonf", pool.sd = FALSE)

```

```{r Q2.SC.logreg.chrmClass_BivData, echo=FALSE, include=FALSE, eval=FALSE}

log.SC_male_chrm.class_all <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class_all)


#use the 1CO or 2CO DF
Bivalent_1o2_WSB <-  Bivalent_1o2 %>% filter(strain == "WSB")

log.SC_male_chrm.class.WSB <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_WSB,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class.WSB)


Bivalent_1o2_G <-  Bivalent_1o2 %>% filter(strain == "G") 
log.SC_chrm.class.G <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_G,  family=binomial(link="logit"))
summary(log.SC_chrm.class.G)


Bivalent_1o2_LEW <-  Bivalent_1o2 %>% filter(strain == "LEW") 
log.SC_chrm.class.LEW <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_LEW,  family=binomial(link="logit"))
summary(log.SC_chrm.class.LEW)


Bivalent_1o2_PWD <-  Bivalent_1o2 %>% filter(strain == "PWD") 
log.SC_chrm.class.PWD <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_PWD,  family=binomial(link="logit"))
summary(log.SC_chrm.class.PWD)


Bivalent_1o2_SKIVE <-  Bivalent_1o2 %>% filter(strain == "SKIVE") 
log.SC_chrm.class.SKIVE <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_SKIVE,  family=binomial(link="logit"))
summary(log.SC_chrm.class.SKIVE)


Bivalent_1o2_KAZ <-  Bivalent_1o2 %>% filter(strain == "KAZ") 
log.SC_chrm.class.KAZ <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_KAZ,  family=binomial(link="logit"))
summary(log.SC_chrm.class.KAZ)


Bivalent_1o2_CZECH <-  Bivalent_1o2 %>% filter(strain == "CZECH") 
log.SC_chrm.class.CZECH <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_CZECH,  family=binomial(link="logit"))
summary(log.SC_chrm.class.CZECH)

Bivalent_1o2_MSM <-  Bivalent_1o2 %>% filter(strain == "MSM") 
log.SC_chrm.class.MSM <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MSM,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MSM)


Bivalent_1o2_MOLF <-  Bivalent_1o2 %>% filter(strain == "MOLF")
log.SC_chrm.class.MOLF <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MOLF,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MOLF)

```

```{r Q2.logreg.plots, echo=FALSE, include=FALSE, eval=FALSE}

log.reg.chrm.class_all.strains <- ggplot(Bivalent_1o2,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO)")+facet_wrap(subsp~ strain)
log.reg.chrm.class_all.strains



WSB.log.reg.chrm.class <- ggplot(Bivalent_1o2_WSB,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO, WSB)")+facet_wrap(~subsp)


MSMlog.reg.chrm.class <- ggplot(Bivalent_1o2_MSM,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("MSM Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)


PWDlog.reg.chrm.class <- ggplot(Bivalent_1o2_PWD,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("PWD Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)

```

```{r Q2.SC.Chrm.Class, echo=FALSE, include=FALSE, eval=FALSE}
#REMOVE COMPARES ACROSS FROM FULL BIVDAAT

#1CO
log.SC_male_1CO.poly <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_1CO.poly)

log.SC_male_1CO.Musc <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_1CO.Musc)
#double check these directions

log.SC_male_1CO.Mol <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))

#summary(log.SC_male_1CO.Mol)


#2CO
log.SC_male_2CO.poly <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_2CO.poly)


log.SC_male_2CO.Musc <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Musc)


log.SC_male_2CO.Mol <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Mol)


#3CO
log.SC_male_3CO.poly <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_3CO.poly)


log.SC_male_3CO.Musc <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Musc)


#there's no rec group for this table
log.SC_male_3CO.Mol <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Mol)


#reverse logistic regression (single bivalent level)
#how well does SC length predict 1 or 2 COs?

Bivalent_1o2 <-  Curated_BivData_male %>% filter(species== "M.musculus") %>% filter(hand.foci.count > 0) %>% filter(hand.foci.count < 3) 

#need to switch the co counts to 1 - 0
Bivalent_1o2$chrm.class <- ifelse(grepl(1, Bivalent_1o2$hand.foci.count), 0, 
                                    ifelse(grepl(2, Bivalent_1o2$hand.foci.count), 1, ""))


Bivalent_1o2$chrm.class <- as.numeric(Bivalent_1o2$chrm.class)
Bivalent_1o2$strain <- factor(Bivalent_1o2$strain, ordered = FALSE)

log.SC_male_chrm.class <- glm(chrm.class ~ chromosomeLength*strain,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class)
#not sure if this is the equivilent of running each strain seperatly
#the strain effect is probably also pulling in the different proportion of chrm class
#useing the chrm.length*strain gives fewer significant factors. 

#i'd be more convinced by running all those log regression plots for each strain
#come back later
```

```{r Q2.SC.log.regression.show.plots, echo=FALSE, include=FALSE}

plot.blah.mouse.av <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean_SC, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC (pooled) \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_1CO <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_1CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 1CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_2CO <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_2CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 2CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


```

```{r Q2.SClength.ttest, echo=FALSE, include=FALSE, eval=FALSE}
#COMPARISONS ACROSS ALL CLASSES

#MOUSE AVE, all
Rec.group.mouse.SC_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC_Ttest$p.value  #p-value = 0.00238

#mouse.av 1CO
Rec.group.mouse.SC.1CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.1CO_Ttest$p.value  #p-value = 0.9993


#MOUSE.av 2CO
Rec.group.mouse.SC.2CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.2CO_Ttest$p.value  #p-value = 0.03428


#single biv level
#male.biv?

#Rec.group_BivData_F1post_Ttest <- t.test(male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 1], 
#                                 male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 0])
 
#Rec.group_BivData_F1post_Ttest$p.value 

```

```{r log.reg_SC.length, echo=FALSE, include=FALSE}
#REMOVE THIS COMPARES FROM FULL BIV DATA

#male_mouse.av
#Male.poly.Mouse.Table_BivData_4MM

Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                                ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)))

#male poly shouldn't be here
Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 
                                ifelse(grepl("MSM male", Male.poly.Mouse.Table_BivData_4MM$category), 1,
                                ifelse(grepl("SKIVE male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 0)))


#All chrm
log.reg_SC.length_mouse.av <- glm(Rec.group ~ mean_SC, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av)

#considering seperating out by hand foci counts

#1CO
log.reg_SC.length_mouse.av_1CO <- glm(Rec.group ~ mean.SC_1CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_1CO)


#2CO
log.reg_SC.length_mouse.av_2CO <- glm(Rec.group ~ mean.SC_2CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_mouse.av_2CO)


#3CO
log.reg_SC.length_mouse.av_3CO <- glm(Rec.group ~ mean.SC_3CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_3CO)


# bivalent level log regression

log.reg_SC.length_BIV <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV)

#1CO  (BIVDATA)
log.reg_SC.length_BIV_1CO <- glm(Rec.group ~ chromosomeLength, 
                            
                data=Curated_BivData[(Curated_BivData$subsp == "Musc") & (Curated_BivData$hand.foci.count == 1) &(Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_1CO)


#2CO
log.reg_SC.length_BIV_2CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 2) & (Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_2CO)


#3CO
log.reg_SC.length_BIV_3CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 3)&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV_3CO)
```

```{r Q2.SC_class.rec.group_setup, echo=FALSE, include=FALSE}
#REMOVE THIS, IT uses total bivalent data


#rerun the models for datasets -- deviding by chrm class and rec group
Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                            ifelse(grepl("MSM male", Curated_BivData$category), 1,
                             ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)) )


Q2.SC_BivData_low.rec <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)%>% filter(Rec.group == 0 )
Q2.SC_BivData_high.rec <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5) %>% filter(Rec.group == 1 )

#calq_mouse av
mouse.av.SC.low.rec <- ddply(Q2.SC_BivData_low.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                        n_cells = length(unique(fileName) ),
                        mean.SC.total = mean(chromosomeLength),

                    mean.SC_0CO = mean(chromosomeLength[which(hand.foci.count == 0)], na.rm = TRUE),
                  n_0CO =  sum((hand.foci.count == 0), na.rm = TRUE ),
                  
                   mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                    n_1CO = sum((hand.foci.count == 1), na.rm = TRUE),
                  
                   mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                   n_2CO = sum((hand.foci.count == 2), na.rm = TRUE),
                  
                  mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                  n_3CO = sum((hand.foci.count == 3), na.rm = TRUE)
                                                
                         )

mouse.av.SC.low.rec <- add_strain(mouse.av.SC.low.rec)
mouse.av.SC.low.rec <- add_subsp(mouse.av.SC.low.rec)

mouse.av.SC.low.rec$strain <- factor(mouse.av.SC.low.rec$strain, ordered = FALSE)
mouse.av.SC.low.rec$subsp <- factor(mouse.av.SC.low.rec$subsp, ordered = FALSE)


#calq_mouse av
mouse.av.SC.high.rec <- ddply(Q2.SC_BivData_high.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
mouse.av.SC.high.rec <- add_mouse(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_strain(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_subsp(mouse.av.SC.high.rec)

mouse.av.SC.high.rec$strain <- factor(mouse.av.SC.high.rec$strain, ordered = FALSE)
mouse.av.SC.high.rec$add_subsp <- factor(mouse.av.SC.high.rec$subsp, ordered = FALSE)
```

```{r male.show.plotsEXample, echo=FALSE, eval=FALSE}
male_mouse.av <- subset(AP_mouse_table_w.Ages, select= -c(sex.y,sex.x,
                            subsp.y,subsp.x,
                    category.y,category.x, strain.x,
                    strain.y, mouse.1  )  )

male_mouse.av <- add_sex(male_mouse.av)
male_mouse.av <- add_strain(male_mouse.av)
male_mouse.av <- add_subsp(male_mouse.av)
male_mouse.av <- add_species(male_mouse.av)

fomo.male_mouse.av <-  male_mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

fomo.male_mouse.av$subsp <- factor(fomo.male_mouse.av$subsp, ordered = FALSE)
fomo.male_mouse.av$sex <- factor(fomo.male_mouse.av$sex, ordered = FALSE)
fomo.male_mouse.av$strain <- factor(fomo.male_mouse.av$strain, ordered = FALSE)
fomo.male_mouse.av$species <- factor(fomo.male_mouse.av$species, ordered = FALSE)

table( droplevels(fomo.male_mouse.av$strain) )
#there are cast strains too


Musc.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Musc")

musc.male.plot <- ggplot(Musc.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = mean_co, color= strain, alpha=0.5), width = .2 )+ ggtitle("Musc male of MLH1 distributions")+scale_color_manual(values=colors_of_strains)+ylim(c(20,34))
musc.male.plot

# + theme(axis.title.x=element_blank(),
#        axis.text.x=element_blank(),
#        axis.ticks.x=element_blank()) +
#ylim( c((min(MLH1_data$adj_nMLH1.foci)-3) ), (max(MLH1_data$adj_nMLH1.foci)+3)) +  


#make the Mol and
Mol.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Mol")

Mol.male.plot <- ggplot(Mol.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = mean_co, color= strain, alpha=0.5), width = .2 )+ ggtitle("Mol male of MLH1 distributions")+scale_color_manual(values=colors_of_strains)+ylim(c(20,33))
Mol.male.plot


#Dom version 
Dom.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Dom")

Dom.male.plot <- ggplot(Dom.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = mean_co, color= strain, alpha=0.5), width = .2 )+ ggtitle("Dom male of MLH1 distributions")+scale_color_manual(values=colors_of_strains)+ylim(c(20,33))
Dom.male.plot
```

```{r SC.length.male_tests, echo=FALSE, include=FALSE, eval=FALSE}
## run the tests to check following expectations

#1.Dom strains not different from ech other
#2. PWD and SKIVE are different from the other strains
#3.MSM and MOLF are different from each other

#male.Musc.mouse.av <- Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"), ]
  
male.Dom.mouse.av <- Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom"), ]
#the subsp labels get messed up, unless they are designated chr first
Dom.male_SC.length_lm <- lm(mean_SC~ strain,  data =male.Dom.mouse.av  )

Dom.male_SC.length_lm.1 <- lm(mean.SC_1CO~ strain/mouse,  data =male.Dom.mouse.av  ) #wierd sytax 
Dom.male_SC.length_lm.2 <- lm(mean.SC_2CO~ strain,  data =male.Dom.mouse.av  )
#Dom.male_SC.length_lm.3 <- lm(mean.SC_3CO~ strain,  data =male.Dom.mouse.av  ) #only WSB and LEW?
#total sc sig, 1CO sig, 2CO sig


Dom.male_SC.aov <- aov(mean_SC ~ strain, data = male.Dom.mouse.av)
#0.000369 ***
Dom.male_1CO_SC.aov <- aov(mean.SC_1CO ~ strain, data = male.Dom.mouse.av)
#0.000816 ***
Dom.male_2CO_SC.aov <- aov(mean.SC_2CO ~ strain, data = male.Dom.mouse.av)
#0.0148 *

show.Dom.male.SC <- ggplot(male.Dom.mouse.av, aes(y= mean_SC, x= strain, color=strain))+ geom_jitter()

show.Dom.male.SC <- ggplot(male.Dom.mouse.av, aes(y= mean.SC_2CO, x= strain, color=strain))+ geom_jitter()
#making plots above show that mouse average SC lengths are lower could there be microscope issue?


#make sure to remove some of the juvi mice!! from the AP_mouse table
show.Dom.male.CO <- ggplot(
male_mouse.av[(male_mouse.av$subsp.x == "Dom"),], aes(y= mean_co, x= strain.x, color=strain.x))+ geom_jitter()

Dom.male_CO.aov <- aov(mean_co ~ strain, data = male_mouse.av[ (male_mouse.av$subsp == "Dom"),])
#P not sig for CO mean

#seems like there are more mice in the MLH1 data set than bivData
#

#WSB all dissected and imaged in '15
#G imaged 15 - 16
#LEW imaged 15 to 17

ggboxplot(data = male.Dom.mouse.av, x = "strain", y = "mean_SC", 
          color = "strain", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          ylab = "", xlab = "")


show.Dom.male.SC <- ggplot(male.Dom.mouse.av, aes(y= mean_SC, x= strain, color=strain))+ geom_jitter()

ggboxplot(data = male.Dom.mouse.av, x = "strain", y = "mean_SC", 
          color = "strain", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          ylab = "", xlab = "")


ggboxplot(data = male.Dom.mouse.av, x = "strain", y = "mean.SC_1CO", 
          color = "strain", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          ylab = "1CO SC Length", xlab = "")


ggboxplot(data = male.Dom.mouse.av, x = "strain", y = "mean.SC_2CO", 
          color = "strain", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          ylab = "2CO SC Length", xlab = "")
```

```{r SC.length.pairwise.T, echo=FALSE, include=FALSE, eval=FALSE}

#REMOVE RUNS COMPARISONS ACROSS FULL DATASET
#male.Dom.mouse.av, male.Mol.mouse.av, male.Musc.mouse.av

male.Musc.mouse.av <- Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),]
male.Dom.mouse.av <- Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom"),]
male.Mol.mouse.av <- Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol"),]

Pwise.ttest_Dom.male <- pairwise.t.test(male.Dom.mouse.av$mean_SC, male.Dom.mouse.av$strain)
#G-WSB is sig, WSB-LEW are slightly sig

Pwise.ttest_Musc.male <- pairwise.t.test(male.Musc.mouse.av$mean_SC, male.Musc.mouse.av$strain)
#PWD and MSM are most diff from SKIVE?

Pwise.ttest_Mol.male <- pairwise.t.test(male.Mol.mouse.av$mean_SC, male.Mol.mouse.av$strain)
#the pooled SC value tests are sig

#the mol comparisons are different due to adj p values


Pwise.ttest_Dom.male.1CO <- pairwise.t.test(male.Dom.mouse.av$mean.SC_1CO, male.Dom.mouse.av$strain)
#G-WSB is sig, WSB-LEW are slightly sig

Pwise.ttest_Musc.male.1CO <- pairwise.t.test(male.Musc.mouse.av$mean.SC_1CO, male.Musc.mouse.av$strain)
#no sig (only 3) -- does include CZECCH

#non-sig, with mol pooled with musc

Pwise.ttest_Mol.male.1CO <- pairwise.t.test(male.Mol.mouse.av$mean.SC_1CO, male.Mol.mouse.av$strain)

Pwise.ttest_Dom.male.2CO <- pairwise.t.test(male.Dom.mouse.av$mean.SC_2CO, male.Dom.mouse.av$strain)

Pwise.ttest_Musc.male.2CO <- pairwise.t.test(male.Musc.mouse.av$mean.SC_2CO, male.Musc.mouse.av$strain)
#non of these sig with the mulitple adjust

Pwise.ttest_Mol.male.2CO <- pairwise.t.test(male.Mol.mouse.av$mean.SC_2CO, male.Mol.mouse.av$strain)

#pairwise.t.test(Ozone, Month, p.adj = "bonf")
```


Confirming the basic predictions, there is a positive correlation between mean MLH1 foci per cell and total SC ( Spearmans' r = `r cor( totSC.mouse.av.table$mean.skel, totSC.mouse.av.table$mean.MLH1, method = c("spearman") )`; p = `r cor.test(totSC.mouse.av.table$mean.skel, totSC.mouse.av.table$mean.MLH1, method=c("spearman") )$p.value`). Nevertheless, mean total SC only partially differentiates high-recombination and low-recombination strains (Figure X).  **Bret's note on positive correlation, 'A correlation across mice, across strains, or both?** While high-recombination strains have significantly more SC area in the total dataset (t-test; p = 0.01 -- `r Q2tot.sc_t.test_High.Low$p.value`), separate tests by strain show that only within _molossinus_ are high- and low-recombination strains significantly different (t-test; molossinus: p = 0.03 -- `r Q2tot.sc_t.test_High.Low_Mol$p.value`; musculus: p = 0.87  -- `r Q2tot.sc_t.test_High.Low_Musc$p.value`). 
**the values above are diferent between editions**

Additionally, the means for the reduced (short and long) bivalent datasets are not significantly different between high-recombination and low-recombination strains (t-test; short: p = 0.88 -- `r Q2short.biv_t.test_High.Low$p.value`; long: p = 0.18 -- `r Q2long.biv_t.test_High.Low$p.value`).

**the values between versions are slightly different**
In a general linear model with total SC as the dependent variable, two subspecies effects are significant (p = musculus 1.2410^{-6} -- `r sum.Q2.glm_mus.av_totSC_M1[,4][2]`, molossinus p = 10^{-6} -- `r sum.Q2.glm_mus.av_totSC_M1[,4][3]`). In general linear models with reduced bivalent means as dependent variables, several subspecies and strain effects reach significance (p < 0.05) but they are not consistent across models, indicating to some extent the chromatin compaction evolution is decoupled from evolution in mean MLH1 foci per cell.   **Bret's comment; How can you differentiate between this biological conclusion and uncertainty due to the size of the datasets and statistical approaches?**  


# Q2.1CO rec landscape evolution is decoupled from gwRR evolution


```{r Q2.1CO.show_plots, echo=FALSE,  warning=FALSE}
#Curated_BivData_male

#boxplots of nrm F1
male.bivdata.1CO <- Curated_BivData_male %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1)
  
Q2.show.nrmF1 <- ggplot(male.bivdata.1CO, aes(x=strain, y=PER_Foci_1, color=strain) )+geom_jitter(alpha=.5 )+ geom_boxplot(aes(y= PER_Foci_1), alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Normalized 1CO Foci pos All bivalents")
Q2.show.nrmF1

nrmF1_mouse_level <- ggplot(Male.poly.Mouse.Table_BivData_4MM, aes(x=strain, y=norm.first.foci.pos, color=strain) )+geom_jitter(alpha=.5 )+ geom_boxplot(aes(y= norm.first.foci.pos), alpha=.5 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse Level, \nNormalized 1CO Foci pos")

```

```{r Q2.1COpos.LONG.BIV_plot, echo=FALSE, warning=FALSE}
#make the same plots as above but with the long biv data set
male.long.biv.1CO <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1)

#mouse.av.long.biv.table

Q2.show.nrmF1_long.biv <- ggplot(male.long.biv.1CO, aes(x=strain, y=PER_Foci_1, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= PER_Foci_1 ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Normalized 1CO Foci pos \nLong Biv")

Mouse.av.Long.biv <- ddply(male.long.biv.1CO, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Nbiv  = length(Obj.ID),
                       mean.1CO_PER = mean(PER_Foci_1)
                      # mean_CO = mean()
                       )

Mouse.av.Long.biv <- add_strain(Mouse.av.Long.biv)
Mouse.av.Long.biv <- add_subsp(Mouse.av.Long.biv)


Q2.shoooo   <- ggplot(Mouse.av.Long.biv, aes(x=strain, y=mean.1CO_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean.1CO_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("mouse ave \nNormalized 1CO Foci pos \nLong Biv")

```

<!-- t tests mouse.avs_4MM, REAL.short_mouse_table-->

```{r Q2.1COpos_mouse.av.t.test_all, echo=FALSE}
#mouse.avs_4MM, #31may19_SKIVE_m2  has NA for norm.first.foci.pos

#High = MSM, PWD, SKIVE
Q2.1COpos_Ttest <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
            (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "1"))$norm.first.foci.pos )
#p-value = 1

#high = PWD and MSM
Q2.1COpos_Ttest.HL.ex <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == "0"))$norm.first.foci.pos, 
            (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == "1"))$norm.first.foci.pos )
#p-value = 1

```

```{r Q2.1COpos_within.subsp_ttest, echo=FALSE}

#Dom (predicted no difference) -- can't DO a t.test for DOM across groups..

#Musc
Q2.1COpos_mus.av_Musc_ttest  <-  t.test( (mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Musc") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
                                         
            (mouse.avs_4MM  %>%  filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == "1"))$norm.first.foci.pos )
# p-value = 0.4


#Mol
Q2.1COpos_mus.av_Mol_ttest  <-  t.test( (mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
            
              (mouse.avs_4MM  %>%  filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(Rec.group == "1"))$norm.first.foci.pos   )
# p-value = 0.07
# exclusive rec group not sig
```

```{r Q2.1CO_mouse.av.short.long_t.test, echo=FALSE}
#these don't have mean.first.foci

#short -- real.long.bivData -- REAL.short_mouse_table
Q2.1COposABS_short_ttest_HL <- t.test( (REAL.short_mouse_table %>% filter(sex == "male") %>%  filter(Rec.group == "0"))$mean_F1pos_ABS, 
      
      (REAL.short_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == "1"))$mean_F1pos_ABS   )
#p-value = 0.3


Q2.1COpos.PER_short_ttest_HL <- t.test( (REAL.short_mouse_table %>% filter(sex == "male") %>% filter(Rec.group == "0"))$mean_F1pos_PER, 
      (REAL.short_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == "1"))$mean_F1pos_PER   )
# p-value = 0.1

#remove SKIVE??
```

```{r Q2.1CO.pos_short.long.ttest, echo=FALSE}

#real.long.bivData
#single biv level
Rec.group_LONG.BivData_F1post_Ttest <- t.test(
  (real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.5 

Rec.group_BivData_F1post_Ttest <- t.test(
  (Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.2

#
#whoo.mama <-  t.test( (Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count #== 1)  %>%  filter(Rec.group == "0"))$PER_Foci_1, 
#            (Curated_BivData  %>% filter(sex == "male") %>% filter(hand.foci.count == 1)   #%>% filter(Rec.group == "1"))$PER_Foci_1   )
#p-value = 0.2


#whoo.mama.rec.exc <-  t.test( (Curated_BivData  %>% filter(sex == "male") %>% #filter(hand.foci.count == 1)  %>%  filter(Rec.group.exclu == "0"))$PER_Foci_1, 
#            (Curated_BivData  %>% filter(sex == "male") %>% filter(hand.foci.count == 1)   #%>% filter(Rec.group.exclu == "1"))$PER_Foci_1   )
#p-value = 0.4

```

```{r Q2.1COpos_mus.av.full_glm, echo=FALSE}

#(mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Musc") %>% filter(Rec.group == "0"))$norm.first.foci.pos

Q2.glm_mus.av_1COpos_M1 <- glm(norm.first.foci.pos ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.glm_mus.av_1COpos_M1  <- summary(Q2.glm_mus.av_1COpos_M1)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]

#with.chrm.legth  ?
Q2.glm_mus.av_1COpos_M1 <- glm(norm.first.foci.pos ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male"))


#M2
Q2.glm_mus.av_1COpos_M2 <- glm(norm.first.foci.pos ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.glm_mus.av_1COpos_M2 <- summary(Q2.glm_mus.av_1COpos_M2)$coefficients

```

```{r Q2.1COpos.show.MOL, echo=FALSE}

#(mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>% filter(Rec.group == #"0"))$norm.first.foci.pos

mus.av1COpos.plot <- ggplot(data= mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Mol"),
                      aes(x= mouse, y = norm.first.foci.pos))+geom_point()


#+facet_wrap(~mouse, scales = "free")

single.biv_1COpos.plot_Mol <- ggplot(data= Curated_BivData %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>%  filter(hand.foci.count == "1") %>%  filter(chromosomeLength < 100),
                      aes(x= fileName, y = PER_Foci_1, color=chromosomeLength))+geom_point()+facet_wrap(~mouse, scales = "free") + ylim(c(0,1))

#+scale_color_manual(values=colors_of_strains)


single.biv_1COpos.plot_Dom <- ggplot(data= Curated_BivData %>% filter(sex == "male") %>%filter(subsp == "Dom") %>%  filter(hand.foci.count == "1"),
                      aes(x= fileName, y = PER_Foci_1, color=strain ))+geom_point()+facet_wrap(~mouse, scales = "free") + ylim(c(0,1))+scale_color_manual(values=colors_of_strains)

#CHRM.length is very significant-- some of the same subsp and strains are sig     
```

```{r Q2.1CO.pos_glm.chrm.Length, echo=FALSE}
#remove this cell, 

Curated_BivData <- Curated_BivData %>% filter(Obj.ID != "13sep18_28jun18_MOLF_m1_sp1_18.1_rev_14")

Curated_BivData.Mol <- Curated_BivData %>% filter(Foci1 != "")

#making new models 

Curated_BivData$subsp <- factor(Curated_BivData$subsp , ordered = F)
Curated_BivData$strain <- factor(Curated_BivData$strain , ordered = F)

chrm.1CO.pos.chrmLength <- glm(PER_Foci_1 ~ chromosomeLength * subsp * strain, data= Curated_BivData.Mol %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") )

sum.chrm.1CO.pos.chrmLength <- summary(chrm.1CO.pos.chrmLength)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]


chrm.1CO.pos.chrmLength_strain <- glm(PER_Foci_1 ~ chromosomeLength *  strain, data= Curated_BivData.Mol %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") )

#summary(chrm.1CO.pos.chrmLength_strain)

```

```{r Q2.1COpos_strain, echo=FALSE, eval=FALSE}
#isolate all musc
#Curated_BivData_male <- Curated_BivData[Curated_BivData$sex == "male",]

##long biv
male.long.biv <- real.long.bivData %>% filter(sex== "male") %>% filter(species == "M.musculus") 
#table( droplevels( male.long.biv$strain)  )


mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean_F1 = mean(Foci1, na.rm=TRUE),
                        mean_F1.nrm = mean(PER_Foci_1,na.rm=TRUE),
                        
                        mean_SC = mean(chromosomeLength),

                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE)

                                               )
#add subsp

mouse.av.long.biv.table <- add_strain(mouse.av.long.biv.table)
mouse.av.long.biv.table <- add_subsp(mouse.av.long.biv.table)

mouse.av.long.biv.table$strain <- factor(mouse.av.long.biv.table$strain, ordered = FALSE)
mouse.av.long.biv.table$subsp <- factor(mouse.av.long.biv.table$subsp, ordered = FALSE)

#add rec group
mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", mouse.av.long.biv.table$strain), 1, 
                            ifelse(grepl("MSM", mouse.av.long.biv.table$strain), 1,
                             ifelse(grepl("SKIVE", mouse.av.long.biv.table$strain), 1, 0)) )
```

```{r Q2.1COpos.glm, echo=FALSE, eval=FALSE}
male.bivdata.1CO$Rec.group <- ifelse(grepl("PWD", male.bivdata.1CO$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.1CO$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.1CO$strain), 1, 0)))

Log.Q2.1COnrm.F1.PER <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO,  family=binomial(link="logit"))
#summary(Log.glmQ2_M2.1COnrm)

#Musc
Log.Q2.F1_PER_Musc <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Musc",], 
              family=binomial(link="logit"))
#summary(Log.Q2.F1_PER_Musc)


#Mol
Log.Q2.F1_PER_Mol <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Mol",],
              family=binomial(link="logit"))

#summary(Log.glmQ2_M2.1COnrm_Mol)

```


The normalized 1CO position is not significantly different between high-recombination and low-recombination strains for the total pooled data (t-test; p = 0.24 -- `r Rec.group_BivData_F1post_Ttest$p.value`) and also when examined within subspecies (t-test; p = 0.41 -- `r Q2.1COpos_mus.av_Musc_ttest$p.value` and p = 0.07 -- `r Q2.1COpos_mus.av_Mol_ttest$p.value` for _musculus_ and _molossinus_, respectively). **While there are significant strain effects for domesticus^WSB^ and molossinus^MOLF^ in a general linear model with normalized position as the dependent variable (Figure X)**, *this evolution of the 1CO positioning is decoupled from the total genome-wide recombination rate.* <bret asks if the bolded section is correct. are there sig strain effects for WSB and MOLF?> <bret asks if italised statement has been tested statisticaly or in what sense am I discribing this>

# Q2 Evolution of interference is associated with genome wide recombination rate evolution


```{r Q2.IFD.long.short.setup, echo=FALSE}
#long BivData
male.long.biv.2CO_IFD <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.long.biv.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.long.biv.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.long.biv.2CO_IFD$strain), 1, 
                                           ifelse(grepl("SKIVE", male.long.biv.2CO_IFD$strain), 1, 0)))

#show
Long.biv.IFDs_PER_by.group <- ggplot(male.long.biv.2CO_IFD, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized Interfocal Distances, Long BivData\nLow Rec group =0, High Rec group =1")+
  scale_color_manual(values=colors_of_strains)+ facet_wrap(subsp~Rec.group, scales = "free")+theme(legend.position="none")+ylim(c(0,1.1))

#long biv's - short IFD rates

LongBiv_IFD_mus.rate <- ddply(male.long.biv.2CO_IFD %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        
                   N.obs  = length(Obj.ID),

                  mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                  mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                  var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)] ),
                
                inverse.close.foci = length(which(IFD1_PER >= .31)),  
                n.close.foci = length(which(IFD1_PER <= .3)),
                      
                off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                rate.close.foci = n.close.foci / N.obs
                
                                              )

#run t.tests on long biv
LongBiv_IFD_mus.rate <- add_strain(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_category(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_subsp(LongBiv_IFD_mus.rate)

#add rec.group
LongBiv_IFD_mus.rate$Rec.group <- ifelse(grepl("PWD", LongBiv_IFD_mus.rate$strain), 1, 
                                ifelse(grepl("MSM", LongBiv_IFD_mus.rate$strain), 1,
                                 ifelse(grepl("SKIVE", LongBiv_IFD_mus.rate$strain), 1, 0)))

```

```{r Q2.IFD.long.biv_t.test, echo=FALSE}
#short removed PER
Short.removed_BivData.LongBiv_IFD.PER_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])
 
#Short.removed_BivData.LongBiv_IFD.PER_Ttest$p.value
#0.0083

#ABS short removed
Short.removed_BivData.LongBiv_IFD.ABS_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])

#Short.removed_BivData.LongBiv_IFD.ABS_Ttest$p.value
#0.047
```

```{r Q2.show.IFD, echo=FALSE, warning = FALSE}
#subset
male.biv.2CO <- Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.biv.2CO$Rec.group <- ifelse(grepl("PWD", male.biv.2CO$strain), 1, 
                                    ifelse(grepl("MSM", male.biv.2CO$strain), 1, 
                                           ifelse(grepl("SKIVE", male.biv.2CO$strain), 1, 0)))



biv.IFDs_PER_by.group <- ggplot(male.biv.2CO, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized Interfocal Distances,\n Low Rec group =0, High Rec group =1")+
  scale_color_manual(values=colors_of_strains)+ facet_wrap(subsp~Rec.group, scales = "free")+theme(legend.position="none", axis.text.x = element_blank())+ylim(c(0,1.1))

```

```{r Q2.t.test_IFD_mouse.av, echo=FALSE}
#t.test for IFD
#mouse.av - the mouse average IFD is from just 2CO
t.test_mouse.av.IFD_ABS <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") )$mean_IFD.2CO_ABS   )
  
t.test_mouse.av.IFD_PER <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") )$mean_IFD.2CO_PER   )


#t.test_mouse.av.IFD_PER_DOM <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == #"male") %>% filter(subsp == "Dom") )$mean_IFD.2CO_PER,
#   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == #"Dom"))$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_PER_MUSC <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc"))$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_PER_MOL <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_PER   )

#ABS

t.test_mouse.av.IFD_ABS_MUSC <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc"))$mean_IFD.2CO_ABS   )

t.test_mouse.av.IFD_ABS_MOL <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_ABS  )
```

```{r Q2.IFD.glm.test, echo=FALSE}

#M1.ABS
Q2.M1glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male")    )
sum.Q2.M1glm_IFD.raw <- summary(Q2.M1glm_IFD.raw) 

#M1.PER
Q2.M1glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male") )

sum.Q2.M1glm_IFD.PER <- summary(Q2.M1glm_IFD.PER)
#summary(Q2.M1glm_IFD.PER) 

#M2.raw
Q2.M2glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
Sum.Q2.M2glm_IFD.raw <- summary(Q2.M2glm_IFD.raw)

Q2.M2glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.M2glm_IFD.PER <- summary(Q2.M2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

#within subspecies
#Dom
Q2.glm.M2_IFD_Dom <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M2_IFD_Dom)

#Musc
Q2.glm.M2_IFD_Musc <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M2_IFD_Musc)

#Mol
Q2.glm.M2_IFD_Mol <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M2_IFD_Mol)


#Dom
Q2.glm.M2_IFD.PER_Dom <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M2_IFD.PER_Dom) 

#Musc
Q2.glm.M2_IFD.PER_Musc <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M2_IFD.PER_Musc) 

#Mol
Q2.glm.M2_IFD.PER_Mol <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M2_IFD.PER_Mol)

```

```{r Q2.IFD.glm.chrmLength, echo=FALSE, eval=FALSE}

Curated_BivData$subsp  <- factor(Curated_BivData$subsp, ordered = FALSE)

#M.Len.ABS
Q2.BIV.LEN.glm_IFD.raw <- glm(IFD1_ABS ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.raw)

#M.Len.PER
Q2.BIV.LEN.glm_IFD.PER <- glm(IFD1_PER ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.PER)


#M.Len.raw
Q2.BIV.LEN.M2glm_IFD.ABS <- glm(IFD1_ABS ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.ABS)

##M.Len PER
Q2.BIV.LEN.M2glm_IFD.PER <- glm(IFD1_PER ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

```

```{r Q2.IFD_rate.shortIFD, echo=FALSE, warning = FALSE, eval=FALSE}

#for the relevant data, by strain, calcu the number of observations of 2CO above and below 30%

close.IFD.rates.mus.rate <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        N.obs  = length(Obj.ID),

                      #  mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                      mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                      mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)], na.rm=TRUE),
                  
                      inverse.close.foci = length(which(IFD1_PER >= .31)),  
                      n.close.foci = length(which(IFD1_PER <= .3)),
                      
                      off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                      rate.close.foci = n.close.foci / N.obs
)

#mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),

close.IFD.rates.mus.rate <- add_strain(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_category(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_subsp(close.IFD.rates.mus.rate)
#add rec.group
close.IFD.rates.mus.rate$Rec.group <- ifelse(grepl("PWD", close.IFD.rates.mus.rate$strain), 1, 
                                ifelse(grepl("MSM", close.IFD.rates.mus.rate$strain), 1,
                                 ifelse(grepl("SKIVE", close.IFD.rates.mus.rate$strain), 1, 0)))



close.IFD.rates_strain <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("strain"), summarise,
                        N.obs  = length(Obj.ID),

                        mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                        mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm = TRUE),
                        
                        #mean_IFD_short.removed
                      mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                        
                      inverse.close.foci = length(which(IFD1_PER > .3)),  
                      n.close.foci = length(which(IFD1_PER < .3)),
                      rate.close.foci = n.close.foci / N.obs,
                     
                       off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) )
                      
)

close.IFD.rates_strain <- add_subsp(close.IFD.rates_strain)

show.IFDrm <- ggplot(close.IFD.rates_strain, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences")+ geom_abline(slope = 1, intercept = 0)

#close.IFD.rates.mus.rate
show.IFDrm_mus <- ggplot(close.IFD.rates.mus.rate, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences") + geom_abline(slope = 1, intercept = 0)

show.close.IFD.rate <- ggplot(close.IFD.rates_strain, aes(y=rate.close.foci, x=strain, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)

#add rec.group
close.IFD.rates_strain$Rec.group <- ifelse(grepl("PWD", close.IFD.rates_strain$strain), 1, 
                                ifelse(grepl("MSM", close.IFD.rates_strain$strain), 1,
                                 ifelse(grepl("SKIVE", close.IFD.rates_strain$strain), 1, 0)))

#POOL all short and 
#chi square test
high.rec.props <- prop.test( ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$n.close.foci,
                              ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$N.obs)     
#p-value = 0.03, slight dif tween 3 high rec strains
```

```{r Q2.IFD.PER.logreg, echo=FALSE, eval=FALSE}

#Log regression all show significant prediction
#IFD.PER
log.reg.Q2.IFD.PER <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER)

#MUSC
log.reg.Q2.IFD.PER.Musc <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Musc)

#Mol
log.reg.Q2.IFD.PER.Mol <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Mol)


#SINGLE BIVALENT LEVEL
Log.Q2.IFD.per_bivdata <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata)

#Musc
Log.Q2.IFD.per_bivdata.Musc <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata.Musc)

#Mol
Log.Q2.IFD.per_bivdata.Mol <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))

```

```{r Q2IFD_logreg, echo=FALSE, eval=FALSE}

Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                    ifelse(grepl("MSM", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                           ifelse(grepl("SKIVE", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 0)))

#IFD.raw
log.reg.Q2.IFD.raw <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw)

#MUSC
log.reg.Q2.IFD.raw.Musc <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Musc)

#Mol
log.reg.Q2.IFD.raw.Mol <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Mol)

#SINGLE BIV LEVELs
male.bivdata.2CO_IFD <- Curated_BivData_male %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.bivdata.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.bivdata.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.2CO_IFD$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.2CO_IFD$strain), 1, 0)))


Log.Q2.IFD.raw_bivdata <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata)

#Musc
Log.Q2.IFD.raw_bivdata.Musc <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Musc)

#Mol
Log.Q2.IFD.raw_bivdata.Mol <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Mol)
```

```{r Q2.IFD.longbiv_glm, echo=FALSE, eval=FALSE}
#Full dataset
male.long.biv.2CO_IFD$strain <- factor(male.long.biv.2CO_IFD$strain, ordered = FALSE)

#single bivalent
Q2.glm_long.biv_M2.IFD.PER <- glm(IFD1_PER ~ strain, data= male.long.biv.2CO_IFD)
#summary(Q2.glm_long.biv_M2.IFD.PER)
#The PER.IFDs don't have significant strain effects
```

```{r Q2.t.test_IFD, echo=FALSE, eval=FALSE}

male.bivdata.2CO_IFD <- Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)
#t.tests for the Rec group
Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                                    ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                           ifelse(grepl("SKIVE male",Curated_BivData$category),1, 0)))

#Curated_BivData <- add_IFD(Curated_BivData)
#THIS SHOULD ALREADY BE ADDED

#single biv level
Rec.group.BivData_IFD.PER_Ttest <- t.test(male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 1], 
                                 male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 0])
 
#Rec.group.BivData_IFD.PER_Ttest$p.value
#p-value < 2.2e-16

#MOUSE AVE  -- replace with mouse    mouse.avs_4MM,   male.av_4MM
Rec.group_IFD.PER_Ttest <- t.test(  (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "1"))$mean_IFD.2CO_PER, 
                                (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "0"))$mean_IFD.2CO_PER )
 
#Rec.group_IFD.PER_Ttest$p.value 
#p-value = 6.872e-07
```

```{r Q2.IFD_short.removed_t.test, echo=FALSE, include=FALSE, eval=FALSE}
Short.removed_BivData_IFD.PER_Ttest <- t.test(Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 1], 
  Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 0])
 
Short.removed_BivData_IFD.PER_Ttest$p.value

#
Short.removed_BivData_IFD.PER_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                       close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
Short.removed_BivData_IFD.PER_Ttest_mus.av$p.value


Short.removed_BivData_IFD.ABS_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                                 close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
```


Mouse averages for both IFD^raw^ and IFD^norm^ are significantly longer in high-recombination strains (t-test; IFD^norm^: p = 7.7410^{-7} -- `r t.test_mouse.av.IFD_PER$p.value`; IFD^raw^: p = 8.7810^{-6} -- `r t.test_mouse.av.IFD_ABS$p.value`). This pattern is confirmed by separate comparisons within _musculus_ (t-test; IFD^norm^: p =2.0410^{-5} -- `r t.test_mouse.av.IFD_PER_MUSC$p.value`; IFD^raw^: p = 1.9410^{-4} -- `r t.test_mouse.av.IFD_ABS_MUSC$p.value`) and within _molossinus_ (IFD^norm^: p= 0.17 -- `r t.test_mouse.av.IFD_PER_MOL$p.value`; IFD^raw^: p = 0.08 -- `r t.test_mouse.av.IFD_ABS_MOL$p.value`). <Bret's comment, these p values are not very significant.> Similar results are seen with general linear models for both IFD^raw^ and IFD^norm^: only effects associated with high-recombination strains are significant (p < 0.05). 

That IFD^raw^ and IFD^norm^ show similar patterns eliminates variation in SC lengths and bivalent sizes as primary explanations. We determined that the main difference in IFD^norm^ distributions between high-recombination and low-recombination strains is an enrichment of IFD^norm^ values under 30% --

in low-recombination strains. The frequency of IFD^norm^ values that fall below 30% ranges from 8.2% (domesticus^G^) to 16% (musculus^KAZ^) in low-recombination strains, whereas high-recombination strains all show such frequencies below 5% (0%, 1.3%, and 3.3% for musculus^SKIVE^, molossinus^MSM^, and musculus^PWD^, respectively).  

In summary, the level of interference is a significant predictor of evolution in the genome-wide recombination rate, but SC length and crossover position on 1CO bivalents are not. However, the pattern is in the opposite direction to our prediction: high-recombination strains have stronger interference. At least on 2CO bivalents, crossovers are spaced further apart when the genome-wide recombination rate is higher.


# Q2 Summary

**move main themes to conclusion**

Our results show that the greater crossover interference is the strongest single bivalent-based predictor for the observed rapid evolution of mean MLH1 foci per cell. While these results do not conform initial predictions for how a recombination landscapes would accommodate more crossovers, the increased strength of interference aligns with our results on sex differences. The typical recombination landscapes for males and females results in divergence in the proportion of linked sites along chromosomes which segregate together. The stronger interference of the 2CO bivalents in the high recombining strains accentuates this effect. 
The measures of DSB and some comparisons of SC length between high and low recombining strains suggest that the SC length have evolved to be longer in high recombining strains, however this evolution of SC length is partially decoupled from the number of crossovers since similar amounts of SC length evolution are seen in low recombining strains.

<Bret: Are you sure this summary is necessary? Maybe cover this material in the Discussion instead?>


# References