---
title: "Results_setup"
author: "April Peterson"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document: default
  pdf_document: default
---


```{r setup, echo=FALSE, include = FALSE}
library(knitr)
library(ggplot2)
#library(pwr)
library(plyr)
library(lattice)
library(dplyr)
library(raster)
library(lme4)
library(nlme)
library(RLRsim)
library(ggpubr)
library(reshape2)
#library(patchwork)

options(digits=2)
#setwd("~.")

#just load the data_setup, since I load most everything else

load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_5.30.20.RData")#added SKIVE_f BiveData
#load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_5.21.20.RData")
#load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_5.12.20.RData")
#load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_2.24.20.RData")
#load(file = "C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.31.20.RData")

#2.2.20
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")

#load(file="~./MLH1repo/data/CleanBivData_5.12.20.RData") #CleanBivData_5.12.20.RData
#load(file="~./MLH1repo/data/total_SC_30.12.19.RData")

#skeletonize
#SC.skel = read.csv("~./MLH1repo/data/SCskel_output_feb20.csv", header = TRUE, strip.white = TRUE)
#Total.SC_DF = read.xlsx2("~./MLH1repo/data/Total.SC_merge.MLH1.xlsx", header=TRUE, 1)
#remove X -- this table isn't used

#load(file="~./MLH1repo/data/MLH1_data_setup_1.5.20.RData")

#setwd("~./MLH1repo/doc/")
#setwd("C:/Users/alpeterson7/Documents/MLH1repo/doc/")
#setwd("C:/Users/April/Documents/MLH1repo")
#load(file="data/MLH1/MLH1_data_setup.RData")

#load main data file
#load(file="C:/Users/April/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.5.20.RData")#added batch18
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")

#this MLH1 only goes up to batch16!
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#batch18
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#fixing bugs, formating
#load(file="data/MLH1/MLH1_data_setup_12.3.19.RData")#removed exclude mice
#load(file="data/MLH1/MLH1_data_setup_11.12.19.RData")#added batch17
#load(file="data/MLH1/MLH1_data_setup_11.11.19.RData")#deleted DUP image
#load(file="data/MLH1/MLH1_data_setup_9.26.19.RData")#added batch16
#load(file="data/MLH1/MLH1_data_setup_8.29.19.RData") #

#load(file="data/MetaData.RData") #this was replacing most updated data file

#load functions
source("~./MLH1repo/src/CommonFunc_MLH1repo.R")
```

<!-- Data Set Up Notes -->

```{r organizing.data, echo=FALSE, eval=FALSE}
#set the order of another column, based on another variable. consistant order for ploting

#Terminology Note, leptonema, zygonema, and pachynema diplonema diakinesis, are the stage names.
#-ene endings refer to the cells/units within the cell stage? (I think)

#apply this before ploting
MLH1_data <- MLH1_data %>%
  arrange(strain, sex, category, mouse) %>%
  mutate(Original.Name = factor(Original.Name)) #another category that you want the order to match
MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])

# sort your dataframe, by the focal categories
MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))
#use the above line for when order is out of wak

#MLH1_data <- with(MLH1_data, MLH1_data[order(category),])
AP_mouse_table.HQ$var <- as.numeric(AP_mouse_table.HQ$var)

AP_category_table <-  ddply(.data=AP_mouse_table.HQ,
                 .(strain,sex),
                 summarize,
                 sum.ncells = sum(Ncells),
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co),
                 AV.var_MLH1 = mean(var, na.rm=TRUE)
                                  
)

AP_mouse_table.HQ_target <- AP_mouse_table.HQ[!(is.na(AP_mouse_table.HQ$sex) | AP_mouse_table.HQ$sex==""), ]

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC")
AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
```


```{r Q1.rbar.gamma, echo=FALSE, eval=FALSE}

source("~./MLH1repo/src/CommonFunc_MLH1repo.R")

#read.csv of gamma estimates from above
gamma_estimates <- read.csv("~./MLH1repo/results/gamma_estimates.csv", header = TRUE)

table_gamma_estimates <- read.csv("~./MLH1repo/table.csv", header = TRUE)

#for(e in 1:length(cleanCurated_BivData$fileName)){
#  mini.IFD <- calq.intra.rbar(mini.IFD)
#  cleanCurated_BivData$rbar[e] <- new.calq.intra.rbar(cleanCurated_BivData[e,])
#  }

#calq the mouse / strain means for rbar

#summarize_rbar_table <- ddply(.data=cleanCurated_BivData,
#                 .(sex, strain),
#                 summarize,
#                 mean.rbar.all = mean(rbar, na.rm = TRUE),
                 
#                 mean.rbar.2CO = mean(rbar[which(hand.foci.count == 2)], na.rm = TRUE),
#                 mean.rbar.3CO = mean(rbar[which(hand.foci.count == 3)], na.rm = TRUE)
#)
#the 3 is negative...
#how best to merge rbar and gamma estiamtes (which estimate)

raw.gamma_estimates <-  gamma_estimates %>% filter(type.IFD == "raw.IFD") %>% filter( (class == "2CO") | (class == "3CO") )

#write.table(table, "~./MLH1repo/table.csv", sep=",",row.names = TRUE)
#write.table(summarize_rbar_table, "~./MLH1repo/RBAR.table.csv", sep=",",row.names = TRUE)

#what comparison of IFD and rbar would be logical
#plot rbar and gamma
#ll <- ggplot(table_gamma_estimates, aes(y=mean.rbar, x = all.biv.gamma, color = class, shape = sex ))+geom_point()+facet_wrap(~strain)+ ggtitle("")+ylim(c(0,.5))


```


```{r MLH1.FEMALE.TABLE, echo=FALSE, eval=TRUE}


female_mouse.avs_for.analysis <-  Mouse.Table_HQ %>% filter(sex== "female") %>% filter(species == "M.musculus")

female_mouse.avs_for.analysis$subsp <- factor(female_mouse.avs_for.analysis$subsp, ordered = FALSE)
female_mouse.avs_for.analysis$sex <- factor(female_mouse.avs_for.analysis$sex, ordered = FALSE)
female_mouse.avs_for.analysis$strain <- factor(female_mouse.avs_for.analysis$strain, ordered = FALSE)
female_mouse.avs_for.analysis$species <- factor(female_mouse.avs_for.analysis$species, ordered = FALSE)

```


```{r MLH1.MALE.TABLE, echo=FALSE, eval=TRUE}

#AP_mouse_table.MLH1_HQ
#find the table that includes the las image data
male_mouse.avs_for.analysis <-  Mouse.Table_HQ %>% filter(sex== "male") %>% filter(species == "M.musculus") 

male_mouse.avs_for.analysis$subsp <- factor(male_mouse.avs_for.analysis$subsp, ordered = FALSE)
male_mouse.avs_for.analysis$sex <- factor(male_mouse.avs_for.analysis$sex, ordered = FALSE)
male_mouse.avs_for.analysis$strain <- factor(male_mouse.avs_for.analysis$strain, ordered = FALSE)
male_mouse.avs_for.analysis$species <- factor(male_mouse.avs_for.analysis$species, ordered = FALSE)

#how much greater are the High Rec gwRRs
male_mouse.avs_for.analysis$Rec.group <- ifelse(grepl("PWD", male_mouse.avs_for.analysis$strain), 1, 
                              ifelse(grepl("MSM", male_mouse.avs_for.analysis$strain), 1,
                                ifelse(grepl("SKIVE", male_mouse.avs_for.analysis$strain), 1, 0)))


Musc.male_mouse.av <-  male_mouse.avs_for.analysis %>% filter(sex== "male") %>% filter(subsp == "Musc")
Mol.male_mouse.av <-  male_mouse.avs_for.analysis %>% filter(sex== "male") %>% filter(subsp == "Mol")
#Dom version 
Dom.male_mouse.av <-  male_mouse.avs_for.analysis %>% filter(sex== "male") %>% filter(subsp == "Dom")

```


```{r female.diference, echo=FALSE}

#how much greater are the high strains?
G_female <-  female_mouse.avs_for.analysis %>% filter(strain == "G")
mean.G.female <- mean(G_female$mean_co, na.rm=TRUE)

LEW_female <-  female_mouse.avs_for.analysis %>% filter(strain == "LEW")
mean.LEW.female <- mean(LEW_female$mean_co, na.rm=TRUE)

#how much greater is MSM female
MSM_female <-  female_mouse.avs_for.analysis %>% filter(strain == "MSM")
mean.MSM.female <- mean(MSM_female$mean_co, na.rm=TRUE)


sans_high_female <- female_mouse.avs_for.analysis %>% filter(strain != "G") %>%  filter(strain != "MSM") %>%  filter(strain != "LEW")
mean.all.other <- mean(sans_high_female$mean_co, na.rm=TRUE)


G.female.diff <- (mean.G.female / mean.all.other)
LEW.female.diff <- (mean.LEW.female / mean.all.other)
MSM.female.diff <- (mean.MSM.female / mean.all.other)
```


```{r male.difference, echo=FALSE}

sans_LowRec_male <- male_mouse.avs_for.analysis %>% filter(species == "M.musculus")  %>%   filter(Rec.group == 0)
#mean(sans_LewRec_male$mean_co)

PWD_male <-  male_mouse.avs_for.analysis %>% filter(strain == "PWD")
#mean(PWD_male$mean_co) / mean(sans_LewRec_male$mean_co)

MSM_male <- male_mouse.avs_for.analysis %>% filter(strain == "MSM")
#mean(MSM_male$mean_co) / mean(sans_LewRec_male$mean_co)

SKIVE_male <-   male_mouse.avs_for.analysis %>% filter(strain == "SKIVE")
#mean(SKIVE_male$mean_co) /  
```


```{r MLH1.HetC.rates, echo=FALSE, warning=FALSE}
#calculate the initial HetC levels from best quality mice and cells (compare both levels (cell and mouse average levels))
#subset MLH1_DF, remove non passing mice (as diagnoised from plots)
#remove quality 5 cells

#outgroups
#SPIC
HetC.SPIC <- MLH1_data[(MLH1_data$strain == "SPIC")&(MLH1_data$quality < 5),]
#unique(HetC.SPIC$mouse)
#non-passing mice
SPIC.remove.mice <- c("30may18_SPIC_f1", "8jun18_SPIC_m2")
HetC.SPIC <- HetC.SPIC[ ! HetC.SPIC$mouse %in% SPIC.remove.mice, ]
#calq sex mean
SPIC.mean.MLH1.obs <- ddply(.data=HetC.SPIC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)
SPIC.HETC.val <- SPIC.mean.MLH1.obs$mean.MLH1[1] / SPIC.mean.MLH1.obs$mean.MLH1[2]

#SPRET
HetC.SPRET <- MLH1_data[(MLH1_data$strain == "SPRET")&(MLH1_data$quality < 5),]
#unique(HetC.SPRET$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
SPRET.mean.MLH1.obs <- ddply(.data=HetC.SPRET, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)

SPRET.HETC.val <- SPRET.mean.MLH1.obs$mean.MLH1[1] / SPRET.mean.MLH1.obs$mean.MLH1[2]

#CAROLI
HetC.CAROLI <- MLH1_data[(MLH1_data$strain == "CAROLI")&(MLH1_data$quality < 5),]
#unique(HetC.CAROLI$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAROLI.mean.MLH1.obs <- ddply(.data=HetC.CAROLI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)

#cast
HetC.CAST <- MLH1_data[(MLH1_data$strain == "CAST")&(MLH1_data$quality < 5),]
#unique(HetC.CAST$mouse)
#non-passing mice
#X.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAST.mean.MLH1.obs <- ddply(.data=HetC.CAST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)
CAST.HETC.val <- CAST.mean.MLH1.obs$mean.MLH1[1] / CAST.mean.MLH1.obs$mean.MLH1[2]

#HMI
HetC.HMI <- MLH1_data[(MLH1_data$strain == "HMI")&(MLH1_data$quality < 5),]
HMI.mean.MLH1.obs <- ddply(.data=HetC.HMI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

#dom

#WSB
HetC.WSB <- MLH1_data[(MLH1_data$strain == "WSB")&(MLH1_data$quality < 5),]
#unique(HetC.WSB$mouse)
#non-passing mice
WSB.remove.mice <- c("8oct14_WSB_f1", "18nov17_WSB_f5", "16jun15_WSB_f3","10mar15_WSB_m2")
HetC.WSB <- HetC.WSB[ ! HetC.WSB$mouse %in% WSB.remove.mice, ]
#calq sex mean
WSB.mean.MLH1.obs <- ddply(.data=HetC.WSB, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

WSB.HETC.val <- WSB.mean.MLH1.obs$mean.MLH1[1] / WSB.mean.MLH1.obs$mean.MLH1[2]


#LEW
HetC.LEW <- MLH1_data[(MLH1_data$strain == "LEW")&(MLH1_data$quality < 5),]
unique(HetC.LEW$mouse)
#non-passing mice
LEW.remove.mice <- c("4jan17_LEW_f2")
HetC.LEW <- HetC.WSB[ ! HetC.LEW$mouse %in% LEW.remove.mice, ]

#calq sex mean
LEW.mean.MLH1.obs <- ddply(.data=HetC.LEW, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

LEW.HETC.val <- LEW.mean.MLH1.obs$mean.MLH1[1] / LEW.mean.MLH1.obs$mean.MLH1[2]


#G
HetC.G <- MLH1_data[(MLH1_data$strain == "G")&(MLH1_data$quality < 5),]
#unique(HetC.G$mouse)
#non-passing mice
G.remove.mice <- c("8jun15_G_f3","8jun15_G_f4")
HetC.G <- HetC.G[ ! HetC.G$mouse %in% G.remove.mice, ]

#calq sex mean
G.mean.MLH1.obs <- ddply(.data=HetC.G, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]


#PERC
HetC.PERC <- MLH1_data[(MLH1_data$strain == "PERC")&(MLH1_data$quality < 5),]


#calq sex mean
PERC.mean.MLH1.obs <- ddply(.data=HetC.PERC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]

#MUSC

#PWD
HetC.PWD <- MLH1_data[(MLH1_data$strain == "PWD")&(MLH1_data$quality < 5),]
#unique(HetC.PWD$mouse)
#non-passing mice
PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
PWD.mean.MLH1.obs <- ddply(.data=HetC.PWD, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
PWD.HETC.val <- PWD.mean.MLH1.obs$mean.MLH1[1] / PWD.mean.MLH1.obs$mean.MLH1[2]

# CZECH
HetC.CZECH <- MLH1_data[(MLH1_data$strain == "CZECH")&(MLH1_data$quality < 5),]
#unique(HetC.CZECH$mouse)

#calq sex mean
CZECH.mean.MLH1.obs <- ddply(.data=HetC.CZECH, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
CZECH.HETC.val <- CZECH.mean.MLH1.obs$mean.MLH1[1] / CZECH.mean.MLH1.obs$mean.MLH1[2]


# SKIVE
HetC.SKIVE <- MLH1_data[(MLH1_data$strain == "SKIVE")&(MLH1_data$quality < 5),]
#unique(HetC.SKIVE$mouse)

#calq sex mean
SKIVE.mean.MLH1.obs <- ddply(.data=HetC.SKIVE, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

SKIVE.HETC.val <- SKIVE.mean.MLH1.obs$mean.MLH1[1] / SKIVE.mean.MLH1.obs$mean.MLH1[2]

# KAZ
HetC.KAZ <- MLH1_data[(MLH1_data$strain == "KAZ")&(MLH1_data$quality < 5),]
#unique(HetC.KAZ$mouse)

#calq sex mean
KAZ.mean.MLH1.obs <- ddply(.data=HetC.KAZ, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
KAZ.HETC.val <- KAZ.mean.MLH1.obs$mean.MLH1[1] / KAZ.mean.MLH1.obs$mean.MLH1[2]


#TOM
HetC.TOM <- MLH1_data[(MLH1_data$strain == "TOM")&(MLH1_data$quality < 5),]
#unique(HetC.TOM$mouse)

#calq sex mean
TOM.mean.MLH1.obs <- ddply(.data=HetC.TOM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
TOM.HETC.val <- TOM.mean.MLH1.obs$mean.MLH1[1] / TOM.mean.MLH1.obs$mean.MLH1[2]

#AST
HetC.AST <- MLH1_data[(MLH1_data$strain == "AST")&(MLH1_data$quality < 5),]
#unique(HetC.AST$mouse)

#calq sex mean
AST.mean.MLH1.obs <- ddply(.data=HetC.AST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
AST.HETC.val <- AST.mean.MLH1.obs$mean.MLH1[1] / AST.mean.MLH1.obs$mean.MLH1[2]
#Molosinus

#MSM
HetC.MSM <- MLH1_data[(MLH1_data$strain == "MSM")&(MLH1_data$quality < 5),]
#unique(HetC.MSM$mouse)

#non-passing mice
MSM.remove.mice <- c("12sep16_MSM_f3")
HetC.MSM <- HetC.MSM[ ! HetC.MSM$mouse %in% MSM.remove.mice, ]

#calq sex mean
MSM.mean.MLH1.obs <- ddply(.data=HetC.MSM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

MSM.HETC.val <- MSM.mean.MLH1.obs$mean.MLH1[1] / MSM.mean.MLH1.obs$mean.MLH1[2]


#MOLF
HetC.MOLF <- MLH1_data[(MLH1_data$strain == "MOLF")&(MLH1_data$quality < 5),]

#non-passing mice
MOLF.remove.mice <- c("27oct18_MOLF_m3")
HetC.MOLF <- HetC.MOLF[ ! HetC.MOLF$mouse %in% MOLF.remove.mice, ]

#calq sex mean
MOLF.mean.MLH1.obs <- ddply(.data=HetC.MOLF, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
MOLF.HETC.val <- MOLF.mean.MLH1.obs$mean.MLH1[1] / MOLF.mean.MLH1.obs$mean.MLH1[2]
```


```{r DF.MLH1.HetC.plot, echo=FALSE, warning=FALSE, eval=FALSE}

#I don't think this block is needed.

#HETC plot
#change the main data? 

HetC_strain_table.M <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "male"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length( nMLH1.foci),
                         mean_co = format(round(  mean( nMLH1.foci, na.rm = TRUE), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci, na.rm = TRUE),3), nsmall=3),
                         sd   = round(sd( nMLH1.foci, na.rm = TRUE), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#
#HetC_strain_table.M <- HetC_strain_table.M[ -c(7, 4, 10,11,12, 14, 17, 18,19), ]

HetC_strain_table.F <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "female"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length( nMLH1.foci),
                         mean_co = format(round(  mean( nMLH1.foci, na.rm = TRUE), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci, na.rm = TRUE),3), nsmall=3),
                         sd   = round(sd( nMLH1.foci, na.rm = TRUE), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#HetC_strain_table.F <- HetC_strain_table.F[ -c(11), ]
#remove the 'other'
HetC_strain_table.M$sex <- "male"
HetC_strain_table.F$sex <- "female"

HetC_strain_table <- merge(HetC_strain_table.M, HetC_strain_table.F, by= "strain")
HetC_strain_table <- add_subsp(HetC_strain_table)

HetC_strain_table$mean_co.x <- as.numeric(HetC_strain_table$mean_co.x)
HetC_strain_table$mean_co.y <- as.numeric(HetC_strain_table$mean_co.y)
#str(HetC_strain_table)
```



cleanCurated_BivData  vs Curated_BivData, clean removed the few rows with bad handmeasure values and removed rows which are missing values for the hand foci count.


```{r strain.curated.biv, echo=FALSE}

strain.BivData.Table <- ddply(mouse.level.BivData_table, c("strain", "sex"), summarise,
                        
                       # Nmice = length(Nmice, na.rm = TRUE),
                        Ncells  = sum(Ncells, na.rm = TRUE), #might not to be sum
                        mean.SC = mean(mean_SC, na.rm =TRUE),
                        var.SC = mean(var, na.rm = TRUE), #mouse average variance of bivalent per mouse
                        #chrm classes
                        av.proportion_0CO = mean(proportion_0CO, na.rm = TRUE),
                        av.proportion_1CO = mean(proportion_1CO, na.rm = TRUE),
                        av.proportion_2CO = mean(proportion_2CO, na.rm = TRUE),
                        av.proportion_3CO = mean(proportion_3CO, na.rm = TRUE),
                        #1CO pos
                        mean.1CO.pos = mean(mean_1CO.pos, na.rm = TRUE),
                        
                        #mean.IFD
                        mean.IFD.ABS = mean(mean_IFD.2CO_ABS, na.rm = TRUE),
                        mean.IFD.PER = mean(mean_IFD.2CO_PER, na.rm = TRUE)
                        )

strain.BivData.Table <- add_subsp(strain.BivData.Table)
strain.BivData.Table <- add_species(strain.BivData.Table)
#not sure the source of the NAs
```


```{r algorithm_performance_stats, echo=FALSE}

#sort by category, 
#compare total boxes and rate passed
#Curated_BivData  -- pass rate?

#number of mice, number of cells
#mean number of isolate bivs per cell,
#use these two metrics
#cell.level.BivData_table$boxs.IDd 
#cell.level.BivData_table$nboxes_passed

#calq the mean rate by category

cell.level.BivData_table$pass.rate <- cell.level.BivData_table$nboxes_passed / cell.level.BivData_table$boxs.IDd 

algorithm.stat.mouse <- ddply(cell.level.BivData_table, c("mouse"), summarise,
                        n_obs = length( unique(fileName) ),
                         mean_pass.rate = mean(pass.rate)
                         )

cell.level.BivData_table <- add_sex(cell.level.BivData_table)

algorithm.stat.category <- ddply(cell.level.BivData_table, c("sex", "strain"), summarise,
                        n_obs = length(unique(fileName)),
                        mean_pass.rate = mean(pass.rate)
                         )

```



# MLH1 models


```{r MLH1.MIXED.MODEL.setup, echo=FALSE, warning=FALSE, eval=TRUE}

#make sure that MOLF female is included!

#DF.HetC.MixedModel <- add_species(DF.HetC.MixedModel)
DF.HetC.MixedModel <- Mouse.Table_HQ[Mouse.Table_HQ$species == "M.musculus",]

DF.HetC.MixedModel.3 <- Mouse.Table_HQ %>% filter(species == "M.musculus")
#DF.HetC.MixedModel

DF.HetC.MixedModel.HQ <- DF.HetC.MixedModel

#main df with variables coded as chr, set false for the model
DF.HetC.MixedModel.HQ$subsp <- factor(DF.HetC.MixedModel.HQ$subsp, ordered = FALSE)
DF.HetC.MixedModel.HQ$sex <- factor(DF.HetC.MixedModel.HQ$sex, ordered = FALSE)
DF.HetC.MixedModel.HQ$strain <- factor(DF.HetC.MixedModel.HQ$strain, ordered = FALSE)
DF.HetC.MixedModel.HQ$species <- factor(DF.HetC.MixedModel.HQ$species, ordered = FALSE)

#remove male only data
remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

DF.HetC.MixedModel.HQ <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

```

127 mice, 8 strains (correct), 0 MOLF females!

comes from Mouse.Table_HQ, this has 0 females, 

M1 - subsp, sex, (1 | strain)
M2 - subsp, sex, strain
M3 - sex, strain
M4 - strain (sex specific)

there is another set of of this DF at line 200, this DF isn't defined in the setup script

DF.HetC.MixedModel.HQ should have only the relevant strains, but adding in 


```{r MLH1co.lmer.MM1, echo=FALSE, waring=FALSE, message=FALSE, eval=TRUE}

MLH1.MM.M1 <- lmer(mean_co ~ subsp * sex + (1|strain), data= DF.HetC.MixedModel.HQ ) 
MLH1.MM.M1.reduce.sex <- lmer( mean_co ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1.MM.M1.reduce.subp <- lmer( mean_co ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )


MLH1.MM_interaction <- drop1(MLH1.MM.M1, test="Chisq")$`Pr(Chi)`[2]
MLH1.MM_sex <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
MLH1.MM_subp <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
MLH1.MM_strain <- exactRLRT(MLH1.MM.M1)$p.value 

MLH1.MMlmer_results <- data.frame(sub.sp = MLH1.MM_subp, 
sex.results =  MLH1.MM_sex, 
               interaction.pval = MLH1.MM_interaction,  rand.pval = 
MLH1.MM_strain)
#I get the better values: when there is MOLF female and the old mice are removed
#consider removing these from the start
MLH1.MMlmer_results
```



**these should be the M1 MLH1 results**
sub.sp      sex.results      interaction.pval     rand.pval
1 0.0011     4.9e-06          0.00021         0


```{r MLH1.glmM2, echo=FALSE, eval=TRUE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")
#AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
#kkll <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

#strain = fixed
MLH1.M2.glm.strain.fixed.full <- glm(mean_co ~ subsp * sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]   )

summ.MLH1.M2.glm.strain.fixed.full <- summary(MLH1.M2.glm.strain.fixed.full)

#table of just coeff anf pvalue
#round(summ$coefficients[,c(1,4)],5 )

#write.table(summ$coefficients , "~./MLH1repo/glm.strain.fixed.full.csv", sep=",",row.names = TRUE)
```


```{r MLH1.glm.M3, echo=FALSE, eval=TRUE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

MLH1.M3.strain.fixed <- glm(mean_co ~ sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,])

summ.MLH1.M3.strain.fixed <- summary(MLH1.M3.strain.fixed)

#round(summ.strain.fixed$coefficients[,c(1,4)],5)

#write.table(summ.strain.fixed$coefficients , "~./MLH1repo/summ.strain.fixed.csv", sep=",",row.names = TRUE)
```


```{r Female.specific.glm.M4.M5, echo=FALSE, eval=TRUE}

glm.female.strain.subsp <- glm(mean_co ~ subsp * strain, data= (female_mouse.avs_for.analysis %>% filter(subsp != "Cast") ) )

summry.female.strain.effects <- summary(glm.female.strain.subsp)
#round(summry.female.strain.effects$coefficients[,c(1,4)],5)
#write.table(summry.female.strain.effects$coefficients, "~./MLH1repo/summry.female.strain.effects.csv", sep=",",row.names = TRUE)


MLH1.female.spc.glm.M5 <- glm(mean_co ~ strain, data= (female_mouse.avs_for.analysis %>% filter(subsp != "Cast") ) )
sum_MLH1.female.spc.glm.M5 <- summary(MLH1.female.spc.glm.M5)

#round(lm.female.strain_sum$coefficients[,c(1,4)],5)
#write.table(lm.female.strain_sum$coefficients, "~./MLH1repo/lm.female.strain.csv", sep=",",row.names = TRUE)
```


```{r Male.specific.glm.M4.M5, echo=FALSE, eval=TRUE}
#M4
MLH1.male.glm.M4 <- glm(mean_co ~ subsp * strain, data=(male_mouse.avs_for.analysis  %>% filter(subsp != "Cast") )   )

sum_MLH1.male.glm.M4 <- summary(MLH1.male.glm.M4)
#PWD, SKIVE, MSM
#8,9,10

#write.table(summry.male.strain.effects$coefficients , "~./MLH1repo/summry.male.strain.effects.csv", sep=",",row.names = TRUE)

#M4.2
MLH1.male.glm.M4.2 <- glm(mean_co ~ strain, data= (male_mouse.avs_for.analysis  %>% filter(subsp != "Cast") ))
sum_MLH1.male.glm.M4.2 <- summary(MLH1.male.glm.M4.2)

#round(lm.male.strain_sum$coefficients[,c(1,4)], 5)

#write.table(lm.male.strain_sum$coefficients , "~./MLH1repo/lm.male.strain_sum.csv", sep=",",row.names = TRUE)

```



#MLH1 variance models

M1 - subsp, sex, (1 | strain)  (lmer)
M2 - subsp, sex, strain  (glm / lm?)
M3 - sex, strain
M4 - strain (sex specific)


```{r M1.MLH1.var_cv, echo=FALSE, warning=FALSE, message=FALSE}
MLH1var_M1 <- lmer( var ~ subsp * sex +(1|strain), data= (DF.HetC.MixedModel.HQ %>% filter(species == "M.musculus"))   )
MLH1var_M1.reduce.sex <- lmer( var ~ subsp  +(1|strain), data= (DF.HetC.MixedModel.HQ %>% filter(species == "M.musculus")) )
MLH1var_M1.reduce.subp <- lmer( var ~ sex  +(1|strain), data= (DF.HetC.MixedModel.HQ %>% filter(species == "M.musculus")) )

#summary(MLH1var_M1)
LmerMLH1_VAR_int <- drop1(MLH1var_M1, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_VAR_sex <- anova(MLH1var_M1, MLH1var_M1.reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_subsp <- anova(MLH1var_M1, MLH1var_M1.reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_strain <- exactRLRT(MLH1var_M1)$p.value

LmerMLH1_VAR_results <- data.frame(sub.sp = LmerMLH1_VAR_subsp,
sex.results =  LmerMLH1_VAR_sex, interaction.pval = LmerMLH1_VAR_int,  rand.pval = LmerMLH1_VAR_strain)

#CV
MLH1cV_M1 <- lmer( cV ~ subsp * sex +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1cV_M1.reduce.sex <- lmer( cV ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1cV_M1.reduce.subp <- lmer( cV ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

LmerMLH1_CV_int <- drop1(MLH1cV_M1, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_CV_sex <- anova(MLH1cV_M1, MLH1cV_M1.reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_CV_subsp <- anova(MLH1cV_M1, MLH1cV_M1.reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_CV_strain <- exactRLRT(MLH1cV_M1)$p.value

LmerMLH1_CV_results <- data.frame(sub.sp = LmerMLH1_CV_subsp,
sex.results =  LmerMLH1_CV_sex, interaction.pval = LmerMLH1_CV_int,  rand.pval = LmerMLH1_CV_strain)

#Q12
Q12_mouse_table_MLH1$subsp <- factor(Q12_mouse_table_MLH1$subsp, ordered = FALSE)
Q12_mouse_table_MLH1$sex <- factor(Q12_mouse_table_MLH1$sex, ordered = FALSE)
Q12_mouse_table_MLH1$strain <- factor(Q12_mouse_table_MLH1$strain, ordered = FALSE)
Q12_mouse_table_MLH1$species <- factor(Q12_mouse_table_MLH1$species, ordered = FALSE)


#USE Q12 (Q123) table
#Q12_mouse_table_w.Ages
#Q12 var
MLH1var_M1_Q12 <- lmer( var ~ subsp * sex +(1|strain), data=(Q12_mouse_table_MLH1 %>% filter(species == "M.musculus")) )
MLH1var_M1_Q12reduce.sex <- lmer( var ~ subsp  +(1|strain), data=(Q12_mouse_table_MLH1 %>% filter(species == "M.musculus")) )
MLH1var_M1_Q12reduce.subp <- lmer( var ~ sex  +(1|strain), data=(Q12_mouse_table_MLH1 %>% filter(species == "M.musculus")) )

LmerMLH1_M1_Q12VAR_int <- drop1(MLH1var_M1_Q12, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_M1_Q12_VAR_sex <- anova(MLH1var_M1_Q12, MLH1var_M1_Q12reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_VAR_subsp <- anova(MLH1var_M1_Q12, MLH1var_M1_Q12reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_VAR_strain <- exactRLRT(MLH1var_M1_Q12)$p.value

LmerMLH1_M1_Q12_VAR_results <- data.frame(sub.sp = LmerMLH1_M1_Q12_VAR_subsp,
sex.results =  LmerMLH1_M1_Q12_VAR_sex, interaction.pval = LmerMLH1_M1_Q12VAR_int,  rand.pval = LmerMLH1_M1_Q12_VAR_strain)

#Q12 cv
MLH1cv_M1_Q12 <- lmer( cV ~ subsp * sex +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1cv_M1_Q12reduce.sex <- lmer( cV ~ subsp  +(1|strain), data=Q12_mouse_table_w.Ages )
MLH1cv_M1_Q12reduce.subp <- lmer( cV ~ sex  +(1|strain), data=Q12_mouse_table_w.Ages )

LmerMLH1_M1_Q12_CV_int <- drop1(MLH1cv_M1_Q12, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_M1_Q12_CV_sex <- anova(MLH1cv_M1_Q12, MLH1cv_M1_Q12reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_CV_subsp <- anova(MLH1cv_M1_Q12, MLH1cv_M1_Q12reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_M1_Q12_CV_strain <- exactRLRT(MLH1cv_M1_Q12)$p.value

LmerMLH1_M1_Q12_VAR_results <- data.frame(sub.sp = LmerMLH1_M1_Q12_CV_subsp,
sex.results =  LmerMLH1_M1_Q12_CV_sex, interaction.pval = LmerMLH1_M1_Q12_CV_int,  rand.pval = LmerMLH1_M1_Q12_CV_strain)
```


```{r M2.MLH1.var, echo=FALSE, include=FALSE}

MLH1var_M2 <- glm( var ~ subsp * sex * strain,  data= ( DF.HetC.MixedModel.HQ %>% filter(species == "M.musculus") )  )
MLH1var_M2_sum <- summary(MLH1var_M2)

MLH1var_M2_sum_coE <- as.data.frame( round(summary(MLH1var_M2)$coefficients, 6)) #table of p values for coefficients.

MLH1cv_M2 <- glm(cV ~ subsp*sex*strain, data=DF.HetC.MixedModel.HQ)
#summary(MLH1cv_M2)
#anova(MLH1cv_M2)
#as.data.frame( round(summary(MLH1cv_M2)$coefficients, 6))

#Q12 var
MLH1var_M2_Q12 <- glm( var ~ subsp*sex*strain,  data= (Q12_mouse_table_MLH1 %>% filter(species == "M.musculus")) )
sum.MLH1var_M2_Q12 <- summary(MLH1var_M2_Q12)
sum.MLH1var_M2_Q12.co_eff <- as.data.frame( round(summary(MLH1var_M2_Q12)$coefficients, 6))

#Q12 cv
MLH1cv_M2_Q12 <- glm( cV ~ subsp*sex*strain, data=Q12_mouse_table_w.Ages )
#summary(MLH1cv_M2_Q12)
#anova(MLH1cv_M2_Q12)#sex large F
#as.data.frame( round(summary(MLH1cv_M2_Q12)$coefficients, 6))
```


```{r M3.MLH1.var, echo=FALSE}

glmMLH1Var_M3 <- glm( var ~ sex * strain,  data= (DF.HetC.MixedModel.HQ %>% filter(species == "M.musculus") ) )

glmMLH1Var_M3_sum <- summary(glmMLH1Var_M3)

glmMLH1Var_M3_sum.Coef <- round(glmMLH1Var_M3_sum$coefficients[,c(1,4)], 5)



MLH1cv_M3 <- glm(cV ~ sex * strain, data=DF.HetC.MixedModel.HQ)
#summary(MLH1cv_M4)
#round(summary(MLH1cv_M3)$coefficients[,c(1,4)], 6)

### Q12 var
MLH1var_M3_Q12 <- glm( var ~ sex*strain, data=(Q12_mouse_table_MLH1 %>% filter(species == "M.musculus")) )
MLH1var_M3_Q12_sum <- summary(MLH1var_M3_Q12)

#as.data.frame( round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6))
#round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6)

#Q12 cv
MLH1cv_M4_Q12 <- glm( cV ~ sex*strain, data=Q12_mouse_table_w.Ages )
#round(summary(MLH1cv_M4_Q12)$coefficients[,c(1,4)], 6)
```


```{r MLH1.var.M4, echo=FALSE, eval=F}
#male
glmMLH1Var_M4.male <- glm( var ~ subsp * strain,  data= (DF.HetC.MixedModel.HQ %>% filter(sex == "male") ) )


#female
glmMLH1Var_M4.female <- glm( var ~ subsp * strain,  data= (DF.HetC.MixedModel.HQ %>% filter(sex == "female") ) )
sum.glmMLH1Var_M4.female <- summary(glmMLH1Var_M4.female)

glmMLH1Var_M4.femaleQ12 <- glm( var ~ subsp * strain,  data= (Q12_mouse_table_w.Ages %>% filter(sex == "female") ) )

```


```{r FEMALE.VAR.MODELS, echo=FALSE, eval=F}
## within mouse variance models 
lmVAR.female.strain.subsp <- glm(var ~ subsp * strain, data= female_mouse.avs_for.analysis)
summry.female.strain.VAReffects <- summary(lmVAR.female.strain.subsp)

lmVAR.female.strain <- glm(var ~ strain, data= female_mouse.avs_for.analysis)
lmVAR.female.strain_sum <- summary(lmVAR.female.strain)

#round( #round isn't working for this sumary
#lmVAR.female.strain_sum$coefficients[,c(1,4)]
#Q12
Q12_female_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "female")

lm.m1.Q12_female <- glm(var ~ subsp * strain, data= Q12_female_table)
lm.m1.Q12_female_sum <- summary(lm.m1.Q12_female)


lm.m2.Q12_female <- glm(var ~ strain, data= Q12_female_table)
lm.m2.Q12VAR.female_sum <- summary(lm.m2.Q12_female)#LEW changes to PWD

lm.m2.Q12_female.cv <- glm(cV ~ strain, data= Q12_female_table)
lm.m2.Q12_female.cv_sum <- summary(lm.m2.Q12_female.cv)

#lm.m2.Q12VAR.female_sum$coefficients[,c(1,4)]
#LEW sig

```


```{r MALE.SPECIFIC.variance.model, echo=FALSE, eval=F}
## within mouse variance models 
lmVAR.male.strain.subsp <- glm(var ~ subsp * strain, data= just.male_mouse.av)
summry.male.strain.VAReffects <- summary(lmVAR.male.strain.subsp)
#round(summry.male.strain.VAReffects$coefficients[,c(1,4)], 5)

#all p values kinda high, MSM and TOM are slightly sig
lmVAR.male.strain <- glm(var ~ strain, data= just.male_mouse.av)
lmVAR.male.strain_sum <- summary(lmVAR.male.strain)
#round(lmVAR.male.strain_sum$coefficients[,c(1,4)], 5)
#non sig

lmcv.male.strain <- glm(cV ~ strain, data= just.male_mouse.av)
lmcv.male.strain_sum <- summary(lmcv.male.strain)
#round(lmcv.male.strain_sum$coefficients[,c(1,4)], 5)
#HMI sig for cv model -- in the other model, CAST subsp and TOM strain are slightly significant

#Q12
Q12_male_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "male")

lm.m1.Q12_male <- glm(var ~ subsp * strain, data= Q12_male_table)
lm.m1.Q12_male_sum <- summary(lm.m1.Q12_male)
#round(lm.m1.Q12_male_sum$coefficients[,c(1,4)], 5)
#NS

lm.m2.Q12_male <- glm(var ~ strain, data= Q12_male_table)
lm.m2.Q12VAR.male_sum <- summary(lm.m2.Q12_male)
#round(lm.m2.Q12VAR.male_sum$coefficients[,c(1,4)], 5)
#NS

```





# DMC1 Results

main table (DMC1.mean.table), t.tests  , ratios

set up, t.tests, correlations, says there are duplicate titles



```{r DMC1_t.tests1, echo=FALSE, warning=FALSE}
#2. t-tests for the DMC1 counts 
#need to account for sample sizes when comparing t.tests (KAZ and G don't have equal across )
#best case scnario -- more microscoping to get ~20 cells for each stage by strain combo


#high vs low group (L)
ttest.HighLow.L.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "Early") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "Early") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value =  0.002145


#high vs low group (Z)
ttest.HighLow.Z.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "Late") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "Late") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value = 0.6628


#dom vs musc (L) (2 subsp vs)
ttest.subsp.L <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Early")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "Early")] )
# p-value = 0.003016

#dom vs musc (Z)
ttest.subsp.Z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Late")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "Late")] )
#p-value = 0.09588

#KAZ vs Dom (Z) (only 1 L cell)
ttest.KAZ.Dom.z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Late")], 
      DMC1.DF$total.count[(DMC1.DF$strain == "KAZ") & (DMC1.DF$stage == "Late")] )

#p-value = 0.004148
#Kaz Z are higher than Dom
```


```{r DMC1.rand.calq1, echo=FALSE}

DMC1.mean.obs.L$mean.count.L <- DMC1.mean.obs.L$mean.count
DMC1.mean.obs.Z$mean.count.Z <- DMC1.mean.obs.Z$mean.count

mean.MLH1.obs <- ddply(.data=Mouse.Table_HQ,
                 .(category),
                 summarize, 
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co)
)


DMC1.target.strains <- subset(mean.MLH1.obs, category == "G male" |
                   category == "WSB male" |
                     category == "KAZ male" |
                  category == "MSM male" |
                    category == "PWD male")

DMC1table <- merge(DMC1.mean.obs.L, DMC1.mean.obs.Z, by="category")

DMC1table.main <- merge(DMC1.target.strains, DMC1table, by="category")

MLH1.DMC1.L_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.L, method = c("pearson"))#MLH1.DMC1.Z_cor

MLH1.DMC1.Z_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.Z, method = c("pearson"))#0.2793237
```


```{r DMC1.ratios1, echo=FALSE}

##RATIOS
DMC1table.main$MLH1.L_ratio <- DMC1table.main$mean.MLH1/ DMC1table.main$mean.count.L 
DMC1table.main$MLH1.Z_ratio <- DMC1table.main$mean.MLH1 / DMC1table.main$mean.count.Z
  
#colnames(DMC1table.main) <- c("category", "mean.MLH1", "", "", "")

#DMC1.mean.table
DMC1.mean.table.99 <- subset(DMC1table.main, select= -c(var.MLH1,  mean.count.x,  mean.count.y, stage.x, stage.y))

colnames(DMC1.mean.table.99) <- c("category","mean.MLH1","ncells.L","mean.L",
                  "ncells.Z", "mean.Z", "MLH1.L_ratio", "MLH1.Z_ratio")


WSB_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "WSB male") )$mean.count.L / (DMC1table.main %>% filter(category == "WSB male"))$mean.MLH1
  
G_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "G male") )$mean.count.L / (DMC1table.main %>% filter(category == "G male"))$mean.MLH1

MSM_DMC1.Z_CO_ratio <- ( DMC1table.main %>% filter(category == "MSM male") )$mean.count.L / (DMC1table.main %>% filter(category == "MSM male"))$mean.MLH1

PWD_DMC1.Z_CO_ratio <-( DMC1table.main %>% filter(category == "PWD male") )$mean.count.L / (DMC1table.main %>% filter(category == "PWD male"))$mean.MLH1



DMC1table.main$category <- factor(DMC1table.main$category, levels = c("WSB male","G male","KAZ male",               "PWD male","MSM male"), ordered = TRUE )

DMC1table.main <- DMC1table.main[order(DMC1table.main$category),]

kable(head(DMC1table.main),  caption = "Table X. DMC1 foci counts per cell summary")


DMC1.Lratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.L_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.L_ratio        )
                               

DMC1.Zratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.Z_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.Z_ratio        )

```


-----

```{r DMC1.setup, echo=FALSE, eval=FALSE}
#load DMC1 csv
#DMC1.DF <- read.csv("~./DMC1/newJuviQuant.csv", header = TRUE)
DMC1.DF <- read.csv("~./MLH1repo/data/DMC1newJuviQuant.csv", header = TRUE)


DMC1.DF$fileName <- DMC1.DF$Original.Name
DMC1.DF <- add_mouse(DMC1.DF)
DMC1.DF <- add_strain(DMC1.DF)
DMC1.DF <- add_category(DMC1.DF)
DMC1.DF <- add_subsp(DMC1.DF)
DMC1.DF <- DMC1.DF[DMC1.DF$stage != "P",]

#make DMC1 table
DMC1.mean.obs.L <- ddply(.data=DMC1.DF[DMC1.DF$stage == "L",],
                 .(category),
                 summarize, 
                 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.L$stage <- "L"

DMC1.mean.obs.Z <- ddply(.data=DMC1.DF[DMC1.DF$stage == "Z",],
                 .(category),
                 summarize, 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.Z$stage <- "Z"

DMC1.mean.table <- rbind(DMC1.mean.obs.L,DMC1.mean.obs.Z)

#write.table(DMC1.mean.table, "~./MLH1repo/DMC1.mean.table.csv", sep=",",
#            row.names = FALSE)

DMC1.DF$rec_group <- ifelse(grepl("WSB", DMC1.DF$strain), "Low",
                          ifelse(grepl("G",DMC1.DF$strain), "Low",
                                 
              ifelse(grepl("KAZ", DMC1.DF$strain), "Low",
            ifelse(grepl("PWD", DMC1.DF$strain), "High",
               ifelse(grepl("MSM", DMC1.DF$strain), "High","")))))
```

```{r MAIN.DMC1.plot, echo=FALSE, warning=FALSE, eval=FALSE}
#think of better color scheme
#make the jitter col thinner or make the stacked dots.
#remember that box-plots add outlier dots.
#change y labels

#experimenting with ggboplot
everyday <- ggboxplot(DMC1.DF[DMC1.DF$stage != "P",], x = "strain", y = "total.count",
          color = "stage", palette = "jco",
          add = "jitter", short.panel.labs = FALSE)
  #library gpubr has functions to add in sig/test bars.

#change order

DMC1.DF$strain<- factor(DMC1.DF$strain, levels =c("LEW",
                      "WSB","G", "KAZ", "SKIVE","PWD","MSM"), order=T )

```

```{r plot.stage.ttest, echo=FALSE, warning=FALSE, eval=FALSE}

anno_df_stage = compare_means(total.count ~ stage, group.by = "rec_group", data = DMC1.DF[DMC1.DF$stage != "P",],method = "t.test") %>% mutate(y_pos = 300)
#

DMC1.bxlt_Z_to_L <- ggplot(DMC1.DF[DMC1.DF$stage != "P",], aes(x=stage, y=total.count)) + 
  geom_boxplot(position=position_dodge()) + 
  geom_point(aes(color=rec_group), position=position_jitterdodge()) + 
  
  #facet_wrap(~stage, nrow=1) + 
  
  ggsignif::geom_signif(
    data=anno_df_stage, 
    aes(xmin=group1, xmax=group2, annotations=p.adj, y_position=y_pos), 
    manual=TRUE
  )+ggtitle("Comparison of DMC1 means across high and low recombing groups")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))

#Musc.mouse.av <-  Mouse.Table_BivData_4MM %>%  filter(subsp == "Musc") 

ttest.ZtoL <- t.test(DMC1.DF$total.count[(DMC1.DF$stage == "L")],
               DMC1.DF$total.count[(DMC1.DF$stage == "Z")]  )


DMC1.High.goup <-  DMC1.DF %>%  filter(rec_group == "High") 

ttest.ZtoL.high <- t.test(DMC1.High.goup$total.count[(DMC1.High.goup$stage == "L")],
               DMC1.High.goup$total.count[(DMC1.High.goup$stage == "Z")]  )


DMC1.Low.goup <-  DMC1.DF %>%  filter(rec_group == "Low") 

ttest.ZtoL.Low <- t.test(DMC1.Low.goup$total.count[(DMC1.Low.goup$stage == "L")],
               DMC1.Low.goup$total.count[(DMC1.Low.goup$stage == "Z")]  )
```

```{r DMC1_t.tests, echo=FALSE, warning=FALSE, eval=FALSE}
#2. t-tests for the DMC1 counts 
#need to account for sample sizes when comparing t.tests (KAZ and G don't have equal across )
#best case scnario -- more microscoping to get ~20 cells for each stage by strain combo


#high vs low group (L)
ttest.HighLow.L.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value =  0.002145


#high vs low group (Z)
ttest.HighLow.Z.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value = 0.6628


#dom vs musc (L) (2 subsp vs)
ttest.subsp.L <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "L")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "L")] )
# p-value = 0.003016

#dom vs musc (Z)
ttest.subsp.Z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "Z")] )
#p-value = 0.09588

#KAZ vs Dom (Z) (only 1 L cell)
ttest.KAZ.Dom.z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], 
      DMC1.DF$total.count[(DMC1.DF$strain == "KAZ") & (DMC1.DF$stage == "Z")] )

#p-value = 0.004148
#Kaz Z are higher than Dom
```




# Q1 single bivalent

```{r table.long.biv, echo=FALSE, eval =FALSE}
#This table is already made in setupData


# make a table for the Mixed Models -- from the long.BivData
# Calq mouse averages

#add in all the other stats there are in the other tables

Long.biv_mouse_table <- ddply(real.long.bivData, c("mouse"), summarise,
                        
                        Nmice = length(unique(mouse)),
                        Ncells = length( unique(fileName) ),
                        n_obs  = length(Obj.ID),
                      
                      mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                      
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                        
                        #SC lengths by class
                        nCO0 =  sum(hand.foci.count == 0, na.rm=TRUE), 
                      nCO1 =  sum(hand.foci.count == 1, na.rm=TRUE), 
                       nCO2 = sum(hand.foci.count == 2, na.rm=TRUE),
                       nCO3 = sum(hand.foci.count == 3, na.rm=TRUE),
                       nCO4 = sum(hand.foci.count == 4, na.rm=TRUE),
                       
                      mean.siscoten_0CO = mean(SisCoTen[which(hand.foci.count == 0)], na.rm = TRUE),
                      mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
                     mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
                      mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
                      
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)])
                  
        #          mean_siscoten = mean(siscoten)
        #
)
#mouse averages for long.biv

Long.biv_mouse_table <- add_sex(Long.biv_mouse_table)
Long.biv_mouse_table <- add_strain(Long.biv_mouse_table)
Long.biv_mouse_table <- add_subsp(Long.biv_mouse_table)
Long.biv_mouse_table <- add_category(Long.biv_mouse_table)
Long.biv_mouse_table <- add_species(Long.biv_mouse_table)

#unordered for the mixed models (move this to the MM blocks...?)
Long.biv_mouse_table$subsp <- factor(Long.biv_mouse_table$subsp, ordered = FALSE)
Long.biv_mouse_table$sex <- factor(Long.biv_mouse_table$sex, ordered = FALSE)
Long.biv_mouse_table$strain <- factor(Long.biv_mouse_table$strain, ordered = FALSE)

#rec group
Long.biv_mouse_table$Rec.group <- ifelse(grepl("PWD", Long.biv_mouse_table$category), 1, 
                            ifelse(grepl("MSM", Long.biv_mouse_table$category), 1,
                             ifelse(grepl("SKIVE", Long.biv_mouse_table$category), 1, 0)) )

#long.biv. 1) HetC  2) male.poly (the main factors are still unordered)

#1) Long Biv for 
#remove all the non-used strains!!
Long.biv_mouse_table_HetC <- Long.biv_mouse_table

Long.biv_mouse_table_HetC <- Long.biv_mouse_table_HetC[Long.biv_mouse_table$strain != "AST",]
Long.biv_mouse_table_HetC <- Long.biv_mouse_table_HetC[Curated_BivData$strain != "TOM",]
Long.biv_mouse_table_HetC <- Long.biv_mouse_table_HetC[Long.biv_mouse_table_HetC$strain != "CZECH",]
Long.biv_mouse_table_HetC$strain <- droplevels(Long.biv_mouse_table_HetC$strain)

#remove na's
Long.biv_mouse_table_HetC <- Long.biv_mouse_table_HetC[!(is.na(Long.biv_mouse_table_HetC$mouse) | Long.biv_mouse_table_HetC$mouse==""), ]

#table(droplevels( Long.biv_mouse_table_HetC$category) )  #for double checking


```


```{r table.short.biv, echo=FALSE, eval=FALSE}

#this table is made in SetUpData
#real.short.bivData

#same chunk as above
Short.biv_mouse_table <- ddply(real.short.bivData, c("mouse"), summarise,
                        
                        Nmice = length(unique(mouse)),
                        Ncells = length( unique(fileName) ),
                        n_obs  = length(Obj.ID),
                      
                      mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                      
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                        
                        #SC lengths by class
                        nCO0 =  sum(hand.foci.count == 0, na.rm=TRUE), 
                      nCO1 =  sum(hand.foci.count == 1, na.rm=TRUE), 
                       nCO2 = sum(hand.foci.count == 2, na.rm=TRUE),
                       nCO3 = sum(hand.foci.count == 3, na.rm=TRUE),
                       nCO4 = sum(hand.foci.count == 4, na.rm=TRUE),
                       
                      mean.siscoten_0CO = mean(SisCoTen[which(hand.foci.count == 0)], na.rm = TRUE),
                      mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
                     mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
                      mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
                      
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)])
                  
        #          mean_siscoten = mean(siscoten)
        #
)
#mouse averages for 

Short.biv_mouse_table <- add_sex(Short.biv_mouse_table)
Short.biv_mouse_table <- add_strain(Short.biv_mouse_table)
Short.biv_mouse_table <- add_subsp(Short.biv_mouse_table)
Short.biv_mouse_table <- add_category(Short.biv_mouse_table)
Short.biv_mouse_table <- add_species(Short.biv_mouse_table)

#unordered for the mixed models (move this to the MM blocks...?)
Short.biv_mouse_table$subsp <- factor(Short.biv_mouse_table$subsp, ordered = FALSE)
Short.biv_mouse_table$sex <- factor(Short.biv_mouse_table$sex, ordered = FALSE)
Short.biv_mouse_table$strain <- factor(Short.biv_mouse_table$strain, ordered = FALSE)

#rec group
Short.biv_mouse_table$Rec.group <- ifelse(grepl("PWD", Short.biv_mouse_table$category), 1, 
                            ifelse(grepl("MSM", Short.biv_mouse_table$category), 1,
                             ifelse(grepl("SKIVE", Short.biv_mouse_table$category), 1, 0)) )

```


# toal SC setup


```{r Q1.total_SC.table, echo=FALSE, eval=FALSE}

totSC.strain.av.table <-  mouse.total.skel[,c("subsp","strain", "sex","nmice","ncells","mean.skel"),  drop=T]

#head of table
#see the DMC1 code

#kable(totSC.strain.av.table, row.names = F, caption = "caption") %>%
#  kable_styling() %>%
#  scroll_box(width = "800px", height = "200px")

#add variance
#write.xlsx(totSC.strain.av.table, file = "Results_Table.xlsx", sheetName = "Total.SC.results", append = TRUE, row.names = F)

```


mouse total sc t.tests male female (Q1)

```{r Q1.total.SC_ttests, echo=FALSE}

#mouse.total.skel

#full group
Q1.tot.SC_t.test_FM <- t.test( ( mouse.total.skel %>% filter(sex == "male") %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean.skel,
                    (mouse.total.skel %>% filter(sex == "female") %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ))$mean.skel  ) #<2e-16


#WSB
Q1.tot.SC_t.test_WSB <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="WSB" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="WSB"))$mean.skel)

#LEW
Q1.tot.SC_t.test_LEW <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="LEW" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="LEW"))$mean.skel)

#G
Q1.tot.SC_t.test_G <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="G" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="G"))$mean.skel)

#PWD
Q1.tot.SC_t.test_PWD <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="PWD" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="PWD"))$mean.skel)

#KAZ
Q1.tot.SC_t.test_KAZ <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="KAZ"))$mean.skel)

#SKIVE
Q1.tot.SC_t.test_SKIVE <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="SKIVE" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="SKIVE"))$mean.skel)

#MSM
Q1.tot.SC_t.test_MSM <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(strain =="MSM" ))$mean.skel,
                                (mouse.total.skel %>% filter(sex == "female") %>% filter(strain =="MSM"))$mean.skel)


```


long bivs shouldn't be compared for Q1

```{r Q1_SC.biv.short_ttest, echo=FALSE, include=TRUE}

#Q1.real.long_mouse_table -- change to Short.biv_mouse_table

#all strains -#full group
Q1_short.SC_t.test.FM <- t.test( ( Short.biv_mouse_table %>% filter(sex == "male") %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean_SC,
                    (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ))$mean_SC  ) #<2e-16

# WSB p-value = 0.02 (highest p val)
Q1_short.SC_t.test.WSB <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean_SC,
                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean_SC)


#G  p-value = 5e-04
Q1_short.SC_t.test.G <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "G") )$mean_SC,
                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "G") )$mean_SC)

#LEW  p-value = 0.002
Q1_short.SC_t.test.LEW <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean_SC,
                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean_SC)

#PWD p-value = 0.008
Q1_short.SC_t.test.PWD <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean_SC,
                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean_SC)

#KAZ p-value = 0.06
Q1_short.SC_t.test.KAZ <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean_SC,
                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean_SC)


#not enough y observations
#SKIVE -- not significant (kinda few )
Q1_short.SC_t.test.SKIVE <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean_SC,
                   (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean_SC)

#MSM -- no enough male measures
#Q1_short.SC_t.test.MSM <- t.test((Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$mean_SC,
#                           (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "MSM") )$mean_SC)


#run t.tests for the mouse av. for reduced single bivalent datasets
```



```{r Q1_short_ratios, echo=FALSE, eval=TRUE}
#WSB
Q1SC.mus.av.short.biv_DIFF_WSB <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$mean_SC )

#LEW
Q1SC.mus.av.short.biv_DIFF_LEW <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$mean_SC )

#G
Q1SC.mus.av.short.biv_DIFF_G <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "G") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "G") )$mean_SC )

#PWD
Q1SC.mus.av.short.biv_DIFF_PWD <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$mean_SC )

#KAZ
Q1SC.mus.av.short.biv_DIFF_KAZ <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$mean_SC )

#SKIVE
Q1SC.mus.av.short.biv_DIFF_SKIVE <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$mean_SC )

#MSM
Q1SC.mus.av.short.biv_DIFF_MSM <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "MSM") )$mean_SC) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$mean_SC )

#this bivData ratio is the same as mouse average
Q1SC.BivData.short.biv_DIFF_MSM <- mean( (Short.biv_mouse_table %>% filter(sex == "female") %>% filter(strain == "MSM") )$chromosomeLength) / mean(  (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$chromosomeLength )

```



```{r totSC.viz4outliers, echo=FALSE, eval=FALSE}

#Total.SC_DF
#mouse.total.skel

# -- EXAMINE the ggplot scatter plots for outliers
show.tot.sc_plot <- ggplot(data= ( Total.SC_DF %>% filter(sex == "male") ), aes(y = skel_size, x=strain))+ geom_jitter()+facet_wrap(~category, scales = "free")

show.mus.tot.sc_plot <- ggplot(data= ( mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Musc") ), aes(y = mean.skel, x=strain, color = strain))+ geom_jitter()+ scale_color_manual(values=colors_of_strains)+ facet_wrap(~subsp, scales = "free")

```


```{r tot.skel.table, echo=FALSE, eval=FALSE}
#move to setup file
#this is redundant, setup data made -- mouse.total.skel
#make sure the table is clean -- no 5

MLH1.merge.Skel$nMLH1.foci <- as.numeric(MLH1.merge.Skel$nMLH1.foci)

totSC.mouse.av.table <- ddply(.data=MLH1.merge.Skel, 
                 .(mouse),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 
                 mean.MLH1 = mean(nMLH1.foci, na.rm = TRUE),
                 var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                 var.skel = var(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)

totSC.mouse.av.table <- add_strain(totSC.mouse.av.table)
totSC.mouse.av.table <- add_sex(totSC.mouse.av.table)
totSC.mouse.av.table <- add_category(totSC.mouse.av.table)
totSC.mouse.av.table <- add_subsp(totSC.mouse.av.table)
totSC.mouse.av.table <- add_species(totSC.mouse.av.table)

#unorder the factors
totSC.mouse.av.table$subsp <- factor(totSC.mouse.av.table$subsp, ordered = FALSE)
totSC.mouse.av.table$sex <- factor(totSC.mouse.av.table$sex, ordered = FALSE)
totSC.mouse.av.table$strain <- factor(totSC.mouse.av.table$strain, ordered = FALSE)
totSC.mouse.av.table$species <- factor(totSC.mouse.av.table$species, ordered = FALSE)

#add rec group
totSC.mouse.av.table$Rec.group <- ifelse(grepl("PWD male", totSC.mouse.av.table$category), 1, 
                              ifelse(grepl("MSM male", totSC.mouse.av.table$category), 1,
                                ifelse(grepl("SKIVE male", totSC.mouse.av.table$category), 1, 0)))

OG.totSC.mouse.av.table <- totSC.mouse.av.table

#REMOVE JUVI mice
tot.SC_juvi.male <- totSC.mouse.av.table[totSC.mouse.av.table$mouse  %in% juvi_mice, ]

totSC.mouse.av.table <- totSC.mouse.av.table[! totSC.mouse.av.table$mouse  %in% juvi_mice, ] 

#
totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain!="CAST" & strain !="F1" & strain !="SPIC" & strain !=  "CAROLI" & strain !="SPRET"& strain !="HMI"& strain !="PERC")

```



```{r tot.SC_strain.setup, echo = FALSE, eval=FALSE}

#not sure if this is used

totSC.strain.av.table <- ddply(.data=MLH1.merge.Skel, 
                 .(sex,strain),
                 summarize, 
                 ncells = sum(ncells),
                 nmice = length(unique(mouse)),
                 
                av.MLH1 = mean( mean.MLH1, na.rm = TRUE),
                # var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(mean.skel, na.rm = TRUE),
               # var.skel = var(mean.skel, na.rm = TRUE), #average mouse variance
                 mean.bin =  mean(mean.bin, na.rm = TRUE)
                 
)

totSC.strain.av.table <- add_subsp(totSC.strain.av.table)

```


## total sc models


```{r Q1.total.SC_M1, echo=FALSE}
mouse.total.skel$subsp <- factor(mouse.total.skel$subsp, ordered = FALSE)
mouse.total.skel$sex <- factor(mouse.total.skel$sex, ordered = FALSE)
mouse.total.skel$strain <- factor(mouse.total.skel$strain, ordered = FALSE)
mouse.total.skel$species <- factor(mouse.total.skel$species, ordered = FALSE)

#mouse.total.skel
Q1.lmer_totSC_M1 <- lmer(mean.skel ~ subsp * sex + (1|strain), data= ( mouse.total.skel %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )  )

Q1.lmer_totSC_M1_R.sex <- lmer(mean.skel ~ subsp + (1|strain), data=( mouse.total.skel %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ))

Q1.lmer_totSC_M1_R.subsp <- lmer(mean.skel ~ sex + (1|strain), data=( mouse.total.skel %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )) 

#as.data.frame(round(summary(Q1.lmer_SCLength_1CO_M1)$coefficients, 6))

Q1.lmer_totSC_M1_sex <- anova(Q1.lmer_totSC_M1, Q1.lmer_totSC_M1_R.sex)$`Pr(>Chisq)`[2]
Q1.lmer_totSC_M1_subsp <- anova(Q1.lmer_totSC_M1, Q1.lmer_totSC_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1.lmer_totSC_M1_int <- drop1(Q1.lmer_totSC_M1, test="Chisq")$`Pr(Chi)`[2]
Q1.lmer_totSC_M1_strain <- exactRLRT(Q1.lmer_totSC_M1)$p.value

Q1.lmer_totSC_M1_results <- data.frame(sub.sp = Q1.lmer_totSC_M1_subsp, 
sex.results =  Q1.lmer_totSC_M1_sex, 
               interaction.pval = Q1.lmer_totSC_M1_int,
rand.pval = Q1.lmer_totSC_M1_strain)

```


```{r Q1.glm_totalSC_M2, echo=FALSE, message=FALSE}
#mouse.total.skel

mouse.total.skel$subsp <- factor(mouse.total.skel$subsp, ordered = FALSE)
mouse.total.skel$sex <- factor(mouse.total.skel$sex, ordered = FALSE)
mouse.total.skel$strain <- factor(mouse.total.skel$strain, ordered = FALSE)
mouse.total.skel$species <- factor(mouse.total.skel$species, ordered = FALSE)


Q1.glm_totSC_M2 <- glm(mean.skel ~ subsp*strain * sex, data=  (mouse.total.skel %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )  )

sum.Q1.glm_totSC_M2 <- summary(Q1.glm_totSC_M2)
#sum.Q1.glm_totSC_M2$coefficients[,c(1,4)][8,]

#sex most sig
#subsp

#straing G, LEW
#mol * sex
#G * sex
```


```{r Q1.glm_totalSC_M3, echo=FALSE, message=FALSE}

Q1.glm_totSC_M3 <- glm(mean.skel ~ strain * sex, data=  (mouse.total.skel %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

sum.Q1.glm_totSC_M3 <- summary(Q1.glm_totSC_M3)
#sex most significant, 
#PWD more sig

#G, LEW, MSM, SKIVE, KAZ,  
#G*male, MSM*male

#LOT OF SIGNIFICant strain effects in this model

```


```{r Q1_single.Biv_M1.lmer, echo=FALSE, include=FALSE, eval=FALSE}

#1CO  lmer.Q1_SCLength_M1
Q1.lmer_SCLength_1CO_M1 <- lmer(mean.SC_1CO ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM)
Q1.lmer_SCLength_1CO_M1_R.sex <- lmer(mean.SC_1CO ~ subsp + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE)
Q1.lmer_SCLength_1CO_M1_R.subsp <- lmer(mean.SC_1CO ~ sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 

#as.data.frame(round(summary(Q1.lmer_SCLength_1CO_M1)$coefficients, 6))

Q1.lmer_SCLength.1CO_sex <- anova(Q1.lmer_SCLength_1CO_M1, Q1.lmer_SCLength_1CO_M1_R.sex)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.1CO_subsp <- anova(Q1.lmer_SCLength_1CO_M1, Q1.lmer_SCLength_1CO_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.1CO_int <- drop1(Q1.lmer_SCLength_1CO_M1, test="Chisq")$`Pr(Chi)`[2]
Q1.lmer_SCLength.1CO_strain <- exactRLRT(Q1.lmer_SCLength_1CO_M1)$p.value

Q1.lmer_SCLength.1CO_results <- data.frame(sub.sp = Q1.lmer_SCLength.1CO_subsp, 
sex.results =  Q1.lmer_SCLength.1CO_sex, 
               interaction.pval = Q1.lmer_SCLength.1CO_int,  rand.pval = 
Q1.lmer_SCLength.1CO_strain)


#2CO
Q1.lmer_SCLength_2CO_M1 <- lmer(mean.SC_2CO ~ subsp * sex + (1|strain), data=Mouse.Table_BivData_4MM)
Q1.lmer_SCLength_2CO_M1_R.sex <- lmer(mean.SC_2CO ~ subsp + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 
Q1.lmer_SCLength_2CO_M1_R.subsp <- lmer(mean.SC_2CO ~ sex + (1|strain), data=Mouse.Table_BivData_4MM, REML = TRUE) 

#as.data.frame(round(summary(Q1.lmer_SCLength_2CO_M1)$coefficients, 6))

Q1.lmer_SCLength.2CO_sex <- anova(Q1.lmer_SCLength_2CO_M1, Q1.lmer_SCLength_2CO_M1_R.sex)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.2CO_subsp <- anova(Q1.lmer_SCLength_2CO_M1, Q1.lmer_SCLength_2CO_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1.lmer_SCLength.2CO_int <- drop1(Q1.lmer_SCLength_2CO_M1, test="Chisq")$`Pr(Chi)`[2]
Q1.lmer_SCLength.2CO_strain <- exactRLRT(Q1.lmer_SCLength_2CO_M1)$p.value


Q1.lmer_SCLength.2CO_results <- data.frame(sub.sp = Q1.lmer_SCLength.2CO_subsp, 
sex.results =  Q1.lmer_SCLength.2CO_sex, 
               interaction.pval = Q1.lmer_SCLength.2CO_int,  rand.pval = 
Q1.lmer_SCLength.2CO_strain)
#as.data.frame(round(summary(SCLength_long.biv_MM.M1)$coefficients, 6))
```


```{r Q1.M1_short_biv_lmer, echo=FALSE, warning=FALSE, message=FALSE}

lmer.Q1_SCLength_short_M1 <- lmer(mean_SC ~ subsp * sex + (1|strain), data=Short.biv_mouse_table, REML = TRUE) 

lmer.Q1_SCLength_short_M1_R.sex <- lmer(mean_SC ~ subsp + (1|strain), data=Short.biv_mouse_table, REML = TRUE) 

lmer.Q1_SCLength_short_M1_R.subsp <- lmer(mean_SC ~ sex + (1|strain), data=Short.biv_mouse_table, REML = TRUE) 

Q1lmer.MM_SC_short_interaction  <-drop1(lmer.Q1_SCLength_short_M1, test="Chisq" )$`Pr(Chi)`[2]
Q1lmer.MM_SC_short_sex  <-anova(lmer.Q1_SCLength_short_M1, lmer.Q1_SCLength_short_M1_R.sex)$`Pr(>Chisq)`[2]
Q1lmer.MM_SC_short_subp  <- anova(lmer.Q1_SCLength_short_M1, lmer.Q1_SCLength_short_M1_R.subsp)$`Pr(>Chisq)`[2]
Q1lmer.MM_SC_short_strain  <- exactRLRT(lmer.Q1_SCLength_short_M1)$p.value 

#as.data.frame(round(summary(lmer.SCLength_all_MM.M1)$coefficients, 6))#these Dont return p values for the fixed effects

Q1lmer.MM_SC_short_results <- data.frame(sub.sp = Q1lmer.MM_SC_short_subp, 
sex.results =  Q1lmer.MM_SC_short_sex, 
               interaction.pval = Q1lmer.MM_SC_short_interaction,  rand.pval = 
Q1lmer.MM_SC_short_strain)


#Q1lmer.MM_SC_short_results

```


```{r Q1_SC_short.M1, echo=FALSE}

Short.biv_mouse_table$subsp <- factor(Short.biv_mouse_table$subsp, ordered = FALSE)
Short.biv_mouse_table$sex <- factor(Short.biv_mouse_table$sex, ordered = FALSE)
Short.biv_mouse_table$strain <- factor(Short.biv_mouse_table$strain, ordered = FALSE)
Short.biv_mouse_table$species <- factor(Short.biv_mouse_table$species, ordered = FALSE)

Q1.lmer_short_M1 <- lmer(mean_SC ~ subsp * sex + (1|strain), data= ( Short.biv_mouse_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

Q1.lmer_short_M1_R.sex <- lmer(mean_SC ~ subsp + (1|strain), data= ( Short.biv_mouse_table %>%  filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

Q1.lmer_short_M1_R.subsp <- lmer(mean_SC ~ sex + (1|strain), data= ( Short.biv_mouse_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )  ) 


Q1.lmer_short_M1_sex <- anova(Q1.lmer_short_M1, Q1.lmer_short_M1_R.sex)$`Pr(>Chisq)`[2]

Q1.lmer_short_M1_subsp <- anova(Q1.lmer_short_M1, Q1.lmer_short_M1_R.subsp)$`Pr(>Chisq)`[2]

Q1.lmer_short_M1_int <- drop1(Q1.lmer_short_M1, test="Chisq")$`Pr(Chi)`[2]

Q1.lmer_short_M1_strain <- exactRLRT(Q1.lmer_short_M1)$p.value


Q1.lmer_short_M1_results <- data.frame(sub.sp = Q1.lmer_short_M1_subsp, 
sex.results =  Q1.lmer_short_M1_sex, 
               interaction.pval = Q1.lmer_short_M1_int,
rand.pval = Q1.lmer_short_M1_strain)

```


```{r Q1.SC_short_M2, echo=FALSE, warning=FALSE, message=FALSE}

Short.biv_mouse_table$subsp <- factor(Short.biv_mouse_table$subsp, ordered = FALSE)
Short.biv_mouse_table$sex <- factor(Short.biv_mouse_table$sex, ordered = FALSE)
Short.biv_mouse_table$strain <- factor(Short.biv_mouse_table$strain, ordered = FALSE)

Q1.glm_short.SC_M2 <- glm(mean_SC ~ subsp * strain * sex, data= ( Short.biv_mouse_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

summ.Q1.glm_short.SC_M2 <- summary(Q1.glm_short.SC_M2)
#summ.Q1.glm_short.SC_M2$coefficients[,c(1,4)][8,]

#sex most sig
#skive, slightly sig
```


```{r Q1.glm_short.SC_M3, echo=FALSE, message=FALSE}
Q1.glm_short.SC_M3 <- glm(mean_SC ~ strain * sex, data= ( Short.biv_mouse_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )  )

#summary(Q1.glm_short.SC_M3)
summ.Q1.glm_short.SC_M3 <- summary(Q1.glm_short.SC_M3)

#round(summ.Q1.glm_short.SC_M3$coefficients[,c(1,4)],5)
#sex male very sig -- only sig
#sum.Q1.glm_totSC_M2$coefficients[,c(1,4)][8,]
#SKIVE * male
```


```{r Q1.SC.M2plot, echo=FALSE, include=FALSE, eval=FALSE}

#removing these plots for space

Musc.mouse.av <-  Mouse.Table_BivData_4MM %>%  filter(subsp == "Musc") 
#Musc.all
Q1glm_SCLength_M2.Musc <- glm(mean_SC ~ strain * sex, data = Musc.mouse.av)

#BivData Level
Musc_BivData <-  Curated_BivData %>%  filter(subsp == "Musc") 

Q1.SClength_Musc.BivData_plot <- ggplot( Musc_BivData, aes(y = chromosomeLength, x = strain, color=strain)) + geom_jitter(alpha=.3)+ geom_boxplot(alpha=.3)+scale_color_manual(values=colors_of_strains)+ggtitle("Musc av. SC Length \nBivData Level")+facet_wrap(~sex, scales="free")+ylim(c(30,225))

#BivData Level
Dom_BivData <-  Curated_BivData %>%  filter(subsp == "Dom") 

Q1.SClength_Dom.BivData_plot <- ggplot( Dom_BivData, aes(y = chromosomeLength, x = strain, color=strain)) + geom_jitter(alpha=.3)+ geom_boxplot(alpha=.3)+scale_color_manual(values=colors_of_strains)+ggtitle("Dom SC Lengths \nBivData Level")+facet_wrap(~sex, scales="free")+ylim(c(30,225))

```


```{r Q1.SC.Q12, echo=FALSE}

#make comparisons for the high quality cells
#get Q12 cells from MLH1.merge.Skel
#calq the mouse averages

Total.SC_DF$quality <- as.numeric(Total.SC_DF$quality)

totSC_Q12_mouse.av.table <- ddply(.data= Total.SC_DF %>% filter(quality < 3), 
                 .(mouse),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                # mean.MLH1 = mean( nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)

totSC_Q12_mouse.av.table <- add_strain(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_sex(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_category(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_subsp(totSC_Q12_mouse.av.table)
totSC_Q12_mouse.av.table <- add_species(totSC_Q12_mouse.av.table)

#unorder the factors
totSC_Q12_mouse.av.table$subsp <- factor(totSC_Q12_mouse.av.table$subsp, ordered = FALSE)
totSC_Q12_mouse.av.table$sex <- factor(totSC_Q12_mouse.av.table$sex, ordered = FALSE)
totSC_Q12_mouse.av.table$strain <- factor(totSC_Q12_mouse.av.table$strain, ordered = FALSE)
totSC_Q12_mouse.av.table$species <- factor(totSC_Q12_mouse.av.table$species, ordered = FALSE)

#add rec group
totSC_Q12_mouse.av.table$Rec.group <- ifelse(grepl("PWD male", totSC_Q12_mouse.av.table$category), 1, 
                              ifelse(grepl("MSM male", totSC_Q12_mouse.av.table$category), 1,
                                ifelse(grepl("SKIVE male", totSC_Q12_mouse.av.table$category), 1, 0)))

#REMOVE JUVI mice
tot.SC.Q12_juvi.male <- totSC_Q12_mouse.av.table[totSC_Q12_mouse.av.table$mouse  %in% juvi_mice.list, ]
totSC_Q12_mouse.av.table <- totSC_Q12_mouse.av.table[! totSC_Q12_mouse.av.table$mouse  %in% juvi_mice.list, ] 



totSC_Q12_strain.av.table <- ddply(.data= Total.SC_DF %>% filter(quality < 3), 
                 .(strain, sex),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                # mean.MLH1 = mean( nMLH1.foci, na.rm = TRUE),
                # var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)
#totSC_Q12_strain.av.table <- add_strain(totSC_Q12_strain.av.table)
#totSC_Q12_strain.av.table <- add_sex(totSC_Q12_strain.av.table)
#totSC_Q12_strain.av.table <- add_category(totSC_Q12_strain.av.table)
totSC_Q12_strain.av.table <- add_subsp(totSC_Q12_strain.av.table)
totSC_Q12_strain.av.table <- add_species(totSC_Q12_strain.av.table)

#unorder the factors
totSC_Q12_strain.av.table$subsp <- factor(totSC_Q12_strain.av.table$subsp, ordered = FALSE)
totSC_Q12_strain.av.table$sex <- factor(totSC_Q12_strain.av.table$sex, ordered = FALSE)
totSC_Q12_strain.av.table$strain <- factor(totSC_Q12_strain.av.table$strain, ordered = FALSE)
totSC_Q12_strain.av.table$species <- factor(totSC_Q12_strain.av.table$species, ordered = FALSE)

```


```{r Q1.SC_showQ12Tot.SC, echo=FALSE, warning=FALSE}

Q12.Tot.SC_mouse.av_Dom <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Dom"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Dom"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,2600 ))+ggtitle("Mouse av. Q12 total SC area")

#Q12.Tot.SC_mouse.av_Dom
#Tot.SC_mouse.av_Dom

Q12.Tot.SC_mouse.av_Musc <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Musc"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Musc"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,3000 ))+ggtitle("Mouse av. Q12 total SC area")

#Q12.Tot.SC_mouse.av_Musc
#Tot.SC_mouse.av_Musc

Q12.Tot.SC_mouse.av_Mol <- ggplot(data= totSC_Q12_mouse.av.table %>% filter(subsp == "Mol"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(~sex, scales="free", ncol = 3)+ 
  
  geom_hline(data =totSC_Q12_strain.av.table %>% filter(subsp == "Mol"), aes(yintercept=mean.skel) )+
  
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank())+  ylim(c(1000,3000 ))+ggtitle("Mouse av. Q12 total SC area")
```


```{r Q1.show.SC.length, echo=FALSE, warning=FALSE, eval=FALSE}
#switch the cleanCurated_BivData

#nested boxplots, pooled Bivalents
Q1.SC.length_Nested_boxplots_Dom <- ggplot(cleanCurated_BivData[cleanCurated_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ggtitle("Bivalent SC Lengths by Chrm Class \n Dom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,255))+theme(legend.position="none") 

```


need to save this reduced dataset, Q1.real.short_mouse_table.


# Proportions


```{r chrm_prop_data, echo=FALSE, warning=FALSE}
#shut off eval for now because of wd / path error
#chrm.class.DF = read.csv("~./MLH1repo/data/ChrmClassProportions.csv", header = TRUE)
#chrm.class.DF = read.csv("C:/Users/alpeterson7/Documents/MLH1repo/data/ChrmClassProportions.csv", header = TRUE)

chrm.class.DF = read.csv("~./MLH1repo/data/ChrmClassProportions2.csv", header = TRUE)

#this excel file is ~100 cells (10 per category) where I manually verified the number of chrom classes. (this file can also be used to quantify error for CO counts)

chrm.class.DF$fileName <- (chrm.class.DF$Original.Name)
chrm.class.DF <- add_mouse(chrm.class.DF)
chrm.class.DF <- add_strain(chrm.class.DF)
chrm.class.DF <- add_sex(chrm.class.DF)
chrm.class.DF <- add_category(chrm.class.DF)
#chrm.class.DF <- add_euth_date(meta.data.file2)
#chrm.class.DF <- add_age(meta.data.file2)

#table(chrm.class.DF$category)
#str(chrm.class.DF)

#summarize by category
proportion_stats_category  <- ddply(.data=chrm.class.DF, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                  tot_biv  = sum(biv.sum.check,  na.rm = TRUE),

                 n0CO = sum(n0CO, na.rm = TRUE),
                  n1CO = sum(n1CO,na.rm = TRUE),
                  n2CO = sum(n2CO,na.rm = TRUE),
                  n3CO = sum(n3CO,na.rm = TRUE),
                  n4CO = sum(n4CO,na.rm = TRUE),
                 
                 per0CO = sum(n0CO) / tot_biv,                 
                 per1CO= sum(n1CO)/ tot_biv,
                 per2CO= sum(n2CO)/ tot_biv,
                 per3CO= sum(n3CO)/ tot_biv,
                 per4CO= sum(n4CO)/ tot_biv,
                 
                 mean.MLH1.foci = mean(MLH1.sum.check),
                 mean.MLH1.foci2 = mean(nMLH1.foci),
                 meanQ = mean(quality)

)


#write.table(proportion_stats_category, "~./MLH1repo/prop_category.csv", sep=",", row.names = FALSE)
```

```{r plot.chrm.prop.melt, echo=FALSE, warning=FALSE}

#add subspecies to these values
melt.Chrm.Prop.table = read.csv("~./MLH1repo/data/ChrmClassProportions2_melt.csv", header = TRUE)

#melt.Chrm.Prop.table = read.csv("MLH1repo/data/ChrmClassProportions2_melt.csv", header = TRUE)
melt.Chrm.Prop.table <- melt.Chrm.Prop.table[c(1:5)]

#add the subsps
melt.Chrm.Prop.table$strain<- factor(melt.Chrm.Prop.table$strain, levels =c("LEW",
                      "WSB","G", "TOM","AST","KAZ", "SKIVE","PWD","MSM", "MOLF"), order=T )

melt.Chrm.Prop.table <- with(melt.Chrm.Prop.table, melt.Chrm.Prop.table[order(strain),])

chrm.class.barplot <- ggplot(data = melt.Chrm.Prop.table, aes(y = value, x = strain, fill=as.factor(type)) ) + geom_col(position = "dodge")+facet_grid(sex~strain, scales = "free")+ggtitle("Chrm Proportions from Hand Measured Data")+ylim(c(0,1))+theme(legend.position="none")

#need a second DF / the first df
#+ annotate() text 
#annotate()text

#proportion_stats_category,  tot_biv, ncells
#add number of cells and bivalents in the corner

#chrm.class.barplot
```


```{r test.Chrm.Prop, echo=FALSE, eval=TRUE, warning=FALSE}

#prop.test(x, y)  x number of successes, y total  
#strain sums of n
#look up continuity correction

#mouse.level.BivData_table <-- has more male strains
#Mouse.Table_BivData_4MM <- only sex matched strains

#perform test across strain 
#removed all lines with no hand.foci.count entry
Chrm.prop_strain_table <- ddply(mouse.level.BivData_table, c("strain","sex"), summarise,
                  
                  nbiv = sum(tot.biv ),              
                 n0CO = sum(n0CO ),
                  n1CO = sum(n1CO ),
                 n2CO = sum(n2CO ),
                  n3CO = sum(n3CO ),
                 n4CO = sum(n4CO )
                          )

Chrm.prop_strain_table <- add_subsp(Chrm.prop_strain_table)

for(g in 1:length(Chrm.prop_strain_table$nbiv)){
  
  Chrm.prop_strain_table$sum2[g] <- sum(c(Chrm.prop_strain_table$n0CO[g],
                                     Chrm.prop_strain_table$n1CO[g],
                                     Chrm.prop_strain_table$n2CO[g],
                                     Chrm.prop_strain_table$n3CO[g] ))  
}

Chrm.prop_strain_table$dcheck <- Chrm.prop_strain_table$nbiv - Chrm.prop_strain_table$sum2
#there are still some wacky entries -- but much fewer than before

chrm.prop.strain.female <-  Chrm.prop_strain_table %>%  filter(sex == "female")

female.0CO.prop.test <- prop.test(chrm.prop.strain.female$n0CO, chrm.prop.strain.female$sum2 )
female.1CO.prop.test <- prop.test(chrm.prop.strain.female$n1CO, chrm.prop.strain.female$sum2 )
female.2CO.prop.test <- prop.test(chrm.prop.strain.female$n2CO, chrm.prop.strain.female$sum2 )
#the pvalues for 0 are not sig dif
#the p values for 1 and 2CO are sig diff

#seperate by subsp
chrm.prop.female.dom <-  chrm.prop.strain.female %>%  filter(subsp == "Dom")
chrm.prop.female.musc <-  chrm.prop.strain.female %>%  filter(subsp == "Musc")
chrm.prop.female.mol <-  chrm.prop.strain.female %>%  filter(subsp == "Mol")

Dom_female.0CO.prop.test <- prop.test(chrm.prop.female.dom$n0CO, chrm.prop.female.dom$sum2 )
Dom_female.1CO.prop.test <- prop.test(chrm.prop.female.dom$n1CO, chrm.prop.female.dom$sum2 )
Dom_female.2CO.prop.test <- prop.test(chrm.prop.female.dom$n2CO, chrm.prop.female.dom$sum2 )
Dom_female.3CO.prop.test <- prop.test(chrm.prop.female.dom$n3CO, chrm.prop.female.dom$sum2 )
#WSB has fewer 2COs than other 3 strains

Musc_female.0CO.prop.test <- prop.test(chrm.prop.female.musc$n0CO, chrm.prop.female.musc$sum2 )
Musc_female.1CO.prop.test <- prop.test(chrm.prop.female.musc$n1CO, chrm.prop.female.musc$sum2 )
Musc_female.2CO.prop.test <- prop.test(chrm.prop.female.musc$n2CO, chrm.prop.female.musc$sum2 )
#KAZ has slightly more 1CO than the other two


#high.female_G.LEW.
chrm.prop.female.high <-  chrm.prop.strain.female %>%  filter(strain == "G" | strain == "LEW")

high_female.0CO.prop.test <- prop.test(chrm.prop.female.high$n0CO, chrm.prop.female.high$sum2 )
high_female.1CO.prop.test <- prop.test(chrm.prop.female.high$n1CO, chrm.prop.female.high$sum2 )
high_female.2CO.prop.test <- prop.test(chrm.prop.female.high$n2CO, chrm.prop.female.high$sum2 )


#Low.female.G.LEW.
chrm.prop.female.low <-  chrm.prop.strain.female %>%  filter(strain != "G" | strain != "LEW")

low_female.0CO.prop.test <- prop.test(chrm.prop.female.low$n0CO, chrm.prop.female.low$sum2 )
low_female.1CO.prop.test <- prop.test(chrm.prop.female.low$n1CO, chrm.prop.female.low$sum2 )
low_female.2CO.prop.test <- prop.test(chrm.prop.female.low$n2CO, chrm.prop.female.low$sum2 )

#all females
chrm.prop.strain.male <-  Chrm.prop_strain_table %>%  filter(sex == "male")
male.0CO.prop.test <- prop.test(chrm.prop.strain.male$n0CO, chrm.prop.strain.male$sum2 )

male.1CO.prop.test <- prop.test(chrm.prop.strain.male$n1CO, chrm.prop.strain.male$sum2 )
male.2CO.prop.test <- prop.test(chrm.prop.strain.male$n2CO, chrm.prop.strain.male$sum2 )
#the pvals for these 3 class are sig dif

#seperate by subsp
chrm.prop.male.dom <-  chrm.prop.strain.male %>%  filter(subsp == "Dom")
chrm.prop.male.musc <-  chrm.prop.strain.male %>%  filter(subsp == "Musc")
chrm.prop.male.mol <-  chrm.prop.strain.male %>%  filter(subsp == "Mol")

Dom_male.0CO.prop.test <- prop.test(chrm.prop.male.dom$n0CO, chrm.prop.male.dom$nbiv )
Dom_male.1CO.prop.test <- prop.test(chrm.prop.male.dom$n1CO, chrm.prop.male.dom$nbiv )
Dom_male.2CO.prop.test <- prop.test(chrm.prop.male.dom$n2CO, chrm.prop.male.dom$nbiv )
#non of the Dom proportions are different

Musc_male.0CO.prop.test <- prop.test(chrm.prop.male.musc$n0CO, chrm.prop.male.musc$nbiv )
Musc_male.1CO.prop.test <- prop.test(chrm.prop.male.musc$n1CO, chrm.prop.male.musc$nbiv )
Musc_male.2CO.prop.test <- prop.test(chrm.prop.male.musc$n2CO, chrm.prop.male.musc$nbiv )
#all v different

Mol_male.0CO.prop.test <- prop.test(chrm.prop.male.mol$n0CO, chrm.prop.male.mol$nbiv )
Mol_male.1CO.prop.test <- prop.test(chrm.prop.male.mol$n1CO, chrm.prop.male.mol$nbiv )
Mol_male.2CO.prop.test <- prop.test(chrm.prop.male.mol$n2CO, chrm.prop.male.mol$nbiv )


#high vs low
chrm.prop.strain.male$Rec.group <- ifelse(grepl("PWD", chrm.prop.strain.male$strain), 1, 
                              ifelse(grepl("MSM", chrm.prop.strain.male$strain), 1,
                                 ifelse(grepl("SKIVE", chrm.prop.strain.male$strain), 1, 0)))

chrm.prop.male.low <-  chrm.prop.strain.male %>%  filter(Rec.group == 0)
chrm.prop.male.low2 <-  chrm.prop.strain.male  %>%  filter(Rec.group == 0 | strain == "SKIVE") #cool this worked


chrm.prop.male.high2 <-  chrm.prop.strain.male %>%  filter(Rec.group == 1) %>%  filter(strain != "SKIVE")
chrm.prop.male.high1 <-  chrm.prop.strain.male %>%  filter(Rec.group == 1)


Low_male.0CO.prop.test <- prop.test(chrm.prop.male.low$n0CO, chrm.prop.male.low$nbiv )
Low_male.1CO.prop.test <- prop.test(chrm.prop.male.low$n1CO, chrm.prop.male.low$nbiv )
Low_male.2CO.prop.test <- prop.test(chrm.prop.male.low$n2CO, chrm.prop.male.low$nbiv )
#the low strains do vary slightly in their 1CO and 2CO proportions

#includes SKIVE
Low2_male.0CO.prop.test <- prop.test(chrm.prop.male.low2$n0CO, chrm.prop.male.low2$nbiv )
Low2_male.1CO.prop.test <- prop.test(chrm.prop.male.low2$n1CO, chrm.prop.male.low2$nbiv )
Low2_male.2CO.prop.test <- prop.test(chrm.prop.male.low2$n2CO, chrm.prop.male.low2$nbiv )
#all very sig p values


High2_male.0CO.prop.test <-prop.test(chrm.prop.male.high2$n0CO,chrm.prop.male.high2$nbiv )
High2_male.1CO.prop.test <- prop.test(chrm.prop.male.high2$n1CO,chrm.prop.male.high2$nbiv )
High2_male.2CO.prop.test <- prop.test(chrm.prop.male.high2$n2CO,chrm.prop.male.high2$nbiv )
#these proportions are v different

#no SKIVE
High1_male.0CO.prop.test <- prop.test(chrm.prop.male.high1$n0CO, chrm.prop.male.high1$nbiv )
High1_male.1CO.prop.test <- prop.test(chrm.prop.male.high1$n1CO, chrm.prop.male.high1$nbiv )
High1_male.2CO.prop.test <- prop.test(chrm.prop.male.high1$n2CO, chrm.prop.male.high1$nbiv )
#MSM and PWD only slightly sig dif 2CO

#MSM-MOLF
MSM.MOLF.0CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n0CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  )

MSM.MOLF.1CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n1CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  )

MSM.MOLF.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter(subsp == "Mol") )$n2CO, (chrm.prop.strain.male %>% filter(subsp == "Mol"))$nbiv  ) 
 
#PWD-KAZ
PWD.KAZ.0CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n0CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

PWD.KAZ.1CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n1CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

PWD.KAZ.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "KAZ") )$n2CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "KAZ") )$nbiv )

#PWD-MSM
PWD.MSM.2CO.prop.test <- prop.test( (chrm.prop.strain.male %>% filter( (strain == "PWD") | strain == "MSM") )$n2CO, (chrm.prop.strain.male %>% filter(strain == "PWD" | strain == "MSM") )$nbiv )


```


# Q1 CO pos


```{r CO.positions.figs, echo=FALSE, include=FALSE, warning=FALSE}
#main figure of density plots,
MELT_Curated_BivData <- add_sex(MELT_Curated_BivData)
MELT_Curated_BivData <- add_strain(MELT_Curated_BivData)
MELT_Curated_BivData <- add_subsp(MELT_Curated_BivData)#subsp, needs strain

#clean up all the non 1 to 4 hand.foci counts
MELT_Curated_BivData.1CO <- MELT_Curated_BivData[MELT_Curated_BivData$hand.foci.count < 2, ]

MELT_Curated_BivData.1CO <- MELT_Curated_BivData.1CO[MELT_Curated_BivData.1CO$PER.Foci.Pos < 1.01, ]

# remove the na's
MELT_Curated_BivData.1CO <- MELT_Curated_BivData.1CO[!(is.na(MELT_Curated_BivData.1CO$hand.foci.count) | MELT_Curated_BivData.1CO$hand.foci.count==""), ]

CO.Pos.density_1CO <- ggplot(MELT_Curated_BivData.1CO, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(sex~subsp, ncol=2)+ggtitle("Normalized 1CO Foci Positions")+scale_fill_manual(values=colors_of_strains)

#category specific plots, don't run for now.
Dom.female_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "female") & (MELT_Curated_BivData$subsp == "Dom") ), ]
CO.Pos.density_Dom_female <- ggplot(Dom.female_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Dom female \nNormalized Foci Positions")
#Musc male
Musc.male_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "male") & (MELT_Curated_BivData$subsp == "Musc") ), ]

CO.Pos.density_Musc_male <- ggplot(Musc.male_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Musc male \nNormalized Foci Positions")
#Dom male
Dom.male_MELT_curBivData <- MELT_Curated_BivData[ ((MELT_Curated_BivData$sex == "male") & (MELT_Curated_BivData$subsp == "Dom") ), ]

CO.Pos.density_Dom_male <- ggplot(Dom.male_MELT_curBivData, aes(x=PER.Foci.Pos, fill=strain) ) + geom_density(alpha=.2) + facet_wrap(~hand.foci.count, ncol=1)+ggtitle("Dom male \nNormalized Foci Positions")
```


```{r Q1_1COpos.t.test, echo=FALSE}
#testing,
#norm.first.foci.pos  - mean nrm.F1.pos for just 1CO bivalents

Q1_1CO.pos_t.test.FULL <- t.test( ( mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "male") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$norm.first.foci.pos,
(mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "female") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$norm.first.foci.pos ) #<2e-16


#WSB
Q1_1CO.pos_t.test.WSB <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "WSB") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "WSB") )$norm.first.foci.pos)

#G
Q1_1CO.pos_t.test.G <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "G") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "G") )$norm.first.foci.pos)
#LEW
Q1_1CO.pos_t.test.LEW <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "LEW") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "LEW") )$norm.first.foci.pos)

#PWD
Q1_1CO.pos_t.test.PWD <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "PWD") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "PWD") )$norm.first.foci.pos)

#KAZ
Q1_1CO.pos_t.test.KAZ <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "KAZ") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "KAZ") )$norm.first.foci.pos)

#SKIVE
Q1_1CO.pos_t.test.SKIVE <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "SKIVE") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "SKIVE") )$norm.first.foci.pos)


#MSM
Q1_1CO.pos_t.test.MSM <- t.test((mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain == "MSM") )$norm.first.foci.pos,
                           (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain == "MSM") )$norm.first.foci.pos)

```


```{r Q1.CO1pos_lmer.M1, echo=FALSE, message=FALSE}

lmer.Q1.nrm1CO_M1 <- lmer(norm.first.foci.pos ~ subsp * sex + (1|strain), 
                          data= ( mouse.level.BivData_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )


lmer.Q1.nrm1CO_M1reduce.sex <- lmer( norm.first.foci.pos ~ subsp  +(1|strain), data=( mouse.level.BivData_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

lmer.Q1.nrm1CO_M1reduce.subp <- lmer( norm.first.foci.pos ~ sex  +(1|strain), data=( mouse.level.BivData_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

lmer.Q1.nrm1CO_M1.sex <-  anova(lmer.Q1.nrm1CO_M1, lmer.Q1.nrm1CO_M1reduce.sex)$`Pr(>Chisq)`[2]
lmer.Q1.nrm1CO_M1.subp <-  anova(lmer.Q1.nrm1CO_M1, lmer.Q1.nrm1CO_M1reduce.subp)$`Pr(>Chisq)`[2]

lmer.Q1.nrm1CO_M1_interaction <- drop1(lmer.Q1.nrm1CO_M1, test="Chisq" )$`Pr(Chi)`[2]
lmer.Q1.nrm1CO_M1_strain <- exactRLRT(lmer.Q1.nrm1CO_M1)$p.value 

lmer.Q1.nrm1CO_M1_results <- data.frame(sub.sp = lmer.Q1.nrm1CO_M1.subp, 
sex.results = lmer.Q1.nrm1CO_M1.sex , 
               interaction.pval = lmer.Q1.nrm1CO_M1_interaction,  rand.pval = lmer.Q1.nrm1CO_M1_strain)

#lmer.Q1.nrm1CO_M1_results

#write.table(round(summry.glm.Q1_IFD.PER.M2$coefficients, 6), "~./MLH1repo/summry.glm.Q1_IFD.PER.M2.csv", sep=",",row.names = TRUE)

```


```{r Q1.CO1pos_glm.M2, echo=FALSE}

#in case factors aren't ordered
mouse.level.BivData_table$subsp <- factor(mouse.level.BivData_table$subsp, ordered = FALSE)
mouse.level.BivData_table$sex <- factor(mouse.level.BivData_table$sex, ordered = FALSE)
mouse.level.BivData_table$strain <- factor(mouse.level.BivData_table$strain, ordered = FALSE)

Q1.glm_F1pos_M2 <- glm(norm.first.foci.pos ~ subsp * strain * sex, data=( mouse.level.BivData_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ) )

#summary(Q1.glm_F1pos_M2)

summry.Q1.glm_F1pos_M2 <- summary(Q1.glm_F1pos_M2)
#round(summry.Q1.glm_F1pos_M2$coefficients[,c(1,4)],5)

#write.table(round(summry.Q1.glm_nrmF1pos_M2$coefficients,5), "~./MLH1repo/summry.Q1.glm_nrmF1pos_M2.csv", #sep=",",row.names = TRUE)


#DOM
Q1.glm_nrmF1pos_M2_Dom <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q1.glm_nrmF1pos_M2_Dom)

#MUSC
Q1.glm_nrmF1pos_M2_Musc <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q1.glm_nrmF1pos_M2_Musc)

#MOL
Q1.glm_nrmF1pos_M2_Mol <- glm(norm.first.foci.pos ~ strain * sex, data=Mouse.Table_BivData_4MM[Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q1.glm_nrmF1pos_M2_Mol)

```


```{r Q1.CO1pos_glm.M3, echo=FALSE, eval=TRUE}

Q1.glm_1CO.pos_M3 <- glm(norm.first.foci.pos ~ strain * sex, data=( mouse.level.BivData_table %>% filter(species == "M.musculus") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) ))

#summary(Q1.glm_1CO.pos_M3)

summry.Q1.glm_1CO.pos_M3 <- summary(Q1.glm_1CO.pos_M3)
#round(summry.Q1.glm_1CO.pos_M3$coefficients[,c(1,4)],5)
#write.table(round(summry.Q1.glm_nrmF1pos_M3$coefficients,5), "~./MLH1repo/summry.Q1.glm_nrmF1pos_M3.csv", sep=",",row.names = TRUE)

```



# Q1 IFD


```{r Q1.IFD_Ttests_ABS, echo=FALSE, warning=FALSE, message=FALSE}
#below are calq just from 2COs, have no fear
#mean_IFD.2CO_ABS
#mean_IFD.2CO_PER

#FULL all strains
Q1.IFD.ABS_FULL_t.test <- t.test(   (mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "male") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean_IFD.2CO_ABS,
                                    
(mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "female") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean_IFD.2CO_ABS    ) #0.03 (female larger)
#this comparison should be within subspecies due to strain, SC differences


#WSB
Q1.IFD.raw_t.test_WSB <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="WSB" ))$mean_IFD.2CO_ABS,
                                (mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="WSB"))$mean_IFD.2CO_ABS)

#LEW
Q1.IFD.raw_t.test_LEW <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="LEW" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="LEW"))$mean_IFD.2CO_ABS)

#G
Q1.IFD.raw_t.test_G <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="G" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="G"))$mean_IFD.2CO_ABS)

#PWD
Q1.IFD.raw_t.test_PWD <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="PWD" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="PWD"))$mean_IFD.2CO_ABS)

#KAZ - low KAZ male curation (3 mice)
Q1.IFD.raw_t.test_KAZ <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="KAZ"))$mean_IFD.2CO_ABS)

#SKIVE
Q1.IFD.raw_t.test_SKIVE <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="SKIVE" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="SKIVE"))$mean_IFD.2CO_ABS)

#MSM - 3 male 4 female measures
#only 3 MSM males
#could be missing MSM measures, (4 females, 3 males)
Q1.IFD.raw_t.test_MSM <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="MSM" ))$mean_IFD.2CO_ABS,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="MSM"))$mean_IFD.2CO_ABS)

#FULL all strains
Q1.IFD.raw_all <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain !=  "CZECH" ) %>% filter(strain !=  "MOLF" )  %>%  filter(strain !="G") %>% filter(species == "M.musculus") )$mean_IFD.2CO_ABS,
                           
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>%  filter(strain !="G")%>% filter(species == "M.musculus") )$mean_IFD.2CO_ABS)
#p-value = 0.3
```


```{r Q1.IFD_ttest_PER, echo=FALSE}

Q1.IFD.PER_FULL_t.test <- t.test(   (mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "male") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean_IFD.2CO_PER,
                                    
(mouse.level.BivData_table %>% filter(species == "M.musculus")  %>%  filter(sex == "female") %>% filter(strain !=  "CAST" ) %>% filter(strain !=  "MOLF" ) %>% filter(strain !=  "HMI" ) %>% filter(strain !=  "AST" ) %>% filter(strain !=  "PERC" ) %>% filter(strain !=  "CZECH" ) )$mean_IFD.2CO_PER    ) #p-value = 1e-10

#WSB
Q1.IFD.PER_t.test_WSB <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="WSB" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="WSB"))$mean_IFD.2CO_PER )#p-value = 0.03

#LEW
Q1.IFD.PER_t.test_LEW <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="LEW"))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="LEW"))$mean_IFD.2CO_PER)#p-value = 7e-05

#G
Q1.IFD.PER_t.test_G <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="G" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="G"))$mean_IFD.2CO_PER )#p-value = 0.03

#PWD
Q1.IFD.PER_t.test_PWD <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="PWD" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="PWD"))$mean_IFD.2CO_PER)#p-value = 9e-04

#KAZ
Q1.IFD.PER_t.test_KAZ <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="KAZ" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="KAZ"))$mean_IFD.2CO_PER)#p-value = 0.3

#MSM
Q1.IFD.PER_t.test_MSM <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="MSM" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="MSM"))$mean_IFD.2CO_PER)

#SKIVE
Q1.IFD.PER_t.test_SKIVE <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(strain =="SKIVE" ))$mean_IFD.2CO_PER,
                                ( mouse.level.BivData_table %>% filter(sex == "female") %>% filter(strain =="SKIVE"))$mean_IFD.2CO_PER)

```


```{r Q1.IFD.lmer.M1, echo=FALSE, message=FALSE, warning=FALSE}

#M1_IFD_2CO_ABS
lmer.IFD.ABS_MM.M1 <- lmer(mean_IFD.2CO_ABS ~ subsp * sex + (1|strain), data= ( mouse.level.BivData_table %>% filter(strain != "CZECH") )) 
lmer.IFD.ABS_MM.M1.reduce.sex <- lmer( mean_IFD.2CO_ABS ~ subsp  +(1|strain), data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ) )
lmer.IFD.ABS_MM.M1.reduce.subp <- lmer( mean_IFD.2CO_ABS ~ sex  +(1|strain), data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ) )

ABS.IFD_Q1.M1_sex  <- anova(lmer.IFD.ABS_MM.M1, lmer.IFD.ABS_MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
ABS.IFD_Q1.M1_subsp  <- anova(lmer.IFD.ABS_MM.M1, lmer.IFD.ABS_MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
ABS.IFD_Q1.M1_intr  <- drop1(lmer.IFD.ABS_MM.M1, test="Chisq" )$`Pr(Chi)`[2]
ABS.IFD_Q1.M1_strain  <- exactRLRT(lmer.IFD.ABS_MM.M1)$p.value

Q1.IFD.ABS_M1_lmer.results <- data.frame(sub.sp = ABS.IFD_Q1.M1_subsp, sex.results =  ABS.IFD_Q1.M1_sex, 
               interaction.pval = ABS.IFD_Q1.M1_intr,  rand.pval = ABS.IFD_Q1.M1_strain)

#M1_IFD_2CO
lmer.IFD.PER_MM.M1 <- lmer(mean_IFD.2CO_PER ~ subsp * sex + (1|strain), data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ) ) 
lmer.IFD.PER_MM.M1.reduce.sex <- lmer( mean_IFD.2CO_PER ~ subsp  +(1|strain), data=( mouse.level.BivData_table %>% filter(strain != "CZECH") )  )
lmer.IFD.PER_MM.M1.reduce.subp <- lmer( mean_IFD.2CO_PER ~ sex  +(1|strain), data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ) )

sex.pval <- anova(lmer.IFD.PER_MM.M1, lmer.IFD.PER_MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
subsp.pval <- anova(lmer.IFD.PER_MM.M1, lmer.IFD.PER_MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
subsp.sex.pval <- drop1(lmer.IFD.PER_MM.M1, test="Chisq" )$`Pr(Chi)`[2]
strain.pval <- exactRLRT(lmer.IFD.PER_MM.M1)$p.value

Q1.IFD.PER_M1_lmer.results <- data.frame(sub.sp = subsp.pval, sex.results =  sex.pval, 
               interaction.pval = subsp.sex.pval,  rand.pval = strain.pval)

```

```{r Q1.IFD_glm.M2, echo=FALSE, warning=FALSE, message=FALSE}
#mouse.avs_4MM -- is also the bivbased mouse average table 
#Mouse.Table_BivData_4MM #this one is the HetC table (all the Curated BivData)

glm.Q1_IFD.ABS.M2  <- glm(mean_IFD.2CO_ABS ~ subsp * sex * strain, data= ( mouse.level.BivData_table %>% filter(strain != "CZECH") )  )
summry.glm.Q1_IFD.ABS.M2 <- summary(glm.Q1_IFD.ABS.M2)

#write.table(round(summry.glm.Q1_IFD.ABS.M2$coefficients,5), "~./MLH1repo/summry.glm.Q1_IFD.ABS.M2.csv", sep=",",row.names = TRUE)

#PER
glm.Q1_IFD.PER.M2 <- glm(mean_IFD.2CO_PER ~ subsp * sex * strain, data= ( mouse.level.BivData_table %>% filter(strain != "CZECH") ) )
summry.glm.Q1_IFD.PER.M2 <- summary(glm.Q1_IFD.PER.M2)

```



```{r Q1.IFD_glmM3, echo=FALSE, warning=FALSE, message=FALSE}

glm.Q1_IFD.ABS.M3  <- glm(mean_IFD.2CO_ABS ~  sex * strain, data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ))
summry.glm.Q1_IFD.ABS.M3 <- summary(glm.Q1_IFD.ABS.M3)

#PER
glm.Q1_IFD.PER.M3  <- glm(mean_IFD.2CO_PER ~ sex * strain, data=( mouse.level.BivData_table %>% filter(strain != "CZECH") ) )
summry.glm.Q1_IFD.PER.M3 <- summary(glm.Q1_IFD.PER.M3)
#round(summry.glm.Q1_IFD.PER.M3$coefficients[,c(1,4)],5)

#write.table(round(summry.glm.Q1_IFD.PER.M3$coefficients,6), #"~./MLH1repo/summry.glm.Q1_IFD.PER.M3.csv", sep=",",row.names = TRUE)
```


```{r Q1.IFD_glm.M4.M5_female, echo=FALSE}

glm.Q1_IFD.ABS.M4.female  <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= (mouse.level.BivData_table %>% filter(sex == "female") ) )
summry.glm.Q1_IFD.ABS.M4.female  <- summary(glm.Q1_IFD.ABS.M4.female)


glm.Q1_IFD.PER.M4.female  <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= (mouse.level.BivData_table %>% filter(sex == "female") ) )
summry.glm.Q1_IFD.PER.M4.female  <- summary(glm.Q1_IFD.PER.M4.female)

#M5
glm.Q1_IFD.ABS.M5.female  <- glm(mean_IFD.2CO_PER ~  strain, data= (mouse.level.BivData_table %>% filter(sex == "female") ) )
summry.glm.Q1_IFD.ABS.M5.female  <- summary(glm.Q1_IFD.ABS.M4.female)


glm.Q1_IFD.PER.M5.female  <- glm(mean_IFD.2CO_PER ~  strain, data= (mouse.level.BivData_table %>% filter(sex == "female") ) )
summry.glm.Q1_IFD.PER.M5.female  <- summary(glm.Q1_IFD.PER.M5.female)

```


```{r Q1.IFD_glm.M4.M5_male, echo=FALSE}

glm.Q1_IFD.ABS.M4.male  <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= (mouse.level.BivData_table %>% filter(sex == "male") ) )
summry.glm.Q1_IFD.ABS.M4.male  <- summary(glm.Q1_IFD.ABS.M4.male)


glm.Q1_IFD.PER.M4.male  <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= (mouse.level.BivData_table %>% filter(sex == "male") ) )
summry.glm.Q1_IFD.PER.M4.male  <- summary(glm.Q1_IFD.PER.M4.male)


#M5
glm.Q1_IFD.ABS.M5.male  <- glm(mean_IFD.2CO_PER ~  strain, data= (mouse.level.BivData_table %>% filter(sex == "male") ) )
summry.glm.Q1_IFD.ABS.M5.male  <- summary(glm.Q1_IFD.ABS.M4.male)


glm.Q1_IFD.PER.M5.male  <- glm(mean_IFD.2CO_PER ~  strain, data= (mouse.level.BivData_table %>% filter(sex == "male") ) )
summry.glm.Q1_IFD.PER.M5.male  <- summary(glm.Q1_IFD.PER.M5.male)


```



```{r Q1.show.IFD.scatter, echo=FALSE, eval=FALSE, message=FALSE}

#these are the scatter plots

nrm.IFD_KAZ_long <- ggplot( (Q1.IFD.long %>% filter(strain =="KAZ" ) ) , aes(y = meanIFD2CO_norm, x= sex,color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")

nrm.IFD_KAZ_BIV.long <- ggplot( (real.long.bivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2")  ) , aes(y = IFD1_PER, x= sex, color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")
#11jan18_KAZ_m3, 26jan18_11jan18_KAZ_m3_sp1_8_rev_19
#looked up image, measures confirmed 

####
nrm.IFD_KAZ_short <- ggplot( (Q1.IFD.short %>% filter(strain =="KAZ" ) ) , aes(y = meanIFD2CO_norm, x= sex,color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")

nrm.IFD_KAZ_BIV.short <- ggplot( (real.short.bivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2")  ) , aes(y = IFD1_PER, x= sex, color=mouse))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")
#21may18_KAZ_m2 -- seems like it might be an outlier
#5jun18_21may18_KAZ_m2_sp1_19.2_rev_16
#second foci slightly smaller, kinda fainter -- but also much brighter than background

#check all KAZ males

nrm.IFD_KAZ_BIV.data <- ggplot( (cleanCurated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_KAZ.female_BIV.data <- ggplot( (cleanCurated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_KAZ.female_BIV.data


nrm.IFD_PWD.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="PWD" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female PWD")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_PWD.female_BIV.data

nrm.IFD_LEW.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_LEW.female_BIV.data

nrm.IFD_G.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="G" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female G")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_G.female_BIV.data

nrm.IFD_WSB.female_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="WSB" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "female")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, female WSB")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))
nrm.IFD_WSB.female_BIV.data    #18nov17_WSB_f2 has continuous ifd range

nrm.IFD_LEW_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MOLF")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))+theme(axis.text.x = element_blank())

raw.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_ABS, x= mouse, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MOLF")+theme(axis.text.x = element_blank())+ylim(c(0, 100))

raw.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_ABS, x= mouse, color=chromosomeLength))+geom_point()+ggtitle("Interfocal Distances, ABS MSM")+theme(axis.text.x = element_blank())+ylim(c(0, 100))



Fby.F.IFD_MOLF_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MOLF" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = Foci1, x=Foci2, color=chromosomeLength))+geom_point()+ggtitle("FOce Pos by Fos Pos MOLF")+facet_wrap(~mouse, scales = "free")+ylim(c(0,75))+xlim(c(0,120))+theme(legend.position="none") 

Fby.F.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = Foci1, x=Foci2, color=chromosomeLength))+geom_point()+ggtitle("Foci Pos by Fos Pos MSM")+facet_wrap(~mouse, scales = "free")+ylim(c(0,75))+xlim(c(0,120))+theme(legend.position="none") 


###look at why KAZ males are weird
nrm.IFD_KAZ_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="KAZ" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male KAZ")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))+theme(axis.text.x = element_blank(), legend.position = "none")


nrm.IFD_LEW_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male LEW")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

#the difference the the Nrm IFD cut off is striking with these plots
nrm.IFD_PWD_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="PWD" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male") ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male PWD")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))


nrm.IFD_MSM_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="MSM" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male GMSM")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_SKIVE_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="SKIVE" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male SKIVE")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))

nrm.IFD_G_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="G" ) %>%  filter(hand.foci.count == "2") %>%  filter(sex == "male")  ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, male G")+facet_wrap(~mouse, scales = "free")+ylim(c(0,1))


nrm.IFD_sex.comp_BIV.data <- ggplot( (Curated_BivData %>% filter(strain =="LEW" ) %>%  filter(hand.foci.count == "2") ) , aes(y = IFD1_PER, x= fileName, color=chromosomeLength))+geom_point()+ggtitle("Normalized Interfocal Distances, ")+facet_wrap(~sex, scales = "free")+ylim(c(0,1))+theme(legend.position="none",axis.text.x = element_blank()) 

```


```{r Q1.IFD_show.IFD_99, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}

#first draft of the IFD comparisons
#make the mouse boxplots -- instead of geom_points

#Only use 2CO bivalents
Curated_BivData.22 <- Curated_BivData[Curated_BivData$hand.foci.count == 2,]
Curated_BivData.22 <- Curated_BivData.22[(!is.na(Curated_BivData.22$hand.foci.count)),]


P1.by.P2_plot <- ggplot(Curated_BivData.22, aes(y = rev(PER_Foci_2), x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized IFD")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none")+xlim(c(0,1))+ylim(c(0,1))

#each point is a 2CO, with the F1 and F2 position 
#based on plot from Dourad et al (Mercier)

P1.by.P2_plot_raw.WSB <- ggplot(Curated_BivData.22 %>% filter(strain == "LEW"),
    aes(y = Foci2, x= Foci1, color=strain))+
  geom_jitter(alpha=.5)+
  ggtitle("Raw IFD WSB")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none") + ylim(c(0,160))+xlim(c(0,160))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )

#trying to move x axis to top
#cowplot might be the easier way -- since kinda diffecult in ggplot
#or ggdraw

P1.by.P2_plot_nrm.PWD.f <- ggplot(Curated_BivData.22 %>% filter(strain == "PWD") %>% filter(sex == "female"),
    aes(y = PER_Foci_2, x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.5)+
#  scale_x_continuous(position = "top") +
  scale_x_continuous(sec.axis = dup_axis(), position = "top")+
    ggtitle("Nrm IFD PWD, female")+scale_color_manual(values=colors_of_strains)+ ylim(c(0,1))+xlim(c(0,1))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )


P1.by.P2_plot_nrm.PWD.male <- ggplot(Curated_BivData.22 %>% filter(strain == "PWD") %>% filter(sex == "male"),
    aes(y = PER_Foci_2, x= PER_Foci_1, color=strain))+
  geom_jitter(alpha=.5)+
#  scale_x_continuous(position = "top") +
  scale_x_continuous(sec.axis = dup_axis(), position = "top")+
    ggtitle("Nrm IFD PWD, male")+scale_color_manual(values=colors_of_strains)+ ylim(c(0,1))+xlim(c(0,1))+ theme(  panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank() )

#boxplots
boxplots_first.IFD.plot_ABS <- ggplot(Curated_BivData.22, aes(y = IFD1_ABS, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, ABS")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+ylim(c(20,160))+theme(legend.position="none")
#order is out of wack, but -- good for now

boxplots_first.IFD.plot_PER <- ggplot(Curated_BivData.22, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Interfocal Distances, PER")+
  scale_color_manual(values=colors_of_strains)+  facet_wrap(sex~subsp, scales = "free")+theme(legend.position="none")+ylim(c(0,1))


first.IFD.plot_ABS <- ggplot(Curated_BivData.22, aes(y = IFD1_ABS, x= strain, color=mouse))+geom_jitter()+ggtitle("Interfocal Distances, ABS")+facet_wrap(sex~subsp, scales = "free")+ylim(c(20,160))+theme(legend.position="none") #+scale_color_manual(values=colors_of_strains)


first.IFD.plot_PER <- ggplot(Curated_BivData.22 %>% filter(chromosomeLength < 150), aes(y = IFD1_PER, x= strain, color=chromosomeLength))+geom_jitter()+ggtitle("Interfocal Distances, PER \ncut off of chrm lengths, 150")+facet_wrap(sex~subsp, scales = "free")+ylim(c(0,1)) 

#+theme(legend.position="none")
```


#Q2 section

#Q2 SC 


```{r Q2.totSC_male.first.comp, echo=FALSE}
#move to Q2
Q1.male.Dom.Musc.t.test <- t.test( ( mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Dom") )$mean.skel,
(mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean.skel)

Q1.male.Dom.Mol.t.test <- t.test( ( mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Dom") )$mean.skel,
(mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean.skel)
```


```{r Q2.SC.short.long.setup, echo=FALSE}

#table(male.long.biv$strain)
#the Long biv dataset is quite unbalance (esp MSM)
male.long.biv <- real.long.bivData %>% filter(sex== "male")

#mouse av for long biv
cell.av.long.biv.table <- ddply(male.long.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
cell.av.long.biv.table <- add_mouse(cell.av.long.biv.table)
cell.av.long.biv.table <- add_strain(cell.av.long.biv.table)
cell.av.long.biv.table <- add_subsp(cell.av.long.biv.table)

cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)


Q2mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                         #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)])
                         )

Q2mouse.av.long.biv.table <- add_strain(Q2mouse.av.long.biv.table)
Q2mouse.av.long.biv.table <- add_subsp(Q2mouse.av.long.biv.table)

Q2mouse.av.long.biv.table$strain <- factor(Q2mouse.av.long.biv.table$strain, ordered = FALSE)
Q2mouse.av.long.biv.table$subsp <- factor(Q2mouse.av.long.biv.table$subsp, ordered = FALSE)

#divide musc males into groups
Q2mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.long.biv.table$strain), 1, 
                                  ifelse(grepl("MSM", Q2mouse.av.long.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.long.biv.table$strain), 1,
                                           0)))


male.short.biv <- real.short.bivData %>% filter(sex== "male")

Q2mouse.av.short.biv.table <- ddply(male.short.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                        #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]
                         ) ) 

Q2mouse.av.short.biv.table <- add_mouse(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_strain(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_subsp(Q2mouse.av.short.biv.table)

Q2mouse.av.short.biv.table$strain <- factor(Q2mouse.av.short.biv.table$strain, ordered = FALSE)
Q2mouse.av.short.biv.table$subsp <- factor(Q2mouse.av.short.biv.table$subsp, ordered = FALSE)

Q2mouse.av.short.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.short.biv.table$strain), 1, 
ifelse(grepl("MSM", Q2mouse.av.short.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.short.biv.table$strain), 1,
                                           0)))

```


```{r Q2.SC.long.biv_plots, echo=FALSE, eval=FALSE}

#REAL.long_mouse_table
#REAL.short_mouse_table

#real.long.bivData
#real.short.bivData

shoo.long.biv <- ggplot( (real.long.bivData %>% filter(sex == "male") ), aes(y=chromosomeLength, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Single Biv \nMale Long Biv SC Lengths")


#cell.avlong.biv <- ggplot(cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Cell av. \nMale Long Biv SC Lengths")


mouse.shoo.long.biv <- ggplot( REAL.long_mouse_table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Mouse av. \nMale Long Biv SC Lengths")

                      
#cell.avlong.biv <- ggplot( cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + #ggtitle("Cell av. \nMale Long Biv SC Lengths")

```


```{r Q2_tot.sc_plot, echo=FALSE, warning=FALSE}

mouse.av_totsc_male <- ggplot(data= mouse.total.skel %>% filter(sex == "male"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(Rec.group~subsp, scales="free")+
  theme(axis.title.x=element_blank(),  axis.text.x=element_blank(), axis.text.y = element_text(size=9), axis.ticks.x=element_blank(), legend.position = c(0.8, 0.2) ) + ylim(c(1200,1850 ) )+labs(y="Mouse Mean Total SC")

mouse.av_totsc_male <- addSmallLegend(mouse.av_totsc_male)

```


```{r Q2.totSC.ttest, echo=FALSE}

#totalSC high and low rec group

Q2tot.sc_t.test_High.Low <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(species == "M.musculus") )$mean.skel,
                (mouse.total.skel %>% filter(species == "M.musculus") %>% filter(sex == "male") %>% filter(Rec.group == "1") )$mean.skel)


#mol -- why is there only 1 MOLF male now?
#there are 3 MOLF males in bivdata
Q2tot.sc_t.test_High.Low_Mol <- t.test( (mouse.total.skel %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.skel,
         (mouse.total.skel %>% filter(sex == "male") %>% filter(Rec.group == "1") %>% filter(subsp == "Mol") )$mean.skel)

#musc
Q2tot.sc_t.test_High.Low_Musc <- t.test((mouse.total.skel %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Musc"))$mean.skel,
                (mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == "1") )$mean.skel)

```


The molf male t-tests don't work because I only have total Sc measures for 1 MOLF male.


```{r Q2.short.long.ttest, echo=FALSE}

#long and short 
#mouse.av.short.biv.table
#Q2mouse.av.short.biv.table

Q2short.biv_t.test_High.Low <- t.test((Q2mouse.av.short.biv.table %>% filter(Rec.group == "0") )$mean.SC,
                                      (Q2mouse.av.short.biv.table %>% filter(Rec.group == "1") )$mean.SC)

#p-value = 0.9

#mouse.av.long.biv.table
Q2long.biv_t.test_High.Low <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") )$mean.SC,
                (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") )$mean.SC)
#p-value = 0.2


#mUSC-short
Q2.short_t.test_High.Low.musc <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-short
#Q2.short_t.test_High.Low.mol <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Mol"))$mean.SC)


#musc-long
Q2.long_t.test_High.Low.musc <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-long
#Q2.long_t.test_High.Low.mol <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp =="Mol"))$mean.SC)

#not enought observations 

```


```{r Q2.short.long.ttest.old, echo=FALSE, eval=FALSE}

#long and short 
#mouse.av.short.biv.table
#Q2mouse.av.short.biv.table
Q2short.biv_t.test_High.Low <- t.test((Q2mouse.av.short.biv.table %>% filter(Rec.group == "0") )$mean.SC,
                                      (Q2mouse.av.short.biv.table %>% filter(Rec.group == "1") )$mean.SC)

#p-value = 0.9

#mouse.av.long.biv.table
Q2long.biv_t.test_High.Low <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") )$mean.SC)
#p-value = 0.2


#mUSC-short
Q2.short_t.test_High.Low.musc <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-short
#Q2.short_t.test_High.Low.mol <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Mol"))$mean.SC)


#musc-long
Q2.long_t.test_High.Low.musc <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-long
#Q2.long_t.test_High.Low.mol <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp =="Mol"))$mean.SC)

#not enought observations 

```


```{r Q2.SC_HvL_allBiv, echo=FALSE}

#High-Low_All-BivData

Q2.all.BIV_t.test_HL <- t.test((Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)


#short
Q2.BIV_short_t.test_HL <- t.test((real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

#long
Q2.BIV_long_t.test_HL <- t.test((real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

```


```{r Q2.SC_HvL_allBiv.old, echo=FALSE, eval=FALSE}

#High-Low_All-BivData

Q2.all.BIV_t.test_HL <- t.test((cleanCurated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (cleanCurated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)


#short
Q2.BIV_short_t.test_HL <- t.test((real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

#long
Q2.BIV_long_t.test_HL <- t.test((real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

```



```{r Q2.SC_across.subsp_tot.SC, echo=FALSE}

#Dom-Musc
Q2.totSC_t.test_DomMusc <- t.test((mouse.total.skel  %>% filter(subsp == "Dom") )$mean.skel,
                          (mouse.total.skel  %>%  filter(subsp == "Musc"))$mean.skel)
#p-value = 0.5

#Dom-Mol
Q2.totSC_t.test_DomMol <- t.test((mouse.total.skel  %>% filter(subsp == "Dom") )$mean.skel,
                          (mouse.total.skel  %>%  filter(subsp == "Mol"))$mean.skel)
#p-value = 0.1
```


```{r Q2.SC_across.subsp_short.long.mus.av, echo=FALSE, eval=FALSE}

#DOM-musc-long
Q2.long_t.test_DomMusc <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.08

#DOM-musc-short
Q2.short_t.test_DomMusc <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.8

#DOM-mol-long
Q2.long_t.test_DomMol <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.4

#DOM-mol-short
Q2.short_t.test_DomMol <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.09

```


```{r Q2.SC_across.subsp_short.long_biv, echo=FALSE}

#DOM-MUSC-ALL
Q2.all.BIV_t.test_DomMusc <- t.test((cleanCurated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (cleanCurated_BivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 4e-13

#DOM-MOL-ALL
Q2.all.BIV_t.test_DomMol <- t.test((cleanCurated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (cleanCurated_BivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 6e-10

#DOM-musc-long
Q2.longBIV_t.test_DomMusc <- t.test((real.long.bivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.long.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.2

#DOM-musc-short
Q2.shortBIV_t.test_DomMusc <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.short.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.8


#DOM-mol-long
Q2.longBIV_t.test_DomMol <- t.test((real.long.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.long.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.4

#DOM-mol-short
Q2.shortBIV_t.test_DomMol <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.short.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.06

```



```{r Q2.SC_across.subsp_short.long_biv.old, echo=FALSE, eval=FALSE}

#DOM-MUSC-ALL
Q2.all.BIV_t.test_DomMusc <- t.test((cleanCurated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (cleanCurated_BivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 4e-13

#DOM-MOL-ALL
Q2.all.BIV_t.test_DomMol <- t.test((cleanCurated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (cleanCurated_BivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 6e-10

#DOM-musc-long
Q2.longBIV_t.test_DomMusc <- t.test((real.long.bivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.long.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.2

#DOM-musc-short
Q2.shortBIV_t.test_DomMusc <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.short.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.8


#DOM-mol-long
Q2.longBIV_t.test_DomMol <- t.test((real.long.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.long.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.4

#DOM-mol-short
Q2.shortBIV_t.test_DomMol <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.short.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.06

```



```{r Q2.totSC.glm, echo=FALSE}

mouse.total.skel$strain <- factor(mouse.total.skel$strain, ordered = F)
mouse.total.skel$subsp <- factor(mouse.total.skel$subsp, ordered = F)


Q2.glm_mus.av_totSC_M4 <- glm(mean.skel ~ subsp * strain, data= mouse.total.skel %>% filter(sex == "male") %>% filter(species == "M.musculus") %>% filter(subsp != "Cast"))
sum.Q2.glm_mus.av_totSC_M4  <- summary(Q2.glm_mus.av_totSC_M4)$coefficients

#sum.Q2.glm_mus.av_totSC_M4$coefficients[,4]   pvalues of all effects
#sum.Q2.glm_mus.av_totSC_M4$coefficients[,1]  coefficients of all effects
#round(sum.Q2.glm_mus.av_totSC_M4$coefficients[,c(1,4)], 6)

#M4.2? (removed subspecies?)

Q2.glm_mus.av_totSC_M4.2 <- glm(mean.skel ~ strain, data= mouse.total.skel %>% filter(sex == "male") %>% filter(species == "M.musculus") %>% filter(subsp != "Cast"))
sum.Q2.glm_mus.av_totSC_M4.2  <- summary(Q2.glm_mus.av_totSC_M4.2)
#round(summary(sum.Q2.glm_mus.av_totSC_M2)$coefficients[,c(1,4)], 6)


#Dom
Q2.glm_mus.av_totSC_M4.2_DOM <- glm(mean.skel ~ strain, data= mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Dom") %>% filter(species == "M.musculus") )
sum.Q2.glm_mus.av_totSC_M4.2_DOM  <- summary(Q2.glm_mus.av_totSC_M4.2_DOM)
#there are significant strain effects in DOM,

#Musc
Q2.glm_mus.av_totSC_M4.2_MUSC <- glm(mean.skel ~ strain, data= mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(species == "M.musculus") )
sum.Q2.glm_mus.av_totSC_M4.2_MUSC  <- summary(Q2.glm_mus.av_totSC_M4.2_MUSC)
#KAZ -- is the only significant effect

#Mol
Q2.glm_mus.av_totSC_M4.2_MOL <- glm(mean.skel ~ strain, data= mouse.total.skel %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )
sum.Q2.glm_mus.av_totSC_M4.2_MOL  <- summary(Q2.glm_mus.av_totSC_M4.2_MOL)

```


```{r Q2.glm.SC.long, echo=FALSE, eval=FALSE}

#this dataset is all males
glmQ2_long.biv_M4 <- glm(mean.SC ~ subsp * strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)


glmQ2_long.biv_M4 <- glm(mean.SC ~ strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)
#round(sum.glmQ2_long.biv_M2$coefficients[,c(1,4)], 6)

glmQ2_long.biv_M4.2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_long.biv_M4.2_DOM <- summary(glmQ2_long.biv_M4.2_DOM)

#MUSC
glmQ2_long.biv_M4.2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_long.biv_M4.2_MUSC <- summary(glmQ2_long.biv_M4.2_MUSC)

#MOL can't be done -- only 1 mouse for each MSM and MOLF
glmQ2_long.biv_M4.2_MOL <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Mol") )  )
sum.glmQ2_long.biv_M4.2_MOL <- summary(glmQ2_long.biv_M4.2_MOL)


#Dom
glm_SC.male_Dom_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Dom",])
#Musc
glm_SC.male_Musc_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Musc",])
#summary(glm_SC.male_Musc_long.biv)
#Mol
glm_SC.male_Mol_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Mol",])

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom")%>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain )

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$strain )

```




```{r Q2.glm.SC.long.old, echo=FALSE, eval=FALSE}

#this dataset is all males
glmQ2_long.biv_M4 <- glm(mean_SC ~ subsp * strain, data= (Long.biv_mouse_table %>% filter(sex == "male") )  )
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)


glmQ2_long.biv_M4 <- glm(mean_SC ~ strain, data= (Long.biv_mouse_table %>% filter(sex == "male") ))
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)
#round(sum.glmQ2_long.biv_M2$coefficients[,c(1,4)], 6)

glmQ2_long.biv_M4.2_DOM <- glm(mean_SC ~ strain, data= (Long.biv_mouse_table %>% filter(sex == "male") %>% filter(subsp == "Dom") )  )

sum.glmQ2_long.biv_M4.2_DOM <- summary(glmQ2_long.biv_M4.2_DOM)

#MUSC
glmQ2_long.biv_M4.2_MUSC <- glm(mean_SC ~ strain, data= 
  ( Long.biv_mouse_table %>% filter(sex == "male") %>% filter(subsp == "Musc"))  )
sum.glmQ2_long.biv_M4.2_MUSC <- summary(glmQ2_long.biv_M4.2_MUSC)

#MOL can't be done -- only 1 mouse for each MSM and MOLF
#glmQ2_long.biv_M4.2_MOL <- glm(mean_SC ~ strain, data=  ( Long.biv_mouse_table %>% filter(sex == "male") %>%  filter(subsp == "Mol") )  )

#sum.glmQ2_long.biv_M4.2_MOL <- summary(glmQ2_long.biv_M4.2_MOL)


#Dom
glm_SC.male_Dom_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Dom",])
#Musc
glm_SC.male_Musc_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Musc",])
#summary(glm_SC.male_Musc_long.biv)
#Mol
glm_SC.male_Mol_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Mol",])

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom")%>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain )

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$strain )
```



```{r Q2.glm.SC.short, echo=FALSE}
#Q2mouse.av.short.biv.table
#mouse.av.short.biv.table

glmQ2_short.biv_M1 <- glm(mean.SC ~ subsp*strain, data= Q2mouse.av.short.biv.table)
sum.glmQ2_short.biv_M1 <- summary(glmQ2_short.biv_M1)

#round(summary(sum.glmQ2_short.biv_M1)$coefficients[,c(1,4)], 6)

glmQ2_short.biv_M2 <- glm(mean.SC ~ strain, data= Q2mouse.av.short.biv.table)
glmQ2_short.biv_M2 <- summary(glmQ2_short.biv_M2)

#DOM
glmQ2_short.biv_M2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_short.biv_M2_DOM <- summary(glmQ2_short.biv_M2_DOM)

#MUSC
glmQ2_short.biv_M2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_short.biv_M2_MUSC <- summary(glmQ2_short.biv_M2_MUSC)

#MOL
#within subspecies

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$strain, p.adj = "bonf", pool.sd = FALSE)

```



```{r Q2.glm.SC.short.old, echo=FALSE, eval=FALSE}
#Q2mouse.av.short.biv.table
#mouse.av.short.biv.table

glmQ2_short.biv_M1 <- glm(mean.SC ~ subsp*strain, data= Q2mouse.av.short.biv.table)
sum.glmQ2_short.biv_M1 <- summary(glmQ2_short.biv_M1)

#round(summary(sum.glmQ2_short.biv_M1)$coefficients[,c(1,4)], 6)

glmQ2_short.biv_M2 <- glm(mean.SC ~ strain, data= Q2mouse.av.short.biv.table)
glmQ2_short.biv_M2 <- summary(glmQ2_short.biv_M2)

#DOM
glmQ2_short.biv_M2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_short.biv_M2_DOM <- summary(glmQ2_short.biv_M2_DOM)

#MUSC
glmQ2_short.biv_M2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_short.biv_M2_MUSC <- summary(glmQ2_short.biv_M2_MUSC)

#MOL
#within subspecies

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$strain, p.adj = "bonf", pool.sd = FALSE)

```



```{r Q2.SC.logreg.chrmClass_BivData, echo=FALSE, include=FALSE, eval=FALSE}

log.SC_male_chrm.class_all <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class_all)


#use the 1CO or 2CO DF
Bivalent_1o2_WSB <-  Bivalent_1o2 %>% filter(strain == "WSB")

log.SC_male_chrm.class.WSB <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_WSB,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class.WSB)


Bivalent_1o2_G <-  Bivalent_1o2 %>% filter(strain == "G") 
log.SC_chrm.class.G <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_G,  family=binomial(link="logit"))
summary(log.SC_chrm.class.G)


Bivalent_1o2_LEW <-  Bivalent_1o2 %>% filter(strain == "LEW") 
log.SC_chrm.class.LEW <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_LEW,  family=binomial(link="logit"))
summary(log.SC_chrm.class.LEW)


Bivalent_1o2_PWD <-  Bivalent_1o2 %>% filter(strain == "PWD") 
log.SC_chrm.class.PWD <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_PWD,  family=binomial(link="logit"))
summary(log.SC_chrm.class.PWD)


Bivalent_1o2_SKIVE <-  Bivalent_1o2 %>% filter(strain == "SKIVE") 
log.SC_chrm.class.SKIVE <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_SKIVE,  family=binomial(link="logit"))
summary(log.SC_chrm.class.SKIVE)


Bivalent_1o2_KAZ <-  Bivalent_1o2 %>% filter(strain == "KAZ") 
log.SC_chrm.class.KAZ <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_KAZ,  family=binomial(link="logit"))
summary(log.SC_chrm.class.KAZ)


Bivalent_1o2_CZECH <-  Bivalent_1o2 %>% filter(strain == "CZECH") 
log.SC_chrm.class.CZECH <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_CZECH,  family=binomial(link="logit"))
summary(log.SC_chrm.class.CZECH)

Bivalent_1o2_MSM <-  Bivalent_1o2 %>% filter(strain == "MSM") 
log.SC_chrm.class.MSM <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MSM,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MSM)


Bivalent_1o2_MOLF <-  Bivalent_1o2 %>% filter(strain == "MOLF")
log.SC_chrm.class.MOLF <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MOLF,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MOLF)

```


```{r Q2.logreg.plots, echo=FALSE, include=FALSE, eval=FALSE}

log.reg.chrm.class_all.strains <- ggplot(Bivalent_1o2,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO)")+facet_wrap(subsp~ strain)
log.reg.chrm.class_all.strains



WSB.log.reg.chrm.class <- ggplot(Bivalent_1o2_WSB,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO, WSB)")+facet_wrap(~subsp)


MSMlog.reg.chrm.class <- ggplot(Bivalent_1o2_MSM,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("MSM Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)


PWDlog.reg.chrm.class <- ggplot(Bivalent_1o2_PWD,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("PWD Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)

```


```{r Q2.SC.Chrm.Class, echo=FALSE, include=FALSE, eval=FALSE}
#REMOVE COMPARES ACROSS FROM FULL BIVDAAT

#1CO
log.SC_male_1CO.poly <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_1CO.poly)

log.SC_male_1CO.Musc <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_1CO.Musc)
#double check these directions

log.SC_male_1CO.Mol <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))

#summary(log.SC_male_1CO.Mol)


#2CO
log.SC_male_2CO.poly <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_2CO.poly)


log.SC_male_2CO.Musc <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Musc)


log.SC_male_2CO.Mol <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Mol)


#3CO
log.SC_male_3CO.poly <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_3CO.poly)


log.SC_male_3CO.Musc <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Musc)


#there's no rec group for this table
log.SC_male_3CO.Mol <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Mol)


#reverse logistic regression (single bivalent level)
#how well does SC length predict 1 or 2 COs?

Bivalent_1o2 <-  Curated_BivData_male %>% filter(species== "M.musculus") %>% filter(hand.foci.count > 0) %>% filter(hand.foci.count < 3) 

#need to switch the co counts to 1 - 0
Bivalent_1o2$chrm.class <- ifelse(grepl(1, Bivalent_1o2$hand.foci.count), 0, 
                                    ifelse(grepl(2, Bivalent_1o2$hand.foci.count), 1, ""))


Bivalent_1o2$chrm.class <- as.numeric(Bivalent_1o2$chrm.class)
Bivalent_1o2$strain <- factor(Bivalent_1o2$strain, ordered = FALSE)

log.SC_male_chrm.class <- glm(chrm.class ~ chromosomeLength*strain,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class)
#not sure if this is the equivilent of running each strain seperatly
#the strain effect is probably also pulling in the different proportion of chrm class
#useing the chrm.length*strain gives fewer significant factors. 

#i'd be more convinced by running all those log regression plots for each strain
#come back later
```


```{r Q2.SC.log.regression.show.plots, echo=FALSE, include=FALSE, eval=FALSE}

plot.blah.mouse.av <- ggplot( Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean_SC, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC (pooled) \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_1CO <- ggplot( Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_1CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 1CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_2CO <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_2CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 2CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


```


```{r Q2.SClength.ttest, echo=FALSE, include=FALSE, eval=FALSE}
#COMPARISONS ACROSS ALL CLASSES

#MOUSE AVE, all
Rec.group.mouse.SC_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC_Ttest$p.value  #p-value = 0.00238

#mouse.av 1CO
Rec.group.mouse.SC.1CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.1CO_Ttest$p.value  #p-value = 0.9993


#MOUSE.av 2CO
Rec.group.mouse.SC.2CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.2CO_Ttest$p.value  #p-value = 0.03428


#single biv level
#male.biv?

#Rec.group_BivData_F1post_Ttest <- t.test(male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 1], 
#                                 male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 0])
 
#Rec.group_BivData_F1post_Ttest$p.value 

```


```{r log.reg_SC.length, echo=FALSE, include=FALSE, eval=FALSE}
#REMOVE THIS COMPARES FROM FULL BIV DATA

#male poly shouldn't be here
Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 
                                ifelse(grepl("MSM male", Male.poly.Mouse.Table_BivData_4MM$category), 1,
                                ifelse(grepl("SKIVE male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 0)))


#All chrm
log.reg_SC.length_mouse.av <- glm(Rec.group ~ mean_SC, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av)

#considering seperating out by hand foci counts

#1CO
log.reg_SC.length_mouse.av_1CO <- glm(Rec.group ~ mean.SC_1CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_1CO)


#2CO
log.reg_SC.length_mouse.av_2CO <- glm(Rec.group ~ mean.SC_2CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_mouse.av_2CO)


#3CO
log.reg_SC.length_mouse.av_3CO <- glm(Rec.group ~ mean.SC_3CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_3CO)


# bivalent level log regression

log.reg_SC.length_BIV <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV)

#1CO  (BIVDATA)
log.reg_SC.length_BIV_1CO <- glm(Rec.group ~ chromosomeLength, 
                            
                data=Curated_BivData[(Curated_BivData$subsp == "Musc") & (Curated_BivData$hand.foci.count == 1) &(Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_1CO)


#2CO
log.reg_SC.length_BIV_2CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 2) & (Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_2CO)


#3CO
log.reg_SC.length_BIV_3CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 3)&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV_3CO)
```


```{r Q2.SC_class.rec.group_setup, echo=FALSE, include=FALSE}
#REMOVE THIS, IT uses total bivalent data

Q2.SC_BivData_low.rec <- cleanCurated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)%>% filter(Rec.group == 0 )
Q2.SC_BivData_high.rec <- cleanCurated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5) %>% filter(Rec.group == 1 )

#calq_mouse av
mouse.av.SC.low.rec <- ddply(Q2.SC_BivData_low.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                        n_cells = length(unique(fileName) ),
                        mean.SC.total = mean(chromosomeLength),

                    mean.SC_0CO = mean(chromosomeLength[which(hand.foci.count == 0)], na.rm = TRUE),
                  n_0CO =  sum((hand.foci.count == 0), na.rm = TRUE ),
                  
                   mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                    n_1CO = sum((hand.foci.count == 1), na.rm = TRUE),
                  
                   mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                   n_2CO = sum((hand.foci.count == 2), na.rm = TRUE),
                  
                  mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                  n_3CO = sum((hand.foci.count == 3), na.rm = TRUE)
                                                
                         )

mouse.av.SC.low.rec <- add_strain(mouse.av.SC.low.rec)
mouse.av.SC.low.rec <- add_subsp(mouse.av.SC.low.rec)

mouse.av.SC.low.rec$strain <- factor(mouse.av.SC.low.rec$strain, ordered = FALSE)
mouse.av.SC.low.rec$subsp <- factor(mouse.av.SC.low.rec$subsp, ordered = FALSE)


#calq_mouse av
mouse.av.SC.high.rec <- ddply(Q2.SC_BivData_high.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
mouse.av.SC.high.rec <- add_mouse(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_strain(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_subsp(mouse.av.SC.high.rec)

mouse.av.SC.high.rec$strain <- factor(mouse.av.SC.high.rec$strain, ordered = FALSE)
mouse.av.SC.high.rec$add_subsp <- factor(mouse.av.SC.high.rec$subsp, ordered = FALSE)
```



```{r Q2.show.SC.length, echo=FALSE, warning=FALSE, eval=FALSE}

Q2.SC_BivData <- cleanCurated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)

#nested boxplots, pooled Bivalents
#x axis for hand.focicount -- good for seperating the points --- but it pools 

#prediction for Dom strains: low variation 
Q2.SC.length_Nested_boxplots_Dom <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \n Dom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") + scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Dom2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nDom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Musc2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Musc",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot( aes(x=strain), alpha=0.5)+geom_jitter(alpha=.2)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nMusc")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)


Q2.SC.length_Nested_boxplots_Mol <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Mol",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+geom_jitter(alpha=.3)+  ggtitle("Bivalent SC Lengths by Chrm Class\n Mol")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none")+scale_color_manual(values=color_chrm_class)

#+theme(legend.position="none") 
```




#Q2 1CO postion


```{r Q2.1COpos_mouse.av.t.test_all, echo=FALSE}

#High = MSM, PWD, SKIVE
Q2.1COpos_Ttest <- t.test( (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(Rec.group == 0))$norm.first.foci.pos,    
        (mouse.level.BivData_table %>% filter(sex == "male") %>% filter(Rec.group == 1))$norm.first.foci.pos )


#high = PWD and MSM
#Q2.1COpos_Ttest.HL.ex <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == "0"))$norm.first.foci.pos, 
#            (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == #"1"))$norm.first.foci.pos )
#p-value = 1

```


```{r Q2.1COpos_within.subsp_ttest, echo=FALSE}
#Musc
Q2.1COpos_mus.av_Musc_ttest  <-  t.test( (mouse.level.BivData_table %>%  filter(sex == "male") %>%  filter(subsp == "Musc") %>% filter(Rec.group == 0))$norm.first.foci.pos, 
                                         
            (mouse.level.BivData_table  %>%  filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == 1))$norm.first.foci.pos )
# p-value = 0.4


#Mol
Q2.1COpos_mus.av_Mol_ttest  <-  t.test( (mouse.level.BivData_table %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
            
              (mouse.level.BivData_table  %>%  filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(Rec.group == "1"))$norm.first.foci.pos   )
# p-value = 0.07
# exclusive rec group not sig
```

- mouse.level.BivData, t-tests

```{r Q2.1CO_mouse.av.short.long_t.test, echo=FALSE, eval=FALSE}
#these t.tests are causing issues not sure if they are used in final MS

#short -- real.long.bivData -- REAL.short_mouse_table
Q2.1COposABS_short_ttest_HL <- t.test( (Short.biv_mouse_table %>% filter(sex == "male") %>%  filter(Rec.group == "0" ) %>% filter(species == "M.musculus") )$ABS.first.foci.pos, 
      
      (Short.biv_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == 1) %>% filter(species == "M.musculus") )$ABS.first.foci.pos   )
#p-value = 0.3


Q2.1COpos.PER_short_ttest_HL <- t.test( (Short.biv_mouse_table %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(species == "M.musculus") )$norm.first.foci.pos, 
      (Short.biv_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == "1") %>% filter(species == "M.musculus") )$norm.first.foci.pos   )
# p-value = 0.1

```

```{r Q2.1CO.pos_short.long.ttest, echo=FALSE}

#real.long.bivData
#single biv level
Rec.group_LONG.BivData_F1post_Ttest <- t.test(
  (real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.5 

Rec.group_BivData_F1post_Ttest <- t.test(
  (cleanCurated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(cleanCurated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.3

```




```{r Q2.1COpos_mus.av.full_glm, echo=FALSE}

Q2.glm_mus.av_1COpos_M4 <- glm(mean_1CO.pos.PER ~ subsp * strain, data = (mouse.level.BivData_table  %>% filter(sex == "male") %>% filter(species == "M.musculus") ) )

sum.Q2.glm_mus.av_1COpos_M4  <- summary(Q2.glm_mus.av_1COpos_M4)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]


#M4.2 (just strain)
Q2.glm_mus.av_1COpos_M4.2 <- glm(norm.first.foci.pos ~ strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )
sum.Q2.glm_mus.av_1COpos_M4.2 <- summary(Q2.glm_mus.av_1COpos_M4.2)$coefficients

```


```{r Q2.1CO.pos_glm.chrm.Length, echo=FALSE}
#remove this cell, 

cleanCurated_BivData <- cleanCurated_BivData %>% filter(Obj.ID != "13sep18_28jun18_MOLF_m1_sp1_18.1_rev_14")

#making new models 

cleanCurated_BivData$subsp <- factor(cleanCurated_BivData$subsp , ordered = F)
cleanCurated_BivData$strain <- factor(cleanCurated_BivData$strain , ordered = F)

chrm.1CO.pos.chrmLength <- glm(PER_Foci_1 ~ chromosomeLength * subsp * strain, data= ( cleanCurated_BivData %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") ) )

sum.chrm.1CO.pos.chrmLength <- summary(chrm.1CO.pos.chrmLength)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]


chrm.1CO.pos.chrmLength_strain <- glm(PER_Foci_1 ~ chromosomeLength *  strain, data= Curated_BivData %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") )

#summary(chrm.1CO.pos.chrmLength_strain)

```

```{r Q2.1COpos_strain, echo=FALSE, eval=FALSE}
#isolate all musc
#Curated_BivData_male <- Curated_BivData[Curated_BivData$sex == "male",]

##long biv
male.long.biv <- real.long.bivData %>% filter(sex== "male") %>% filter(species == "M.musculus") 
#table( droplevels( male.long.biv$strain)  )


mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean_F1 = mean(Foci1, na.rm=TRUE),
                        mean_F1.nrm = mean(PER_Foci_1,na.rm=TRUE),
                        
                        mean_SC = mean(chromosomeLength),

                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE)

                                               )
#add subsp

mouse.av.long.biv.table <- add_strain(mouse.av.long.biv.table)
mouse.av.long.biv.table <- add_subsp(mouse.av.long.biv.table)

mouse.av.long.biv.table$strain <- factor(mouse.av.long.biv.table$strain, ordered = FALSE)
mouse.av.long.biv.table$subsp <- factor(mouse.av.long.biv.table$subsp, ordered = FALSE)

#add rec group
mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", mouse.av.long.biv.table$strain), 1, 
                            ifelse(grepl("MSM", mouse.av.long.biv.table$strain), 1,
                             ifelse(grepl("SKIVE", mouse.av.long.biv.table$strain), 1, 0)) )
```


```{r Q2.1COpos.LOG.glm, echo=FALSE, eval=FALSE}

#logistic regression, reverse variables

male.bivdata.1CO$Rec.group <- ifelse(grepl("PWD", male.bivdata.1CO$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.1CO$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.1CO$strain), 1, 0)))

Log.Q2.1COnrm.F1.PER <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO,  family=binomial(link="logit"))
#summary(Log.glmQ2_M2.1COnrm)

#Musc
Log.Q2.F1_PER_Musc <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Musc",], 
              family=binomial(link="logit"))
#summary(Log.Q2.F1_PER_Musc)


#Mol
Log.Q2.F1_PER_Mol <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Mol",],
              family=binomial(link="logit"))

#summary(Log.glmQ2_M2.1COnrm_Mol)

```



```{r Q2.1COpos.LONG.BIV_plot, echo=FALSE, warning=FALSE, eval=FALSE}
#make the same plots as above but with the long biv data set
male.long.biv.1CO <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1)

#mouse.av.long.biv.table

Q2.show.nrmF1_long.biv <- ggplot(male.long.biv.1CO, aes(x=strain, y=PER_Foci_1, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= PER_Foci_1 ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Normalized 1CO Foci pos \nLong Biv")

Mouse.av.Long.biv <- ddply(male.long.biv.1CO, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Nbiv  = length(Obj.ID),
                       mean.1CO_PER = mean(PER_Foci_1)
                      # mean_CO = mean()
                       )

Mouse.av.Long.biv <- add_strain(Mouse.av.Long.biv)
Mouse.av.Long.biv <- add_subsp(Mouse.av.Long.biv)


Q2.shoooo   <- ggplot(Mouse.av.Long.biv, aes(x=strain, y=mean.1CO_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean.1CO_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("mouse ave \nNormalized 1CO Foci pos \nLong Biv")

```


```{r Q2.1COpos.show.MOL, echo=FALSE, eval=FALSE}

#(mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>% filter(Rec.group == #"0"))$norm.first.foci.pos

mus.av1COpos.plot <- ggplot(data= mouse.level.BivData_table %>%  filter(sex == "male") %>%  filter(subsp == "Mol"),
                      aes(x= mouse, y = norm.first.foci.pos))+geom_point()
#+facet_wrap(~mouse, scales = "free")

single.biv_1COpos.plot_Mol <- ggplot(data= Curated_BivData %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>%  filter(hand.foci.count == "1") %>%  filter(chromosomeLength < 100),
                      aes(x= fileName, y = PER_Foci_1, color=chromosomeLength))+geom_point()+facet_wrap(~mouse, scales = "free") + ylim(c(0,1))

#+scale_color_manual(values=colors_of_strains)


single.biv_1COpos.plot_Dom <- ggplot(data= Curated_BivData %>% filter(sex == "male") %>%filter(subsp == "Dom") %>%  filter(hand.foci.count == "1"),
                      aes(x= fileName, y = PER_Foci_1, color=strain ))+geom_point()+facet_wrap(~mouse, scales = "free") + ylim(c(0,1))+scale_color_manual(values=colors_of_strains)

#CHRM.length is very significant-- some of the same subsp and strains are sig     
```



#Q2 IFD

```{r Q2.IFD.setup, echo=FALSE}

#identify and remove mice with 1 bivalent observation (MSM:  1feb18_MSM_m1)
#some cells just have 1 cell, but the MSM_m is the only with just 1 bivlent

```



```{r Q2.IFD.long.short.setup, echo=FALSE}
#long BivData
male.long.biv.2CO_IFD <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.long.biv.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.long.biv.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.long.biv.2CO_IFD$strain), 1, 
                                           ifelse(grepl("SKIVE", male.long.biv.2CO_IFD$strain), 1, 0)))

#show
Long.biv.IFDs_PER_by.group <- ggplot(male.long.biv.2CO_IFD, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized Interfocal Distances, Long BivData\nLow Rec group =0, High Rec group =1")+
  scale_color_manual(values=colors_of_strains)+ facet_wrap(subsp~Rec.group, scales = "free")+theme(legend.position="none")+ylim(c(0,1.1))

#long biv's - short IFD rates

LongBiv_IFD_mus.rate <- ddply(male.long.biv.2CO_IFD %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        
                   N.obs  = length(Obj.ID),

                  mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                  mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                  var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)] ),
                
                inverse.close.foci = length(which(IFD1_PER >= .31)),  
                n.close.foci = length(which(IFD1_PER <= .3)),
                      
                off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                rate.close.foci = n.close.foci / N.obs
                
                                              )

#run t.tests on long biv
LongBiv_IFD_mus.rate <- add_strain(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_category(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_subsp(LongBiv_IFD_mus.rate)

#add rec.group
LongBiv_IFD_mus.rate$Rec.group <- ifelse(grepl("PWD", LongBiv_IFD_mus.rate$strain), 1, 
                                ifelse(grepl("MSM", LongBiv_IFD_mus.rate$strain), 1,
                                 ifelse(grepl("SKIVE", LongBiv_IFD_mus.rate$strain), 1, 0)))

```


```{r Q2.IFD.long.biv_t.test, echo=FALSE}
#short removed PER
Short.removed_BivData.LongBiv_IFD.PER_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])
 
#Short.removed_BivData.LongBiv_IFD.PER_Ttest$p.value
#0.0083

#ABS short removed
Short.removed_BivData.LongBiv_IFD.ABS_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])

#Short.removed_BivData.LongBiv_IFD.ABS_Ttest$p.value
#0.047
```


```{r Q2.t.test_IFD_mouse.av, echo=FALSE, eval=TRUE}
#t.test for IFD
#mouse.av - the mouse average IFD is from just 2CO

#high, low
t.test_mouse.av.IFD_ABS <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(species == "M.musculus")  )$mean_IFD.2CO_ABS, 
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male")%>% filter(species == "M.musculus") )$mean_IFD.2CO_ABS   )
  

t.test_mouse.av.IFD_PER <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") )$mean_IFD.2CO_PER,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER   )


#t.test_mouse.av.IFD_PER_DOM <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == #"male") %>% filter(subsp == "Dom") )$mean_IFD.2CO_PER,
#   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == #"Dom"))$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_PER_MUSC <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER   )

#ABS
t.test_mouse.av.IFD_ABS_MUSC <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(species == "M.musculus"))$mean_IFD.2CO_ABS,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc")%>% filter(species == "M.musculus"))$mean_IFD.2CO_ABS   )

#niether PER or ABS is sig, 1 mouse, #1feb18_MSM_m1 has only 1 observation 

t.test_mouse.av.IFD_PER_MOL <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(mouse != "1feb18_MSM_m1")   )$mean_IFD.2CO_PER,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_ABS_MOL <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(mouse != "1feb18_MSM_m1") )$mean_IFD.2CO_ABS,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_ABS  )

```


```{r Q2.t.test_IFD, echo=FALSE, eval=FALSE}

male.bivdata.2CO_IFD <- Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)
#t.tests for the Rec group
Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                                    ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                           ifelse(grepl("SKIVE male",Curated_BivData$category),1, 0)))

#Curated_BivData <- add_IFD(Curated_BivData)
#THIS SHOULD ALREADY BE ADDED

#single biv level
Rec.group.BivData_IFD.PER_Ttest <- t.test(male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 1], 
                                 male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 0])
 
#Rec.group.BivData_IFD.PER_Ttest$p.value
#p-value < 2.2e-16

#MOUSE AVE  -- replace with mouse    mouse.avs_4MM,   male.av_4MM
Rec.group_IFD.PER_Ttest <- t.test(  (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "1"))$mean_IFD.2CO_PER, 
                                (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "0"))$mean_IFD.2CO_PER )
 
#Rec.group_IFD.PER_Ttest$p.value 
#p-value = 6.872e-07
```


```{r Q2.show.IFD.Mol, echo=FALSE}

#mouse.level.BivData_table
#cleanCurated_BivData

#molossinus does not show 

Musc.IFD.Biv <- ggplot(data = (cleanCurated_BivData %>% filter(subsp == "Musc") %>% filter(sex == "male") %>% filter(hand.foci.count == 2)  ), aes(x = strain, y = IFD1_PER) ) + geom_jitter()

Mol.IFD <- ggplot(data = (cleanCurated_BivData %>% filter(subsp == "Mol") %>% filter(sex == "male") %>% filter(hand.foci.count == 2)  ), aes(x = strain, y = IFD1_PER) ) + geom_jitter() +facet_wrap(~mouse)



t.test_biv.av.IFD_PER_MOL <- t.test(  (cleanCurated_BivData %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )$IFD1_PER,
   (cleanCurated_BivData %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )$IFD1_PER   )
#p value for the bivalent level IFD1 norm positions are significant


#mouse level
t.test_mouse.av.IFD_PER_MOL <- t.test(  (mouse.level.BivData_table %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER,
   (mouse.level.BivData_table %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(species == "M.musculus") )$mean_IFD.2CO_PER   )

#1feb18_MSM_m1

Mol.mus.IFD <- ggplot(data = (mouse.level.BivData_table %>% filter(subsp == "Mol") %>% filter(sex == "male")   ), aes(x = strain, y = mean_IFD_PER, color = mouse) ) + geom_jitter()
#there is mouse MSM with v low, 1feb18_MSM_m1 -- it only has 1 measure


```



```{r Q2.IFD.glm.test, echo=FALSE}

#M4.ABS
Q2.M4glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ subsp * strain, data= mouse.level.BivData_table %>% filter(sex == "male")  %>% filter(species == "M.musculus")  )
sum.Q2.M4glm_IFD.raw <- summary(Q2.M4glm_IFD.raw) 

#M4.PER
Q2.M4glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus")  )

sum.Q2.M4glm_IFD.PER <- summary(Q2.M4glm_IFD.PER)
#summary(Q2.M1glm_IFD.PER) 

#M4.2.raw
Q2.M4.2glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )
Sum.Q2.M4.2glm_IFD.raw <- summary(Q2.M4.2glm_IFD.raw)

Q2.M4.2glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )
sum.Q2.M4.2glm_IFD.PER <- summary(Q2.M4.2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

#within subspecies
#Dom
#Q2.glm.M4.2_IFD_Dom <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M4.2_IFD_Dom)

#Musc
#Q2.glm.M4.2_IFD_Musc <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M4.2_IFD_Musc)

#Mol
#Q2.glm.M4.2_IFD_Mol <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M4.2_IFD_Mol)

#Dom
#Q2.glm.M4.2_IFD.PER_Dom <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M4.2_IFD.PER_Dom) 

#Musc
#Q2.glm.M4.2_IFD.PER_Musc <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M4.2_IFD.PER_Musc) 

#Mol
#Q2.glm.M4.2_IFD.PER_Mol <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M4.2_IFD.PER_Mol)
```


```{r Q2.IFD.glm.test.old, echo=FALSE, warning=FALSE, eval=FALSE}

#M1.ABS
Q2.M1glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ subsp * strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus")  )
sum.Q2.M1glm_IFD.raw <- summary(Q2.M1glm_IFD.raw) 

#M1.PER
Q2.M1glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )

sum.Q2.M1glm_IFD.PER <- summary(Q2.M1glm_IFD.PER)
#summary(Q2.M1glm_IFD.PER) 

#M2.raw
Q2.M2glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )
Sum.Q2.M2glm_IFD.raw <- summary(Q2.M2glm_IFD.raw)

Q2.M2glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.level.BivData_table %>% filter(sex == "male") %>% filter(species == "M.musculus") )
sum.Q2.M2glm_IFD.PER <- summary(Q2.M2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

#within subspecies
#Dom
Q2.glm.M2_IFD_Dom <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Dom") )
#summary(Q2.glm.M2_IFD_Dom)

#Musc
Q2.glm.M2_IFD_Musc <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Musc") )
#summary(Q2.glm.M2_IFD_Musc)

#Mol
Q2.glm.M2_IFD_Mol <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Mol") )
#summary(Q2.glm.M2_IFD_Mol)


#Dom
Q2.glm.M2_IFD.PER_Dom <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Dom") )
#summary(Q2.glm.M2_IFD.PER_Dom) 

#Musc
Q2.glm.M2_IFD.PER_Musc <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Musc") )
#summary(Q2.glm.M2_IFD.PER_Musc) 

#Mol
Q2.glm.M2_IFD.PER_Mol <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.level.BivData_table %>% filter(subsp == "Mol")  )
#summary(Q2.glm.M2_IFD.PER_Mol)

```



```{r Q2.IFD.glm.chrmLength, echo=FALSE, eval=FALSE}

Curated_BivData$subsp  <- factor(Curated_BivData$subsp, ordered = FALSE)

#M.Len.ABS
Q2.BIV.LEN.glm_IFD.raw <- glm(IFD1_ABS ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.raw)

#M.Len.PER
Q2.BIV.LEN.glm_IFD.PER <- glm(IFD1_PER ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.PER)


#M.Len.raw
Q2.BIV.LEN.M2glm_IFD.ABS <- glm(IFD1_ABS ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.ABS)

##M.Len PER
Q2.BIV.LEN.M2glm_IFD.PER <- glm(IFD1_PER ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

```


```{r Q2.IFD_rate.shortIFD, echo=FALSE, warning = FALSE, eval=FALSE}

#for the relevant data, by strain, calcu the number of observations of 2CO above and below 30%

close.IFD.rates.mus.rate <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        N.obs  = length(Obj.ID),

                      #  mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                      mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                      mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)], na.rm=TRUE),
                  
                      inverse.close.foci = length(which(IFD1_PER >= .31)),  
                      n.close.foci = length(which(IFD1_PER <= .3)),
                      
                      off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                      rate.close.foci = n.close.foci / N.obs
)

#mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),

close.IFD.rates.mus.rate <- add_strain(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_category(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_subsp(close.IFD.rates.mus.rate)
#add rec.group
close.IFD.rates.mus.rate$Rec.group <- ifelse(grepl("PWD", close.IFD.rates.mus.rate$strain), 1, 
                          ifelse(grepl("MSM", close.IFD.rates.mus.rate$strain), 1,
                         ifelse(grepl("SKIVE", close.IFD.rates.mus.rate$strain), 1, 0)))



close.IFD.rates_strain <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("strain"), summarise,
                        N.obs  = length(Obj.ID),

                        mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                        mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm = TRUE),
                        
                        #mean_IFD_short.removed
                      mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                        
                      inverse.close.foci = length(which(IFD1_PER > .3)),  
                      n.close.foci = length(which(IFD1_PER < .3)),
                      rate.close.foci = n.close.foci / N.obs,
                     
                       off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) )
                      
)

close.IFD.rates_strain <- add_subsp(close.IFD.rates_strain)

show.IFDrm <- ggplot(close.IFD.rates_strain, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences")+ geom_abline(slope = 1, intercept = 0)

#close.IFD.rates.mus.rate
show.IFDrm_mus <- ggplot(close.IFD.rates.mus.rate, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences") + geom_abline(slope = 1, intercept = 0)

show.close.IFD.rate <- ggplot(close.IFD.rates_strain, aes(y=rate.close.foci, x=strain, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)

#add rec.group
close.IFD.rates_strain$Rec.group <- ifelse(grepl("PWD", close.IFD.rates_strain$strain), 1, 
                                ifelse(grepl("MSM", close.IFD.rates_strain$strain), 1,
                                 ifelse(grepl("SKIVE", close.IFD.rates_strain$strain), 1, 0)))

#POOL all short and 
#chi square test
high.rec.props <- prop.test( ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$n.close.foci,
                              ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$N.obs)     
#p-value = 0.03, slight dif tween 3 high rec strains
```

```{r Q2.IFD.PER.logreg, echo=FALSE, eval=FALSE}

#Log regression all show significant prediction
#IFD.PER
log.reg.Q2.IFD.PER <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER)

#MUSC
log.reg.Q2.IFD.PER.Musc <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Musc)

#Mol
log.reg.Q2.IFD.PER.Mol <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Mol)


#SINGLE BIVALENT LEVEL
Log.Q2.IFD.per_bivdata <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata)

#Musc
Log.Q2.IFD.per_bivdata.Musc <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata.Musc)

#Mol
Log.Q2.IFD.per_bivdata.Mol <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))

```

```{r Q2IFD_logreg, echo=FALSE, eval=FALSE}

Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                    ifelse(grepl("MSM", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                           ifelse(grepl("SKIVE", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 0)))

#IFD.raw
log.reg.Q2.IFD.raw <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw)

#MUSC
log.reg.Q2.IFD.raw.Musc <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Musc)

#Mol
log.reg.Q2.IFD.raw.Mol <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Mol)

#SINGLE BIV LEVELs
male.bivdata.2CO_IFD <- Curated_BivData_male %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.bivdata.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.bivdata.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.2CO_IFD$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.2CO_IFD$strain), 1, 0)))


Log.Q2.IFD.raw_bivdata <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata)

#Musc
Log.Q2.IFD.raw_bivdata.Musc <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Musc)

#Mol
Log.Q2.IFD.raw_bivdata.Mol <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Mol)
```

```{r Q2.IFD.longbiv_glm, echo=FALSE, eval=FALSE}
#Full dataset
male.long.biv.2CO_IFD$strain <- factor(male.long.biv.2CO_IFD$strain, ordered = FALSE)

#single bivalent
Q2.glm_long.biv_M2.IFD.PER <- glm(IFD1_PER ~ strain, data= male.long.biv.2CO_IFD)
#summary(Q2.glm_long.biv_M2.IFD.PER)
#The PER.IFDs don't have significant strain effects
```

```{r Q2.IFD_short.removed_t.test, echo=FALSE, include=FALSE, eval=FALSE}
Short.removed_BivData_IFD.PER_Ttest <- t.test(Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 1], 
  Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 0])
 
Short.removed_BivData_IFD.PER_Ttest$p.value

#
Short.removed_BivData_IFD.PER_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                       close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
Short.removed_BivData_IFD.PER_Ttest_mus.av$p.value


Short.removed_BivData_IFD.ABS_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                                 close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
```




# SAVE the data


```{r Save.File, echo=FALSE}
#save Rdata
save.image("~./MLH1repo/data/Results_setup_5.30.20.RData")

```


```{r Q1.mouse.av.F1.pos.LONG.BIV_scatter, echo=FALSE, eval=FALSE}
#REAL.short_mouse_table -- Short.biv_mouse_table
#REAL.long_mouse_table -- Long.biv_mouse_table
#mouse.av.long.biv.table

Q1.av.long.biv_scatr_box   <- ggplot(Long.biv_mouse_table  , aes(x=sex, y=mean_F1pos_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean_F1pos_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nLong Biv")

Q1.av.short.biv_scatr_box   <- ggplot(Short.biv_mouse_table, aes(x=sex, y=mean_F1pos_PER, color=strain) )+geom_jitter( )+ geom_boxplot(aes(y= mean_F1pos_PER ),alpha=.3 ) + scale_color_manual(values=colors_of_strains)+facet_wrap(~subsp, scales = "free")+ylim(c(0,1.1))+ggtitle("Mouse av. \nNormalized 1CO Foci pos \nShort Biv")
```

