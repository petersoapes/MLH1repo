---
title: "Results_setup"
author: "April Peterson"
date: "April 7, 2020"
output: html_document
---



```{r setup, echo=FALSE, include = FALSE}
library(knitr)
library(ggplot2)
#library(pwr)
library(plyr)
library(lattice)
library(dplyr)
library(raster)
library(lme4)
library(nlme)
library(RLRsim)
library(ggpubr)
library(reshape2)
#library(patchwork)

options(digits=2)

setwd("~.")#switch over to here()


load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_4.21.20.RData")
#load(file = "~./MLH1repo/data/MLH1/MLH1_data_setup_2.24.20.RData")
#load(file = "C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.31.20.RData")

#2.2.20
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.27.20.RData")

load(file="~./MLH1repo/data/CleanBivData_6.3.20.RData")

load(file="~./MLH1repo/data/total_SC_30.12.19.RData")

#skeletonize
SC.skel = read.csv("~./MLH1repo/data/SCskel_output_feb20.csv", header = TRUE, strip.white = TRUE)

#load(file="~./MLH1repo/data/MLH1_data_setup_1.5.20.RData")

#setwd("~./MLH1repo/doc/")
#setwd("C:/Users/alpeterson7/Documents/MLH1repo/doc/")
#setwd("C:/Users/April/Documents/MLH1repo")
#load(file="data/MLH1/MLH1_data_setup.RData")

#load main data file
#load(file="C:/Users/April/Documents/MLH1repo/data/MLH1/MLH1_data_setup_1.5.20.RData")#added batch18
#load(file="C:/Users/April/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/CleanBivData_1.28.20.RData")

#this MLH1 only goes up to batch16!
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#batch18
#load(file="C:/Users/alpeterson7/Documents/MLH1repo/data/MLH1/MLH1_data_setup_12.20.19.RData")#fixing bugs, formating
#load(file="data/MLH1/MLH1_data_setup_12.3.19.RData")#removed exclude mice
#load(file="data/MLH1/MLH1_data_setup_11.12.19.RData")#added batch17
#load(file="data/MLH1/MLH1_data_setup_11.11.19.RData")#deleted DUP image
#load(file="data/MLH1/MLH1_data_setup_9.26.19.RData")#added batch16
#load(file="data/MLH1/MLH1_data_setup_8.29.19.RData") #

#load(file="data/MetaData.RData") #this was replacing most updated data file

#load functions
source("~./MLH1repo/src/CommonFunc_MLH1repo.R")
```

<!-- Data Set Up Notes -->

```{r organizing.data, echo=FALSE }
#set the order of another column, based on another variable. consistant order for ploting

#Terminology Note, leptonema, zygonema, and pachynema diplonema diakinesis, are the stage names.
#-ene endings refer to the cells/units within the cell stage? (I think)

#apply this before ploting
MLH1_data <- MLH1_data %>%
  arrange(strain, sex, category, mouse) %>%
  mutate(Original.Name = factor(Original.Name)) #another category that you want the order to match
MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])

# sort your dataframe, by the focal categories
MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))
#use the above line for when order is out of wak

#MLH1_data <- with(MLH1_data, MLH1_data[order(category),])
AP_mouse_table.HQ$var <- as.numeric(AP_mouse_table.HQ$var)

AP_category_table <-  ddply(.data=AP_mouse_table.HQ,
                 .(strain,sex),
                 summarize,
                 sum.ncells = sum(Ncells),
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co),
                 AV.var_MLH1 = mean(var, na.rm=TRUE)
                                  
)

#there might be an error for changing wd
#write.table(AP_category_table, "~./MLH1repo/strain_table_variances.csv", sep=",", row.names = FALSE)

AP_mouse_table.HQ_target <- AP_mouse_table.HQ[!(is.na(AP_mouse_table.HQ$sex) | AP_mouse_table.HQ$sex==""), ]

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC")
AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]

  
var.plot <- ggplot(AP_mouse_table.HQ_target, aes(y=var, x = sex, color=sex))+geom_jitter()+facet_wrap(~strain)+ggtitle("Plots of mouse Variances for MLH1 counts")+
  scale_color_manual(values=c("royalblue", "limegreen"))+theme_bw()

```

```{r misc.setup, echo=FALSE}

colors_of_strains <- c('WSB'= "#56B4E9",'G' ='cadetblue','LEW'= 'lightblue','PERC'= 'blue',
                       #blues
                       
                       'PWD'= 'red2',
                       'SKIVE'= 'coral1','KAZ'= 'coral4', 
                       
                       'TOM'= 'indianred1','AST' = 'tan2',
                       'CZECH'= 'brown1',
                       
                       'MSM'= 'deeppink', 'MOLF'= 'hotpink', #mol are pinks, bc they are fancy mice
                       
                    'CAST'='green','HMI'= 'forestgreen', #greens
                    
                    'SPRET'='gold','SPIC'= 'goldenrod1', #browns? color of mounds?
                    'CAROLI'='gold3',
                    
                    "F1"='grey', "other" = 'grey'
                    )

color_chrm_class <- c( '0' = "#00BFC4", '1' = "#7CAE00", '2' = "#F8766D", '3' = "#C77CFF", '4'= "#F564E3")
#4!!

#show_col(hue_pal()(5))

#add Rec group,

Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                              ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)))

Curated_BivData$Rec.group_alt <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                              ifelse(grepl("MSM male", Curated_BivData$category), 1, 0))


#apply this before ploting, to display strains in desired order
#MLH1_data <- MLH1_data %>%
#  arrange(strain, sex, category, mouse) %>%
#  mutate(Original.Name = factor(Original.Name)) #another category that you want the order to match
#MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])

# sort your dataframe, by the focal categories
#MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))


```


```{r Q1.rbar, echo=FALSE}

source("~./MLH1repo/src/CommonFunc_MLH1repo.R")

#read.csv of gamma estimates from above
gamma_estimates <- read.csv("~./MLH1repo/results/gamma_estimates.csv", header = TRUE)

table_gamma_estimates <- read.csv("~./MLH1repo/table.csv", header = TRUE)

#for(e in 1:length(cleanCurated_BivData$fileName)){
#  mini.IFD <- calq.intra.rbar(mini.IFD)
#  cleanCurated_BivData$rbar[e] <- new.calq.intra.rbar(cleanCurated_BivData[e,])
#  }

#calq the mouse / strain means for rbar

#summarize_rbar_table <- ddply(.data=cleanCurated_BivData,
#                 .(sex, strain),
#                 summarize,
#                 mean.rbar.all = mean(rbar, na.rm = TRUE),
                 
#                 mean.rbar.2CO = mean(rbar[which(hand.foci.count == 2)], na.rm = TRUE),
#                 mean.rbar.3CO = mean(rbar[which(hand.foci.count == 3)], na.rm = TRUE)
#)
#the 3 is negative...
#how best to merge rbar and gamma estiamtes (which estimate)

raw.gamma_estimates <-  gamma_estimates %>% filter(type.IFD == "raw.IFD") %>% filter( (class == "2CO") | (class == "3CO") )

table <- raw.gamma_estimates
#write.table(table, "~./MLH1repo/table.csv", sep=",",row.names = TRUE)

#write.table(summarize_rbar_table, "~./MLH1repo/RBAR.table.csv", sep=",",row.names = TRUE)

#what comparison of IFD and rbar would be logical
#plot rbar and gamma
ll <- ggplot(table_gamma_estimates, aes(y=mean.rbar, x = all.biv.gamma, color = class, shape = sex ))+geom_point()+facet_wrap(~strain)+ ggtitle("")+ylim(c(0,.5))

#mean rbars are up around 
#SKIVE male have extra (very strong interference)
#there's so much variance across the gamma estimates -- 
#most all females seem to have stronger interfernce
#there don't seem to be consistant patterns

#this plot shows much higher 2CO interference (via the gamma estimat from nrmIFD) in high rec males
#across other classes of bivalents 

#most all other estiamtes of gamma estimates are around 4
#

#house mouse raw nu is around 11

```


```{r MLH1.FEMALE.TABLE, echo=FALSE}
female_mouse.av <- subset(AP_mouse_table_w.Ages, select= -c(sex.y,sex.x,
                            subsp.y,subsp.x,
                    category.y,category.x, strain.x,
                    strain.y, mouse.1  )  )

female_mouse.av <- add_sex(female_mouse.av)
female_mouse.av <- add_strain(female_mouse.av)
female_mouse.av <- add_subsp(female_mouse.av)
female_mouse.av <- add_species(female_mouse.av)

female_mouse.avs_for.analysis <-  female_mouse.av %>% filter(sex== "female") %>% filter(species == "M.musculus") %>% filter(strain != "CZECH") %>% filter(strain != "CAST")

female_mouse.avs_for.analysis$subsp <- factor(female_mouse.avs_for.analysis$subsp, ordered = FALSE)
female_mouse.avs_for.analysis$sex <- factor(female_mouse.avs_for.analysis$sex, ordered = FALSE)
female_mouse.avs_for.analysis$strain <- factor(female_mouse.avs_for.analysis$strain, ordered = FALSE)
female_mouse.avs_for.analysis$species <- factor(female_mouse.avs_for.analysis$species, ordered = FALSE)

Musc.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Musc")

#Mol
#Mol.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Mol")

#Dom 
Dom.female_mouse.av <-  female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Dom")

```


```{r MLH1.MALE.TABLE, echo=FALSE}
#AP_mouse_table.MLH1_HQ

#find the table that includes the las image data
male_MLH1mouse.av <- AP_mouse_table_w.Ages

male_MLH1mouse.av <- add_sex(male_MLH1mouse.av)
male_MLH1mouse.av <- add_strain(male_MLH1mouse.av)
male_MLH1mouse.av <- add_subsp(male_MLH1mouse.av)
male_MLH1mouse.av <- add_species(male_MLH1mouse.av)

fomo.male_mouse.av <-  male_MLH1mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

fomo.male_mouse.av$subsp <- factor(fomo.male_mouse.av$subsp, ordered = FALSE)
fomo.male_mouse.av$sex <- factor(fomo.male_mouse.av$sex, ordered = FALSE)
fomo.male_mouse.av$strain <- factor(fomo.male_mouse.av$strain, ordered = FALSE)
fomo.male_mouse.av$species <- factor(fomo.male_mouse.av$species, ordered = FALSE)


Musc.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Musc")
Mol.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Mol")
#Dom version 
Dom.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(subsp == "Dom")
```


```{r MLH1.MIXED.MODEL.setup, echo=FALSE, warning=FALSE, eval=TRUE}
#DF.HetC.MixedModel.HQ

DF.HetC.MixedModel <- AP_mouse_table_w.Ages[AP_mouse_table_w.Ages$species == "M.musculus",]

#remove the extra merged cols
#DF.HetC.MixedModel <- subset(DF.HetC.MixedModel, select= -c(sex.y,sex.x,
#                            subsp.y,subsp.x,
#                    category.y,category.x, strain.x,
#                    strain.y, mouse.1  )  )

#AP_mouse_table excluide Qual5 cells
DF.HetC.MixedModel.HQ <- AP_mouse_table.MLH1_HQ

DF.HetC.MixedModel.HQ <- add_species(DF.HetC.MixedModel.HQ)

#main df with variables coded as chr
DF.HetC.MixedModel.HQ$subsp <- factor(DF.HetC.MixedModel.HQ$subsp, ordered = FALSE)
DF.HetC.MixedModel.HQ$sex <- factor(DF.HetC.MixedModel.HQ$sex, ordered = FALSE)
DF.HetC.MixedModel.HQ$strain <- factor(DF.HetC.MixedModel.HQ$strain, ordered = FALSE)
#DF.HetC.MixedModel.HQ$species <- factor(DF.HetC.MixedModel.HQ$species, ordered = FALSE)

#kable(table(DF.HetC.MixedModel.HQ$sex, DF.HetC.MixedModel.HQ$strain))


all.cell.MM.HQ <- ddply(.data=DF.HetC.MixedModel.HQ,
                 .(sex, strain),
                 summarize,
                 all.cells = sum(Ncells)
)

```



```{r female.diference, echo=FALSE}

#how much greater are the high strains?
G_female <-  female_mouse.avs_for.analysis %>% filter(strain == "G")
mean.G.female <- mean(G_female$mean_co, na.rm=TRUE)

LEW_female <-  female_mouse.avs_for.analysis %>% filter(strain == "LEW")
mean.LEW.female <- mean(LEW_female$mean_co, na.rm=TRUE)

#how much greater is MSM female
MSM_female <-  female_mouse.avs_for.analysis %>% filter(strain == "MSM")
mean.MSM.female <- mean(MSM_female$mean_co, na.rm=TRUE)


sans_high_female <- female_mouse.avs_for.analysis %>% filter(strain != "G") %>%  filter(strain != "MSM") %>%  filter(strain != "LEW")
mean.all.other <- mean(sans_high_female$mean_co, na.rm=TRUE)


G.female.diff <- (mean.G.female / mean.all.other)
LEW.female.diff <- (mean.LEW.female / mean.all.other)
MSM.female.diff <- (mean.MSM.female / mean.all.other)
```


```{r male.difference, echo=FALSE}
just.male_mouse.av <-  fomo.male_mouse.av %>% filter(sex== "male") %>% filter(species == "M.musculus") 

just.male_mouse.av$sex <- factor(just.male_mouse.av$sex, ordered = FALSE)
just.male_mouse.av$strain <- factor(just.male_mouse.av$strain, ordered = FALSE)
just.male_mouse.av$subsp <- factor(just.male_mouse.av$subsp, ordered = FALSE)
just.male_mouse.av$species <- factor(just.male_mouse.av$species, ordered = FALSE)


#how much greater are the High Rec gwRRs
just.male_mouse.av$Rec.group <- ifelse(grepl("PWD", just.male_mouse.av$strain), 1, 
                              ifelse(grepl("MSM", just.male_mouse.av$strain), 1,
                                ifelse(grepl("SKIVE", just.male_mouse.av$strain), 1, 0)))


#how much bigger are the high rec male means?
sans_LewRec_male <- just.male_mouse.av %>% filter(Rec.group == 0)
#mean(sans_LewRec_male$mean_co)

PWD_male <-  just.male_mouse.av %>% filter(strain == "PWD")
#mean(PWD_male$mean_co) / mean(sans_LewRec_male$mean_co)

MSM_male <- just.male_mouse.av %>% filter(strain == "MSM")
#mean(MSM_male$mean_co) / mean(sans_LewRec_male$mean_co)

SKIVE_male <-   just.male_mouse.av %>% filter(strain == "SKIVE")
#mean(SKIVE_male$mean_co) /  
```



```{r MLH1.MIXED.MODEL.setup.2, echo=FALSE, warning=FALSE, eval=FALSE}
#DF.HetC.MixedModel.HQ
#this blck is duplicated in setupData.rm

#https://rcompanion.org/handbook/G_03.html
#testing random effects within lme

DF.HetC.MixedModel <- AP_mouse_table_w.Ages[AP_mouse_table_w.Ages$species == "M.musculus",]

#AP_mouse_table excluide Qual5 cells
DF.HetC.MixedModel.HQ <- AP_mouse_table.MLH1_HQ
DF.HetC.MixedModel.HQ <- add_species(DF.HetC.MixedModel.HQ)

#main df with variables coded as chr
DF.HetC.MixedModel.HQ$subsp <- factor(DF.HetC.MixedModel.HQ$subsp, ordered = FALSE)
DF.HetC.MixedModel.HQ$sex <- factor(DF.HetC.MixedModel.HQ$sex, ordered = FALSE)
DF.HetC.MixedModel.HQ$strain <- factor(DF.HetC.MixedModel.HQ$strain, ordered = FALSE)
#DF.HetC.MixedModel.HQ$species <- factor(DF.HetC.MixedModel.HQ$species, ordered = FALSE)

#kable(table(DF.HetC.MixedModel.HQ$sex, DF.HetC.MixedModel.HQ$strain))


all.cell.MM.HQ <- ddply(.data=DF.HetC.MixedModel.HQ,
                 .(sex, strain),
                 summarize,
                 all.cells = sum(Ncells)
)

```


```{r MLH1.HetC.rates, echo=FALSE, warning=FALSE}
#calculate the initial HetC levels from best quality mice and cells (compare both levels (cell and mouse average levels))
#subset MLH1_DF, remove non passing mice (as diagnoised from plots)
#remove quality 5 cells

#outgroups
#SPIC
HetC.SPIC <- MLH1_data[(MLH1_data$strain == "SPIC")&(MLH1_data$quality < 5),]
#unique(HetC.SPIC$mouse)
#non-passing mice
SPIC.remove.mice <- c("30may18_SPIC_f1", "8jun18_SPIC_m2")
HetC.SPIC <- HetC.SPIC[ ! HetC.SPIC$mouse %in% SPIC.remove.mice, ]
#calq sex mean
SPIC.mean.MLH1.obs <- ddply(.data=HetC.SPIC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)
SPIC.HETC.val <- SPIC.mean.MLH1.obs$mean.MLH1[1] / SPIC.mean.MLH1.obs$mean.MLH1[2]

#SPRET
HetC.SPRET <- MLH1_data[(MLH1_data$strain == "SPRET")&(MLH1_data$quality < 5),]
#unique(HetC.SPRET$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
SPRET.mean.MLH1.obs <- ddply(.data=HetC.SPRET, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)

SPRET.HETC.val <- SPRET.mean.MLH1.obs$mean.MLH1[1] / SPRET.mean.MLH1.obs$mean.MLH1[2]

#CAROLI
HetC.CAROLI <- MLH1_data[(MLH1_data$strain == "CAROLI")&(MLH1_data$quality < 5),]
#unique(HetC.CAROLI$mouse)
#non-passing mice
#SPRET.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAROLI.mean.MLH1.obs <- ddply(.data=HetC.CAROLI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)

#cast
HetC.CAST <- MLH1_data[(MLH1_data$strain == "CAST")&(MLH1_data$quality < 5),]
#unique(HetC.CAST$mouse)
#non-passing mice
#X.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
CAST.mean.MLH1.obs <- ddply(.data=HetC.CAST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean(nMLH1.foci),
                 var.MLH1 = var(nMLH1.foci)
)
CAST.HETC.val <- CAST.mean.MLH1.obs$mean.MLH1[1] / CAST.mean.MLH1.obs$mean.MLH1[2]

#HMI
HetC.HMI <- MLH1_data[(MLH1_data$strain == "HMI")&(MLH1_data$quality < 5),]
#unique(HetC.HMI$mouse)
#non-passing mice
#X.remove.mice <- c("", "")
#HetC.SPRET <- HetC.SPRET[ ! HetC.SPRET$mouse %in% SPRET.remove.mice, ]
#calq sex mean
HMI.mean.MLH1.obs <- ddply(.data=HetC.HMI, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

#dom

#WSB
HetC.WSB <- MLH1_data[(MLH1_data$strain == "WSB")&(MLH1_data$quality < 5),]
#unique(HetC.WSB$mouse)
#non-passing mice
WSB.remove.mice <- c("8oct14_WSB_f1", "18nov17_WSB_f5", "16jun15_WSB_f3","10mar15_WSB_m2")
HetC.WSB <- HetC.WSB[ ! HetC.WSB$mouse %in% WSB.remove.mice, ]
#calq sex mean
WSB.mean.MLH1.obs <- ddply(.data=HetC.WSB, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

WSB.HETC.val <- WSB.mean.MLH1.obs$mean.MLH1[1] / WSB.mean.MLH1.obs$mean.MLH1[2]


#LEW
HetC.LEW <- MLH1_data[(MLH1_data$strain == "LEW")&(MLH1_data$quality < 5),]
unique(HetC.LEW$mouse)
#non-passing mice
LEW.remove.mice <- c("4jan17_LEW_f2")
HetC.LEW <- HetC.WSB[ ! HetC.LEW$mouse %in% LEW.remove.mice, ]

#calq sex mean
LEW.mean.MLH1.obs <- ddply(.data=HetC.LEW, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

LEW.HETC.val <- LEW.mean.MLH1.obs$mean.MLH1[1] / LEW.mean.MLH1.obs$mean.MLH1[2]


#G
HetC.G <- MLH1_data[(MLH1_data$strain == "G")&(MLH1_data$quality < 5),]
#unique(HetC.G$mouse)
#non-passing mice
G.remove.mice <- c("8jun15_G_f3","8jun15_G_f4")
HetC.G <- HetC.G[ ! HetC.G$mouse %in% G.remove.mice, ]

#calq sex mean
G.mean.MLH1.obs <- ddply(.data=HetC.G, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]


#PERC
HetC.PERC <- MLH1_data[(MLH1_data$strain == "PERC")&(MLH1_data$quality < 5),]
#unique(HetC.PERC$mouse)
#non-passing mice
#G.remove.mice <- c("8jun15_G_f3","8jun15_G_f4")
#HetC.G <- HetC.PERC[ ! HetC.PERC$mouse %in% PERC.remove.mice, ]

#calq sex mean
PERC.mean.MLH1.obs <- ddply(.data=HetC.PERC, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
G.HETC.val <- G.mean.MLH1.obs$mean.MLH1[1] / G.mean.MLH1.obs$mean.MLH1[2]

#MUSC

#PWD
HetC.PWD <- MLH1_data[(MLH1_data$strain == "PWD")&(MLH1_data$quality < 5),]
#unique(HetC.PWD$mouse)
#non-passing mice
PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
PWD.mean.MLH1.obs <- ddply(.data=HetC.PWD, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
PWD.HETC.val <- PWD.mean.MLH1.obs$mean.MLH1[1] / PWD.mean.MLH1.obs$mean.MLH1[2]

# CZECH
HetC.CZECH <- MLH1_data[(MLH1_data$strain == "CZECH")&(MLH1_data$quality < 5),]
#unique(HetC.CZECH$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
CZECH.mean.MLH1.obs <- ddply(.data=HetC.CZECH, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

CZECH.HETC.val <- CZECH.mean.MLH1.obs$mean.MLH1[1] / CZECH.mean.MLH1.obs$mean.MLH1[2]


# SKIVE
HetC.SKIVE <- MLH1_data[(MLH1_data$strain == "SKIVE")&(MLH1_data$quality < 5),]
#unique(HetC.SKIVE$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
SKIVE.mean.MLH1.obs <- ddply(.data=HetC.SKIVE, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

SKIVE.HETC.val <- SKIVE.mean.MLH1.obs$mean.MLH1[1] / SKIVE.mean.MLH1.obs$mean.MLH1[2]

# KAZ
HetC.KAZ <- MLH1_data[(MLH1_data$strain == "KAZ")&(MLH1_data$quality < 5),]
#unique(HetC.KAZ$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
KAZ.mean.MLH1.obs <- ddply(.data=HetC.KAZ, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
KAZ.HETC.val <- KAZ.mean.MLH1.obs$mean.MLH1[1] / KAZ.mean.MLH1.obs$mean.MLH1[2]


#TOM
HetC.TOM <- MLH1_data[(MLH1_data$strain == "TOM")&(MLH1_data$quality < 5),]
#unique(HetC.TOM$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
TOM.mean.MLH1.obs <- ddply(.data=HetC.TOM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
TOM.HETC.val <- TOM.mean.MLH1.obs$mean.MLH1[1] / TOM.mean.MLH1.obs$mean.MLH1[2]

#AST
HetC.AST <- MLH1_data[(MLH1_data$strain == "AST")&(MLH1_data$quality < 5),]
#unique(HetC.AST$mouse)

#non-passing mice
#PWD.remove.mice <- c("1apr15_PWD_f2","8oct14_PWD_f2","8oct14_PWD_f5")
#HetC.PWD <- HetC.PWD[ ! HetC.PWD$mouse %in% PWD.remove.mice, ]

#calq sex mean
AST.mean.MLH1.obs <- ddply(.data=HetC.AST, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)
AST.HETC.val <- AST.mean.MLH1.obs$mean.MLH1[1] / AST.mean.MLH1.obs$mean.MLH1[2]


#Molosinus

#MSM
HetC.MSM <- MLH1_data[(MLH1_data$strain == "MSM")&(MLH1_data$quality < 5),]
unique(HetC.MSM$mouse)

#non-passing mice
MSM.remove.mice <- c("12sep16_MSM_f3")
HetC.MSM <- HetC.MSM[ ! HetC.MSM$mouse %in% MSM.remove.mice, ]

#calq sex mean
MSM.mean.MLH1.obs <- ddply(.data=HetC.MSM, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

MSM.HETC.val <- MSM.mean.MLH1.obs$mean.MLH1[1] / MSM.mean.MLH1.obs$mean.MLH1[2]


#MOLF
HetC.MOLF <- MLH1_data[(MLH1_data$strain == "MOLF")&(MLH1_data$quality < 5),]
unique(HetC.MOLF$mouse)

#non-passing mice
MOLF.remove.mice <- c("27oct18_MOLF_m3")
HetC.MOLF <- HetC.MOLF[ ! HetC.MOLF$mouse %in% MOLF.remove.mice, ]

#calq sex mean
MOLF.mean.MLH1.obs <- ddply(.data=HetC.MOLF, 
                 .(category),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 mean.MLH1 = mean( nMLH1.foci),
                 var.MLH1 = var( nMLH1.foci)
)

MOLF.HETC.val <- MOLF.mean.MLH1.obs$mean.MLH1[1] / MOLF.mean.MLH1.obs$mean.MLH1[2]

```


```{r MLH1.HetC.plot, echo=FALSE, warning=FALSE}
#HETC plot
#change the main data? 

HetC_strain_table.M <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "male"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length( nMLH1.foci),
                         mean_co = format(round(  mean( nMLH1.foci), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci),3), nsmall=3),
                         sd   = round(sd( nMLH1.foci), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#
#HetC_strain_table.M <- HetC_strain_table.M[ -c(7, 4, 10,11,12, 14, 17, 18,19), ]

HetC_strain_table.F <- ddply(MLH1_data[(MLH1_data$quality < 5)&(MLH1_data$sex == "female"),], c("strain"), summarise,
                         Nmice = length(unique(mouse)),
                         Ncells  = length( nMLH1.foci),
                         mean_co = format(round(  mean( nMLH1.foci), 3 ), nsmall=3),
                         var = format(round(   var(nMLH1.foci),3), nsmall=3),
                         sd   = round(sd( nMLH1.foci), 3),
                         se   = round(sd / sqrt(Ncells), 3),
                         cV = round( (as.numeric(sd) / as.numeric(mean_co) ),3)
)
#HetC_strain_table.F <- HetC_strain_table.F[ -c(11), ]

#remove the 'other'

HetC_strain_table.M$sex <- "male"
HetC_strain_table.F$sex <- "female"

HetC_strain_table <- merge(HetC_strain_table.M, HetC_strain_table.F, by= "strain")

HetC_strain_table <- add_subsp(HetC_strain_table)

#HetC_strain_table$subsp <- c("Dom", "Dom", "Dom", "Musc", "Musc","Musc","Musc", "Cast", "Outgroup","Outgroup")

HetC_strain_table$mean_co.x <- as.numeric(HetC_strain_table$mean_co.x)
HetC_strain_table$mean_co.y <- as.numeric(HetC_strain_table$mean_co.y)
#str(HetC_strain_table)

```

```{r juvimice.list, echo=FALSE}
juvi_mice <- c(
  "30dec14_WSB_m2","30dec14_WSB_m4","30dec14_WSB_m1","30dec14_WSB_m3","30dec14_WSB_m5",
  "30sep14_G_m1","30sep14_G_m2","30sep14_G_m3","30sep14_G_m4","30sep14_G_m5",
  "12Feb17_LEW_m1","12Feb17_LEW_m2", "13sep17_LEW_m2", "13sep17_LEW_m1","13sep17_LEW_m3",
 
  "12sep17_PWD_m1","12sep17_PWD_m2","12sep17_PWD_m3",
   "30Dec16_MSM_m2","30Dec16_MSM_m3","30Dec16_MSM_m1"
  )

#REMOVE JUVI mice
#juvi.mouse_CurBiv_table <- mouse.avs_4MM[mouse.avs_4MM$mouse  %in% juvi_mice, ]  
#mouse.avs_4MM <- mouse.avs_4MM[! mouse.avs_4MM$mouse  %in% juvi_mice, ] 

```

```{r CurBiv.Mouse.av.TABLE, echo=FALSE}

#this block should be in the data set up
#the mouse averages will be used

#18jul19_31may19_SKIVE_m2_sp1_13.2_rev_8 is missing the 1CO position -- remove for now
cleanCurated_BivData <- cleanCurated_BivData %>% filter(fileName != "18jul19_31may19_SKIVE_m2_sp1_13.2_rev_8")

#cleanCurated_BivData
#removed the no hand foci count

mouse.avs_4MM <- ddply(cleanCurated_BivData, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Ncells  = length(Obj.ID),
                       
                      # mean_CO = mean()
                       
                        mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                       
                       #calq mean.sc by chrm class
                       mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                       
                # IFD things
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                  
              #sis.co.ten!!
              mean.siscoten = mean(SisCoTen, na.rm=TRUE),
              
              mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
              mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
              mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
              
              mean.telo.dist = mean(telo_dist, na.rm=TRUE),
              mean.cent.dist = mean(dis.cent, na.rm=TRUE)
)

#vari
mouse.avs_4MM <- add_sex(mouse.avs_4MM)
mouse.avs_4MM <- add_strain(mouse.avs_4MM)
mouse.avs_4MM <- add_subsp(mouse.avs_4MM)
mouse.avs_4MM <- add_category(mouse.avs_4MM)

#unordered for the mixed models (move this to the MM blocks...?)
#keep order for the plots?
mouse.avs_4MM$subsp <- factor(mouse.avs_4MM$subsp, ordered = FALSE)
mouse.avs_4MM$sex <- factor(mouse.avs_4MM$sex, ordered = FALSE)
mouse.avs_4MM$strain <- factor(mouse.avs_4MM$strain, ordered = FALSE)

#MAKE the same version of the TABLE but for the longest_biv_Dataset (when I get around to making it)
#code if males are high or low?

#REMOVE JUVI mice
juvi.mouse_CurBiv_table <- mouse.avs_4MM[mouse.avs_4MM$mouse  %in% juvi_mice, ]  
mouse.avs_4MM <- mouse.avs_4MM[! mouse.avs_4MM$mouse  %in% juvi_mice, ]  

#assign high and low
#divide musc males into groups
mouse.avs_4MM$Rec.group <- ifelse(grepl("PWD male", mouse.avs_4MM$category), 1, 
                                ifelse(grepl("MSM male", mouse.avs_4MM$category), 1,
                                 ifelse(grepl("SKIVE male", mouse.avs_4MM$category), 1, 0)))


mouse.avs_4MM$Rec.group.exclu <- ifelse(grepl("PWD male", mouse.avs_4MM$category), 1, 
                                ifelse(grepl("MSM male", mouse.avs_4MM$category), 1, 0))

```


```{r algorithm_performance_stats, echo=FALSE}

#sort by category, 
#compare total boxes and rate passed
#Curated_BivData  -- pass rate?

#number of mice, number of cells
#mean number of isolate bivs per cell,
#use these two metrics
#cell.level.BivData_table$boxs.IDd 
#cell.level.BivData_table$nboxes_passed

#calq the mean rate by category

cell.level.BivData_table$pass.rate <- cell.level.BivData_table$nboxes_passed / cell.level.BivData_table$boxs.IDd 

algorithm.stat.mouse <- ddply(cell.level.BivData_table, c("mouse"), summarise,
                        n_obs = length( unique(fileName) ),
                         mean_pass.rate = mean(pass.rate)
                         )

cell.level.BivData_table <- add_sex(cell.level.BivData_table)

algorithm.stat.category <- ddply(cell.level.BivData_table, c("sex", "strain"), summarise,
                        n_obs = length(unique(fileName)),
                        mean_pass.rate = mean(pass.rate)
                         )

#showing the table..
#data.frame(table( droplevels( Curated_BivData  %>%  filter(hand.foci.count  == 0 | hand.foci.count  == 1 |                                       hand.foci.count  == 2 | hand.foci.count  == 3 | hand.foci.count  == 4 ) )$category ) )
```


RENAME the curate bivdata below

```{r Q1.biv.data_table.4MM.Male, echo=FALSE, eval=FALSE}

#add this to setup

#remove female, 
#add back in the BIVDATA from strains which were  removed for the sex-specific comparisons

#Curated_BivData_male  -- RE

male.av_4MM <- ddply(cleanCurated_BivData, c("mouse"), summarise,
                        Nmice = length(unique(mouse)),
                        Ncells  = length(Obj.ID),
                       
                      # mean_CO = mean()
                       
                        mean_SC = as.numeric(format(round(  mean(chromosomeLength), 3 ), nsmall=3) ),
                        cV = cv(chromosomeLength),
                        var = as.numeric(format(round(   var(chromosomeLength),3), nsmall=3) ),
                        sd   = round(sd(chromosomeLength), 3),
                        se   = round(sd / sqrt(Ncells), 3),
                       
                       #calq mean.sc by chrm class
                       mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                       
                # IFD things
                #  mean_IFD_ABS = as.numeric(format(round(  mean(IFD1_ABS, na.rm = TRUE), 3 ), nsmall=3) ),
                # mean_IFD_PER = as.numeric(format(round(  mean(IFD1_PER, na.rm = TRUE), 3 ), nsmall=3) ),
                 
                 mean_IFD.2CO_ABS = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                 mean_IFD.2CO_PER = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE),
                  
                       #CO position things, requires the melt?
              norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                  
              #sis.co.ten!!
              mean.siscoten = mean(SisCoTen, na.rm=TRUE),
              
              mean.siscoten_1CO = mean(SisCoTen[which(hand.foci.count == 1)], na.rm = TRUE),
              mean.siscoten_2CO = mean(SisCoTen[which(hand.foci.count == 2)], na.rm = TRUE),
              mean.siscoten_3CO = mean(SisCoTen[which(hand.foci.count == 3)], na.rm = TRUE),
              
              mean.telo.dist = mean(telo_dist, na.rm=TRUE),
              mean.cent.dist = mean(dis.cent, na.rm=TRUE)
)

#vari
male.av_4MM <- add_sex(male.av_4MM)
male.av_4MM <- add_strain(male.av_4MM)
male.av_4MM <- add_subsp(male.av_4MM)
male.av_4MM <- add_category(male.av_4MM)

#unordered for the mixed models (move this to the MM blocks...?)
#keep order for the plots?
male.av_4MM$subsp <- factor(male.av_4MM$subsp, ordered = FALSE)
male.av_4MM$sex <- factor(male.av_4MM$sex, ordered = FALSE)
male.av_4MM$strain <- factor(male.av_4MM$strain, ordered = FALSE)

#REMOVE JUVI mice
juvi.from.male.biv_table <- male.av_4MM[male.av_4MM$mouse  %in% juvi_mice, ]  
mouse.avs_4MM <- male.av_4MM[! male.av_4MM$mouse  %in% juvi_mice, ] 

```

```{r totSC_setup, echo=FALSE}
#SC.skel
#"anon.batch" "rand_name"  "bin_size"   "skel_size" , all batches included

SC.skel.OG <- SC.skel #5683

#MERGEING MLH1 with SKEL
MLH1.merge.Skel <- merge(original_DF, SC.skel, by.x = "Random.Name", by.y = "rand_name", all= F)

MLH1.merge.Skel <- add_mouse(MLH1.merge.Skel)
MLH1.merge.Skel <- add_strain(MLH1.merge.Skel)
MLH1.merge.Skel <- add_sex(MLH1.merge.Skel)
MLH1.merge.Skel <- add_subsp(MLH1.merge.Skel)
MLH1.merge.Skel <- add_category(MLH1.merge.Skel)
MLH1.merge.Skel <- add_subsp(MLH1.merge.Skel)
#5110, 

OG.MLH1.merge.Skel <- MLH1.merge.Skel #raw version of DF

#check for DUPs, #check for duplicatations of the random name
MLH1.merge.Skel$ fileName  <- as.character(MLH1.merge.Skel$fileName)
tot.SC.dupies <- MLH1.merge.Skel[duplicated(MLH1.merge.Skel$ fileName ),]

MLH1.merge.Skel <- MLH1.merge.Skel %>% filter( X == "") %>% filter(REDO.crop == "no")

MLH1.merge.Skel$bin_size <- as.numeric(MLH1.merge.Skel$bin_size)
MLH1.merge.Skel$skel_size <- as.numeric(MLH1.merge.Skel$skel_size)
#table(MLH1.merge.Skel$category)

#remove outliers
MLH1.merge.Skel <- MLH1.merge.Skel  %>% filter(bin_size < 60000)

```

```{r totSC.viz4outliers, echo=FALSE}

# -- EXAMINE the ggplot scatter plots for outliers
tot.sc <- ggplot(data= MLH1.merge.Skel, aes(y = bin_size, x=strain))+ geom_jitter()+facet_wrap(~category, scales = "free")

#round 1
SC.skel.outliers_round1 <- c(
  #MLH1.merge.Skel  %>% filter(category == "WSB male") %>% filter(skel_size > 2000)
  "10apr15_31mar15_WSB_m3_sp1_4_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "WSB female") %>% filter(skel_size > 2700)       
            "17nov16_3nov15_WSB_f1_sp3_4_rev.tif","1may16_3nov15_WSB_f1_sp2_6_rev.tif",
                      
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 20000) 
                      "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000) 
              "1mar16_20feb16_G_f3_sp1_8_rev.tif","21nov16_16jan16_G_f2_sp1_15_rev.tif",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW male") %>% filter(skel_size < 1000)          
          "6mar18_1feb18_LEW_m1_sp1_21.5_rev",
  
  #MLH1.merge.Skel  %>% filter(category == "LEW female") %>% filter(skel_size > 20000)   
          "12jan17_4jan17_LEW_f1_sp1_32_rev.tif","20mar17_13jan17_LEW_f2_sp1_12_rev.tif","9apr18_1feb18_LEW_f1_sp1_23_rev.tif","9apr18_1feb18_LEW_f1_sp1_12_rev.tif", 
                      
       #MLH1.merge.Skel  %>% filter(category == "PWD male") %>% filter(skel_size > 20000)  
                      "6mar15_1mar15_PWD_m1_sp4_6.1_rev.tif","7mar15_1mar15_PWD_m1_sp4_2_rev.tif","20jul15_18may15_PWD_m2_sp1_10.2_rev.tif",
           
   #MLH1.merge.Skel  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
   "6may15_17apr15_PWD_f1_sp1_7_rev",  
       
      #MLH1.merge.Skel  %>% filter(category == "KAZ male") %>% filter(skel_size < 1000)
            "6aug19_10jul19_KAZ_m1_sp1_7.1_rev.tif",
            
    # MLH1.merge.Skel  %>% filter(category == "KAZ female") %>% filter(skel_size > 30000)     
    "16feb18_1feb18_KAZ_f4_sp1_20_rev.tif",  "8feb18_1feb18_KAZ_f1_sp1_24_rev.tif",  
  "16feb18_1feb18_KAZ_f4_sp1_1_rev.tif",   "8feb18_1feb18_KAZ_f1_sp1_5_rev.tif",   
 "16feb18_1feb18_KAZ_f4_sp1_17_rev.tif",  "1mar18_1feb18_KAZ_f3_sp1_8_rev.tif",   
 "7feb18_11jan18_KAZ_f3_sp1_27_rev.tif",  "20apr18_11jan18_KAZ_f1_sp1_6_rev.tif", 
 "16feb18_1feb18_KAZ_f2_sp1_5.2_rev.tif", "16feb18_1feb18_KAZ_f2_sp1_15_rev.tif", 
"7feb18_11jan18_KAZ_f3_sp1_13_rev.tif",  "13apr18_1feb18_KAZ_f6_sp1_25_rev.tif" ,
            
  # MLH1.merge.Skel  %>% filter(category == "SKIVE female") %>% filter(skel_size > 10000)
    "10jun19_31may19_SKIVE_f6_sp1_47_rev.tif","10jun19_31may19_SKIVE_f6_sp1_7_rev.tif",

# MLH1.merge.Skel  %>% filter(category == "MOLF male") %>% filter(skel_size < 1200)
"4jun19_28sep18_MOLF_m1_sp1_10.1_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "AST male") %>% filter(skel_size > 2100)
"16aug19_27aug18_AST_m1_sp1_23_rev.tif",

#MLH1.merge.Skel  %>% filter(category == "MSM female") %>% filter(skel_size > 20000)
"21nov17_16nov17_MSM_f3_sp1_24_rev.tif","21nov17_16nov17_MSM_f3_sp1_3_rev.tif", "21nov17_16nov17_MSM_f3_sp1_27_rev.tif","4dec17_16nov17_MSM_f2_sp1_10_rev.tif",
"5aug17_14jul17_MSM_f1_sp1_25_rev.tif","24jan18_31dec17_MSM_f3_sp1_3_rev.tif", 
"24jan18_31dec17_MSM_f3_sp1_22_rev.tif","21nov17_16nov17_MSM_f3_sp1_17_rev.tif",

#tt <- MLH1.merge.Skel  %>% filter(category == "SPIC female") %>% filter(skel_size > 20000)
"27dec17_4dec17_SPIC_f1_sp1_12_rev.tif",  "5apr18_31dec17_SPIC_f2_sp1_1_rev.tif",
 "26sep18_30may18_SPIC_f4_sp1_14_rev.tif", "4feb18_31dec17_SPIC_f1_sp1_21_rev.tif", 
 "5apr18_31dec17_SPIC_f2_sp1_22_rev.tif",  "27dec17_4dec17_SPIC_f1_sp1_40_rev.tif", 
 "4jul18_30may18_SPIC_f1_sp1_6_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_6_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_10_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_37_rev.tif" , 
 "5sep17_21aug17_SPI_f2_sp1_15_rev.tif",   "26sep18_30may18_SPIC_f4_sp1_24_rev.tif",
"29dec17_4dec17_SPIC_f2_sp1_16_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_30_rev.tif",  
"4feb18_31dec17_SPIC_f1_sp1_5_rev.tif",   "5apr18_31dec17_SPIC_f2_sp1_25_rev.tif", 
 "26sep18_30may18_SPIC_f4_sp1_4_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_22_rev.tif",  
 "5sep17_21aug17_SPI_f2_sp1_19_rev.tif",   "5sep17_21aug17_SPI_f2_sp1_29_rev.tif",  
 "26sep18_30may18_SPIC_f4_sp1_3_rev.tif",  "5sep17_21aug17_SPI_f2_sp1_5.2_rev.tif", 
 "29dec17_4dec17_SPIC_f2_sp1_6_rev.tif",   "13oct17_21aug17_SPI_f1_sp1_13_rev.tif"  )


MLH1.merge.Skel_1 <- MLH1.merge.Skel[!MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1, ]#62 removed


remove.mice_round2 <- c(
    #MLH1.merge.Skel  %>% filter(category == "G male") %>% filter(skel_size > 2500)
    "28jul15_22jun15_G_m2_sp1_5_rev.tif","12may15_30sep14_G_m5_sp1_26_rev.tif",  
    
    #MLH1.merge.Skel  %>% filter(category == "G female") %>% filter(skel_size > 20000)
  "19oct15_12oct15_G_m1_sp1_17.1_rev.tif",
  
#MLH1.merge.Skel_2  %>% filter(category == "PWD male") %>% filter(skel_size > 2100)
"20jul15_18may15_PWD_m1_sp1_10_rev.tif","22mar15_10mar15_PWD_m2_sp1_11.2_rev.tif","22mar15_10mar15_PWD_m1_sp1_4.1_rev.tif","20jul15_18may15_PWD_m1_sp1_7.2_rev.tif",  

#MLH1.merge.Skel_2  %>% filter(category == "PWD female") %>% filter(skel_size > 20000)
  "6may15_17apr15_PWD_f1_sp1_7_rev.tif",
  
  #MLH1.merge.Skel_2  %>% filter(category == "KAZ female") %>% filter(skel_size < 1000)
  "8feb18_1feb18_KAZ_f1_sp1_19_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW male") %>% filter(skel_size < 1000 | skel_size > 1750)
"6mar18_1feb18_LEW_m1_sp1_10_rev.tif","3mar15_13jan17_LEW_m1_sp1_15_rev.tif", "4feb17_4jan17_LEW_m1_sp1_13_rev.tif","6mar18_1feb18_LEW_m1_sp1_21.5_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "LEW female") %>% filter(skel_size > 2750 ) 
"20mar17_13jan17_LEW_f2_sp1_10_rev.tif",

# MLH1.merge.Skel_2  %>% filter(category == "CAROLI male") %>% filter(skel_size < 1400 )
"31aug18_1mar18_CAROLI_m1_sp3_29.2_rev.tif",

#MLH1.merge.Skel_2  %>% filter(category == "MSM male") %>% filter(skel_size < 1200 )
"16aug17_5jul17_MSM_m1_sp1_6.1_rev.tif",

#tt <- MLH1.merge.Skel_2  %>% filter(category == "MSM female") %>% filter(skel_size > 2850 ) 
"29nov17_16nov17_MSM_f1_sp1_10_rev.tif", "4dec17_16nov17_MSM_f2_sp1_24_rev.tif", "21nov17_16nov17_MSM_f3_sp1_26_rev.tif",
#SPIC male  x
#SPIC female  x
#TOM x
#AST x
#CZECH male x 

#MLH1.merge.Skel_2  %>% filter(category == "SPRET male") %>% filter(skel_size < 1900 ) 
 "24may17_8may17_SPRET_m1_sp1_21.1_rev.tif",
#SPRET female X
#MLH1.merge.Skel_2  %>% filter(category == "HMI male") %>% filter(skel_size < 1000 ) 
"29dec17_4dec17_HMI_m1_sp1_4.1_rev.tif"
)
#3remove.mice_round2

MLH1.merge.Skel_2 <- MLH1.merge.Skel_1[!MLH1.merge.Skel_1$fileName %in% remove.mice_round2, ]
#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% SC.skel.outliers_round1),]
#MLH1.merge.Skel <- MLH1.merge.Skel[! (MLH1.merge.Skel$fileName %in% remove.mice_round2),]
all.remove <- paste( c(SC.skel.outliers_round1, remove.mice_round2 ) )

MLH1.merge.Skel <- MLH1.merge.Skel_2

MLH1.merge.Skel <- add_species(MLH1.merge.Skel)

```

```{r tot.skel.table, echo=FALSE}

MLH1.merge.Skel$nMLH1.foci <- as.numeric(MLH1.merge.Skel$nMLH1.foci)

totSC.mouse.av.table <- ddply(.data=MLH1.merge.Skel, 
                 .(mouse),
                 summarize, 
                 ncells = length(unique(Original.Name)),
                 nmice = length(unique(mouse)),
                 
                 mean.MLH1 = mean(nMLH1.foci, na.rm = TRUE),
                 var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(skel_size, na.rm = TRUE),
                #se for skel
                
                 mean.bin =  mean(bin_size, na.rm = TRUE)
                 
)

totSC.mouse.av.table <- add_strain(totSC.mouse.av.table)
totSC.mouse.av.table <- add_sex(totSC.mouse.av.table)
totSC.mouse.av.table <- add_category(totSC.mouse.av.table)
totSC.mouse.av.table <- add_subsp(totSC.mouse.av.table)
totSC.mouse.av.table <- add_species(totSC.mouse.av.table)

#unorder the factors
totSC.mouse.av.table$subsp <- factor(totSC.mouse.av.table$subsp, ordered = FALSE)
totSC.mouse.av.table$sex <- factor(totSC.mouse.av.table$sex, ordered = FALSE)
totSC.mouse.av.table$strain <- factor(totSC.mouse.av.table$strain, ordered = FALSE)
totSC.mouse.av.table$species <- factor(totSC.mouse.av.table$species, ordered = FALSE)

#add rec group
totSC.mouse.av.table$Rec.group <- ifelse(grepl("PWD male", totSC.mouse.av.table$category), 1, 
                              ifelse(grepl("MSM male", totSC.mouse.av.table$category), 1,
                                ifelse(grepl("SKIVE male", totSC.mouse.av.table$category), 1, 0)))

OG.totSC.mouse.av.table <- totSC.mouse.av.table

#REMOVE JUVI mice
tot.SC_juvi.male <- totSC.mouse.av.table[totSC.mouse.av.table$mouse  %in% juvi_mice, ]

totSC.mouse.av.table <- totSC.mouse.av.table[! totSC.mouse.av.table$mouse  %in% juvi_mice, ] 

totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain!="CAST" & strain !="F1" & strain !="SPIC" & strain !=  "CAROLI" & strain !="SPRET"& strain !="HMI"& strain !="PERC")

```


```{r tot.SC.setup, echo = FALSE}

totSC.strain.av.table <- ddply(.data=totSC.mouse.av.table, 
                 .(sex,strain),
                 summarize, 
                 ncells = sum(ncells),
                 nmice = length(unique(mouse)),
                 
                av.MLH1 = mean( mean.MLH1, na.rm = TRUE),
                # var.MLH1 = var( nMLH1.foci, na.rm = TRUE),
                 
                 mean.skel = mean(mean.skel, na.rm = TRUE),
                 mean.bin =  mean(mean.bin, na.rm = TRUE)
                 
)

totSC.strain.av.table <- add_subsp(totSC.strain.av.table)

```

```{r LONG.SHORT.biv_setup, echo=FALSE}

#FROM q1
#Q1.long.biv_1CO <-  real.long.bivData %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1) %>% filter(strain != "MOLF") %>% filter(strain != "CZECH")
#Q1.short.biv_1CO <-  real.short.bivData %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 1)%>% filter(strain != "MOLF") %>% filter(strain != "CZECH")
#from Q2 IFD
#male.long.biv.2CO_IFD <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)
##long biv
#male.long.biv <- real.long.bivData %>% filter(sex== "male") %>% filter(species == "M.musculus") 
#table( droplevels( male.long.biv$strain)  )

#FROM q1 
REAL.short_mouse_table <- ddply(real.short.bivData, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                        ncells = length(unique(fileName)),
                         mean_SC = mean(chromosomeLength),
                        
                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                        
                      #make sure 1CO  
                       #IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE
                    mean_F1pos_ABS =  mean(Foci1[which(hand.foci.count == 1)]),
                    mean_F1pos_PER =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                           
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                                            
                         )

REAL.short_mouse_table <- add_sex(REAL.short_mouse_table)
REAL.short_mouse_table <- add_strain(REAL.short_mouse_table)
REAL.short_mouse_table <- add_subsp(REAL.short_mouse_table)
REAL.short_mouse_table <- add_category(REAL.short_mouse_table)

REAL.short_mouse_table$sex <- factor(REAL.short_mouse_table$sex, ordered = FALSE)
REAL.short_mouse_table$strain <- factor(REAL.short_mouse_table$strain, ordered = FALSE)
REAL.short_mouse_table$subsp <- factor(REAL.short_mouse_table$subsp, ordered = FALSE)

#divide musc males into groups
REAL.short_mouse_table$Rec.group <- ifelse(grepl("PWD male", REAL.short_mouse_table$category), 1, 
                                  ifelse(grepl("MSM male", REAL.short_mouse_table$category), 1,
                                  ifelse(grepl("SKIVE male", REAL.short_mouse_table$category), 1,
                                           0)))

REAL.short_mouse_table$Rec.group.exclu <- ifelse(grepl("PWD male", REAL.short_mouse_table$category), 1, 
                                ifelse(grepl("MSM male", REAL.short_mouse_table$category), 1, 0))

###LONG BIV

REAL.long_mouse_table <- ddply(real.long.bivData, c("mouse"), summarise,
                       n_obs = length(Obj.ID),
                        ncells = length(unique(fileName)),
                         mean_SC = mean(chromosomeLength),
                        
                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE),
                        
                      #make sure 1CO,  #IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE
                    mean_F1pos_ABS =  mean(Foci1[which(hand.foci.count == 1)]),
                    mean_F1pos_PER =  mean(PER_Foci_1[which(hand.foci.count == 1)]),
                           
                      meanIFD2CO_raw = mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),
                     meanIFD2CO_norm = mean(IFD1_PER[which(hand.foci.count == 2)], na.rm = TRUE)
                         )

REAL.long_mouse_table <- add_sex(REAL.long_mouse_table)
REAL.long_mouse_table <- add_strain(REAL.long_mouse_table)
REAL.long_mouse_table <- add_subsp(REAL.long_mouse_table)
REAL.long_mouse_table <- add_category(REAL.long_mouse_table)

REAL.long_mouse_table$sex <- factor(REAL.long_mouse_table$sex, ordered = FALSE)
REAL.long_mouse_table$strain <- factor(REAL.long_mouse_table$strain, ordered = FALSE)
REAL.long_mouse_table$subsp <- factor(REAL.long_mouse_table$subsp, ordered = FALSE)

#divide musc males into groups
REAL.long_mouse_table$Rec.group <- ifelse(grepl("PWD male", REAL.long_mouse_table$category), 1, 
                                  ifelse(grepl("MSM male", REAL.long_mouse_table$category), 1,
                                  ifelse(grepl("SKIVE male", REAL.long_mouse_table$category), 1,
                                           0)))

REAL.long_mouse_table$Rec.group.exclu <- ifelse(grepl("PWD male", REAL.long_mouse_table$category), 1, 
                                ifelse(grepl("MSM male", REAL.long_mouse_table$category), 1, 0))


#find which one 
```


# Datasubsets


```{r Q1.Short.Long_biv.setup, echo=FALSE}

#REAL.long_mouse_table
#REAL.short_mouse_table

#make the Q1 strain list
Q1.real.short_mouse_table <- REAL.short_mouse_table %>% filter( (strain != "CZECH") & (strain != "MOLF") )

Q1.real.long_mouse_table <- REAL.long_mouse_table %>% filter( (strain != "CZECH") & (strain != "MOLF") )

```


# MLH1 models

M1 - subsp, sex, (1 | strain)
M2 - subsp, sex, strain
M3 - sex, strain
M4 - strain (sex specific)


```{r MLH1co.lmer.MM1, echo=FALSE, waring=FALSE, message=FALSE}

#DF.HetC.MixedModel.HQ

MLH1.MM.M1 <- lmer(mean_co ~ subsp * sex + (1|strain), data=DF.HetC.MixedModel.HQ) 
MLH1.MM.M1.reduce.sex <- lmer( mean_co ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1.MM.M1.reduce.subp <- lmer( mean_co ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

#summary(MLH1.MM.M1)$coefficients

MLH1.MM_interaction <- drop1(MLH1.MM.M1, test="Chisq")$`Pr(Chi)`[2]
MLH1.MM_sex <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
MLH1.MM_subp <- anova(MLH1.MM.M1, MLH1.MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
MLH1.MM_strain<- MM.rand.pval <- exactRLRT(MLH1.MM.M1)$p.value 

MLH1.MMlmer_results <- data.frame(sub.sp = MLH1.MM_subp, 
sex.results =  MLH1.MM_sex, 
               interaction.pval = MLH1.MM_interaction,  rand.pval = 
MLH1.MM_strain)

```

```{r MLH1.glmM2, echo=FALSE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")
#AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
#kkll <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

#strain = fixed
MLH1.M2.glm.strain.fixed.full <- glm(mean_co ~ subsp * sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]   )

summ.MLH1.M2.glm.strain.fixed.full <- summary(MLH1.M2.glm.strain.fixed.full)

#table of just coeff anf pvalue
#round(summ$coefficients[,c(1,4)],5 )

#write.table(summ$coefficients , "~./MLH1repo/glm.strain.fixed.full.csv", sep=",",row.names = TRUE)
```


```{r MLH1.glm.M3, echo=FALSE}

remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

MLH1.M3.strain.fixed <- lm(mean_co ~ sex * strain, data=DF.HetC.MixedModel.HQ[  ! DF.HetC.MixedModel.HQ$strain %in% remove_strains,])

summ.MLH1.M3.strain.fixed <- summary(MLH1.M3.strain.fixed)

#round(summ.strain.fixed$coefficients[,c(1,4)],5)

#write.table(summ.strain.fixed$coefficients , "~./MLH1repo/summ.strain.fixed.csv", sep=",",row.names = TRUE)
```


```{r MLH1.M4, echo=FALSE}

```


```{r Female.specific.glm, echo=FALSE}

glm.female.strain.subsp <- glm(mean_co ~ subsp * strain, data= female_mouse.avs_for.analysis)

summry.female.strain.effects <- summary(glm.female.strain.subsp)
#round(summry.female.strain.effects$coefficients[,c(1,4)],5)
#write.table(summry.female.strain.effects$coefficients, "~./MLH1repo/summry.female.strain.effects.csv", sep=",",row.names = TRUE)

MLH1.female.spc.glm.M2 <- glm(mean_co ~ strain, data= female_mouse.avs_for.analysis)
sum_MLH1.female.spc.glm.M2 <- summary(MLH1.female.spc.glm.M2)

#round(lm.female.strain_sum$coefficients[,c(1,4)],5)

#write.table(lm.female.strain_sum$coefficients, "~./MLH1repo/lm.female.strain.csv", sep=",",row.names = TRUE)
```



```{r Male.specific.glm, echo=FALSE}
# 1 way anova, is at least 1 strain different from the rest?
# given a lm, how sig is the strain effect
glm.male.strain.subsp <- glm(mean_co ~ subsp * strain, data= just.male_mouse.av)

#summry.male.strain.effects <- summary(glm.male.strain.subsp)
#round(summry.male.strain.effects$coefficients[,c(1,4)], 5)

#write.table(summry.male.strain.effects$coefficients , "~./MLH1repo/summry.male.strain.effects.csv", sep=",",row.names = TRUE)

#1. determine which strain effects are sig

#M2
MLH1.male.specific.glm.M2 <- glm(mean_co ~ strain, data= just.male_mouse.av)
sum_MLH1.male.specific.glm.M2 <- summary(MLH1.male.specific.glm.M2)

#round(lm.male.strain_sum$coefficients[,c(1,4)], 5)

#write.table(lm.male.strain_sum$coefficients , "~./MLH1repo/lm.male.strain_sum.csv", sep=",",row.names = TRUE)

#even when all the other male strains are added -- the same result; PWD, MSM and SKIVE strain effects are significant.
```

```{r MALE.SPECIFIC.variance.model, echo=FALSE}
## within mouse variance models 
lmVAR.male.strain.subsp <- lm(var ~ subsp * strain, data= just.male_mouse.av)
summry.male.strain.VAReffects <- summary(lmVAR.male.strain.subsp)
#round(summry.male.strain.VAReffects$coefficients[,c(1,4)], 5)

#all p values kinda high, MSM and TOM are slightly sig
lmVAR.male.strain <- lm(var ~ strain, data= just.male_mouse.av)
lmVAR.male.strain_sum <- summary(lmVAR.male.strain)
#round(lmVAR.male.strain_sum$coefficients[,c(1,4)], 5)
#non sig

lmcv.male.strain <- lm(cV ~ strain, data= just.male_mouse.av)
lmcv.male.strain_sum <- summary(lmcv.male.strain)
#round(lmcv.male.strain_sum$coefficients[,c(1,4)], 5)
#HMI sig for cv model -- in the other model, CAST subsp and TOM strain are slightly significant

#Q12
Q12_male_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "male")

lm.m1.Q12_male <- lm(var ~ subsp * strain, data= Q12_male_table)
lm.m1.Q12_male_sum <- summary(lm.m1.Q12_male)
#round(lm.m1.Q12_male_sum$coefficients[,c(1,4)], 5)
#NS

lm.m2.Q12_male <- lm(var ~ strain, data= Q12_male_table)
lm.m2.Q12VAR.male_sum <- summary(lm.m2.Q12_male)
#round(lm.m2.Q12VAR.male_sum$coefficients[,c(1,4)], 5)
#NS

```



#MLH1 variance models

M1 - subsp, sex, (1 | strain)  (lmer)
M2 - subsp, sex, strain  (glm / lm?)
M3 - sex, strain
M4 - strain (sex specific)


```{r M1.MLH1.var_cv, echo=FALSE, warning=FALSE, message=FALSE}
MLH1var_M1 <- lmer( var ~ subsp * sex +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1var_M1.reduce.sex <- lmer( var ~ subsp  +(1|strain), data=DF.HetC.MixedModel.HQ )
MLH1var_M1.reduce.subp <- lmer( var ~ sex  +(1|strain), data=DF.HetC.MixedModel.HQ )

#summary(MLH1var_M1)
LmerMLH1_VAR_int <- drop1(MLH1var_M1, test="Chisq")$`Pr(Chi)`[2]
LmerMLH1_VAR_sex <- anova(MLH1var_M1, MLH1var_M1.reduce.sex)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_subsp <- anova(MLH1var_M1, MLH1var_M1.reduce.subp)$`Pr(>Chisq)`[2]
LmerMLH1_VAR_strain <- exactRLRT(MLH1var_M1)$p.value

LmerMLH1_VAR_results <- data.frame(sub.sp = LmerMLH1_VAR_subsp,
sex.results =  LmerMLH1_VAR_sex, interaction.pval = LmerMLH1_VAR_int,  rand.pval = LmerMLH1_VAR_strain)

```

standardize the lm's and glms!

```{r M2.MLH1.var, echo=FALSE, include=FALSE}
#not including this model for now / brivity
#$$mouse CO metric  ~=~ subsp * sex * strain + \varepsilon$$

MLH1var_M2 <- lm( var ~ subsp * sex * strain,  data=DF.HetC.MixedModel.HQ )
MLH1var_M2_sum <- summary(MLH1var_M2)

#summary(MLH1var_M2)
#anova(MLH1var_M2)  
#as.data.frame( round(summary(MLH1var_M2)$coefficients, 6)) #table of p values for coefficients.

MLH1cv_M2 <- lm(cV ~ subsp*sex*strain, data=DF.HetC.MixedModel.HQ)

#summary(MLH1cv_M3)
#anova(MLH1cv_M2)
#as.data.frame( round(summary(MLH1cv_M2)$coefficients, 6))

#Q12 var
MLH1var_M2_Q12 <- lm( var ~ subsp*sex*strain,  data=Q12_mouse_table_w.Ages )

#summary(MLH1var_M3_Q12)
#anova(MLH1var_M2_Q12)  
#as.data.frame( round(summary(MLH1var_M2_Q12)$coefficients, 6))

#Q12 cv
MLH1cv_M2_Q12 <- lm( cV ~ subsp*sex*strain, data=Q12_mouse_table_w.Ages )

#summary(MLH1cv_M2_Q12)
#anova(MLH1cv_M2_Q12)#sex large F
#as.data.frame( round(summary(MLH1cv_M2_Q12)$coefficients, 6))
```

```{r M3.MLH1.var, echo=FALSE}
glmMLH1Var_M3 <- glm( var ~ sex * strain,  data=DF.HetC.MixedModel.HQ )
glmMLH1Var_M3_sum <- summary(glmMLH1Var_M3)
#round(glmMLH1Var_M3_sum$coefficients[,c(1,4)], 5)

MLH1cv_M3 <- glm(cV ~ sex * strain, data=DF.HetC.MixedModel.HQ)
#summary(MLH1cv_M4)
#round(summary(MLH1cv_M3)$coefficients[,c(1,4)], 6)

### Q12 var
MLH1var_M3_Q12 <- glm( var ~ sex*strain, data=Q12_mouse_table_w.Ages )
MLH1var_M3_Q12_sum <- summary(MLH1var_M3_Q12)

#as.data.frame( round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6))
#round(summary(MLH1var_M3_Q12)$coefficients[,c(1,4)], 6)

#Q12 cv
MLH1cv_M4_Q12 <- glm( cV ~ sex*strain, data=Q12_mouse_table_w.Ages )
#round(summary(MLH1cv_M4_Q12)$coefficients[,c(1,4)], 6)
```

```{r MLH1.var.M4}

#male
glmMLH1Var_M4.male <- glm( var ~ subsp * strain,  data= (DF.HetC.MixedModel.HQ %>% filter(sex == "male") ) )


#female
glmMLH1Var_M4.female <- glm( var ~ subsp * strain,  data= (DF.HetC.MixedModel.HQ %>% filter(sex == "female") ) )


glmMLH1Var_M4.femaleQ12 <- glm( var ~ subsp * strain,  data= (Q12_mouse_table_w.Ages %>% filter(sex == "female") ) )

```

```{r FEMALE.VAR.MODELS, echo=FALSE}
## within mouse variance models 
lmVAR.female.strain.subsp <- glm(var ~ subsp * strain, data= female_mouse.avs_for.analysis)
summry.female.strain.VAReffects <- summary(lmVAR.female.strain.subsp)

lmVAR.female.strain <- glm(var ~ strain, data= female_mouse.avs_for.analysis)
lmVAR.female.strain_sum <- summary(lmVAR.female.strain)

#round( #round isn't working for this sumary
#lmVAR.female.strain_sum$coefficients[,c(1,4)]
#Q12
Q12_female_table <-  Q12_mouse_table_w.Ages %>% filter(sex == "female")

lm.m1.Q12_female <- glm(var ~ subsp * strain, data= Q12_female_table)
lm.m1.Q12_female_sum <- summary(lm.m1.Q12_female)


lm.m2.Q12_female <- glm(var ~ strain, data= Q12_female_table)
lm.m2.Q12VAR.female_sum <- summary(lm.m2.Q12_female)#LEW changes to PWD

lm.m2.Q12_female.cv <- glm(cV ~ strain, data= Q12_female_table)
lm.m2.Q12_female.cv_sum <- summary(lm.m2.Q12_female.cv)

#lm.m2.Q12VAR.female_sum$coefficients[,c(1,4)]
#LEW sig

```



# DMC1 Results

main table (DMC1.mean.table), t.tests  , ratios

set up, t.tests, correlations

```{r DMC1.setup, echo=FALSE}
#load DMC1 csv
#DMC1.DF <- read.csv("~./DMC1/newJuviQuant.csv", header = TRUE)
DMC1.DF <- read.csv("~./MLH1repo/data/DMC1newJuviQuant.csv", header = TRUE)


DMC1.DF$fileName <- DMC1.DF$Original.Name
DMC1.DF <- add_mouse(DMC1.DF)
DMC1.DF <- add_strain(DMC1.DF)
DMC1.DF <- add_category(DMC1.DF)
DMC1.DF <- add_subsp(DMC1.DF)
DMC1.DF <- DMC1.DF[DMC1.DF$stage != "P",]

#make DMC1 table
DMC1.mean.obs.L <- ddply(.data=DMC1.DF[DMC1.DF$stage == "L",],
                 .(category),
                 summarize, 
                 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.L$stage <- "L"

DMC1.mean.obs.Z <- ddply(.data=DMC1.DF[DMC1.DF$stage == "Z",],
                 .(category),
                 summarize, 
                 ncells = length(fileName),
                 mean.count = mean( total.count)
)
DMC1.mean.obs.Z$stage <- "Z"

DMC1.mean.table <- rbind(DMC1.mean.obs.L,DMC1.mean.obs.Z)

#write.table(DMC1.mean.table, "~./MLH1repo/DMC1.mean.table.csv", sep=",",
#            row.names = FALSE)

DMC1.DF$rec_group <- ifelse(grepl("WSB", DMC1.DF$strain), "Low",
                          ifelse(grepl("G",DMC1.DF$strain), "Low",
                                 
              ifelse(grepl("KAZ", DMC1.DF$strain), "Low",
            ifelse(grepl("PWD", DMC1.DF$strain), "High",
               ifelse(grepl("MSM", DMC1.DF$strain), "High","")))))

#make category averages from AP_mouse_table.HQ
mean.MLH1.obs <- ddply(.data=AP_mouse_table.HQ,
                 .(category),
                 summarize, 
                 mean.MLH1 = mean(mean_co),
                 var.MLH1 = var(mean_co)
)

DMC1.target.strains <- subset(mean.MLH1.obs, category == "G male" |
                   category == "WSB male" |
                     category == "KAZ male" |
                  category == "MSM male" |
                    category == "PWD male")
#attach this mini DF to the DMC1 data


```


```{r DMC1_t.tests, echo=FALSE, warning=FALSE}
#2. t-tests for the DMC1 counts 
#need to account for sample sizes when comparing t.tests (KAZ and G don't have equal across )
#best case scnario -- more microscoping to get ~20 cells for each stage by strain combo


#high vs low group (L)
ttest.HighLow.L.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "L") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value =  0.002145


#high vs low group (Z)
ttest.HighLow.Z.pval <- t.test(DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "MSM") | (DMC1.DF$strain == "PWD") ) )  ],
               DMC1.DF$total.count[( (DMC1.DF$stage == "Z") & ( ( DMC1.DF$strain == "WSB") | (DMC1.DF$strain == "G") | (DMC1.DF$strain == "KAZ") ) )]    )$p.value
# p-value = 0.6628


#dom vs musc (L) (2 subsp vs)
ttest.subsp.L <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "L")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "L")] )
# p-value = 0.003016

#dom vs musc (Z)
ttest.subsp.Z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], DMC1.DF$total.count[(DMC1.DF$subsp == "Musc") & (DMC1.DF$stage == "Z")] )
#p-value = 0.09588

#KAZ vs Dom (Z) (only 1 L cell)
ttest.KAZ.Dom.z <- t.test(DMC1.DF$total.count[(DMC1.DF$subsp == "Dom") & (DMC1.DF$stage == "Z")], 
      DMC1.DF$total.count[(DMC1.DF$strain == "KAZ") & (DMC1.DF$stage == "Z")] )

#p-value = 0.004148
#Kaz Z are higher than Dom
```


```{r DMC1.rand.calq, echo=FALSE}

DMC1.mean.obs.L$mean.count.L <- DMC1.mean.obs.L$mean.count
DMC1.mean.obs.Z$mean.count.Z <- DMC1.mean.obs.Z$mean.count


DMC1table <- merge(DMC1.mean.obs.L, DMC1.mean.obs.Z, by="category")

DMC1table.main <- merge(DMC1.target.strains, DMC1table, by="category")

MLH1.DMC1.L_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.L, method = c("pearson"))#MLH1.DMC1.Z_cor

MLH1.DMC1.Z_cor <- cor(DMC1table.main$mean.MLH1, DMC1table.main$mean.count.Z, method = c("pearson"))#0.2793237
```


```{r DMC1.ratios, echo=FALSE}

##RATIOS
DMC1table.main$MLH1.L_ratio <- DMC1table.main$mean.MLH1/ DMC1table.main$mean.count.L 
DMC1table.main$MLH1.Z_ratio <- DMC1table.main$mean.MLH1 / DMC1table.main$mean.count.Z
  
#colnames(DMC1table.main) <- c("category", "mean.MLH1", "", "", "")

#DMC1.mean.table
DMC1.mean.table.99 <- subset(DMC1table.main, select= -c(var.MLH1,  mean.count.x,  mean.count.y, stage.x, stage.y))

colnames(DMC1.mean.table.99) <- c("category","mean.MLH1","ncells.L","mean.L",
                  "ncells.Z", "mean.Z", "MLH1.L_ratio", "MLH1.Z_ratio")


WSB_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "WSB male") )$mean.count.L / (DMC1table.main %>% filter(category == "WSB male"))$mean.MLH1
  
G_DMC1.Z_CO_ratio <-   ( DMC1table.main %>% filter(category == "G male") )$mean.count.L / (DMC1table.main %>% filter(category == "G male"))$mean.MLH1

MSM_DMC1.Z_CO_ratio <- ( DMC1table.main %>% filter(category == "MSM male") )$mean.count.L / (DMC1table.main %>% filter(category == "MSM male"))$mean.MLH1

PWD_DMC1.Z_CO_ratio <-( DMC1table.main %>% filter(category == "PWD male") )$mean.count.L / (DMC1table.main %>% filter(category == "PWD male"))$mean.MLH1



DMC1table.main$category <- factor(DMC1table.main$category, levels = c("WSB male","G male","KAZ male",               "PWD male","MSM male"), ordered = TRUE )

DMC1table.main <- DMC1table.main[order(DMC1table.main$category),]

kable(head(DMC1table.main),  caption = "Table X. DMC1 foci counts per cell summary")


DMC1.Lratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.L_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.L_ratio        )
                               

DMC1.Zratio_t.test <- t.test(  (DMC1table.main %>% filter(  ( category == "G male" | category == "WSB male" | category == "KAZ male" ) ) )$MLH1.Z_ratio, 
                (DMC1table.main %>% filter(  ( category == "PWD male" | category == "MSM male") ) )$MLH1.Z_ratio        )

```


#Q2 section

#Q2 SC 

```{r Q2.SC.short.long.setup, echo=FALSE}

#table(male.long.biv$strain)
#the Long biv dataset is quite unbalance (esp MSM)
male.long.biv <- real.long.bivData %>% filter(sex== "male")

#mouse av for long biv
cell.av.long.biv.table <- ddply(male.long.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
cell.av.long.biv.table <- add_mouse(cell.av.long.biv.table)
cell.av.long.biv.table <- add_strain(cell.av.long.biv.table)
cell.av.long.biv.table <- add_subsp(cell.av.long.biv.table)

cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)
cell.av.long.biv.table$strain <- factor(cell.av.long.biv.table$strain, ordered = FALSE)


Q2mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                         #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)])
                         )

Q2mouse.av.long.biv.table <- add_strain(Q2mouse.av.long.biv.table)
Q2mouse.av.long.biv.table <- add_subsp(Q2mouse.av.long.biv.table)

Q2mouse.av.long.biv.table$strain <- factor(Q2mouse.av.long.biv.table$strain, ordered = FALSE)
Q2mouse.av.long.biv.table$subsp <- factor(Q2mouse.av.long.biv.table$subsp, ordered = FALSE)

#divide musc males into groups
Q2mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.long.biv.table$strain), 1, 
                                  ifelse(grepl("MSM", Q2mouse.av.long.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.long.biv.table$strain), 1,
                                           0)))

Q2mouse.av.long.biv.table$Rec.group.exclu <- ifelse(grepl("PWD", Q2mouse.av.long.biv.table$strain), 1, 
                                ifelse(grepl("MSM", Q2mouse.av.long.biv.table$strain), 1, 0))


male.short.biv <- real.short.bivData %>% filter(sex== "male")

Q2mouse.av.short.biv.table <- ddply(male.short.biv, c("fileName"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength),
                        
                        #mean.first.1CO
                        norm.first.foci.pos =  mean(PER_Foci_1[which(hand.foci.count == 1)]
                         ) ) 

Q2mouse.av.short.biv.table <- add_mouse(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_strain(Q2mouse.av.short.biv.table)
Q2mouse.av.short.biv.table <- add_subsp(Q2mouse.av.short.biv.table)

Q2mouse.av.short.biv.table$strain <- factor(Q2mouse.av.short.biv.table$strain, ordered = FALSE)
Q2mouse.av.short.biv.table$subsp <- factor(Q2mouse.av.short.biv.table$subsp, ordered = FALSE)

Q2mouse.av.short.biv.table$Rec.group <- ifelse(grepl("PWD", Q2mouse.av.short.biv.table$strain), 1, 
ifelse(grepl("MSM", Q2mouse.av.short.biv.table$strain), 1,
                                  ifelse(grepl("SKIVE", Q2mouse.av.short.biv.table$strain), 1,
                                           0)))

Q2mouse.av.short.biv.table$Rec.group.exclu <- ifelse(grepl("PWD", Q2mouse.av.short.biv.table$strain), 1, 
                                ifelse(grepl("MSM", Q2mouse.av.short.biv.table$strain), 1, 0))
```

<!-- plots -->

```{r Q2.show.SC.length, echo=FALSE, warning=FALSE}

Curated_BivData99 <- Curated_BivData[Curated_BivData$hand.foci.count < 5,]
Curated_BivData99 <- Curated_BivData99[(!is.na(Curated_BivData99$sex)),]

#adjust order of plot here
Curated_BivData99$strain <- factor(Curated_BivData99$strain,levels =c(
  "WSB","G","LEW","PERC",  
"PWD", "SKIVE",  "KAZ",
     "MSM", "MOLF",   
                     "CAST",
                         "SPRET","SPIC" ), order=T )

Q2.SC_BivData <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)

#nested boxplots, pooled Bivalents
#x axis for hand.focicount -- good for seperating the points --- but it pools 

#prediction for Dom strains: low variation 
Q2.SC.length_Nested_boxplots_Dom <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=strain, fill=as.factor(hand.foci.count) ))+geom_boxplot(alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \n Dom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") + scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Dom2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Dom",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+ geom_jitter(alpha = .1)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nDom")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)

Q2.SC.length_Nested_boxplots_Musc2 <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Musc",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot( aes(x=strain), alpha=0.5)+geom_jitter(alpha=.2)+
  ggtitle("Bivalent SC Lengths by Chrm Class \nMusc")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none") +scale_color_manual(values=color_chrm_class)


Q2.SC.length_Nested_boxplots_Mol <- ggplot(Q2.SC_BivData[Q2.SC_BivData$subsp == "Mol",], aes(y = chromosomeLength, x=as.factor(hand.foci.count), fill=as.factor(hand.foci.count) ))+geom_boxplot(aes(x=strain),alpha=0.5)+geom_jitter(alpha=.3)+  ggtitle("Bivalent SC Lengths by Chrm Class\n Mol")+facet_wrap(subsp~sex, scales="free")+ylim(c(25,160))+theme(legend.position="none")+scale_color_manual(values=color_chrm_class)

#+theme(legend.position="none") 
```

```{r Q2.SC.long.biv_plots, echo=FALSE}

#REAL.long_mouse_table
#REAL.short_mouse_table

#real.long.bivData
#real.short.bivData

shoo.long.biv <- ggplot( (real.long.bivData %>% filter(sex == "male") ), aes(y=chromosomeLength, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Single Biv \nMale Long Biv SC Lengths")


#cell.avlong.biv <- ggplot(cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Cell av. \nMale Long Biv SC Lengths")


mouse.shoo.long.biv <- ggplot( REAL.long_mouse_table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + ggtitle("Mouse av. \nMale Long Biv SC Lengths")

                      
#cell.avlong.biv <- ggplot( cell.av.long.biv.table, aes(y=mean.sc, x=strain, color=strain))+geom_jitter()+facet_wrap(~subsp, scales = "free")+scale_color_manual(values=colors_of_strains)+ylim(c(75,140))+geom_boxplot(alpha=.2) + #ggtitle("Cell av. \nMale Long Biv SC Lengths")

```

```{r Q2_tot.sc_plot, echo=FALSE, warning=FALSE}

#totSC.mouse.av.table <- totSC.mouse.av.table %>% filter(strain!="CAST" & strain !="F1"& strain !="SPIC" & strain !=  "CAROLI" & strain !="SPRET"& strain !="HMI"& strain !="PERC")

#MLH1_data <- MLH1_data %>%
#  arrange(strain, sex, mouse) %>%
#  mutate(file.name = factor(file.name))

mouse.av_totsc_male <- ggplot(data= totSC.mouse.av.table %>% filter(sex == "male"), aes(y = mean.skel, x=mouse, color=strain))+ geom_point()+scale_color_manual(values=colors_of_strains)+
  facet_wrap(Rec.group~subsp, scales="free")+ theme(axis.title.x=element_blank(),        axis.text.x=element_blank(), axis.ticks.x=element_blank()) + ylim(c(1200,1850 ))+ggtitle("Mouse av. total SC area")

mouse.av_totsc_male

```

```{r Q2.SC_MLH1.by.totalSC, echo=FALSE, warning=FALSE}

#make plot of mouse averages for MLH1 and total SC

bep <- merge(  fomo.male_mouse.av,   totSC.mouse.av.table)

X.by.texas <- ggplot(bep, aes(x=mean.skel, y=mean_co, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")

X.by.texas

```

```{r Q2totalSC_checkdates, echo=FALSE, eval=FALSE}

#investigating potential skew / technical effects in the algorithm

Neg.control <- ggplot(bep, aes(x=mean.skel, y=mean.bin, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")
#not sure what my expectations for this plot are, 

median(bep$oldest.image.date) #"2017-08-03"
#there might be an issue with the algorithm performance 
#given the parrelle diagonal lines -- 
#this might be due to the dates imaged  2017-02-07

bep$date.cut.off <- ifelse( bep$oldest.image.date < "2017-02-07", 0, 1 )

Neg.control.find.date <- ggplot(bep, aes(x=mean.skel, y=mean.bin, color=strain))+geom_point()+
  scale_color_manual(values=colors_of_strains)+ggtitle("Total SC by mean CO\nMouse Means")+facet_wrap(~date.cut.off)

#there's evidence that the algorithm might have some biased effects -- 
#that will be investigated later.

```

```{r Q2.totSC.ttest, echo=FALSE}
#totalSC high and low rec group

Q2tot.sc_t.test_High.Low <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") )$mean.skel,
                (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "1") )$mean.skel)
#p-value = 0.007


#mol
Q2tot.sc_t.test_High.Low_Mol <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.skel,
         (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "1") %>% filter(subsp == "Mol") )$mean.skel)


#musc
Q2tot.sc_t.test_High.Low_Musc <- t.test((totSC.mouse.av.table %>% filter(sex == "male") %>% filter(Rec.group == "0") %>% filter(subsp == "Musc"))$mean.skel,
                (totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == "1") )$mean.skel)

```


```{r Q2.short.long.ttest, echo=FALSE}

#long and short 
#mouse.av.short.biv.table
#Q2mouse.av.short.biv.table
Q2short.biv_t.test_High.Low <- t.test((Q2mouse.av.short.biv.table %>% filter(Rec.group == "0") )$mean.SC,
                                      (Q2mouse.av.short.biv.table %>% filter(Rec.group == "1") )$mean.SC)

#p-value = 0.9

#mouse.av.long.biv.table
Q2long.biv_t.test_High.Low <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") )$mean.SC)
#p-value = 0.2


#mUSC-short
Q2.short_t.test_High.Low.musc <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-short
#Q2.short_t.test_High.Low.mol <- t.test((Q2mouse.av.short.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.short.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Mol"))$mean.SC)


#musc-long
Q2.long_t.test_High.Low.musc <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Musc") )$mean.SC,
                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp == "Musc"))$mean.SC)

#mol-long
#Q2.long_t.test_High.Low.mol <- t.test((Q2mouse.av.long.biv.table  %>% filter(Rec.group == "0") %>% filter(subsp == "Mol") )$mean.SC,
#                          (Q2mouse.av.long.biv.table  %>% filter(Rec.group == "1") %>% filter(subsp =="Mol"))$mean.SC)

#not enought observations 

```

```{r Q2.SC_HvL_allBiv, echo=FALSE}

#High-Low_All-BivData

Q2.all.BIV_t.test_HL <- t.test((Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (Curated_BivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)


#short
Q2.BIV_short_t.test_HL <- t.test((real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.short.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

#long
Q2.BIV_long_t.test_HL <- t.test((real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "0") )$chromosomeLength,
              (real.long.bivData %>%filter(sex == "male")%>%filter(Rec.group == "1"))$chromosomeLength)

```

```{r Q2.SC_across.subsp_tot.SC, echo=FALSE}

#Dom-Musc
Q2.totSC_t.test_DomMusc <- t.test((totSC.mouse.av.table  %>% filter(subsp == "Dom") )$mean.skel,
                          (totSC.mouse.av.table  %>%  filter(subsp == "Musc"))$mean.skel)
#p-value = 0.5

#Dom-Mol
Q2.totSC_t.test_DomMol <- t.test((totSC.mouse.av.table  %>% filter(subsp == "Dom") )$mean.skel,
                          (totSC.mouse.av.table  %>%  filter(subsp == "Mol"))$mean.skel)
#p-value = 0.1
```

```{r Q2.SC_across.subsp_short.long.mus.av, echo=FALSE}

#DOM-musc-long
Q2.long_t.test_DomMusc <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.08

#DOM-musc-short
Q2.short_t.test_DomMusc <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Musc"))$mean.SC)
#p-value = 0.8

#DOM-mol-long
Q2.long_t.test_DomMol <- t.test((Q2mouse.av.long.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.long.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.4

#DOM-mol-short
Q2.short_t.test_DomMol <- t.test((Q2mouse.av.short.biv.table  %>% filter(subsp == "Dom") )$mean.SC,
                          (Q2mouse.av.short.biv.table %>% filter(subsp == "Mol"))$mean.SC)
#p-value = 0.09

```

```{r Q2.SC_across.subsp_short.long_biv, echo=FALSE}

#DOM-MUSC-ALL
Q2.all.BIV_t.test_DomMusc <- t.test((Curated_BivData %>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (Curated_BivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 4e-13

#DOM-MOL-ALL
Q2.all.BIV_t.test_DomMol <- t.test((Curated_BivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (Curated_BivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 6e-10

#DOM-musc-long
Q2.longBIV_t.test_DomMusc <- t.test((real.long.bivData%>%filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.long.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.2

#DOM-musc-short
Q2.shortBIV_t.test_DomMusc <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
              (real.short.bivData %>% filter(subsp == "Musc")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.8


#DOM-mol-long
Q2.longBIV_t.test_DomMol <- t.test((real.long.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.long.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.4

#DOM-mol-short
Q2.shortBIV_t.test_DomMol <- t.test((real.short.bivData  %>% filter(subsp == "Dom")%>%filter(sex == "male") )$chromosomeLength,
                          (real.short.bivData %>% filter(subsp == "Mol")%>%filter(sex == "male"))$chromosomeLength)
#p-value = 0.06

```



```{r Q2.totSC.glm, echo=FALSE}

Q2.glm_mus.av_totSC_M4 <- glm(mean.skel ~ subsp * strain, data= totSC.mouse.av.table %>% filter(sex == "male"))
sum.Q2.glm_mus.av_totSC_M4  <- summary(Q2.glm_mus.av_totSC_M4)$coefficients

#sum.Q2.glm_mus.av_totSC_M4$coefficients[,4]   pvalues of all effects
#sum.Q2.glm_mus.av_totSC_M4$coefficients[,1]  coefficients of all effects
#round(sum.Q2.glm_mus.av_totSC_M4$coefficients[,c(1,4)], 6)

#M4.2? (removed subspecies?)

Q2.glm_mus.av_totSC_M4.2 <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male"))
sum.Q2.glm_mus.av_totSC_M4.2  <- summary(Q2.glm_mus.av_totSC_M4.2)
#round(summary(sum.Q2.glm_mus.av_totSC_M2)$coefficients[,c(1,4)], 6)

totSC.mouse.av.table <- add_strain(totSC.mouse.av.table)
totSC.mouse.av.table <- add_sex(totSC.mouse.av.table)
totSC.mouse.av.table <- add_subsp(totSC.mouse.av.table)
#within subspecies values

#Dom
Q2.glm_mus.av_totSC_M4.2_DOM <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Dom"))
sum.Q2.glm_mus.av_totSC_M4.2_DOM  <- summary(Q2.glm_mus.av_totSC_M4.2_DOM)
#there are significant strain effects in DOM,


#Musc
Q2.glm_mus.av_totSC_M4.2_MUSC <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Musc") )
sum.Q2.glm_mus.av_totSC_M4.2_MUSC  <- summary(Q2.glm_mus.av_totSC_M4.2_MUSC)
#KAZ -- is the only significant effect

#Mol
Q2.glm_mus.av_totSC_M4.2_MOL <- glm(mean.skel ~ strain, data= totSC.mouse.av.table %>% filter(sex == "male") %>% filter(subsp == "Mol") )
sum.Q2.glm_mus.av_totSC_M4.2_MOL  <- summary(Q2.glm_mus.av_totSC_M4.2_MOL)

```


```{r Q2.glm.SC.long, echo=FALSE}


#this dataset is all males
glmQ2_long.biv_M4 <- glm(mean.SC ~ subsp * strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)


glmQ2_long.biv_M4 <- glm(mean.SC ~ strain, data= Q2mouse.av.long.biv.table)
sum.glmQ2_long.biv_M4 <- summary(glmQ2_long.biv_M4)
#round(sum.glmQ2_long.biv_M2$coefficients[,c(1,4)], 6)

glmQ2_long.biv_M4.2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_long.biv_M4.2_DOM <- summary(glmQ2_long.biv_M4.2_DOM)

#MUSC
glmQ2_long.biv_M4.2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_long.biv_M4.2_MUSC <- summary(glmQ2_long.biv_M4.2_MUSC)

#MOL can't be done -- only 1 mouse for each MSM and MOLF
glmQ2_long.biv_M4.2_MOL <- glm(mean.SC ~ strain, data= ( Q2mouse.av.long.biv.table %>% filter(subsp == "Mol") )  )
sum.glmQ2_long.biv_M4.2_MOL <- summary(glmQ2_long.biv_M4.2_MOL)


#Dom
glm_SC.male_Dom_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Dom",])
#Musc
glm_SC.male_Musc_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Musc",])
#summary(glm_SC.male_Musc_long.biv)
#Mol
glm_SC.male_Mol_long.biv <- glm(mean_SC ~ strain, data= Long.biv_mouse_table[Long.biv_mouse_table$subsp == "Mol",])

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom")%>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain )

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.long.biv.table %>% filter(subsp == "Musc") )$strain )

```


```{r Q2.glm.SC.short, echo=FALSE}
#Q2mouse.av.short.biv.table
#mouse.av.short.biv.table

glmQ2_short.biv_M1 <- glm(mean.SC ~ subsp*strain, data= Q2mouse.av.short.biv.table)
sum.glmQ2_short.biv_M1 <- summary(glmQ2_short.biv_M1)

#round(summary(sum.glmQ2_short.biv_M1)$coefficients[,c(1,4)], 6)

glmQ2_short.biv_M2 <- glm(mean.SC ~ strain, data= Q2mouse.av.short.biv.table)
glmQ2_short.biv_M2 <- summary(glmQ2_short.biv_M2)

#DOM
glmQ2_short.biv_M2_DOM <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )  )
sum.glmQ2_short.biv_M2_DOM <- summary(glmQ2_short.biv_M2_DOM)

#MUSC
glmQ2_short.biv_M2_MUSC <- glm(mean.SC ~ strain, data= ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )  )
sum.glmQ2_short.biv_M2_MUSC <- summary(glmQ2_short.biv_M2_MUSC)

#MOL
#within subspecies

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Dom") )$strain, p.adj = "bonf", pool.sd = FALSE)

#pairwise.t.test( ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$mean.SC, ( Q2mouse.av.short.biv.table %>% filter(subsp == "Musc") )$strain, p.adj = "bonf", pool.sd = FALSE)

```


```{r Q2.SC.logreg.chrmClass_BivData, echo=FALSE, include=FALSE, eval=FALSE}

log.SC_male_chrm.class_all <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class_all)


#use the 1CO or 2CO DF
Bivalent_1o2_WSB <-  Bivalent_1o2 %>% filter(strain == "WSB")

log.SC_male_chrm.class.WSB <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_WSB,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class.WSB)


Bivalent_1o2_G <-  Bivalent_1o2 %>% filter(strain == "G") 
log.SC_chrm.class.G <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_G,  family=binomial(link="logit"))
summary(log.SC_chrm.class.G)


Bivalent_1o2_LEW <-  Bivalent_1o2 %>% filter(strain == "LEW") 
log.SC_chrm.class.LEW <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_LEW,  family=binomial(link="logit"))
summary(log.SC_chrm.class.LEW)


Bivalent_1o2_PWD <-  Bivalent_1o2 %>% filter(strain == "PWD") 
log.SC_chrm.class.PWD <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_PWD,  family=binomial(link="logit"))
summary(log.SC_chrm.class.PWD)


Bivalent_1o2_SKIVE <-  Bivalent_1o2 %>% filter(strain == "SKIVE") 
log.SC_chrm.class.SKIVE <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_SKIVE,  family=binomial(link="logit"))
summary(log.SC_chrm.class.SKIVE)


Bivalent_1o2_KAZ <-  Bivalent_1o2 %>% filter(strain == "KAZ") 
log.SC_chrm.class.KAZ <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_KAZ,  family=binomial(link="logit"))
summary(log.SC_chrm.class.KAZ)


Bivalent_1o2_CZECH <-  Bivalent_1o2 %>% filter(strain == "CZECH") 
log.SC_chrm.class.CZECH <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_CZECH,  family=binomial(link="logit"))
summary(log.SC_chrm.class.CZECH)

Bivalent_1o2_MSM <-  Bivalent_1o2 %>% filter(strain == "MSM") 
log.SC_chrm.class.MSM <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MSM,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MSM)


Bivalent_1o2_MOLF <-  Bivalent_1o2 %>% filter(strain == "MOLF")
log.SC_chrm.class.MOLF <- glm(chrm.class ~ chromosomeLength,
              data=Bivalent_1o2_MOLF,  family=binomial(link="logit"))
summary(log.SC_chrm.class.MOLF)

```


```{r Q2.logreg.plots, echo=FALSE, include=FALSE, eval=FALSE}

log.reg.chrm.class_all.strains <- ggplot(Bivalent_1o2,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO)")+facet_wrap(subsp~ strain)
log.reg.chrm.class_all.strains



WSB.log.reg.chrm.class <- ggplot(Bivalent_1o2_WSB,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Chrm Class prediction (1CO or 2CO, WSB)")+facet_wrap(~subsp)


MSMlog.reg.chrm.class <- ggplot(Bivalent_1o2_MSM,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("MSM Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)


PWDlog.reg.chrm.class <- ggplot(Bivalent_1o2_PWD,
                          aes(x=chromosomeLength, y=chrm.class)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("PWD Chrm Class prediction (1CO or 2CO)")+facet_wrap(~subsp)

```


```{r Q2.SC.Chrm.Class, echo=FALSE, include=FALSE, eval=FALSE}
#REMOVE COMPARES ACROSS FROM FULL BIVDAAT

#1CO
log.SC_male_1CO.poly <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_1CO.poly)

log.SC_male_1CO.Musc <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_1CO.Musc)
#double check these directions

log.SC_male_1CO.Mol <- glm(Rec.group ~ mean.SC_1CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))

#summary(log.SC_male_1CO.Mol)


#2CO
log.SC_male_2CO.poly <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_2CO.poly)


log.SC_male_2CO.Musc <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Musc)


log.SC_male_2CO.Mol <- glm(Rec.group ~ mean.SC_2CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_2CO.Mol)


#3CO
log.SC_male_3CO.poly <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.SC_male_3CO.poly)


log.SC_male_3CO.Musc <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Musc)


#there's no rec group for this table
log.SC_male_3CO.Mol <- glm(Rec.group ~ mean.SC_3CO,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.SC_male_3CO.Mol)


#reverse logistic regression (single bivalent level)
#how well does SC length predict 1 or 2 COs?

Bivalent_1o2 <-  Curated_BivData_male %>% filter(species== "M.musculus") %>% filter(hand.foci.count > 0) %>% filter(hand.foci.count < 3) 

#need to switch the co counts to 1 - 0
Bivalent_1o2$chrm.class <- ifelse(grepl(1, Bivalent_1o2$hand.foci.count), 0, 
                                    ifelse(grepl(2, Bivalent_1o2$hand.foci.count), 1, ""))


Bivalent_1o2$chrm.class <- as.numeric(Bivalent_1o2$chrm.class)
Bivalent_1o2$strain <- factor(Bivalent_1o2$strain, ordered = FALSE)

log.SC_male_chrm.class <- glm(chrm.class ~ chromosomeLength*strain,
              data=Bivalent_1o2,  family=binomial(link="logit"))

summary(log.SC_male_chrm.class)
#not sure if this is the equivilent of running each strain seperatly
#the strain effect is probably also pulling in the different proportion of chrm class
#useing the chrm.length*strain gives fewer significant factors. 

#i'd be more convinced by running all those log regression plots for each strain
#come back later
```


```{r Q2.SC.log.regression.show.plots, echo=FALSE, include=FALSE}

plot.blah.mouse.av <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean_SC, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC (pooled) \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_1CO <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_1CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 1CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


plot.logReg.mouse.av_2CO <- ggplot(Male.poly.Mouse.Table_BivData_4MM,
                          aes(x=mean.SC_2CO, y=Rec.group)) + geom_point(aes(color=strain)) +  scale_color_manual(values=colors_of_strains)+ stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE) + ggtitle("Mouse av. SC 2CO \nHigh vs low gwRR strains")+facet_wrap(~subsp)


```


```{r Q2.SClength.ttest, echo=FALSE, include=FALSE, eval=FALSE}
#COMPARISONS ACROSS ALL CLASSES

#MOUSE AVE, all
Rec.group.mouse.SC_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean_SC[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC_Ttest$p.value  #p-value = 0.00238

#mouse.av 1CO
Rec.group.mouse.SC.1CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_1CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.1CO_Ttest$p.value  #p-value = 0.9993


#MOUSE.av 2CO
Rec.group.mouse.SC.2CO_Ttest <- t.test(Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 1], 
                                 Male.poly.Mouse.Table_BivData_4MM$mean.SC_2CO[Male.poly.Mouse.Table_BivData_4MM$Rec.group == 0])
 
Rec.group.mouse.SC.2CO_Ttest$p.value  #p-value = 0.03428


#single biv level
#male.biv?

#Rec.group_BivData_F1post_Ttest <- t.test(male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 1], 
#                                 male.bivdata.1CO$PER_Foci_1[male.bivdata.1CO$Rec.group == 0])
 
#Rec.group_BivData_F1post_Ttest$p.value 

```

```{r log.reg_SC.length, echo=FALSE, include=FALSE}
#REMOVE THIS COMPARES FROM FULL BIV DATA

#male_mouse.av
#Male.poly.Mouse.Table_BivData_4MM

Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                                ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)))

#male poly shouldn't be here
Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 
                                ifelse(grepl("MSM male", Male.poly.Mouse.Table_BivData_4MM$category), 1,
                                ifelse(grepl("SKIVE male", Male.poly.Mouse.Table_BivData_4MM$category), 1, 0)))


#All chrm
log.reg_SC.length_mouse.av <- glm(Rec.group ~ mean_SC, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av)

#considering seperating out by hand foci counts

#1CO
log.reg_SC.length_mouse.av_1CO <- glm(Rec.group ~ mean.SC_1CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_1CO)


#2CO
log.reg_SC.length_mouse.av_2CO <- glm(Rec.group ~ mean.SC_2CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_mouse.av_2CO)


#3CO
log.reg_SC.length_mouse.av_3CO <- glm(Rec.group ~ mean.SC_3CO, 
                            data=Male.poly.Mouse.Table_BivData_4MM[(Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_mouse.av_3CO)


# bivalent level log regression

log.reg_SC.length_BIV <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV)

#1CO  (BIVDATA)
log.reg_SC.length_BIV_1CO <- glm(Rec.group ~ chromosomeLength, 
                            
                data=Curated_BivData[(Curated_BivData$subsp == "Musc") & (Curated_BivData$hand.foci.count == 1) &(Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_1CO)


#2CO
log.reg_SC.length_BIV_2CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 2) & (Curated_BivData$sex == "male"),], family=binomial(link="logit"))
#summary(log.reg_SC.length_BIV_2CO)


#3CO
log.reg_SC.length_BIV_3CO <- glm(Rec.group ~ chromosomeLength, 
                            data=Curated_BivData[(Curated_BivData$subsp == "Musc")&(Curated_BivData$hand.foci.count == 3)&(Curated_BivData$sex == "male"),], family=binomial(link="logit"))

#summary(log.reg_SC.length_BIV_3CO)
```

```{r Q2.SC_class.rec.group_setup, echo=FALSE, include=FALSE}
#REMOVE THIS, IT uses total bivalent data


#rerun the models for datasets -- deviding by chrm class and rec group
Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                            ifelse(grepl("MSM male", Curated_BivData$category), 1,
                             ifelse(grepl("SKIVE male", Curated_BivData$category), 1, 0)) )


Q2.SC_BivData_low.rec <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5)%>% filter(Rec.group == 0 )
Q2.SC_BivData_high.rec <- Curated_BivData %>% filter(sex=="male") %>% filter( hand.foci.count < 5) %>% filter(Rec.group == 1 )

#calq_mouse av
mouse.av.SC.low.rec <- ddply(Q2.SC_BivData_low.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                        n_cells = length(unique(fileName) ),
                        mean.SC.total = mean(chromosomeLength),

                    mean.SC_0CO = mean(chromosomeLength[which(hand.foci.count == 0)], na.rm = TRUE),
                  n_0CO =  sum((hand.foci.count == 0), na.rm = TRUE ),
                  
                   mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                    n_1CO = sum((hand.foci.count == 1), na.rm = TRUE),
                  
                   mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                   n_2CO = sum((hand.foci.count == 2), na.rm = TRUE),
                  
                  mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                  n_3CO = sum((hand.foci.count == 3), na.rm = TRUE)
                                                
                         )

mouse.av.SC.low.rec <- add_strain(mouse.av.SC.low.rec)
mouse.av.SC.low.rec <- add_subsp(mouse.av.SC.low.rec)

mouse.av.SC.low.rec$strain <- factor(mouse.av.SC.low.rec$strain, ordered = FALSE)
mouse.av.SC.low.rec$subsp <- factor(mouse.av.SC.low.rec$subsp, ordered = FALSE)


#calq_mouse av
mouse.av.SC.high.rec <- ddply(Q2.SC_BivData_high.rec, c("mouse"), summarise,
                        n_obs = length(Obj.ID),
                         mean.SC = mean(chromosomeLength)
                         )
mouse.av.SC.high.rec <- add_mouse(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_strain(mouse.av.SC.high.rec)
mouse.av.SC.high.rec <- add_subsp(mouse.av.SC.high.rec)

mouse.av.SC.high.rec$strain <- factor(mouse.av.SC.high.rec$strain, ordered = FALSE)
mouse.av.SC.high.rec$add_subsp <- factor(mouse.av.SC.high.rec$subsp, ordered = FALSE)
```



#Q2 1CO postion


```{r Q2.1COpos_mouse.av.t.test_all, echo=FALSE}
#mouse.avs_4MM, #31may19_SKIVE_m2  has NA for norm.first.foci.pos

#High = MSM, PWD, SKIVE
Q2.1COpos_Ttest <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
            (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "1"))$norm.first.foci.pos )
#p-value = 1

#high = PWD and MSM
Q2.1COpos_Ttest.HL.ex <- t.test( (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == "0"))$norm.first.foci.pos, 
            (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group.exclu == "1"))$norm.first.foci.pos )
#p-value = 1

```

```{r Q2.1COpos_within.subsp_ttest, echo=FALSE}

#Dom (predicted no difference) -- can't DO a t.test for DOM across groups..

#Musc
Q2.1COpos_mus.av_Musc_ttest  <-  t.test( (mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Musc") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
                                         
            (mouse.avs_4MM  %>%  filter(sex == "male") %>% filter(subsp == "Musc") %>% filter(Rec.group == "1"))$norm.first.foci.pos )
# p-value = 0.4


#Mol
Q2.1COpos_mus.av_Mol_ttest  <-  t.test( (mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Mol") %>% filter(Rec.group == "0"))$norm.first.foci.pos, 
            
              (mouse.avs_4MM  %>%  filter(sex == "male") %>% filter(subsp == "Mol") %>% filter(Rec.group == "1"))$norm.first.foci.pos   )
# p-value = 0.07
# exclusive rec group not sig
```

```{r Q2.1CO_mouse.av.short.long_t.test, echo=FALSE}
#these don't have mean.first.foci

#short -- real.long.bivData -- REAL.short_mouse_table
Q2.1COposABS_short_ttest_HL <- t.test( (REAL.short_mouse_table %>% filter(sex == "male") %>%  filter(Rec.group == "0"))$mean_F1pos_ABS, 
      
      (REAL.short_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == "1"))$mean_F1pos_ABS   )
#p-value = 0.3


Q2.1COpos.PER_short_ttest_HL <- t.test( (REAL.short_mouse_table %>% filter(sex == "male") %>% filter(Rec.group == "0"))$mean_F1pos_PER, 
      (REAL.short_mouse_table %>% filter(sex == "male")  %>% filter(Rec.group == "1"))$mean_F1pos_PER   )
# p-value = 0.1

#remove SKIVE??
```

```{r Q2.1CO.pos_short.long.ttest, echo=FALSE}

#real.long.bivData
#single biv level
Rec.group_LONG.BivData_F1post_Ttest <- t.test(
  (real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(real.long.bivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.5 

Rec.group_BivData_F1post_Ttest <- t.test(
  (Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "0") )$PER_Foci_1, 
(Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count == 1) %>% filter(Rec.group == "1"))$PER_Foci_1  )
#p-value = 0.2

#
#whoo.mama <-  t.test( (Curated_BivData %>% filter(sex == "male") %>% filter(hand.foci.count #== 1)  %>%  filter(Rec.group == "0"))$PER_Foci_1, 
#            (Curated_BivData  %>% filter(sex == "male") %>% filter(hand.foci.count == 1)   #%>% filter(Rec.group == "1"))$PER_Foci_1   )
#p-value = 0.2


#whoo.mama.rec.exc <-  t.test( (Curated_BivData  %>% filter(sex == "male") %>% #filter(hand.foci.count == 1)  %>%  filter(Rec.group.exclu == "0"))$PER_Foci_1, 
#            (Curated_BivData  %>% filter(sex == "male") %>% filter(hand.foci.count == 1)   #%>% filter(Rec.group.exclu == "1"))$PER_Foci_1   )
#p-value = 0.4

```


```{r Q2.1COpos_mus.av.full_glm, echo=FALSE}

#(mouse.avs_4MM %>%  filter(sex == "male") %>%  filter(subsp == "Musc") %>% filter(Rec.group == "0"))$norm.first.foci.pos

#none of these are M1 -- since they are male specific 
#all of these are M4

Q2.glm_mus.av_1COpos_M4 <- glm(norm.first.foci.pos ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.glm_mus.av_1COpos_M4  <- summary(Q2.glm_mus.av_1COpos_M4)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]


#with.chrm.legth  ?
#Q2.glm_mus.av_1COpos_M4 <- glm(norm.first.foci.pos ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male"))


#M4.2 (just strain)
Q2.glm_mus.av_1COpos_M4.2 <- glm(norm.first.foci.pos ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.glm_mus.av_1COpos_M4.2 <- summary(Q2.glm_mus.av_1COpos_M4.2)$coefficients

```


```{r Q2.1CO.pos_glm.chrm.Length, echo=FALSE}
#remove this cell, 

Curated_BivData <- Curated_BivData %>% filter(Obj.ID != "13sep18_28jun18_MOLF_m1_sp1_18.1_rev_14")

Curated_BivData.Mol <- Curated_BivData %>% filter(Foci1 != "")

#making new models 

Curated_BivData$subsp <- factor(Curated_BivData$subsp , ordered = F)
Curated_BivData$strain <- factor(Curated_BivData$strain , ordered = F)

chrm.1CO.pos.chrmLength <- glm(PER_Foci_1 ~ chromosomeLength * subsp * strain, data= Curated_BivData.Mol %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") )

sum.chrm.1CO.pos.chrmLength <- summary(chrm.1CO.pos.chrmLength)$coefficients
#summary(Q2.glm_mus.av_1COpos_M1)$coefficients[,4]


chrm.1CO.pos.chrmLength_strain <- glm(PER_Foci_1 ~ chromosomeLength *  strain, data= Curated_BivData.Mol %>% filter(sex == "male")  %>%  filter(hand.foci.count == "1") )

#summary(chrm.1CO.pos.chrmLength_strain)

```

```{r Q2.1COpos_strain, echo=FALSE, eval=FALSE}
#isolate all musc
#Curated_BivData_male <- Curated_BivData[Curated_BivData$sex == "male",]

##long biv
male.long.biv <- real.long.bivData %>% filter(sex== "male") %>% filter(species == "M.musculus") 
#table( droplevels( male.long.biv$strain)  )


mouse.av.long.biv.table <- ddply(male.long.biv, c("mouse"), summarise,
                             
                        n_obs = length(Obj.ID),
                         mean_F1 = mean(Foci1, na.rm=TRUE),
                        mean_F1.nrm = mean(PER_Foci_1,na.rm=TRUE),
                        
                        mean_SC = mean(chromosomeLength),

                      mean.SC_1CO = mean(chromosomeLength[which(hand.foci.count == 1)], na.rm = TRUE),
                       mean.SC_2CO = mean(chromosomeLength[which(hand.foci.count == 2)], na.rm = TRUE),
                       mean.SC_3CO = mean(chromosomeLength[which(hand.foci.count == 3)], na.rm = TRUE),
                       mean.SC_4CO = mean(chromosomeLength[which(hand.foci.count == 4)], na.rm = TRUE)

                                               )
#add subsp

mouse.av.long.biv.table <- add_strain(mouse.av.long.biv.table)
mouse.av.long.biv.table <- add_subsp(mouse.av.long.biv.table)

mouse.av.long.biv.table$strain <- factor(mouse.av.long.biv.table$strain, ordered = FALSE)
mouse.av.long.biv.table$subsp <- factor(mouse.av.long.biv.table$subsp, ordered = FALSE)

#add rec group
mouse.av.long.biv.table$Rec.group <- ifelse(grepl("PWD", mouse.av.long.biv.table$strain), 1, 
                            ifelse(grepl("MSM", mouse.av.long.biv.table$strain), 1,
                             ifelse(grepl("SKIVE", mouse.av.long.biv.table$strain), 1, 0)) )
```


```{r Q2.1COpos.LOG.glm, echo=FALSE, eval=FALSE}

#logistic regression, reverse variables

male.bivdata.1CO$Rec.group <- ifelse(grepl("PWD", male.bivdata.1CO$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.1CO$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.1CO$strain), 1, 0)))

Log.Q2.1COnrm.F1.PER <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO,  family=binomial(link="logit"))
#summary(Log.glmQ2_M2.1COnrm)

#Musc
Log.Q2.F1_PER_Musc <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Musc",], 
              family=binomial(link="logit"))
#summary(Log.Q2.F1_PER_Musc)


#Mol
Log.Q2.F1_PER_Mol <- glm(Rec.group ~ PER_Foci_1,
              data=male.bivdata.1CO[male.bivdata.1CO$subsp == "Mol",],
              family=binomial(link="logit"))

#summary(Log.glmQ2_M2.1COnrm_Mol)

```


#Q2 IFD


```{r Q2.IFD.long.short.setup, echo=FALSE}
#long BivData
male.long.biv.2CO_IFD <- real.long.bivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.long.biv.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.long.biv.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.long.biv.2CO_IFD$strain), 1, 
                                           ifelse(grepl("SKIVE", male.long.biv.2CO_IFD$strain), 1, 0)))

#show
Long.biv.IFDs_PER_by.group <- ggplot(male.long.biv.2CO_IFD, aes(y = IFD1_PER, x= mouse, color=strain))+geom_boxplot(alpha=.2)+
  geom_jitter(alpha=.2)+
  ggtitle("Normalized Interfocal Distances, Long BivData\nLow Rec group =0, High Rec group =1")+
  scale_color_manual(values=colors_of_strains)+ facet_wrap(subsp~Rec.group, scales = "free")+theme(legend.position="none")+ylim(c(0,1.1))

#long biv's - short IFD rates

LongBiv_IFD_mus.rate <- ddply(male.long.biv.2CO_IFD %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        
                   N.obs  = length(Obj.ID),

                  mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                  mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                  var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)] ),
                
                inverse.close.foci = length(which(IFD1_PER >= .31)),  
                n.close.foci = length(which(IFD1_PER <= .3)),
                      
                off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                rate.close.foci = n.close.foci / N.obs
                
                                              )

#run t.tests on long biv
LongBiv_IFD_mus.rate <- add_strain(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_category(LongBiv_IFD_mus.rate)
LongBiv_IFD_mus.rate <- add_subsp(LongBiv_IFD_mus.rate)

#add rec.group
LongBiv_IFD_mus.rate$Rec.group <- ifelse(grepl("PWD", LongBiv_IFD_mus.rate$strain), 1, 
                                ifelse(grepl("MSM", LongBiv_IFD_mus.rate$strain), 1,
                                 ifelse(grepl("SKIVE", LongBiv_IFD_mus.rate$strain), 1, 0)))

```

```{r Q2.IFD.long.biv_t.test, echo=FALSE}
#short removed PER
Short.removed_BivData.LongBiv_IFD.PER_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.perIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])
 
#Short.removed_BivData.LongBiv_IFD.PER_Ttest$p.value
#0.0083

#ABS short removed
Short.removed_BivData.LongBiv_IFD.ABS_Ttest <- t.test(LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 1], 
                                 LongBiv_IFD_mus.rate$mean.absIFD_short.rm[LongBiv_IFD_mus.rate$Rec.group == 0])

#Short.removed_BivData.LongBiv_IFD.ABS_Ttest$p.value
#0.047
```


```{r Q2.t.test_IFD_mouse.av, echo=FALSE}
#t.test for IFD
#mouse.av - the mouse average IFD is from just 2CO
t.test_mouse.av.IFD_ABS <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") )$mean_IFD.2CO_ABS   )
  
t.test_mouse.av.IFD_PER <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") )$mean_IFD.2CO_PER   )


#t.test_mouse.av.IFD_PER_DOM <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == #"male") %>% filter(subsp == "Dom") )$mean_IFD.2CO_PER,
#   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == #"Dom"))$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_PER_MUSC <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc"))$mean_IFD.2CO_PER   )

t.test_mouse.av.IFD_PER_MOL <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_PER,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_PER   )

#ABS

t.test_mouse.av.IFD_ABS_MUSC <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Musc") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male")  %>% filter(subsp == "Musc"))$mean_IFD.2CO_ABS   )

t.test_mouse.av.IFD_ABS_MOL <- t.test(  (mouse.avs_4MM %>% filter(Rec.group == "1") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_ABS,
   (mouse.avs_4MM %>% filter(Rec.group == "0") %>% filter(sex == "male") %>% filter(subsp == "Mol") )$mean_IFD.2CO_ABS  )
```



```{r Q2.IFD.glm.test, echo=FALSE}

#M4.ABS
Q2.M4glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male")    )
sum.Q2.M4glm_IFD.raw <- summary(Q2.M4glm_IFD.raw) 

#M4.PER
Q2.M4glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ subsp * strain, data= mouse.avs_4MM %>% filter(sex == "male") )

sum.Q2.M4glm_IFD.PER <- summary(Q2.M4glm_IFD.PER)
#summary(Q2.M1glm_IFD.PER) 

#M4.2.raw
Q2.M4.2glm_IFD.raw <- glm(mean_IFD.2CO_ABS ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
Sum.Q2.M4.2glm_IFD.raw <- summary(Q2.M4.2glm_IFD.raw)

Q2.M4.2glm_IFD.PER <- glm(mean_IFD.2CO_PER ~ strain, data= mouse.avs_4MM %>% filter(sex == "male"))
sum.Q2.M4.2glm_IFD.PER <- summary(Q2.M4.2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

#within subspecies
#Dom
Q2.glm.M4.2_IFD_Dom <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M4.2_IFD_Dom)

#Musc
Q2.glm.M4.2_IFD_Musc <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M4.2_IFD_Musc)

#Mol
Q2.glm.M4.2_IFD_Mol <- glm(mean_IFD.2CO_ABS ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M4.2_IFD_Mol)


#Dom
Q2.glm.M4.2_IFD.PER_Dom <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Dom",])
#summary(Q2.glm.M4.2_IFD.PER_Dom) 

#Musc
Q2.glm.M4.2_IFD.PER_Musc <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",])
#summary(Q2.glm.M4.2_IFD.PER_Musc) 

#Mol
Q2.glm.M4.2_IFD.PER_Mol <- glm(mean_IFD.2CO_PER ~ strain, data= Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",])
#summary(Q2.glm.M4.2_IFD.PER_Mol)
```

```{r Q2.IFD.glm.chrmLength, echo=FALSE, eval=FALSE}

Curated_BivData$subsp  <- factor(Curated_BivData$subsp, ordered = FALSE)

#M.Len.ABS
Q2.BIV.LEN.glm_IFD.raw <- glm(IFD1_ABS ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.raw)

#M.Len.PER
Q2.BIV.LEN.glm_IFD.PER <- glm(IFD1_PER ~ subsp * strain * chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2")    )
#summary(Q2.BIV.LEN.glm_IFD.PER)


#M.Len.raw
Q2.BIV.LEN.M2glm_IFD.ABS <- glm(IFD1_ABS ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.ABS)

##M.Len PER
Q2.BIV.LEN.M2glm_IFD.PER <- glm(IFD1_PER ~ strain* chromosomeLength, data= Curated_BivData %>% filter(sex == "male")%>% filter(hand.foci.count == "2"))
#summary(Q2.BIV.LEN.M2glm_IFD.PER)
#  MSM strain effect for 2CO PER not significant

```

```{r Q2.IFD_rate.shortIFD, echo=FALSE, warning = FALSE, eval=FALSE}

#for the relevant data, by strain, calcu the number of observations of 2CO above and below 30%

close.IFD.rates.mus.rate <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("mouse"), summarise,
                        N.obs  = length(Obj.ID),

                      #  mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                      mean.ABS.IFD = mean(IFD1_ABS, na.rm = TRUE),  
                      mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm=TRUE),
                        
                  #mean_IFD_short.removed
                  mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                mean.absIFD_short.rm = mean(  IFD1_ABS[which(IFD1_PER >= .3)], na.rm=TRUE),
                  
                      inverse.close.foci = length(which(IFD1_PER >= .31)),  
                      n.close.foci = length(which(IFD1_PER <= .3)),
                      
                      off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) ),
                      
                      rate.close.foci = n.close.foci / N.obs
)

#mean(IFD1_ABS[which(hand.foci.count == 2)], na.rm = TRUE),

close.IFD.rates.mus.rate <- add_strain(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_category(close.IFD.rates.mus.rate)
close.IFD.rates.mus.rate <- add_subsp(close.IFD.rates.mus.rate)
#add rec.group
close.IFD.rates.mus.rate$Rec.group <- ifelse(grepl("PWD", close.IFD.rates.mus.rate$strain), 1, 
                                ifelse(grepl("MSM", close.IFD.rates.mus.rate$strain), 1,
                                 ifelse(grepl("SKIVE", close.IFD.rates.mus.rate$strain), 1, 0)))



close.IFD.rates_strain <- ddply(Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2), 
                         c("strain"), summarise,
                        N.obs  = length(Obj.ID),

                        mean_SC = as.numeric(format(round(  mean(chromosomeLength, na.rm = TRUE), 3 ), nsmall=3) ),
                        mean.per.IFD = mean(IFD1_PER, na.rm=TRUE),
                        var.IFD = var(IFD1_PER, na.rm = TRUE),
                        
                        #mean_IFD_short.removed
                      mean.perIFD_short.rm = mean(  IFD1_PER[which(IFD1_PER >= .3)], na.rm=TRUE),
                      
                        
                      inverse.close.foci = length(which(IFD1_PER > .3)),  
                      n.close.foci = length(which(IFD1_PER < .3)),
                      rate.close.foci = n.close.foci / N.obs,
                     
                       off.by = (N.obs - sum(c(inverse.close.foci,n.close.foci)) )
                      
)

close.IFD.rates_strain <- add_subsp(close.IFD.rates_strain)

show.IFDrm <- ggplot(close.IFD.rates_strain, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences")+ geom_abline(slope = 1, intercept = 0)

#close.IFD.rates.mus.rate
show.IFDrm_mus <- ggplot(close.IFD.rates.mus.rate, aes(y=mean.per.IFD, x=mean.perIFD_short.rm, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)+ylim(c(.4,.7))+xlim(c(.4,.7))+ggtitle("2CO interference differences") + geom_abline(slope = 1, intercept = 0)

show.close.IFD.rate <- ggplot(close.IFD.rates_strain, aes(y=rate.close.foci, x=strain, color=strain))+geom_jitter()+scale_color_manual(values=colors_of_strains)

#add rec.group
close.IFD.rates_strain$Rec.group <- ifelse(grepl("PWD", close.IFD.rates_strain$strain), 1, 
                                ifelse(grepl("MSM", close.IFD.rates_strain$strain), 1,
                                 ifelse(grepl("SKIVE", close.IFD.rates_strain$strain), 1, 0)))

#POOL all short and 
#chi square test
high.rec.props <- prop.test( ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$n.close.foci,
                              ( close.IFD.rates_strain %>% filter(Rec.group == 1) )$N.obs)     
#p-value = 0.03, slight dif tween 3 high rec strains
```

```{r Q2.IFD.PER.logreg, echo=FALSE, eval=FALSE}

#Log regression all show significant prediction
#IFD.PER
log.reg.Q2.IFD.PER <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER)

#MUSC
log.reg.Q2.IFD.PER.Musc <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Musc)

#Mol
log.reg.Q2.IFD.PER.Mol <- glm(Rec.group ~ mean_IFD.2CO_PER,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.PER.Mol)


#SINGLE BIVALENT LEVEL
Log.Q2.IFD.per_bivdata <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata)

#Musc
Log.Q2.IFD.per_bivdata.Musc <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.per_bivdata.Musc)

#Mol
Log.Q2.IFD.per_bivdata.Mol <- glm(Rec.group ~ IFD1_PER,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))

```

```{r Q2IFD_logreg, echo=FALSE, eval=FALSE}

Male.poly.Mouse.Table_BivData_4MM$Rec.group <- ifelse(grepl("PWD", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                    ifelse(grepl("MSM", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 
                                           ifelse(grepl("SKIVE", Male.poly.Mouse.Table_BivData_4MM$strain), 1, 0)))

#IFD.raw
log.reg.Q2.IFD.raw <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM,  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw)

#MUSC
log.reg.Q2.IFD.raw.Musc <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Musc",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Musc)

#Mol
log.reg.Q2.IFD.raw.Mol <- glm(Rec.group ~ mean_IFD.2CO_ABS,
              data=Male.poly.Mouse.Table_BivData_4MM[Male.poly.Mouse.Table_BivData_4MM$subsp == "Mol",],  family=binomial(link="logit"))
#summary(log.reg.Q2.IFD.raw.Mol)

#SINGLE BIV LEVELs
male.bivdata.2CO_IFD <- Curated_BivData_male %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)

male.bivdata.2CO_IFD$Rec.group <- ifelse(grepl("PWD", male.bivdata.2CO_IFD$strain), 1, 
                                    ifelse(grepl("MSM", male.bivdata.2CO_IFD$strain), 1, 
                                            ifelse(grepl("SKIVE", male.bivdata.2CO_IFD$strain), 1, 0)))


Log.Q2.IFD.raw_bivdata <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD,  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata)

#Musc
Log.Q2.IFD.raw_bivdata.Musc <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Musc",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Musc)

#Mol
Log.Q2.IFD.raw_bivdata.Mol <- glm(Rec.group ~ IFD1_ABS,
              data=male.bivdata.2CO_IFD[male.bivdata.2CO_IFD$subsp == "Mol",],  family=binomial(link="logit"))
#summary(Log.Q2.IFD.raw.PER_bivdata.Mol)
```

```{r Q2.IFD.longbiv_glm, echo=FALSE, eval=FALSE}
#Full dataset
male.long.biv.2CO_IFD$strain <- factor(male.long.biv.2CO_IFD$strain, ordered = FALSE)

#single bivalent
Q2.glm_long.biv_M2.IFD.PER <- glm(IFD1_PER ~ strain, data= male.long.biv.2CO_IFD)
#summary(Q2.glm_long.biv_M2.IFD.PER)
#The PER.IFDs don't have significant strain effects
```

```{r Q2.t.test_IFD, echo=FALSE, eval=FALSE}

male.bivdata.2CO_IFD <- Curated_BivData %>% filter(sex== "male") %>% filter(species =="M.musculus") %>% filter(hand.foci.count == 2)
#t.tests for the Rec group
Curated_BivData$Rec.group <- ifelse(grepl("PWD male", Curated_BivData$category), 1, 
                                    ifelse(grepl("MSM male", Curated_BivData$category), 1,
                                           ifelse(grepl("SKIVE male",Curated_BivData$category),1, 0)))

#Curated_BivData <- add_IFD(Curated_BivData)
#THIS SHOULD ALREADY BE ADDED

#single biv level
Rec.group.BivData_IFD.PER_Ttest <- t.test(male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 1], 
                                 male.bivdata.2CO_IFD$IFD1_PER[male.bivdata.2CO_IFD$Rec.group == 0])
 
#Rec.group.BivData_IFD.PER_Ttest$p.value
#p-value < 2.2e-16

#MOUSE AVE  -- replace with mouse    mouse.avs_4MM,   male.av_4MM
Rec.group_IFD.PER_Ttest <- t.test(  (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "1"))$mean_IFD.2CO_PER, 
                                (mouse.avs_4MM %>% filter(sex == "male") %>% filter(Rec.group == "0"))$mean_IFD.2CO_PER )
 
#Rec.group_IFD.PER_Ttest$p.value 
#p-value = 6.872e-07
```

```{r Q2.IFD_short.removed_t.test, echo=FALSE, include=FALSE, eval=FALSE}
Short.removed_BivData_IFD.PER_Ttest <- t.test(Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 1], 
  Curated_BivData_short.IFD.removed$IFD1_PER[Curated_BivData_short.IFD.removed$Rec.group == 0])
 
Short.removed_BivData_IFD.PER_Ttest$p.value

#
Short.removed_BivData_IFD.PER_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                       close.IFD.rates.mus.rate$mean.perIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
Short.removed_BivData_IFD.PER_Ttest_mus.av$p.value


Short.removed_BivData_IFD.ABS_Ttest_mus.av <- t.test(close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 1], 
                                 close.IFD.rates.mus.rate$mean.absIFD_short.rm[close.IFD.rates.mus.rate$Rec.group == 0])
```


# SAVE the data

```{r Save.File, echo=FALSE}
#save Rdata
save.image("~./MLH1repo/data/Results_setup_4.21.20.RData")

```

