---
title: "Between Cell Variance"
author: "April Peterson"
date: 
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#library(tidyverse)
library(knitr)
library(ggplot2)
#library(pwr)
library(purrr) #for replicate
library(dplyr)
library(plyr)
library(lattice)
library(tidyr)
library(raster)
library(lme4)
library(nlme)
library(RLRsim)
#library(ggpubr)
library(reshape2)
library(patchwork)
library(png)
library(grid)
library(gridBase)
library(gridExtra)
library(dplyr)
library(cowplot)
library(kableExtra)
library(xlsx)

library(ggpubr) #for arranging ggplots

#set wd
#load datafile

options(digits=2)

#setwd("~.")#switch over to here()

load(file="~./MLH1repo/data/Results_setup_4.24.20.RData")

load(file="~./MLH1repo/data/Results_setup_4.21.20.RData")

load(file="~./MLH1repo/data/CleanBivData_6.3.20.RData")
load(file="~./MLH1repo/data/total_SC_30.12.19.RData")

#skeletonize
SC.skel = read.csv("~./MLH1repo/data/SCskel_output_feb20.csv", header = TRUE, strip.white = TRUE)


#load functions
source("~./MLH1repo/src/CommonFunc_MLH1repo.R")
```

```{r female.strain.table, echo=FALSE}

female_mouse.avs_for.analysis <- female_mouse.avs_for.analysis %>% filter(strain != "CAST")
#female strain table
#female_mouse.avs_for.analysis
F.strain.table <- ddply(female_mouse.avs_for.analysis, c("strain"), summarise,
                       
                        Nmice = length(unique(mouse)),
                        
                        total.cells  = sum(Ncells, na.rm = TRUE),
                        
                        mouse.mean_co = mean(mean_co, na.rm=TRUE),
                       
                        mean.mouse_cV = mean(cV, na.rm = TRUE),
                        
                        mean.mouse_var = mean(var, na.rm = TRUE ), 
                        
                        mean.mouse_sd   = mean(sd, na.rm = TRUE ),
                       
                        #Standard error (mice vs cells)
                        mean.mouse_se  = mean(se, na.rm=TRUE)
    )

```

```{r mouse.var.plots.female, echo=FALSE, fig.width = 4, fig.height=2.5, warning=FALSE}

#variance plots
musc.female.VAR.plot <- ggplot( (female_mouse.avs_for.analysis %>% filter(sex== "female") %>% filter(subsp == "Musc") ) , aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Musc female of within mouse \nMLH1 variance")+scale_color_manual(values=colors_of_strains)


Mol.female.VAR.plot <- ggplot( (female_mouse.avs_for.analysis %>% filter(subsp == "Mol") ), aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Mol female\nwithin mouse MLH1 variance")+scale_color_manual(values=colors_of_strains)


Dom.female.VAR.plot <- ggplot(Dom.female_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain), width = .2 )+ ggtitle("Dom female\nwithin mouse \nMLH1 variance") + scale_color_manual(values=colors_of_strains)


```


```{r male.strain.table, echo=FALSE}

M.strain.table <- ddply(fomo.male_mouse.av, c("strain"), summarise,
                        Nmice =length(unique(mouse)),
                        
                        totNcells  = sum(Ncells, na.rm=TRUE),
                        
                        mean.mouse_mean_co = mean(mean_co, na.rm=TRUE),
                       
                        mean.mouse_cV = mean(cV, na.rm = TRUE),
                        
                        mean.mouse_var = mean(var, na.rm = TRUE ), 
                        
                        mean.mouse_sd   = mean(sd, na.rm=TRUE),
                       
                        #Standard error (mice . cells)
                        mean.mouse_se  = mean(se, na.rm=TRUE)
    )
#M.strain.table
#same issue as the female table .. ugh



```

```{r mouse.var.plots.male, echo=FALSE, fig.width = 4, fig.height=2.5, warning=FALSE}

#variance plots
OG.male.VAR.plot <- ggplot(M.strain.table, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Musc male of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)


Mol.male.VAR.plot <- ggplot(Mol.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Mol male of within mouse MLH1 distributions")+scale_color_manual(values=colors_of_strains)


Dom.male.VAR.plot <- ggplot(Dom.male_mouse.av, aes(color= strain))+geom_jitter(aes(x = as.factor(strain), y = var, color= strain, alpha=0.5), width = .2 )+ ggtitle("VAR Dom male ofwithin mouse  MLH1 distributions")+scale_color_manual(values=colors_of_strains)

```


> How much do CO counts vary among cells from the same individual?

> What factors shape between-cell variance in CO count?

The approach will use the same glm models as in Chapter 2. A motivation for addressing these questions is that the variance of a quantitative trait can impact the evolution.

Below is the table for the number of cells per category by quality score. For these between cell variance will just use those in quality 1-2.


```{r OG.table.qual.num, echo=FALSE}

table(MLH1_data$quality, MLH1_data$category, exclude = NULL)

```


# Q12 Variance Plots

The plots below show each point as a mouse-level CO count variance, calculated from Quality 1-2 cells. The number of cells per mouse is indicated by size.


```{r Q12.table.qual.num, echo=FALSE, warning=FALSE}

#high quality cells
Q12.MLH1_data <- MLH1_data %>% filter(quality < 3 )

Q12.MLH1_data$fileName <- Q12.MLH1_data$Original.Name

#table(Q12.MLH1_data$quality, Q12.MLH1_data$category, exclude = NULL)
#all this information is in the top table

#make mouse level table
FULL_mouse_table_Q12.MLH1 <- ddply(Q12.MLH1_data, c("mouse"), summarise,
                        
                        Nmice = length(unique(mouse)),
                        Ncells  = length(nMLH1.foci),
                        mean_co = as.numeric(format(round(  mean(nMLH1.foci), 3 ), nsmall=3) ),
                        cV = cv(nMLH1.foci),
                        var = as.numeric(format(round(   var(nMLH1.foci),3), nsmall=3)),
                        sd   = round(sd(nMLH1.foci), 3),
                        se   = round(sd / sqrt(Ncells), 3)
)

FULL_mouse_table_Q12.MLH1 <- add_strain(FULL_mouse_table_Q12.MLH1)
FULL_mouse_table_Q12.MLH1 <- add_subsp(FULL_mouse_table_Q12.MLH1)
FULL_mouse_table_Q12.MLH1 <- add_sex(FULL_mouse_table_Q12.MLH1)
FULL_mouse_table_Q12.MLH1 <- add_category(FULL_mouse_table_Q12.MLH1)
FULL_mouse_table_Q12.MLH1 <- add_species(FULL_mouse_table_Q12.MLH1)

```


```{r Q12.mouse.var.plots.male, echo=FALSE, fig.width = 6, fig.height=6, warning=FALSE}

#variance plots
#musc.male.VAR.plot  #%>% filter(subsp == "Musc") 

FULL.male.Var.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male") %>% filter(species == "M.musculus") ),
                             aes(color= strain, size = Ncells))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Musc male of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE) + facet_wrap(~ subsp, scales = "free")+ylim(c(0,55))


Dom.male.VAR.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male") %>% filter(subsp == "Dom")  ),
                             aes(color= strain, size = Ncells) ) +geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Dom male of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE)


mol.male.VAR.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male") %>% filter(subsp == "Mol")  ),
                             aes(color= strain, size = Ncells))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Mol male of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE)

FULL.male.Var.plot
```


```{r Q12.mouse.var.plots.female, echo=FALSE, fig.width = 5, fig.height=5, warning=FALSE}

FULL.female.Var.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female") %>% filter(species == "M.musculus") ),
                             aes(color= strain, size = Ncells))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Musc male of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE) + facet_wrap(~ subsp, scales = "free")+ylim(c(0,55))



#variance plots
musc.female.VAR.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female") %>% filter(subsp == "Musc")  ),
                             aes(color= strain, size = Ncells))+
  geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2, guide = FALSE )+ ggtitle("Q12 VAR Musc female of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE)


Dom.female.VAR.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female") %>% filter(subsp == "Dom")  ),
                             aes(color= strain, size = Ncells) ) +geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Dom female of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE)


mol.female.VAR.plot <- ggplot( ( FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female") %>% filter(subsp == "Mol")  ),
                             aes(color= strain, size = Ncells))+geom_jitter(aes(x = as.factor(strain), y =var, color= strain, alpha=0.5), width = .2 )+ ggtitle("Q12 VAR Mol female of within mouse\nMLH1 variance")+scale_color_manual(values=colors_of_strains, guide = FALSE)

FULL.female.Var.plot
```



# Models (var)

The same glm models are being applied to variance and cV (M1 to M3) and sex specific models (M4 and M5). Out groups and strains with just one sex have been removed for M1-M3. Al factors are unordered.


```{r model.set.up, echo=FALSE}

#FULL_mouse_table_Q12.MLH1
#sex-specific

FULL_mouse_table_Q12.MLH1$subsp <- factor(FULL_mouse_table_Q12.MLH1$subsp, ordered = FALSE)
FULL_mouse_table_Q12.MLH1$sex <- factor(FULL_mouse_table_Q12.MLH1$sex, ordered = FALSE)
FULL_mouse_table_Q12.MLH1$strain <- factor(FULL_mouse_table_Q12.MLH1$strain, ordered = FALSE)

#remove all the mice with fewer than 3cells
One.cell.mice <- FULL_mouse_table_Q12.MLH1 %>% filter(Ncells == 1)
oo <- FULL_mouse_table_Q12.MLH1[  ! FULL_mouse_table_Q12.MLH1$mouse %in% One.cell.mice$mouse, ]
```


```{r varMLH1co.lmer.MM1, echo=FALSE, waring=FALSE, message=FALSE, eval=TRUE}

#FULL_mouse_table_Q12.MLH1, remove molf not enough female

#DF.for.model <- ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  )

#these are all mouse level values

varMLH1.M1 <- lmer(var ~ subsp * sex + (1|strain), data= ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  )  )

varMLH1.MM.M1.reduce.sex <- lmer( var ~ subsp  +(1|strain), data= ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  ) )

varMLH1.MM.M1.reduce.subp <- lmer( var ~ sex  +(1|strain), data=( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  ) )

#summary(varMLH1.M1)$coefficients

varMLH1.MM_interaction <- drop1(varMLH1.M1, test="Chisq")$`Pr(Chi)`[2]
varMLH1.MM_sex <- anova(varMLH1.M1, varMLH1.MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
varMLH1.MM_subp <- anova(varMLH1.M1, varMLH1.MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
varMLH1.MM_strain<- MM.rand.pval <- exactRLRT(varMLH1.M1)$p.value 

varMLH1.MMlmer_results <- data.frame(sub.sp = varMLH1.MM_subp, 
sex.results =  varMLH1.MM_sex, 
               interaction.pval = varMLH1.MM_interaction,  rand.pval = 
varMLH1.MM_strain)

```

**M1** Mixed model result for the mouse level for: subspecies, sex, interaction and strain `r varMLH1.MMlmer_results`. (Sex is the most significant).


**M2**
```{r varMLH1.glm.M2, echo=FALSE, eval=TRUE}
remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")
#AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
#kkll <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

#strain = fixed, 
varMLH1.M2.glm.strain.fixed.full <- glm(var ~ subsp * sex * strain, data= FULL_mouse_table_Q12.MLH1[  ! FULL_mouse_table_Q12.MLH1$strain %in% remove_strains, ]   )

summ.varMLH1.M2.glm.strain.fixed.full <- summary(varMLH1.M2.glm.strain.fixed.full)
round(summ.varMLH1.M2.glm.strain.fixed.full$coefficients[,c(1,4)],5)
#adding cell number has some significant parts
```


**M3**
```{r varMLH1.glm.M3, echo=FALSE, eval=TRUE}
remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

varMLH1.M3.strain.fixed <- glm(var ~ sex * strain, data= FULL_mouse_table_Q12.MLH1[  ! FULL_mouse_table_Q12.MLH1$strain %in% remove_strains, ] )
                              
summ.MLH1.M3.strain.fixed <- summary(varMLH1.M3.strain.fixed)

round(summ.MLH1.M3.strain.fixed$coefficients[,c(1,4)],5)
#write.table(summ.strain.fixed$coefficients , "~./MLH1repo/summ.strain.fixed.csv", sep=",",row.names = TRUE)
```

LEW and G are slightly significant strain p values. Sex is also slightly significant. Intercept is also significant.

**M4-M5 female**
```{r Female.specific.MLHvar.glm, echo=FALSE, eval=TRUE}

Var.female.strain.subsp <- glm(var ~ subsp * strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female" ) %>% filter(species == "M.musculus") ) )

Var.summry.female.strain.effects <- summary(Var.female.strain.subsp)
round(Var.summry.female.strain.effects$coefficients[,c(1,4)],5)


varMLH1.female.glm.M2 <- glm(var ~ strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female" ) %>% filter(species == "M.musculus") ) )

sum_varMLH1.female.spc.glm.M2 <- summary(varMLH1.female.glm.M2)
round(sum_varMLH1.female.spc.glm.M2$coefficients[,c(1,4)],5)
```

Only the intercept's are significant in the female specific models. None of the subsp or strain effects are significant.

**M4-M5 male**

```{r Male.specific.MLHvar.glm, echo=FALSE, eval=TRUE}

#M4
varMLH1.male.glm.M4 <- glm(var ~ subsp * strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male" ) %>% filter(species == "M.musculus") ) )
sum_varMLH1.male.glm.M4 <- summary(varMLH1.male.glm.M4)
round(sum_varMLH1.male.glm.M4$coefficients[,c(1,4)],5)

#M4.2
varMLH1.male.glm.M4.2 <- glm(var ~ strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male" ) %>% filter(species == "M.musculus") ) )

sum_varMLH1.male.glm.M4.2 <- summary(varMLH1.male.glm.M4.2)
round(sum_varMLH1.male.glm.M4.2$coefficients[,c(1,4)],5)
```


There are no signifcant subspecies + strain effects for the male specific data.


# Models (cV)
```{r cVMLH1co.lmer.MM1, echo=FALSE, waring=FALSE, message=FALSE, eval=TRUE}

#FULL_mouse_table_Q12.MLH1, remove molf not enough female

#DF.for.model <- ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  )

#these are all mouse level values

cVMLH1.M1 <- lmer(cV ~ subsp * sex + (1|strain), data= ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  )  )

cVMLH1.MM.M1.reduce.sex <- lmer( cV ~ subsp  +(1|strain), data= ( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  ) )

cVMLH1.MM.M1.reduce.subp <- lmer( cV ~ sex  +(1|strain), data=( FULL_mouse_table_Q12.MLH1 %>% filter(species == "M.musculus")  %>% filter(strain != "MOLF") %>% filter(strain != "AST") %>% filter(strain != "HMI") %>% filter(strain != "CAST") %>% filter(strain != "CZECH")  ) )

#summary(varMLH1.M1)$coefficients

cVMLH1.MM_interaction <- drop1(varMLH1.M1, test="Chisq")$`Pr(Chi)`[2]
cVMLH1.MM_sex <- anova(varMLH1.M1, varMLH1.MM.M1.reduce.sex)$`Pr(>Chisq)`[2]
cVMLH1.MM_subp <- anova(varMLH1.M1, varMLH1.MM.M1.reduce.subp)$`Pr(>Chisq)`[2]
cVMLH1.MM_strain<- MM.rand.pval <- exactRLRT(varMLH1.M1)$p.value 

cVMLH1.MMlmer_results <- data.frame(sub.sp = cVMLH1.MM_subp, 
sex.results =  varMLH1.MM_sex, 
               interaction.pval = cVMLH1.MM_interaction,  rand.pval = 
cVMLH1.MM_strain)

```

**M1** Mixed model result for the mouse level for: subspecies, sex, interaction and strain `r cVMLH1.MMlmer_results`. (Sex is the most significant).


**M2**

```{r cVMLH1.glm.M2, echo=FALSE, eval=TRUE}
remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")
#AP_mouse_table.HQ_target <- AP_mouse_table.HQ_target[ ! AP_mouse_table.HQ_target$strain %in% remove_strains, ]
#kkll <- DF.HetC.MixedModel.HQ[! DF.HetC.MixedModel.HQ$strain %in% remove_strains,]

#strain = fixed, 
cVMLH1.M2.glm.strain.fixed.full <- glm(cV ~ subsp * sex * strain, data= FULL_mouse_table_Q12.MLH1[  ! FULL_mouse_table_Q12.MLH1$strain %in% remove_strains, ]   )

summ.cvMLH1.M2.glm.strain.fixed.full <- summary(cVMLH1.M2.glm.strain.fixed.full)
round(summ.cvMLH1.M2.glm.strain.fixed.full$coefficients[,c(1,4)],5)

#adding cell number has some significant parts
```


**M3**

```{r cVMLH1.glm.M3, echo=FALSE, eval=TRUE}
remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC")

cVMLH1.M3.strain.fixed <- glm(cV ~ sex * strain, data= FULL_mouse_table_Q12.MLH1[  ! FULL_mouse_table_Q12.MLH1$strain %in% remove_strains, ] )
                              
summ.cV.MLH1.M3.strain.fixed <- summary(cVMLH1.M3.strain.fixed)

round(summ.cV.MLH1.M3.strain.fixed$coefficients[,c(1,4)],5)

```

LEW and G are slightly significant strain p values. Sex is also slightly significant. Intercept is also significant.

**M4-M5 female**

```{r Female.specific.MLHcV.glm, echo=FALSE, eval=TRUE}

cV.female.strain.subsp <- glm(cV ~ subsp * strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female" ) %>% filter(species == "M.musculus") ) )

cV.summry.female.strain.effects <- summary(cV.female.strain.subsp)
round(cV.summry.female.strain.effects$coefficients[,c(1,4)],5)


cVMLH1.female.glm.M2 <- glm(cV ~ strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "female" ) %>% filter(species == "M.musculus") ) )

sum_cVMLH1.female.spc.glm.M2 <- summary(cVMLH1.female.glm.M2)
round(sum_cVMLH1.female.spc.glm.M2$coefficients[,c(1,4)],5)

```

Only the intercept's are significant in the female specific models. None of the subsp or strain effects are significant.

**M4-M5 male**

```{r Male.specific.MLHcV.glm, echo=FALSE, eval=TRUE}

#M4
cVMLH1.male.glm.M4 <- glm(cV ~ subsp * strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male" ) %>% filter(species == "M.musculus") ) )
sum_varMLH1.male.glm.M4 <- summary(varMLH1.male.glm.M4)
round(sum_varMLH1.male.glm.M4$coefficients[,c(1,4)],5)

#M4.2
cVMLH1.male.glm.M4.2 <- glm(cV ~ strain, data= (FULL_mouse_table_Q12.MLH1 %>% filter(sex == "male" ) %>% filter(species == "M.musculus") ) )

sum_cVMLH1.male.glm.M4.2 <- summary(cVMLH1.male.glm.M4.2)

round(sum_cVMLH1.male.glm.M4.2$coefficients[,c(1,4)],5)

```


<!-- Bret's suggestions / Permutations

On the question of variance in MLH1 count, I agree that it is crucial to reduce experimental noise to find a signal. 

I would suggest the following approach:
1. Consider only high-quality cells.

2. Pool cells within a strain and within a sex and compute one estimate of the variance in MLH1 count for each sex in each strain.

3. Randomly permute cells among strains, keeping the structure of the dataset otherwise the same.

4. For each permutation, compute the among-strain variance in the MLH1 count variance (separately for each sex).
Compute the among-strain variance in the MLH1 count variance (separately for each sex) in your original data.
Compare your observed variance with the null distribution generated by permutations to compute a p-value (one for each sex).

-->


# Permutations


We'd like to know if the set of strains has bigger differences in between-cell variance than expected by chance. Your liner models provide one test, but they could suffer from small sample sizes per mouse. We can conduct a permutation test that enables you to pool all cells in each strain to increase the sample size.

#Permutation Step Up

Here's the permutation test I was imagining:
1. Separate the sexes.  

2. Pool all cells within a strain and compute the **variance for each strain**.  

3. Compute the **variance across strains** (VAS) of the variance within strains. This will leave you with a single estimate for the set of strains.

4. Randomly permute cells across strains. (pool all male cells, pool all female cells)  

5. For the permuted data set, pool all cells within a strain and compute the variance for each strain. (compute a variance for a strain, var( sample( all.female.cells, N.WSB.f ) ) ).

6. For the permuted data set, compute the variance across strains of the variance within strains. This will leave you with a single estimate for the set of strains.  

7. Repeat 4-6 10,000 times to establish a null distribution for the variance in variances.  

8. Compare observed variance in variances to null distribution.  


#observed values

```{r pool.cell.calq, echo=FALSE}

OG.vals_Q12.MLH1 <- ddply(Q12.MLH1_data, c("strain", "sex"), summarise,
                        
                        Nmice = length(unique(mouse)),
                        Ncells  = length(nMLH1.foci),
                        mean_co = as.numeric(format(round(mean(nMLH1.foci), 3), nsmall=3)),
                        cV = cv(nMLH1.foci),
                        var = as.numeric(format(round( var(nMLH1.foci),3), nsmall=3)),
                        sd   = round(sd(nMLH1.foci), 3),
                        se   = round(sd / sqrt(Ncells), 3)
)

OG.vals_Q12.MLH1 <- add_subsp(OG.vals_Q12.MLH1)
OG.vals_Q12.MLH1 <- add_species(OG.vals_Q12.MLH1)

#remove extra strains
remove.strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC", "MOLF")
vals_Q12.MLH1 <- OG.vals_Q12.MLH1[!OG.vals_Q12.MLH1$strain %in% remove.strains, ]

#for males and females, calq the total variance across the strain-specific var
Obs.f.VAS <- var( ( vals_Q12.MLH1 %>% filter(sex == "female") )$var )
Obs.m.VAS <- var( ( vals_Q12.MLH1 %>%  filter(sex == "male") )$var )

```


These are the female strain variances:  `r ( vals_Q12.MLH1 %>% filter(sex == "female") )$var`, the variance across strains (VAS) is `r Obs.f.VAS`.  


These are the male strain variances:  `r ( vals_Q12.MLH1 %>% filter(sex == "male") )$var`, the variance across strains (VAS) is `r Obs.m.VAS`. (For `r ( vals_Q12.MLH1 %>% filter(sex == "female") )$strain` respectively)


```{r str.of.DF, echo=FALSE, eval=TRUE}
#redundant
#remove_strains <- c("TOM","AST","CZECH","CAST","HMI","SPRET","CAROLI", "F1", "PERC", "SPIC", "MOLF")
#Q12.permute.DF <- Q12.MLH1_data[!Q12.MLH1_data$strain %in% remove_strains, ]

#Data structure (from the cell level data)
len.WSB.female <- length( ( Q12.MLH1_data %>% filter(strain == "WSB") %>% filter(sex == "female") )$fileName )
len.WSB.male <- length( ( Q12.MLH1_data %>% filter(strain == "WSB") %>% filter(sex == "male") )$fileName )

len.G.female <- length( ( Q12.MLH1_data %>% filter(strain == "LEW") %>% filter(sex == "female") )$fileName )
len.G.male <- length( ( Q12.MLH1_data %>% filter(strain == "WSB") %>% filter(sex == "male") )$fileName )

len.LEW.female <- length( ( Q12.MLH1_data %>% filter(strain == "LEW") %>% filter(sex == "female") )$fileName )
len.LEW.male <- length( ( Q12.MLH1_data %>% filter(strain == "LEW") %>% filter(sex == "male") )$fileName )

len.PWD.female <- length( ( Q12.MLH1_data %>% filter(strain == "PWD") %>% filter(sex == "female") )$fileName )
len.PWD.male <- length( ( Q12.MLH1_data %>% filter(strain == "PWD") %>% filter(sex == "male") )$fileName )

len.KAZ.female <- length( ( Q12.MLH1_data %>% filter(strain == "KAZ") %>% filter(sex == "female") )$fileName )
len.KAZ.male <- length( ( Q12.MLH1_data %>% filter(strain == "KAZ") %>% filter(sex == "male") )$fileName )

len.SKIVE.female <- length( ( Q12.MLH1_data %>% filter(strain == "SKIVE") %>% filter(sex == "female") )$fileName )
len.SKIVE.male <- length( ( Q12.MLH1_data %>% filter(strain == "SKIVE") %>% filter(sex == "male") )$fileName )

len.MSM.female <- length( ( Q12.MLH1_data %>% filter(strain == "MSM") %>% filter(sex == "female") )$fileName )
len.MSM.male <- length( ( Q12.MLH1_data %>% filter(strain == "MSM") %>% filter(sex == "male") )$fileName )

```

<!--
random permutations below, (COMPUTE the VAS)

For the permuted data set, **pool all cells within a strain (permuted strain ie defined by sample size?) and compute the variance for each strain**.  

6. For the permuted data set, compute the variance across strains of the variance within strains. This will leave you with a single estimate for the set of strains.  

7. Repeat 4-6 10,000 times to establish a null distribution for the variance in variances.  

8. Compare observed variance in variances to null distribution.  -->

# Permutation Output

```{r permutations2, echo=FALSE}
#I made a DF of strain X sex specific variance

nrepeat = 10000

#I need to sample within strain? -- then I feel like I need to change the sample size -- otherwise I'm just sampling all the same episodes

permuted.var <- data.frame( "wsb_f.var" = replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[ (Q12.MLH1_data$sex == "female")], len.WSB.female, replace = FALSE) ) ),
                            "wsb_m.var" =  replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"], len.WSB.male, replace = FALSE) ) ), 
  "lew_f.var" = replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"], len.LEW.female, replace = FALSE) ) ), 
  
  "lew_m.var" =  replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"], len.LEW.male, replace = FALSE) ) ), 
  
  "g_f.var" = replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"], len.G.female, replace = FALSE) ) ), 
  "g_m.var" =  replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"], len.G.male, replace = FALSE) ) ), 
  
  "pwd_f.var" = replicate(n=nrepeat, var( sample( Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"], len.PWD.female, replace = FALSE) ) ), 
  "pwd_m.var" =  replicate(n=nrepeat, var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"],len.PWD.male, replace = FALSE))),
  
  "kaz_f.var" = replicate(n=nrepeat,var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"],len.KAZ.female,replace = FALSE) ) ), 
  
  "kaz_m.var" =  replicate(n=nrepeat, var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"],len.KAZ.male, replace = FALSE)) ), 
  
  "skive_f.var" = replicate(n=nrepeat,var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"],len.SKIVE.female,replace = FALSE) ) ), 
  
  "skive_m.var" =  replicate(n=nrepeat,var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"],len.SKIVE.male, replace = FALSE) ) ),
  
  "msm_f.var" = replicate(n=nrepeat, var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "female"], len.MSM.female, replace = FALSE) ) ), "msm_m.var" =  replicate(n=nrepeat, var(sample(Q12.MLH1_data$nMLH1.foci[Q12.MLH1_data$sex == "male"], len.MSM.male, replace = FALSE) )   )  
  )

```


```{r functions.Chap3, echo=FALSE}
#formate the permuted DF, adding strain and sex to the DF

add_sex_chp3 <- function(dat){
  dframe <- dat
  dframe$sex <- "other"
  dframe$sex <- ifelse(grepl("f.", dframe$names), "female", 
                       ifelse(grepl("m.",dframe$names), "male", "other"))
  dframe$sex<- factor(dframe$sex, ordered = TRUE, levels =c( "female", "male"))
  return(dframe)
}

add_strain_Chap3 <- function(dat){
  dframe <- dat
  dframe$strain <- "other"
  dframe$strain <- ifelse(grepl("wsb", dframe$names), "WSB",
                    ifelse(grepl("g",dframe$names), "G",
                   ifelse(grepl("lew", dframe$names), "LEW",
                     ifelse(grepl("perc", dframe$names), "PERC",
                     ifelse(grepl("msm", dframe$names), "MSM",
                 ifelse(grepl("molf", dframe$names), "MOLF",
                     ifelse(grepl("skive", dframe$names), "SKIVE",      
                      ifelse(grepl("pwd", dframe$names), "PWD",
                  ifelse(grepl("kaz", dframe$names), "KAZ",
                   ifelse(grepl("tom", dframe$names), "TOM",
                  ifelse(grepl("ast", dframe$names), "AST",
                   ifelse(grepl("czech", dframe$names), "CZECH",
                    ifelse(grepl("cast", dframe$names), "CAST",
                   ifelse(grepl("hmi", dframe$names), "HMI",
                       ifelse(grepl("_SPRET_", dframe$names), "SPRET",
                       ifelse(grepl("_SPI_", dframe$names), "SPIC",
                                                                                                                                          ifelse(grepl("spic", dframe$names), "SPIC",
                                                                                                                                                 ifelse(grepl("_CAROLI_", dframe$names), "CAROLI",
                                 ifelse(grepl("F1_", dframe$names), "F1",         
                                   "other")))))))))))))))))))
  
  #the ordering factor below deletes all strain entries
  dframe$strain<- factor(dframe$strain, ordered = FALSE, levels =c( "WSB", "G", "LEW", "PERC",
                                                                   "PWD", "MSM", "MOLF","SKIVE", "KAZ", "TOM", "AST","CZECH",
                                                                   "CAST", "HMI",
                                                                   "SPRET", "SPIC", "CAROLI", "F1", "other") )
  return(dframe)
}


```


```{r pvals.VAS, echo=FALSE, warning=F, message=FALSE,  fig.width = 5, fig.height=5}

#need to merge all the pvales into a DF
#for(u in unique( OG.vals_Q12.MLH1$strain[ ( (OG.vals_Q12.MLH1$sex == "female") & (OG.vals_Q12.MLH1$species == "M.musculus") )] ) ){
#  print(u)
#  }

transposed.permuted <- t(permuted.var)

permuted.DF <- data.frame(names = row.names(transposed.permuted), transposed.permuted); rownames(transposed.permuted) <- NULL

permuted.DF <- add_sex_chp3(permuted.DF)
permuted.DF <- add_strain_Chap3(permuted.DF)

# 
VAS.F.permuted.DF <- permuted.DF %>% filter(sex == "female")
VAS.M.permuted.DF <- permuted.DF %>% filter(sex == "male")

#sampling.size <- nrepeat-3
#careful aboout matching the size of the dataframe!!

list.VAS_F <- c()
for(ff in 1:length(VAS.F.permuted.DF[,2:9997]) ){
  list.VAS_F[ff]  <- var( VAS.F.permuted.DF[,ff] )
}
#list of VAS
list.VAS_F.DF <- data.frame( "female.VAS" =  list.VAS_F)


list.VAS_M <- c()
for(mm in 1:length(VAS.M.permuted.DF[,2:9997]) ){
  
  perm.VAS.mm <- var( VAS.M.permuted.DF[,mm] )
  list.VAS_M[mm]  <- perm.VAS.mm
  
}
#p value is calculated for the distribution.

list.VAS_M.DF <- data.frame("male.VAS" = list.VAS_M)
#cbind the 2 VAS DF
Full.VAS <- cbind( list.VAS_F.DF, list.VAS_M.DF)

male.plot <- ggplot(Full.VAS, aes(x = male.VAS)) + geom_histogram() + geom_vline(xintercept = Obs.m.VAS ) + ggtitle("Male Variance Across Species")

female.plot <- ggplot(Full.VAS, aes(x = female.VAS)) + geom_histogram() + geom_vline(xintercept = Obs.f.VAS ) + ggtitle("Female Variance Across Species")

male.plot
female.plot
```


The plots above show the distributions of permuted VAS for 10,000 permutations, the vertical line shows the observed VAS. 

The proportion of permutations which are less than the oberserved VAS are `r sum(  Full.VAS$male.VAS <= Obs.m.VAS ) / nrepeat` and `r sum(  Full.VAS$female.VAS <= Obs.f.VAS ) / nrepeat`  for male and female respectively



```{r old.pval, echo=FALSE, eval=F}

F.strain.var <- c(0)
counter = 1
for(u in unique(permuted.DF$strain[permuted.DF$sex == "female"])){
  # print(u)
   
  F.strain.var[counter] <-  sum( ( permuted.DF %>% filter(sex == "female")  %>% filter(strain == u )  )[,2:1000]  <= ( OG.vals_Q12.MLH1 %>% filter(strain == u) %>% filter(sex == "female") )$var  ) / nrepeat
  counter = counter + 1
  #print(counter)
}
names(F.strain.var) <- unique( permuted.DF$strain[permuted.DF$sex == "female"]  )

#male loop
M.strain.var <- c(0)
counter = 1
for(u in unique(permuted.DF$strain[permuted.DF$sex == "male"])){
  # print(u)
  # print( sum( ( permuted.DF %>% filter(sex == "male")  %>% filter(strain == u )  )[,2:1000]  <= (    OG.vals_Q12.MLH1 %>% filter(strain == u) %>% filter(sex == "male") )$var  ) / nrepeat  )

  M.strain.var[counter] <-  sum( ( permuted.DF %>% filter(sex == "male")  %>% filter(strain == u )  )[,2:1000]  <= ( OG.vals_Q12.MLH1 %>% filter(strain == u) %>% filter(sex == "male") )$var  ) / nrepeat

  counter = counter + 1
  #print(counter)
}
names(M.strain.var) <- unique( permuted.DF$strain[permuted.DF$sex == "male"]  )

df.M.strain.var <- data.frame( vals = M.strain.var, strain = names(M.strain.var) )
df.F.strain.var <- data.frame( vals = F.strain.var, strain = names(F.strain.var) )

df.M.strain.var$sex <- "male"
df.F.strain.var$sex <- "female"

row.names(df.M.strain.var) <- c()
row.names(df.F.strain.var) <- c()

Strain.var.full <- rbind(df.M.strain.var, df.F.strain.var)

```


```{r p.vals, echo=FALSE, eval=FALSE}

p.val.WSB.f <- sum( (permuted.var$wsb.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "WSB") %>% filter(sex == "female") )$var )) / nrepeat

p.val.WSB.m <- sum( (permuted.var$wsb.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "WSB") %>% filter(sex == "male") )$var )) / nrepeat

p.val.G.f <- sum( (permuted.var$g.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "G") %>% filter(sex == "female") )$var )) / nrepeat
p.val.G.m <- sum( (permuted.var$g.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "G") %>% filter(sex == "male") )$var )) / nrepeat

p.val.LEW.f <- sum( (permuted.var$lew.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "LEW") %>% filter(sex == "female") )$var )) / nrepeat
p.val.LEW.m <- sum( (permuted.var$lew.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "LEW") %>% filter(sex == "male") )$var )) / nrepeat

p.val.KAZ.f <- sum( (permuted.var$kaz.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "KAZ") %>% filter(sex == "female") )$var )) / nrepeat
p.val.KAZ.m <- sum( (permuted.var$kaz.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "KAZ") %>% filter(sex == "male") )$var )) / nrepeat

p.val.SKIVE.f <- sum( (permuted.var$skive.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "SKIVE") %>% filter(sex == "female") )$var )) / nrepeat
p.val.SKIVE.m <- sum( (permuted.var$skive.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "SKIVE") %>% filter(sex == "male") )$var )) / nrepeat

p.val.PWD.f <- sum( (permuted.var$pwd.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "PWD") %>% filter(sex == "female") )$var )) / nrepeat
p.val.PWD.m <- sum( (permuted.var$pwd.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "PWD") %>% filter(sex == "male") )$var )) / nrepeat

#calculate p values
p.val.MSM.f <- sum( (permuted.var$msm.f.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "MSM") %>% filter(sex == "female") )$var )) / nrepeat
           
p.val.MSM.m <- sum( (permuted.var$msm.m.var <= ( OG.vals_Q12.MLH1 %>% filter(strain == "MSM") %>% filter(sex == "male") )$var )) / nrepeat


```



```{r plots.var.dist, echo=FALSE, eval=F, warning=FALSE, message=FALSE}

#good ref
#http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/

wsb.fff <- ggplot(permuted.var, aes(x = wsb_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "WSB") %>% filter(sex == "female") )$var ) +  
  geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "WSB") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

wsb.mmm <- ggplot(permuted.var, aes(x = wsb_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "WSB") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "WSB") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

lew.fff <- ggplot(permuted.var, aes(x = lew_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "LEW") %>% filter(sex == "female") )$var ) + geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "LEW") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)
  
#lew female observed var is greater than randomized
lew.mmm <- ggplot(permuted.var, aes(x = lew_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "LEW") %>% filter(sex == "male") )$var ) + geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "LEW") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)


g.fff <- ggplot(permuted.var, aes(x = g_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "G") %>% filter(sex == "female") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "G") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

#lew female observed var is greater than randomized
g.mmm <- ggplot(permuted.var, aes(x = g_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "G") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "G") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)


kaz.fff <- ggplot(permuted.var, aes(x = kaz_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "KAZ") %>% filter(sex == "female") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "KAZ") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

kaz.mmm <- ggplot(permuted.var, aes(x = kaz_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "KAZ") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "KAZ") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)


pwd.fff <- ggplot(permuted.var, aes(x = pwd_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "PWD") %>% filter(sex == "female") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "PWD") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

#pwd female oberserved variance is lower than the permutations.
pwd.mmm <- ggplot(permuted.var, aes(x = pwd_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "PWD") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "PWD") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)


skive.fff <- ggplot(permuted.var, aes(x = skive_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "SKIVE") %>% filter(sex == "female") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "SKIVE") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

skive.mmm <- ggplot(permuted.var, aes(x = skive_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "SKIVE") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "SKIVE") ) , aes(x=25, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)


msm.mmm <- ggplot(permuted.var, aes(x = msm_m.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "MSM") %>% filter(sex == "male") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "male") %>% filter(strain == "MSM") ) , aes(x=18, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

msm.fff <- ggplot(permuted.var, aes(x = msm_f.var))+ geom_histogram() + geom_vline(xintercept = (OG.vals_Q12.MLH1 %>% filter(strain == "MSM") %>% filter(sex == "female") )$var )+ geom_text(data= ( Strain.var.full %>% filter(sex == "female") %>% filter(strain == "MSM") ) , aes(x=18, y=80, label=vals),  colour="black", inherit.aes=FALSE, parse=FALSE)

#answer: The difference in CO means between wild and LL Pleucopus, is greater than if mice are randomized.


permutation.results <- ggarrange(wsb.fff, wsb.mmm,
          lew.fff, lew.mmm,
          g.fff, g.mmm, 
          kaz.fff, kaz.mmm,
          pwd.fff, pwd.mmm,
          skive.fff, skive.mmm, 
           msm.fff, msm.mmm + rremove("x.text"), 
          ncol = 4, nrow = 4)

annotate_figure(
  
  permutation.results, top = text_grob("permutations", color = "Black", face = "bold", size = 14) )


```




