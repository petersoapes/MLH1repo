---
title: "MLH1 data report "
author: "April Peterson"
date: "August 29, 2017"
output: github_document
---

TODO
data set up page; remove non quality observations

include is for blocking output messages. echo false is for silencing the code commands.
```{r setup, echo=FALSE, include = FALSE}
library(knitr)
library(ggplot2)
library(dplyr)
library(lattice)

#setwd("C:/Users/alpeterson7/Documents/MLH1repo")
load(file="MLH1_data_setup.RData")

```

#### goals of research
Measure nMLH1 foci per meiotic cell to estimate recombination rate for diverse strains of house mice (rodents). Comparisons the differences in recombination rates across sexes and genetic background to inform models of how meiotic recombination rates evolve. (insert small picture of meixyte)

### Goal / Discription of Report
Goal of this report;

> *to keep track of the number of images for each category and mouse*

This is important for getting an idea of the 'power' I have to accurately estimate MLH1 distributions across the categories of cells I am quantifying.

#### Discription of data and quantification process
data frames are loaded of MLH1 data 
imagename, mouse name, strain, sex, nMLH1.

quanti process. anonymized, given quality score

This is the text above the table, this will show category wide stats of current MLH1 data set.
```{r, fig.height=2, fig.width=4, echo=FALSE}
#use kable to make tables. warning this might not work for github Rmd.
kable(AP_strain_table)
```

### disctibutions based on quality

Assess pattern of quality score and nMLH1. why? The human scoring the cells may have introcudced biases by giving a higher quality to cells with more foci. Unbiased cell quality assignment, would not show a positive correlation with quality and nMLH1.

Quality score is 1 based, to a correlation of nMLH1 and quality will have a right dowward line.
```{r, scatter plots of nMLH1 by score, echo=FALSE}
#make lattice / plots seperated by strain and sex
#facet
qual_means <- MLH1_data %>% 
        group_by(category, quality) %>% 
        summarise(
          adj_nMLH1.foci = mean(adj_nMLH1.foci)
        )


p <- ggplot(MLH1_data,(aes(adj_nMLH1.foci,quality)))
p <- p + geom_point(stat = "identity")
p <- p  + geom_point(data = qual_means, colour="red") 
p <- p + facet_wrap(~ category)
p

```
hmm, not sure if scatter plots are the best for assessing this due to the discrite nature of nMLH1...
Red point displays the 

I ploted the mean of each quality bin with a red dot. From the pattern of the red dots, there is definately a negative relationship with quality and nMLH1 foci across the data. This is most pronounced in MSM males and least pronounced in G males. 

Potential solutions? admit that the quality criteria are stupid..? does RW's data have this pattern? should the data be transformed/adjusted? Will looking at these figures bias how I score here on out?!

> *do some mice have better quality cells?* *Does this cause bias in the data?*


```{r, fig.height=8, fig.width=4, echo=FALSE, fig.caption="histogrms"}
# do the same thing as above but geom_hist

histM <- ggplot(MLH1_data,(aes(adj_nMLH1.foci))) + xlim(c(16, 38))
histM <- histM + geom_histogram(stat = "bin", binwidth = 1)
histM <- histM + facet_wrap(~ category, ncol=2)
histM


```
bin width was adjusted to 1. x axis scale was adjusted.
It seems like there is a population of lower cells in MSM males. This could be from slides which had bad staining.


### power calqs
Find those old R scripts and recreate here.


### initial inferences of nMLH1 Patterns
(make boxplots, note differences, include caveats for low numbers or quality differences)

This Rmd file displays the boxplots of MLH1 distributions.

```{r, echo=FALSE, include = FALSE}
##FIX ORDER HERE (this should be put in the data setup script)
MLH1_data$strain<- factor(MLH1_data$strain,levels =c("G", "LEWES",
                                     "WSB", "PWD","MSM","CAST"), order=T )
#order the data frame
MLH1_data <- with(MLH1_data, MLH1_data[order(sex, strain),])
#set the order of another column, based on another variable (so that when)

MLH1_data <- MLH1_data %>%
  arrange(strain, sex, mouse) %>%
  mutate(file.name = factor(file.name)) #another category that you want the order to match
# sort your dataframe, by the focal categories
MLH1_data$mouse <- factor(MLH1_data$mouse, levels=unique(MLH1_data$mouse))

MLH1_by_F_strain <- MLH1_data[MLH1_data$sex == "female", ]
MLH1_by_M_strain <- MLH1_data[MLH1_data$sex == "male", ]
```

Below is a figure of boxplots all mice from current data batches.

```{r, echo=FALSE, fig.width=3.5, fig.height = 2}
# TODO, custom color the strains
bb <- ggplot(MLH1_data, aes(x = mouse, y = nMLH1.foci)) + 
  geom_boxplot(data = MLH1_data, aes(fill = factor(strain), color = factor(sex) ) ) + theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

bb
```

#### Assessing the number of cells per mouse

In this analysis each mouse will have a sample of cells that are used to estimate the *ture* distribution of nMLH1 foci per cell. Power calculations can be done to assess if the current sample of cells gives a good estimate of the true distrubtion of nMLH1 foci.


Below are the boxplots for female MLH1 distributions.

```{r, echo=FALSE}
ff <- ggplot(MLH1_by_F_strain, aes(x = mouse, y = nMLH1.foci)) + geom_boxplot(data = MLH1_by_F_strain, aes(fill = factor(strain) ) )+ theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
ff

```

Below are the boxplots for male MLH1 distributions.

```{r, echo=FALSE, fig.caption="boxplots of MLH1 distributions"}
mm <- ggplot(MLH1_by_M_strain, aes(x = mouse, y = nMLH1.foci)) + geom_boxplot(data = MLH1_by_F_strain, aes(fill = factor(strain) ) )+ theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
mm
```


```{r}

#q_cutoff_table <- ddply(MLH1_data, .(mouse), summarise,
 #                       total =  length(nMLH1.foci),
  #                      q5 = sum(as.numeric(quality) >= 4, na.rm = TRUE ), 
   #                     q_l3 = sum(as.numeric(as.numeric(quality)) <= 4, na.rm = TRUE)
#)
#q_cutoff_table
```

 figure will be generated below. this is the text above that prefaces it, how and why the figure(s) are set up.
 The following figure will display the boxplots of MLH1 distributions seperated by sexes. 
```{r, MLH1 box plots, fig.width=2, fig.height=3, fig.cap="this is the figure caption"}

```




text before the table for mouse specific tables. (make them smaller and more compact?)
```{r, mouse table}

```


```{r, MxF hetC plot}

```

